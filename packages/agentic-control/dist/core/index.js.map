{"version":3,"sources":["../../src/core/tokens.ts","../../src/core/errors.ts","../../src/core/validation.ts","../../src/core/config.ts","../../src/core/providers.ts","../../src/core/security.ts","../../src/core/subprocess.ts"],"names":["config","SandboxErrorCode","DockerErrorCode","ConfigErrorCode","loadEnvConfig","provider"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Intelligent Token Management for Multi-Organization GitHub Access\n *\n * This module provides automatic token switching based on repository organization.\n * ALL configuration is user-provided - no hardcoded organizations or tokens.\n *\n * Configuration methods (in priority order):\n * 1. Programmatic: setTokenConfig() / addOrganization()\n * 2. Config file: agentic.config.json with \"tokens\" section\n * 3. Environment variables: AGENTIC_ORG_<NAME>_TOKEN pattern\n *\n * @example Config file (agentic.config.json):\n * ```json\n * {\n *   \"tokens\": {\n *     \"organizations\": {\n *       \"MyOrg\": { \"name\": \"MyOrg\", \"tokenEnvVar\": \"GITHUB_MYORG_TOKEN\" },\n *       \"AnotherOrg\": { \"name\": \"AnotherOrg\", \"tokenEnvVar\": \"ANOTHER_TOKEN\" }\n *     },\n *     \"defaultTokenEnvVar\": \"GITHUB_TOKEN\",\n *     \"prReviewTokenEnvVar\": \"GITHUB_TOKEN\"\n *   }\n * }\n * ```\n *\n * @example Environment variables:\n * ```bash\n * # Define org-to-token mappings\n * export AGENTIC_ORG_MYORG_TOKEN=GITHUB_MYORG_TOKEN\n * export AGENTIC_ORG_ANOTHER_TOKEN=ANOTHER_ORG_PAT\n *\n * # Override defaults\n * export AGENTIC_DEFAULT_TOKEN=GITHUB_TOKEN\n * export AGENTIC_PR_REVIEW_TOKEN=GITHUB_TOKEN\n * ```\n */\n\nimport type { OrganizationConfig, Result, TokenConfig } from './types.js';\n\n// ============================================\n// Configuration State (NO HARDCODED VALUES)\n// ============================================\n\n/**\n * Default token configuration - uses standard GITHUB_TOKEN\n * Users MUST configure their own organizations\n */\nconst DEFAULT_CONFIG: TokenConfig = {\n  organizations: {}, // Empty by default - users configure their own\n  defaultTokenEnvVar: 'GITHUB_TOKEN',\n  prReviewTokenEnvVar: 'GITHUB_TOKEN',\n};\n\nlet currentConfig: TokenConfig = { ...DEFAULT_CONFIG };\n\n// ============================================\n// Environment Configuration Loading\n// ============================================\n\n/**\n * Load organization configs from environment variables\n *\n * Pattern: AGENTIC_ORG_<NAME>_TOKEN=<TOKEN_ENV_VAR_NAME>\n *\n * @example\n * AGENTIC_ORG_MYCOMPANY_TOKEN=GITHUB_MYCOMPANY_TOKEN\n * This maps \"mycompany\" org to use the value from GITHUB_MYCOMPANY_TOKEN env var\n */\nfunction loadEnvConfig(): void {\n  const orgPattern = /^AGENTIC_ORG_([A-Z0-9_]+)_TOKEN$/;\n\n  for (const [key, value] of Object.entries(process.env)) {\n    const match = key.match(orgPattern);\n    if (match?.[1] && value) {\n      // Convert UPPER_CASE to kebab-case for org name\n      const orgName = match[1].toLowerCase().replace(/_/g, '-');\n      if (!currentConfig.organizations[orgName]) {\n        currentConfig.organizations[orgName] = {\n          name: orgName,\n          tokenEnvVar: value,\n        };\n      }\n    }\n  }\n\n  // Override PR review token if specified\n  if (process.env.AGENTIC_PR_REVIEW_TOKEN) {\n    currentConfig.prReviewTokenEnvVar = process.env.AGENTIC_PR_REVIEW_TOKEN;\n  }\n\n  // Override default token if specified\n  if (process.env.AGENTIC_DEFAULT_TOKEN) {\n    currentConfig.defaultTokenEnvVar = process.env.AGENTIC_DEFAULT_TOKEN;\n  }\n}\n\n// Load env config on module initialization\nloadEnvConfig();\n\n// ============================================\n// Public Configuration API\n// ============================================\n\n/**\n * Get the current token configuration\n */\nexport function getTokenConfig(): TokenConfig {\n  return { ...currentConfig };\n}\n\n/**\n * Update the token configuration\n *\n * @example\n * setTokenConfig({\n *   organizations: {\n *     \"my-org\": { name: \"my-org\", tokenEnvVar: \"MY_ORG_TOKEN\" }\n *   },\n *   prReviewTokenEnvVar: \"PR_REVIEW_TOKEN\"\n * });\n */\nexport function setTokenConfig(config: Partial<TokenConfig>): void {\n  currentConfig = {\n    ...currentConfig,\n    ...config,\n    organizations: {\n      ...currentConfig.organizations,\n      ...config.organizations,\n    },\n  };\n}\n\n/**\n * Reset configuration to defaults (useful for testing)\n */\nexport function resetTokenConfig(): void {\n  currentConfig = { ...DEFAULT_CONFIG, organizations: {} };\n  loadEnvConfig();\n}\n\n/**\n * Add or update an organization configuration\n *\n * @example\n * addOrganization({\n *   name: \"my-company\",\n *   tokenEnvVar: \"GITHUB_MYCOMPANY_TOKEN\",\n *   defaultBranch: \"main\",\n *   isEnterprise: true\n * });\n */\nexport function addOrganization(org: OrganizationConfig): void {\n  currentConfig.organizations[org.name] = org;\n}\n\n/**\n * Remove an organization configuration\n */\nexport function removeOrganization(orgName: string): void {\n  delete currentConfig.organizations[orgName];\n}\n\n// ============================================\n// Organization Extraction\n// ============================================\n\n/**\n * Extract organization name from a repository URL or full name\n * Uses a safe regex pattern to prevent ReDoS attacks\n *\n * @example\n * extractOrg(\"https://github.com/my-org/my-repo\") // \"my-org\"\n * extractOrg(\"my-org/my-repo\") // \"my-org\"\n * extractOrg(\"git@github.com:my-org/my-repo.git\") // \"my-org\"\n */\nexport function extractOrg(repoUrl: string): string | null {\n  // Handle full GitHub URLs - safe pattern with character class restriction\n  const urlMatch = repoUrl.match(/github\\.com[/:]([a-zA-Z0-9_.-]+)/);\n  if (urlMatch?.[1]) {\n    return urlMatch[1];\n  }\n\n  // Handle owner/repo format\n  const shortMatch = repoUrl.match(/^([a-zA-Z0-9_.-]+)\\//);\n  if (shortMatch?.[1]) {\n    return shortMatch[1];\n  }\n\n  return null;\n}\n\n// ============================================\n// Token Resolution\n// ============================================\n\n/**\n * Get the token environment variable name for a given organization\n * Returns the default if org is not configured\n *\n * @param org - Organization name (case-insensitive)\n */\nexport function getTokenEnvVar(org: string): string {\n  // Try exact match first\n  const config = currentConfig.organizations[org];\n  if (config?.tokenEnvVar) {\n    return config.tokenEnvVar;\n  }\n\n  // Try case-insensitive match\n  const lowerOrg = org.toLowerCase();\n  for (const [key, value] of Object.entries(currentConfig.organizations)) {\n    if (key.toLowerCase() === lowerOrg && value.tokenEnvVar) {\n      return value.tokenEnvVar;\n    }\n  }\n\n  return currentConfig.defaultTokenEnvVar;\n}\n\n/**\n * Get the actual token value for an organization\n *\n * @param org - Organization name\n * @returns Token value or undefined if not set\n */\nexport function getTokenForOrg(org: string): string | undefined {\n  const envVar = getTokenEnvVar(org);\n  return process.env[envVar];\n}\n\n/**\n * Get the token for a repository URL\n * Automatically extracts the organization and returns the appropriate token\n *\n * @param repoUrl - Repository URL or owner/repo format\n * @returns Token value or undefined if not set\n *\n * @example\n * // If configured: addOrganization({ name: \"myorg\", tokenEnvVar: \"MYORG_TOKEN\" })\n * getTokenForRepo(\"https://github.com/myorg/my-repo\")\n * // Returns value of MYORG_TOKEN\n */\nexport function getTokenForRepo(repoUrl: string): string | undefined {\n  const org = extractOrg(repoUrl);\n  if (!org) {\n    return process.env[currentConfig.defaultTokenEnvVar];\n  }\n  return getTokenForOrg(org);\n}\n\n/**\n * Get the token that should be used for PR reviews\n * Ensures a consistent identity across all PR interactions\n *\n * @returns Token value or undefined if not set\n */\nexport function getPRReviewToken(): string | undefined {\n  return process.env[currentConfig.prReviewTokenEnvVar];\n}\n\n/**\n * Get the PR review token environment variable name\n */\nexport function getPRReviewTokenEnvVar(): string {\n  return currentConfig.prReviewTokenEnvVar;\n}\n\n// ============================================\n// Validation\n// ============================================\n\n/**\n * Validate that required tokens are available\n *\n * @param orgs - Organization names to validate (optional, validates all configured if not specified)\n * @returns Validation result with any missing tokens\n */\nexport function validateTokens(orgs?: string[]): Result<string[]> {\n  const missing: string[] = [];\n  const orgsToCheck = orgs ?? Object.keys(currentConfig.organizations);\n\n  for (const org of orgsToCheck) {\n    const token = getTokenForOrg(org);\n    if (!token) {\n      const envVar = getTokenEnvVar(org);\n      missing.push(`${org}: ${envVar} not set`);\n    }\n  }\n\n  // Check PR review token\n  if (!getPRReviewToken()) {\n    missing.push(`PR Review: ${currentConfig.prReviewTokenEnvVar} not set`);\n  }\n\n  // Check default token\n  if (!process.env[currentConfig.defaultTokenEnvVar]) {\n    missing.push(`Default: ${currentConfig.defaultTokenEnvVar} not set`);\n  }\n\n  return {\n    success: missing.length === 0,\n    data: missing,\n    error: missing.length > 0 ? `Missing tokens: ${missing.join(', ')}` : undefined,\n  };\n}\n\n// ============================================\n// Organization Configuration Access\n// ============================================\n\n/**\n * Get organization configuration (case-insensitive)\n */\nexport function getOrgConfig(org: string): OrganizationConfig | undefined {\n  // Try exact match first\n  if (currentConfig.organizations[org]) {\n    return currentConfig.organizations[org];\n  }\n\n  // Try case-insensitive match\n  const lowerOrg = org.toLowerCase();\n  for (const [key, value] of Object.entries(currentConfig.organizations)) {\n    if (key.toLowerCase() === lowerOrg) {\n      return value;\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Get all configured organizations\n */\nexport function getConfiguredOrgs(): string[] {\n  return Object.keys(currentConfig.organizations);\n}\n\n/**\n * Check if an organization is configured (case-insensitive)\n */\nexport function isOrgConfigured(org: string): boolean {\n  if (org in currentConfig.organizations) {\n    return true;\n  }\n\n  const lowerOrg = org.toLowerCase();\n  for (const key of Object.keys(currentConfig.organizations)) {\n    if (key.toLowerCase() === lowerOrg) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n// ============================================\n// Environment Helpers for Subprocesses\n// ============================================\n\n/**\n * Create environment variables object for a subprocess targeting a specific org\n * Useful when spawning child processes that need the correct GitHub token\n *\n * @param repoUrl - Repository URL to get token for\n * @returns Object with GH_TOKEN and GITHUB_TOKEN set\n *\n * @example\n * import { spawnSync } from 'node:child_process';\n * const proc = spawnSync('gh', ['pr', 'list'], {\n *   env: { ...process.env, ...getEnvForRepo(\"owner/repo\") }\n * });\n */\nexport function getEnvForRepo(repoUrl: string): Record<string, string> {\n  const token = getTokenForRepo(repoUrl);\n  if (!token) {\n    return {};\n  }\n  return {\n    GH_TOKEN: token,\n    GITHUB_TOKEN: token,\n  };\n}\n\n/**\n * Create environment variables for PR review operations\n * Uses the configured PR review identity\n *\n * @returns Object with GH_TOKEN and GITHUB_TOKEN set for PR review\n */\nexport function getEnvForPRReview(): Record<string, string> {\n  const token = getPRReviewToken();\n  if (!token) {\n    return {};\n  }\n  return {\n    GH_TOKEN: token,\n    GITHUB_TOKEN: token,\n  };\n}\n\n// ============================================\n// Convenience Utilities\n// ============================================\n\n/**\n * Check if we have a valid token for an organization\n */\nexport function hasTokenForOrg(org: string): boolean {\n  return !!getTokenForOrg(org);\n}\n\n/**\n * Check if we have a valid token for a repository\n */\nexport function hasTokenForRepo(repoUrl: string): boolean {\n  return !!getTokenForRepo(repoUrl);\n}\n\n/**\n * Get a summary of token availability for debugging/display\n */\nexport function getTokenSummary(): Record<\n  string,\n  { envVar: string; available: boolean; configured: boolean }\n> {\n  const summary: Record<string, { envVar: string; available: boolean; configured: boolean }> = {};\n\n  for (const org of getConfiguredOrgs()) {\n    const envVar = getTokenEnvVar(org);\n    summary[org] = {\n      envVar,\n      available: !!process.env[envVar],\n      configured: true,\n    };\n  }\n\n  summary._default = {\n    envVar: currentConfig.defaultTokenEnvVar,\n    available: !!process.env[currentConfig.defaultTokenEnvVar],\n    configured: true,\n  };\n\n  summary._pr_review = {\n    envVar: currentConfig.prReviewTokenEnvVar,\n    available: !!getPRReviewToken(),\n    configured: true,\n  };\n\n  return summary;\n}\n","/**\n * Typed error classes for agentic-control\n */\n\nexport enum SandboxErrorCode {\n  CONTAINER_CREATE_FAILED = 'CONTAINER_CREATE_FAILED',\n  CONTAINER_START_FAILED = 'CONTAINER_START_FAILED',\n  EXECUTION_TIMEOUT = 'EXECUTION_TIMEOUT',\n  MEMORY_LIMIT_EXCEEDED = 'MEMORY_LIMIT_EXCEEDED',\n  WORKSPACE_MOUNT_FAILED = 'WORKSPACE_MOUNT_FAILED',\n  OUTPUT_EXTRACTION_FAILED = 'OUTPUT_EXTRACTION_FAILED',\n  RUNTIME_NOT_FOUND = 'RUNTIME_NOT_FOUND',\n}\n\nexport class SandboxError extends Error {\n  constructor(\n    message: string,\n    public code: SandboxErrorCode,\n    public containerId?: string,\n    public override cause?: Error\n  ) {\n    super(message);\n    this.name = 'SandboxError';\n  }\n}\n\nexport enum DockerErrorCode {\n  BUILD_FAILED = 'BUILD_FAILED',\n  PUSH_FAILED = 'PUSH_FAILED',\n  PLATFORM_NOT_SUPPORTED = 'PLATFORM_NOT_SUPPORTED',\n  REGISTRY_AUTH_FAILED = 'REGISTRY_AUTH_FAILED',\n}\n\nexport class DockerBuildError extends Error {\n  constructor(\n    message: string,\n    public code: DockerErrorCode,\n    public dockerfile?: string,\n    public override cause?: Error\n  ) {\n    super(message);\n    this.name = 'DockerBuildError';\n  }\n}\n\nexport enum ConfigErrorCode {\n  INVALID_SCHEMA = 'INVALID_SCHEMA',\n  MISSING_REQUIRED_FIELD = 'MISSING_REQUIRED_FIELD',\n  INVALID_VALUE = 'INVALID_VALUE',\n  FILE_NOT_FOUND = 'FILE_NOT_FOUND',\n}\n\nexport class ConfigurationError extends Error {\n  constructor(\n    message: string,\n    public code: ConfigErrorCode,\n    public field?: string,\n    public override cause?: Error\n  ) {\n    super(message);\n    this.name = 'ConfigurationError';\n  }\n}\n","/**\n * Configuration validation using Zod schemas\n */\n\nimport { z } from 'zod';\nimport { ConfigErrorCode, ConfigurationError } from './errors.js';\n\n// ============================================\n// Base Schemas\n// ============================================\n\nconst TokenOrgSchema = z.object({\n  name: z.string().min(1).max(39),\n  tokenEnvVar: z.string().min(1),\n});\n\nconst TokenConfigSchema = z.object({\n  organizations: z.record(z.string(), TokenOrgSchema).optional(),\n  defaultTokenEnvVar: z.string().optional(),\n  prReviewTokenEnvVar: z.string().optional(),\n});\n\nconst FleetConfigSchema = z.object({\n  autoCreatePr: z.boolean().optional(),\n  openAsCursorGithubApp: z.boolean().optional(),\n  skipReviewerRequest: z.boolean().optional(),\n});\n\nconst TriageConfigSchema = z.object({\n  provider: z.enum(['anthropic', 'openai', 'google', 'mistral', 'azure']).optional(),\n  model: z.string().optional(),\n  apiKeyEnvVar: z.string().optional(),\n});\n\nconst MCPServerConfigSchema = z.object({\n  enabled: z.boolean().optional(),\n  tokenEnvVar: z.string().optional(),\n  tokenEnvVarFallbacks: z.array(z.string()).optional(),\n  mode: z.enum(['stdio', 'proxy']).optional(),\n  command: z.string().optional(),\n  args: z.array(z.string()).optional(),\n  proxyUrl: z.string().url().optional(),\n});\n\nconst MCPConfigSchema = z\n  .object({\n    cursor: MCPServerConfigSchema.optional(),\n    github: MCPServerConfigSchema.optional(),\n    context7: MCPServerConfigSchema.optional(),\n    '21st-magic': MCPServerConfigSchema.optional(),\n  })\n  .catchall(MCPServerConfigSchema);\n\nconst CursorConfigSchema = z.object({\n  apiKeyEnvVar: z.string().optional(),\n  baseUrl: z.string().url().optional(),\n});\n\n// ============================================\n// Main Configuration Schema\n// ============================================\n\nexport const AgenticConfigSchema = z.object({\n  tokens: TokenConfigSchema.optional(),\n  defaultRepository: z.string().optional(),\n  coordinationPr: z.number().int().positive().optional(),\n  logLevel: z.enum(['debug', 'info', 'warn', 'error']).optional(),\n  verbose: z.boolean().optional(),\n  cursor: CursorConfigSchema.optional(),\n  fleet: FleetConfigSchema.optional(),\n  triage: TriageConfigSchema.optional(),\n  mcp: MCPConfigSchema.optional(),\n});\n\n// ============================================\n// Validation Functions\n// ============================================\n\n/**\n * Validate configuration object against schema\n */\nexport function validateConfig(config: unknown): void {\n  try {\n    AgenticConfigSchema.parse(config);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      const firstIssue = error.issues[0];\n      if (firstIssue) {\n        const field = firstIssue.path.join('.');\n        const message = `Invalid configuration at '${field}': ${firstIssue.message}`;\n        throw new ConfigurationError(message, ConfigErrorCode.INVALID_SCHEMA, field);\n      }\n      throw new ConfigurationError('Invalid configuration', ConfigErrorCode.INVALID_SCHEMA);\n    }\n    throw error;\n  }\n}\n\n/**\n * Validate environment variable exists and is not empty\n */\nexport function validateEnvVar(envVar: string, description?: string): string {\n  const value = process.env[envVar];\n\n  if (!value || value.trim() === '') {\n    const desc = description ?? envVar;\n    throw new ConfigurationError(\n      `Missing required environment variable: ${envVar}. Please set ${desc} to continue.`,\n      ConfigErrorCode.MISSING_REQUIRED_FIELD,\n      envVar\n    );\n  }\n\n  return value.trim();\n}\n\n/**\n * Validate environment variable with clear error message\n */\nexport function validateEnvVarWithMessage(envVar: string, purpose: string): string {\n  const value = process.env[envVar];\n\n  if (!value || value.trim() === '') {\n    throw new ConfigurationError(\n      `${purpose} requires ${envVar} environment variable. Please set it and try again.`,\n      ConfigErrorCode.MISSING_REQUIRED_FIELD,\n      envVar\n    );\n  }\n\n  return value.trim();\n}\n\n/**\n * Validate repository format (owner/repo)\n */\nexport function validateRepository(repo: string): void {\n  const repoPattern = /^[a-zA-Z0-9._-]+\\/[a-zA-Z0-9._-]+$/;\n\n  if (!repoPattern.test(repo)) {\n    throw new ConfigurationError(\n      `Invalid repository format: ${repo}. Expected format: owner/repo`,\n      ConfigErrorCode.INVALID_VALUE,\n      'repository'\n    );\n  }\n}\n\n/**\n * Validate git reference format\n */\nexport function validateGitRef(ref: string): void {\n  if (!/^[a-zA-Z0-9._/-]+$/.test(ref)) {\n    throw new ConfigurationError(\n      `Invalid git reference format: ${ref}`,\n      ConfigErrorCode.INVALID_VALUE,\n      'gitRef'\n    );\n  }\n\n  if (ref.length > 200) {\n    throw new ConfigurationError(\n      `Git reference too long: ${ref} (max 200 characters)`,\n      ConfigErrorCode.INVALID_VALUE,\n      'gitRef'\n    );\n  }\n}\n\n/**\n * Validate positive integer\n */\nexport function validatePositiveInt(value: string, field: string): number {\n  const parsed = Number.parseInt(value, 10);\n\n  if (Number.isNaN(parsed) || parsed <= 0) {\n    throw new ConfigurationError(\n      `${field} must be a positive integer, got: ${value}`,\n      ConfigErrorCode.INVALID_VALUE,\n      field\n    );\n  }\n\n  return parsed;\n}\n","/**\n * Configuration Management for agentic-control\n *\n * Uses cosmiconfig for standard config file discovery and loading.\n * Searches for configuration in:\n *   - agentic.config.json\n *   - agentic.config.js\n *   - agentic.config.cjs\n *   - .agenticrc\n *   - .agenticrc.json\n *   - package.json \"agentic\" key\n *\n * Priority: CLI args > env vars > config file > defaults\n *\n * @example Config file (agentic.config.json):\n * ```json\n * {\n *   \"tokens\": {\n *     \"organizations\": {\n *       \"my-org\": { \"name\": \"my-org\", \"tokenEnvVar\": \"MY_ORG_TOKEN\" }\n *     }\n *   },\n *   \"defaultModel\": \"claude-sonnet-4-20250514\",\n *   \"fleet\": {\n *     \"autoCreatePr\": true\n *   }\n * }\n * ```\n */\n\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { setTokenConfig } from './tokens.js';\nimport type { TokenConfig } from './types.js';\nimport { validateConfig } from './validation.js';\n\n// ============================================\n// Configuration Types\n// ============================================\n\nexport interface FleetConfig {\n  /** Auto-create PR when agent completes */\n  autoCreatePr?: boolean;\n  /** Open PR as Cursor GitHub App */\n  openAsCursorGithubApp?: boolean;\n  /** Skip adding user as reviewer */\n  skipReviewerRequest?: boolean;\n}\n\nexport interface TriageConfig {\n  /** AI provider: anthropic, openai, google, mistral, azure */\n  provider?: string;\n  /** Model ID for the provider */\n  model?: string;\n  /** API key environment variable name */\n  apiKeyEnvVar?: string;\n}\n\nexport interface MCPServerConfig {\n  /** Whether this MCP server is enabled */\n  enabled?: boolean;\n  /** Environment variable name for the API key/token */\n  tokenEnvVar?: string;\n  /** Fallback env vars to try if primary not found */\n  tokenEnvVarFallbacks?: string[];\n  /** Transport mode: stdio or proxy */\n  mode?: 'stdio' | 'proxy';\n  /** Command to run for stdio transport */\n  command?: string;\n  /** Arguments for the command */\n  args?: string[];\n  /** Proxy URL for proxy mode */\n  proxyUrl?: string;\n}\n\nexport interface MCPConfig {\n  /** Cursor Background Agent MCP */\n  cursor?: MCPServerConfig;\n  /** GitHub MCP */\n  github?: MCPServerConfig;\n  /** Context7 documentation MCP */\n  context7?: MCPServerConfig;\n  /** 21st.dev Magic MCP */\n  '21st-magic'?: MCPServerConfig;\n  /** Custom MCP servers */\n  [key: string]: MCPServerConfig | undefined;\n}\n\nexport interface RoleConfig {\n  /** Enable/disable the role */\n  enabled?: boolean;\n  /** Override the system prompt */\n  systemPrompt?: string;\n  /** Model override */\n  model?: string;\n}\n\nexport interface RolesConfig {\n  /** Sage role configuration */\n  sage?: RoleConfig;\n  /** Harvester role configuration */\n  harvester?: RoleConfig;\n  /** Curator role configuration */\n  curator?: RoleConfig;\n  /** Reviewer role configuration */\n  reviewer?: RoleConfig;\n  /** Fixer role configuration */\n  fixer?: RoleConfig;\n  /** Delegator role configuration */\n  delegator?: RoleConfig;\n}\n\nexport interface AgenticConfig {\n  /** Token configuration for multi-org access */\n  tokens?: Partial<TokenConfig>;\n\n  /** Default repository for fleet operations */\n  defaultRepository?: string;\n\n  /** Coordination PR number for fleet communication */\n  coordinationPr?: number;\n\n  /** Log level */\n  logLevel?: 'debug' | 'info' | 'warn' | 'error';\n\n  /** Whether to enable verbose output */\n  verbose?: boolean;\n\n  /** Cursor API configuration */\n  cursor?: {\n    /** API key environment variable name */\n    apiKeyEnvVar?: string;\n    /** Base URL for Cursor API */\n    baseUrl?: string;\n  };\n\n  /** Fleet default options */\n  fleet?: FleetConfig;\n\n  /** Triage (AI analysis) configuration */\n  triage?: TriageConfig;\n\n  /** MCP server configuration */\n  mcp?: MCPConfig;\n\n  /** Roles configuration */\n  roles?: RolesConfig;\n}\n\n// ============================================\n// Cosmiconfig Setup\n// ============================================\n\nconst MODULE_NAME = 'agentic';\n\n// Security: Only allow JSON config files to prevent code execution\n// JavaScript config files could execute arbitrary code during require()\nconst explorer = cosmiconfigSync(MODULE_NAME, {\n  searchPlaces: ['package.json', 'agentic.config.json', '.agenticrc', '.agenticrc.json'],\n  // Security: Disable loaders that execute code\n  loaders: {\n    '.json': (_filepath: string, content: string) => JSON.parse(content),\n  },\n});\n\n// ============================================\n// Configuration State\n// ============================================\n\nlet config: AgenticConfig = {};\nlet configLoaded = false;\nlet configPath: string | null = null;\n\n// ============================================\n// Environment Variable Loading\n// ============================================\n\nfunction loadEnvConfig(): Partial<AgenticConfig> {\n  const envConfig: Partial<AgenticConfig> = {};\n\n  // Build triage config from environment variables\n  const triageFromEnv: Partial<TriageConfig> = {};\n  if (process.env.AGENTIC_MODEL) {\n    triageFromEnv.model = process.env.AGENTIC_MODEL;\n  }\n  if (process.env.AGENTIC_PROVIDER) {\n    triageFromEnv.provider = process.env.AGENTIC_PROVIDER;\n  }\n  if (Object.keys(triageFromEnv).length > 0) {\n    envConfig.triage = triageFromEnv;\n  }\n\n  if (process.env.AGENTIC_REPOSITORY) {\n    envConfig.defaultRepository = process.env.AGENTIC_REPOSITORY;\n  }\n\n  if (process.env.AGENTIC_COORDINATION_PR) {\n    const parsed = Number.parseInt(process.env.AGENTIC_COORDINATION_PR, 10);\n    if (!Number.isNaN(parsed) && parsed > 0) {\n      envConfig.coordinationPr = parsed;\n    }\n  }\n\n  if (process.env.AGENTIC_LOG_LEVEL) {\n    const level = process.env.AGENTIC_LOG_LEVEL.toLowerCase();\n    if (['debug', 'info', 'warn', 'error'].includes(level)) {\n      envConfig.logLevel = level as AgenticConfig['logLevel'];\n    }\n  }\n\n  if (process.env.AGENTIC_VERBOSE === 'true' || process.env.AGENTIC_VERBOSE === '1') {\n    envConfig.verbose = true;\n  }\n\n  return envConfig;\n}\n\n// ============================================\n// Configuration Loading\n// ============================================\n\n/**\n * Deep merge configuration objects\n */\nfunction mergeConfig(base: AgenticConfig, overrides: Partial<AgenticConfig>): AgenticConfig {\n  const result = { ...base };\n\n  for (const [key, value] of Object.entries(overrides)) {\n    if (value === undefined) continue;\n\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      const baseValue = (base as Record<string, unknown>)[key];\n      // Only spread baseValue if it's a non-null object\n      const baseObj =\n        typeof baseValue === 'object' && baseValue !== null && !Array.isArray(baseValue)\n          ? baseValue\n          : {};\n      (result as Record<string, unknown>)[key] = {\n        ...baseObj,\n        ...value,\n      };\n    } else {\n      (result as Record<string, unknown>)[key] = value;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Initialize configuration from all sources\n * Priority: programmatic overrides > env vars > config file\n */\nexport function initConfig(overrides?: Partial<AgenticConfig>): AgenticConfig {\n  // Search for config file using cosmiconfig\n  const result = explorer.search();\n\n  if (result && !result.isEmpty) {\n    // Validate configuration before using it\n    validateConfig(result.config);\n    config = result.config as AgenticConfig;\n    configPath = result.filepath;\n  } else {\n    config = {};\n    configPath = null;\n  }\n\n  // Merge environment variables\n  const envConfig = loadEnvConfig();\n  config = mergeConfig(config, envConfig);\n\n  // Apply programmatic overrides\n  if (overrides) {\n    config = mergeConfig(config, overrides);\n  }\n\n  // Validate final configuration\n  validateConfig(config);\n\n  // Apply token configuration\n  if (config.tokens) {\n    setTokenConfig(config.tokens);\n  }\n\n  configLoaded = true;\n  return config;\n}\n\n/**\n * Load config from a specific file path\n */\nexport function loadConfigFromPath(filepath: string): AgenticConfig {\n  const result = explorer.load(filepath);\n\n  if (result && !result.isEmpty) {\n    // Validate configuration before using it\n    validateConfig(result.config);\n    config = result.config as AgenticConfig;\n    configPath = result.filepath;\n\n    if (config.tokens) {\n      setTokenConfig(config.tokens);\n    }\n\n    configLoaded = true;\n    return config;\n  }\n\n  throw new Error(`Failed to load config from ${filepath}`);\n}\n\n// ============================================\n// Public API\n// ============================================\n\n/**\n * Get the current configuration\n */\nexport function getConfig(): AgenticConfig {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return { ...config };\n}\n\n/**\n * Get path to loaded config file\n */\nexport function getConfigPath(): string | null {\n  return configPath;\n}\n\n/**\n * Update configuration at runtime\n */\nexport function setConfig(updates: Partial<AgenticConfig>): void {\n  config = mergeConfig(config, updates);\n\n  if (updates.tokens) {\n    setTokenConfig(updates.tokens);\n  }\n}\n\n/**\n * Reset configuration (useful for testing)\n */\nexport function resetConfig(): void {\n  config = {};\n  configLoaded = false;\n  configPath = null;\n}\n\n/**\n * Get a specific configuration value\n */\nexport function getConfigValue<K extends keyof AgenticConfig>(key: K): AgenticConfig[K] {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return config[key];\n}\n\n/**\n * Check if verbose mode is enabled\n */\nexport function isVerbose(): boolean {\n  return config.verbose ?? false;\n}\n\n/**\n * Get triage configuration\n */\nexport function getTriageConfig(): TriageConfig {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return (\n    config.triage ?? {\n      provider: 'anthropic',\n      model: 'claude-sonnet-4-20250514',\n      apiKeyEnvVar: 'ANTHROPIC_API_KEY',\n    }\n  );\n}\n\n/**\n * Get the default model for triage operations\n * @deprecated Use getTriageConfig() instead\n */\nexport function getDefaultModel(): string {\n  return getTriageConfig().model ?? 'claude-sonnet-4-20250514';\n}\n\n/**\n * Get fleet defaults\n */\nexport function getFleetDefaults(): FleetConfig {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return config.fleet ?? {};\n}\n\n/**\n * Get the log level\n */\nexport function getLogLevel(): string {\n  return config.logLevel ?? 'info';\n}\n\n/**\n * Get Cursor API key from configured environment variable\n */\nexport function getCursorApiKey(): string | undefined {\n  const envVar = config.cursor?.apiKeyEnvVar ?? 'CURSOR_API_KEY';\n  return process.env[envVar];\n}\n\n/**\n * Get default API key env var for a provider\n */\nexport function getDefaultApiKeyEnvVar(provider?: string): string {\n  switch (provider) {\n    case 'openai':\n      return 'OPENAI_API_KEY';\n    case 'google':\n      return 'GOOGLE_API_KEY';\n    case 'mistral':\n      return 'MISTRAL_API_KEY';\n    case 'azure':\n      return 'AZURE_API_KEY';\n    case 'ollama':\n      return 'OLLAMA_API_KEY';\n    default:\n      return 'ANTHROPIC_API_KEY';\n  }\n}\n\n/**\n * Get triage API key from configured environment variable\n * @param providerOverride - Optional provider to use instead of config value\n */\nexport function getTriageApiKey(providerOverride?: string): string | undefined {\n  const triageConfig = getTriageConfig();\n  const provider = providerOverride ?? triageConfig.provider;\n  const envVar = triageConfig.apiKeyEnvVar ?? getDefaultApiKeyEnvVar(provider);\n  return process.env[envVar];\n}\n\n// ============================================\n// Logging Utilities\n// ============================================\n\nconst LOG_LEVELS = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n};\n\nfunction shouldLog(level: keyof typeof LOG_LEVELS): boolean {\n  const currentLevel = LOG_LEVELS[getLogLevel() as keyof typeof LOG_LEVELS] ?? 1;\n  return LOG_LEVELS[level] >= currentLevel;\n}\n\nexport const log = {\n  debug: (...args: unknown[]): void => {\n    if (shouldLog('debug')) {\n      console.debug('[agentic:debug]', ...args);\n    }\n  },\n  info: (...args: unknown[]): void => {\n    if (shouldLog('info')) {\n      console.log('[agentic:info]', ...args);\n    }\n  },\n  warn: (...args: unknown[]): void => {\n    if (shouldLog('warn')) {\n      console.warn('[agentic:warn]', ...args);\n    }\n  },\n  error: (...args: unknown[]): void => {\n    if (shouldLog('error')) {\n      console.error('[agentic:error]', ...args);\n    }\n  },\n};\n","/**\n * AI Provider Loading - Shared provider utilities\n *\n * Supports multiple AI providers via Vercel AI SDK:\n * - anthropic (@ai-sdk/anthropic)\n * - openai (@ai-sdk/openai)\n * - google (@ai-sdk/google)\n * - mistral (@ai-sdk/mistral)\n * - azure (@ai-sdk/azure)\n * - ollama (ai-sdk-ollama) - for Ollama Cloud and local Ollama\n *\n * Install the provider you need:\n *   pnpm add @ai-sdk/anthropic\n *   pnpm add ai-sdk-ollama  # for Ollama support\n */\n\nimport { getDefaultApiKeyEnvVar, getTriageConfig } from './config.js';\n\n// ============================================\n// Types\n// ============================================\n\nexport type ProviderFactory = (config: { apiKey: string }) => unknown;\nexport type ModelFactory = (model: string) => unknown;\n\nexport type SupportedProvider = 'anthropic' | 'openai' | 'google' | 'mistral' | 'azure' | 'ollama';\n\nexport interface ProviderConfig {\n  package: string;\n  factory: string;\n}\n\n// ============================================\n// Provider Configuration\n// ============================================\n\n/**\n * Security: Explicit allowlist of supported providers and their packages.\n * Dynamic imports are only allowed for these pre-defined packages.\n */\nexport const PROVIDER_CONFIG: Record<SupportedProvider, ProviderConfig> = {\n  anthropic: { package: '@ai-sdk/anthropic', factory: 'createAnthropic' },\n  openai: { package: '@ai-sdk/openai', factory: 'createOpenAI' },\n  google: { package: '@ai-sdk/google', factory: 'createGoogleGenerativeAI' },\n  mistral: { package: '@ai-sdk/mistral', factory: 'createMistral' },\n  azure: { package: '@ai-sdk/azure', factory: 'createAzure' },\n  ollama: { package: 'ai-sdk-ollama', factory: 'createOllama' },\n} as const;\n\n/**\n * Ollama-specific configuration\n */\nexport const OLLAMA_CONFIG = {\n  /** Default model for Ollama Cloud (qwen3-coder has excellent tool support) */\n  defaultModel: 'qwen3-coder:480b-cloud',\n  /** Ollama Cloud API URL (SDK appends /api paths automatically) */\n  cloudHost: 'https://ollama.com',\n  /** Local Ollama API URL (SDK appends /api paths automatically) */\n  localHost: 'http://localhost:11434',\n  /** Enable reliable object generation with automatic JSON repair (v3.0.0+) */\n  reliableObjectGeneration: true,\n  /** Object generation options for better reliability */\n  objectGenerationOptions: {\n    /** Enable automatic JSON repair for malformed outputs */\n    enableTextRepair: true,\n    /** Maximum retries for object generation */\n    maxRetries: 3,\n  },\n} as const;\n\n/**\n * Check if a provider name is valid\n */\nexport function isValidProvider(name: string): name is SupportedProvider {\n  return name in PROVIDER_CONFIG;\n}\n\n/**\n * Get list of supported provider names\n */\nexport function getSupportedProviders(): SupportedProvider[] {\n  return Object.keys(PROVIDER_CONFIG) as SupportedProvider[];\n}\n\n// ============================================\n// Provider Loading\n// ============================================\n\n/**\n * Load an AI provider dynamically.\n *\n * @param providerName - Name of the provider (anthropic, openai, etc.)\n * @param apiKey - API key for the provider\n * @returns A function that creates a model instance\n * @throws Error if provider is unknown or package not installed\n */\nexport async function loadProvider(providerName: string, apiKey: string): Promise<ModelFactory> {\n  // Security: Validate provider name against explicit allowlist\n  if (!isValidProvider(providerName)) {\n    throw new Error(\n      `Unknown provider: ${providerName}\\n` +\n        `Supported providers: ${getSupportedProviders().join(', ')}`\n    );\n  }\n\n  const config = PROVIDER_CONFIG[providerName];\n\n  try {\n    // Security: Only import from pre-defined allowlist - no user input in import path\n    let module: Record<string, unknown>;\n    switch (providerName) {\n      case 'anthropic':\n        module = await import('@ai-sdk/anthropic');\n        break;\n      case 'openai':\n        module = await import('@ai-sdk/openai');\n        break;\n      case 'google':\n        module = await import('@ai-sdk/google');\n        break;\n      case 'mistral':\n        module = await import('@ai-sdk/mistral');\n        break;\n      case 'azure':\n        module = await import('@ai-sdk/azure');\n        break;\n      case 'ollama':\n        module = await import('ai-sdk-ollama');\n        break;\n      default:\n        // This should never happen due to isValidProvider check above\n        throw new Error(`Provider ${providerName} not implemented`);\n    }\n\n    const factory = module[config.factory] as ProviderFactory;\n\n    if (typeof factory !== 'function') {\n      throw new Error(`Factory ${config.factory} not found in ${config.package}`);\n    }\n\n    // Ollama provider has different config structure (ai-sdk-ollama v3.0.0+)\n    if (providerName === 'ollama') {\n      // Determine host URL based on API key presence\n      const host =\n        process.env.OLLAMA_HOST || (apiKey ? OLLAMA_CONFIG.cloudHost : OLLAMA_CONFIG.localHost);\n      // Normalize URL to remove any trailing slashes or /api path (SDK appends /api automatically)\n      const normalizedHost = host.replace(/\\/api\\/?$/, '').replace(/\\/$/, '');\n\n      // ai-sdk-ollama v3.0.0+ configuration with reliable object generation\n      type OllamaProviderFactory = (config: {\n        baseURL: string;\n        headers?: { Authorization: string };\n      }) => unknown;\n\n      // Model factory type with v3 options\n      type OllamaModelFactory = (\n        model: string,\n        options?: {\n          structuredOutputs?: boolean;\n          reliableObjectGeneration?: boolean;\n          objectGenerationOptions?: {\n            enableTextRepair?: boolean;\n            maxRetries?: number;\n          };\n        }\n      ) => unknown;\n\n      const provider = (factory as unknown as OllamaProviderFactory)({\n        baseURL: normalizedHost,\n        headers: apiKey ? { Authorization: `Bearer ${apiKey}` } : undefined,\n      });\n\n      // Return a model factory that applies reliability settings by default\n      return (model: string) =>\n        (provider as OllamaModelFactory)(model, {\n          // Enable reliable object generation with automatic JSON repair\n          reliableObjectGeneration: OLLAMA_CONFIG.reliableObjectGeneration,\n          objectGenerationOptions: OLLAMA_CONFIG.objectGenerationOptions,\n        });\n    }\n\n    const provider = factory({ apiKey });\n    return (model: string) => (provider as ModelFactory)(model);\n  } catch (err) {\n    if ((err as NodeJS.ErrnoException).code === 'ERR_MODULE_NOT_FOUND') {\n      throw new Error(\n        `Provider package not installed: ${config.package}\\n` +\n          `Install it with: pnpm add ${config.package}`\n      );\n    }\n    throw err;\n  }\n}\n\n// ============================================\n// Provider Instance Management\n// ============================================\n\n/**\n * Cached provider instances to avoid re-loading\n */\nconst providerCache = new Map<string, ModelFactory>();\n\n/**\n * Get or create a cached provider instance.\n *\n * @param providerName - Name of the provider\n * @param apiKey - API key for the provider\n * @returns A function that creates a model instance\n */\nexport async function getOrLoadProvider(\n  providerName: string,\n  apiKey: string\n): Promise<ModelFactory> {\n  const cacheKey = `${providerName}:${apiKey.slice(0, 8)}`;\n\n  let provider = providerCache.get(cacheKey);\n  if (!provider) {\n    provider = await loadProvider(providerName, apiKey);\n    providerCache.set(cacheKey, provider);\n  }\n\n  return provider;\n}\n\n/**\n * Clear the provider cache (useful for testing)\n */\nexport function clearProviderCache(): void {\n  providerCache.clear();\n}\n\n// ============================================\n// Configuration Helpers\n// ============================================\n\nexport interface ProviderOptions {\n  /** AI provider: anthropic, openai, google, mistral, azure, ollama */\n  provider?: string;\n  /** Model to use */\n  model?: string;\n  /** API key (defaults to provider-specific env var) */\n  apiKey?: string;\n}\n\n/**\n * Resolve provider options with defaults from config.\n *\n * @param options - User-provided options\n * @returns Resolved provider name, model, and API key\n * @throws Error if API key is not available\n */\nexport function resolveProviderOptions(options: ProviderOptions = {}): {\n  providerName: string;\n  model: string;\n  apiKey: string;\n} {\n  const triageConfig = getTriageConfig();\n\n  const providerName = options.provider ?? triageConfig.provider ?? 'anthropic';\n  const model = options.model ?? triageConfig.model ?? 'claude-sonnet-4-20250514';\n\n  // Determine the correct API key\n  const effectiveProvider = options.provider ?? triageConfig.provider ?? 'anthropic';\n  const envVarName =\n    options.provider && options.provider !== triageConfig.provider\n      ? getDefaultApiKeyEnvVar(effectiveProvider)\n      : (triageConfig.apiKeyEnvVar ?? getDefaultApiKeyEnvVar(effectiveProvider));\n\n  const apiKey = options.apiKey ?? process.env[envVarName] ?? '';\n\n  if (!apiKey) {\n    const hint = getDefaultApiKeyEnvVar(effectiveProvider);\n    throw new Error(\n      `API key required for ${providerName} provider.\\n` +\n        `Set ${hint} environment variable or pass apiKey option.`\n    );\n  }\n\n  return { providerName, model, apiKey };\n}\n","/**\n * Security utilities for safe error reporting and token sanitization\n */\n\n/**\n * Sanitize error messages to remove sensitive tokens\n */\nexport function sanitizeError(error: string | Error): string {\n  const message = error instanceof Error ? error.message : error;\n\n  // Patterns for common token formats\n  const tokenPatterns = [\n    // GitHub tokens: ghp_, gho_, ghu_, ghs_, ghr_\n    /gh[pous]_[A-Za-z0-9_]{36,}/g,\n    // GitHub fine-grained tokens: github_pat_\n    /github_pat_[A-Za-z0-9_]{82}/g,\n    // Anthropic API keys: sk-ant-\n    /sk-ant-[A-Za-z0-9_-]{95,}/g,\n    // OpenAI API keys: sk-\n    /sk-[A-Za-z0-9]{48,}/g,\n    // Generic API key patterns\n    /[A-Za-z0-9_-]{32,}/g,\n  ];\n\n  let sanitized = message;\n\n  for (const pattern of tokenPatterns) {\n    sanitized = sanitized.replace(pattern, '[REDACTED_TOKEN]');\n  }\n\n  return sanitized;\n}\n\n/**\n * Sanitize environment variables from error messages\n */\nexport function sanitizeEnvironment(\n  env: Record<string, string | undefined>\n): Record<string, string> {\n  const sanitized: Record<string, string> = {};\n\n  for (const [key, value] of Object.entries(env)) {\n    if (value === undefined) {\n      sanitized[key] = 'undefined';\n    } else if (\n      key.toLowerCase().includes('token') ||\n      key.toLowerCase().includes('key') ||\n      key.toLowerCase().includes('secret')\n    ) {\n      sanitized[key] = value ? '[REDACTED]' : '(not set)';\n    } else {\n      sanitized[key] = value;\n    }\n  }\n\n  return sanitized;\n}\n\n/**\n * Create a safe error for logging that removes sensitive information\n */\nexport function createSafeError(message: string, originalError?: Error): Error {\n  const sanitizedMessage = sanitizeError(message);\n  const error = new Error(sanitizedMessage);\n\n  if (originalError) {\n    error.cause = new Error(sanitizeError(originalError.message));\n    error.stack = originalError.stack ? sanitizeError(originalError.stack) : undefined;\n  }\n\n  return error;\n}\n\n/**\n * Safe console logging that sanitizes output\n */\nexport const safeConsole = {\n  log: (message: string, ...args: unknown[]) => {\n    console.log(\n      sanitizeError(message),\n      ...args.map((arg) => (typeof arg === 'string' ? sanitizeError(arg) : arg))\n    );\n  },\n\n  error: (message: string, ...args: unknown[]) => {\n    console.error(\n      sanitizeError(message),\n      ...args.map((arg) => (typeof arg === 'string' ? sanitizeError(arg) : arg))\n    );\n  },\n\n  warn: (message: string, ...args: unknown[]) => {\n    console.warn(\n      sanitizeError(message),\n      ...args.map((arg) => (typeof arg === 'string' ? sanitizeError(arg) : arg))\n    );\n  },\n};\n","/**\n * Safe subprocess execution utilities\n */\n\nimport { type SpawnOptions, type SpawnSyncOptions, spawn, spawnSync } from 'node:child_process';\nimport { sanitizeError } from './security.js';\n\n// ============================================\n// Safe Execution Functions\n// ============================================\n\n/**\n * Safely execute a command with array-based arguments (no shell interpolation)\n */\nexport function safeSpawnSync(\n  command: string,\n  args: string[] = [],\n  options: SpawnSyncOptions = {}\n): { success: boolean; stdout: string; stderr: string; code: number | null } {\n  // Validate inputs\n  if (typeof command !== 'string' || command.trim() === '') {\n    throw new Error('Command must be a non-empty string');\n  }\n\n  if (!Array.isArray(args)) {\n    throw new Error('Arguments must be an array');\n  }\n\n  // Ensure we don't use shell\n  const safeOptions: SpawnSyncOptions = {\n    ...options,\n    shell: false, // Explicitly disable shell to prevent injection\n    encoding: 'utf-8',\n  };\n\n  try {\n    const result = spawnSync(command, args, safeOptions);\n\n    return {\n      success: result.status === 0,\n      stdout: result.stdout?.toString() ?? '',\n      stderr: result.stderr?.toString() ?? '',\n      code: result.status,\n    };\n  } catch (error) {\n    const sanitizedError = sanitizeError(error instanceof Error ? error.message : String(error));\n    throw new Error(`Command execution failed: ${sanitizedError}`);\n  }\n}\n\n/**\n * Safely execute a command asynchronously with array-based arguments\n */\nexport function safeSpawn(\n  command: string,\n  args: string[] = [],\n  options: SpawnOptions = {}\n): Promise<{ success: boolean; stdout: string; stderr: string; code: number | null }> {\n  return new Promise((resolve, reject) => {\n    // Validate inputs\n    if (typeof command !== 'string' || command.trim() === '') {\n      reject(new Error('Command must be a non-empty string'));\n      return;\n    }\n\n    if (!Array.isArray(args)) {\n      reject(new Error('Arguments must be an array'));\n      return;\n    }\n\n    // Ensure we don't use shell\n    const safeOptions: SpawnOptions = {\n      ...options,\n      shell: false, // Explicitly disable shell to prevent injection\n    };\n\n    const child = spawn(command, args, safeOptions);\n\n    let stdout = '';\n    let stderr = '';\n\n    child.stdout?.on('data', (data) => {\n      stdout += data.toString();\n    });\n\n    child.stderr?.on('data', (data) => {\n      stderr += data.toString();\n    });\n\n    child.on('close', (code) => {\n      resolve({\n        success: code === 0,\n        stdout,\n        stderr,\n        code,\n      });\n    });\n\n    child.on('error', (error) => {\n      const sanitizedError = sanitizeError(error.message);\n      reject(new Error(`Command execution failed: ${sanitizedError}`));\n    });\n  });\n}\n\n/**\n * Validate command arguments to prevent injection\n */\nexport function validateCommandArgs(args: string[]): void {\n  for (const arg of args) {\n    if (typeof arg !== 'string') {\n      throw new Error('All command arguments must be strings');\n    }\n\n    // Check for potentially dangerous characters that could be used for injection\n    if (arg.includes('\\n') || arg.includes('\\r')) {\n      throw new Error('Command arguments cannot contain newline characters');\n    }\n\n    // Check for null bytes (common injection technique)\n    if (arg.includes('\\0')) {\n      throw new Error('Command arguments cannot contain null bytes');\n    }\n  }\n}\n\n/**\n * Safely execute git commands with validation\n */\nexport function safeGitCommand(args: string[], options: SpawnSyncOptions = {}) {\n  // Validate git arguments\n  validateCommandArgs(args);\n\n  // Additional git-specific validation\n  const allowedGitCommands = [\n    'diff',\n    'log',\n    'show',\n    'status',\n    'branch',\n    'remote',\n    'config',\n    'rev-parse',\n    'ls-remote',\n    'fetch',\n    'pull',\n    'push',\n    'clone',\n    'checkout',\n    'merge',\n    'rebase',\n    'commit',\n    'add',\n    'reset',\n  ];\n\n  const firstArg = args[0];\n  if (!firstArg || !allowedGitCommands.includes(firstArg)) {\n    throw new Error(`Git command not allowed: ${firstArg ?? '(empty)'}`);\n  }\n\n  return safeSpawnSync('git', args, options);\n}\n\n/**\n * Safely execute docker commands with validation\n */\nexport function safeDockerCommand(args: string[], options: SpawnSyncOptions = {}) {\n  // Validate docker arguments\n  validateCommandArgs(args);\n\n  // Additional docker-specific validation\n  const allowedDockerCommands = [\n    'build',\n    'run',\n    'exec',\n    'ps',\n    'images',\n    'pull',\n    'push',\n    'start',\n    'stop',\n    'restart',\n    'rm',\n    'rmi',\n    'logs',\n    'inspect',\n    'create',\n    'cp',\n    'stats',\n    'top',\n    'version',\n    'info',\n  ];\n\n  const firstArg = args[0];\n  if (!firstArg || !allowedDockerCommands.includes(firstArg)) {\n    throw new Error(`Docker command not allowed: ${firstArg ?? '(empty)'}`);\n  }\n\n  return safeSpawnSync('docker', args, options);\n}\n"]}