{"version":3,"sources":["../../src/core/security.ts","../../src/core/subprocess.ts","../../src/sandbox/container.ts","../../src/sandbox/runtime/claude.ts","../../src/sandbox/runtime/cursor.ts","../../src/sandbox/executor.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Security utilities for safe error reporting and token sanitization\n */\n\n/**\n * Sanitize error messages to remove sensitive tokens\n */\nexport function sanitizeError(error: string | Error): string {\n  const message = error instanceof Error ? error.message : error;\n\n  // Patterns for common token formats\n  const tokenPatterns = [\n    // GitHub tokens: ghp_, gho_, ghu_, ghs_, ghr_\n    /gh[pous]_[A-Za-z0-9_]{36,}/g,\n    // GitHub fine-grained tokens: github_pat_\n    /github_pat_[A-Za-z0-9_]{82}/g,\n    // Anthropic API keys: sk-ant-\n    /sk-ant-[A-Za-z0-9_-]{95,}/g,\n    // OpenAI API keys: sk-\n    /sk-[A-Za-z0-9]{48,}/g,\n    // Generic API key patterns\n    /[A-Za-z0-9_-]{32,}/g,\n  ];\n\n  let sanitized = message;\n\n  for (const pattern of tokenPatterns) {\n    sanitized = sanitized.replace(pattern, '[REDACTED_TOKEN]');\n  }\n\n  return sanitized;\n}\n\n/**\n * Sanitize environment variables from error messages\n */\nexport function sanitizeEnvironment(\n  env: Record<string, string | undefined>\n): Record<string, string> {\n  const sanitized: Record<string, string> = {};\n\n  for (const [key, value] of Object.entries(env)) {\n    if (value === undefined) {\n      sanitized[key] = 'undefined';\n    } else if (\n      key.toLowerCase().includes('token') ||\n      key.toLowerCase().includes('key') ||\n      key.toLowerCase().includes('secret')\n    ) {\n      sanitized[key] = value ? '[REDACTED]' : '(not set)';\n    } else {\n      sanitized[key] = value;\n    }\n  }\n\n  return sanitized;\n}\n\n/**\n * Create a safe error for logging that removes sensitive information\n */\nexport function createSafeError(message: string, originalError?: Error): Error {\n  const sanitizedMessage = sanitizeError(message);\n  const error = new Error(sanitizedMessage);\n\n  if (originalError) {\n    error.cause = new Error(sanitizeError(originalError.message));\n    error.stack = originalError.stack ? sanitizeError(originalError.stack) : undefined;\n  }\n\n  return error;\n}\n\n/**\n * Safe console logging that sanitizes output\n */\nexport const safeConsole = {\n  log: (message: string, ...args: unknown[]) => {\n    console.log(\n      sanitizeError(message),\n      ...args.map((arg) => (typeof arg === 'string' ? sanitizeError(arg) : arg))\n    );\n  },\n\n  error: (message: string, ...args: unknown[]) => {\n    console.error(\n      sanitizeError(message),\n      ...args.map((arg) => (typeof arg === 'string' ? sanitizeError(arg) : arg))\n    );\n  },\n\n  warn: (message: string, ...args: unknown[]) => {\n    console.warn(\n      sanitizeError(message),\n      ...args.map((arg) => (typeof arg === 'string' ? sanitizeError(arg) : arg))\n    );\n  },\n};\n","/**\n * Safe subprocess execution utilities\n */\n\nimport { type SpawnOptions, type SpawnSyncOptions, spawn, spawnSync } from 'node:child_process';\nimport { sanitizeError } from './security.js';\n\n// ============================================\n// Safe Execution Functions\n// ============================================\n\n/**\n * Safely execute a command with array-based arguments (no shell interpolation)\n */\nexport function safeSpawnSync(\n  command: string,\n  args: string[] = [],\n  options: SpawnSyncOptions = {}\n): { success: boolean; stdout: string; stderr: string; code: number | null } {\n  // Validate inputs\n  if (typeof command !== 'string' || command.trim() === '') {\n    throw new Error('Command must be a non-empty string');\n  }\n\n  if (!Array.isArray(args)) {\n    throw new Error('Arguments must be an array');\n  }\n\n  // Ensure we don't use shell\n  const safeOptions: SpawnSyncOptions = {\n    ...options,\n    shell: false, // Explicitly disable shell to prevent injection\n    encoding: 'utf-8',\n  };\n\n  try {\n    const result = spawnSync(command, args, safeOptions);\n\n    return {\n      success: result.status === 0,\n      stdout: result.stdout?.toString() ?? '',\n      stderr: result.stderr?.toString() ?? '',\n      code: result.status,\n    };\n  } catch (error) {\n    const sanitizedError = sanitizeError(error instanceof Error ? error.message : String(error));\n    throw new Error(`Command execution failed: ${sanitizedError}`);\n  }\n}\n\n/**\n * Safely execute a command asynchronously with array-based arguments\n */\nexport function safeSpawn(\n  command: string,\n  args: string[] = [],\n  options: SpawnOptions = {}\n): Promise<{ success: boolean; stdout: string; stderr: string; code: number | null }> {\n  return new Promise((resolve, reject) => {\n    // Validate inputs\n    if (typeof command !== 'string' || command.trim() === '') {\n      reject(new Error('Command must be a non-empty string'));\n      return;\n    }\n\n    if (!Array.isArray(args)) {\n      reject(new Error('Arguments must be an array'));\n      return;\n    }\n\n    // Ensure we don't use shell\n    const safeOptions: SpawnOptions = {\n      ...options,\n      shell: false, // Explicitly disable shell to prevent injection\n    };\n\n    const child = spawn(command, args, safeOptions);\n\n    let stdout = '';\n    let stderr = '';\n\n    child.stdout?.on('data', (data) => {\n      stdout += data.toString();\n    });\n\n    child.stderr?.on('data', (data) => {\n      stderr += data.toString();\n    });\n\n    child.on('close', (code) => {\n      resolve({\n        success: code === 0,\n        stdout,\n        stderr,\n        code,\n      });\n    });\n\n    child.on('error', (error) => {\n      const sanitizedError = sanitizeError(error.message);\n      reject(new Error(`Command execution failed: ${sanitizedError}`));\n    });\n  });\n}\n\n/**\n * Validate command arguments to prevent injection\n */\nexport function validateCommandArgs(args: string[]): void {\n  for (const arg of args) {\n    if (typeof arg !== 'string') {\n      throw new Error('All command arguments must be strings');\n    }\n\n    // Check for potentially dangerous characters that could be used for injection\n    if (arg.includes('\\n') || arg.includes('\\r')) {\n      throw new Error('Command arguments cannot contain newline characters');\n    }\n\n    // Check for null bytes (common injection technique)\n    if (arg.includes('\\0')) {\n      throw new Error('Command arguments cannot contain null bytes');\n    }\n  }\n}\n\n/**\n * Safely execute git commands with validation\n */\nexport function safeGitCommand(args: string[], options: SpawnSyncOptions = {}) {\n  // Validate git arguments\n  validateCommandArgs(args);\n\n  // Additional git-specific validation\n  const allowedGitCommands = [\n    'diff',\n    'log',\n    'show',\n    'status',\n    'branch',\n    'remote',\n    'config',\n    'rev-parse',\n    'ls-remote',\n    'fetch',\n    'pull',\n    'push',\n    'clone',\n    'checkout',\n    'merge',\n    'rebase',\n    'commit',\n    'add',\n    'reset',\n  ];\n\n  const firstArg = args[0];\n  if (!firstArg || !allowedGitCommands.includes(firstArg)) {\n    throw new Error(`Git command not allowed: ${firstArg ?? '(empty)'}`);\n  }\n\n  return safeSpawnSync('git', args, options);\n}\n\n/**\n * Safely execute docker commands with validation\n */\nexport function safeDockerCommand(args: string[], options: SpawnSyncOptions = {}) {\n  // Validate docker arguments\n  validateCommandArgs(args);\n\n  // Additional docker-specific validation\n  const allowedDockerCommands = [\n    'build',\n    'run',\n    'exec',\n    'ps',\n    'images',\n    'pull',\n    'push',\n    'start',\n    'stop',\n    'restart',\n    'rm',\n    'rmi',\n    'logs',\n    'inspect',\n    'create',\n    'cp',\n    'stats',\n    'top',\n    'version',\n    'info',\n  ];\n\n  const firstArg = args[0];\n  if (!firstArg || !allowedDockerCommands.includes(firstArg)) {\n    throw new Error(`Docker command not allowed: ${firstArg ?? '(empty)'}`);\n  }\n\n  return safeSpawnSync('docker', args, options);\n}\n","/**\n * Docker container lifecycle management\n */\n\nimport { randomUUID } from 'node:crypto';\nimport { safeDockerCommand, safeSpawn } from '../core/subprocess.js';\nimport type { ContainerConfig, ContainerResult } from './types.js';\n\nexport class ContainerManager {\n  async create(config: ContainerConfig): Promise<string> {\n    const containerId = `agentic-sandbox-${randomUUID().slice(0, 8)}`;\n\n    const dockerArgs = [\n      'create',\n      '--name',\n      containerId,\n      '--rm',\n      '--workdir',\n      '/workspace',\n      '-v',\n      `${config.workspace}:/workspace:ro`,\n      '-v',\n      `${config.outputDir}:/output`,\n    ];\n\n    // Add memory limit if specified\n    if (config.memory) {\n      dockerArgs.push('-m', `${config.memory}m`);\n    }\n\n    // Add environment variables\n    if (config.env) {\n      for (const [key, value] of Object.entries(config.env)) {\n        dockerArgs.push('-e', `${key}=${value}`);\n      }\n    }\n\n    // Use the appropriate image based on runtime\n    const image = this.getImageForRuntime(config.runtime);\n    dockerArgs.push(image);\n\n    const result = safeDockerCommand(dockerArgs);\n    if (!result.success) {\n      throw new Error(`Failed to create container: ${result.stderr}`);\n    }\n\n    return containerId;\n  }\n\n  async start(containerId: string): Promise<void> {\n    const result = safeDockerCommand(['start', containerId]);\n    if (!result.success) {\n      throw new Error(`Failed to start container ${containerId}: ${result.stderr}`);\n    }\n  }\n\n  async stop(containerId: string): Promise<void> {\n    const result = safeDockerCommand(['stop', containerId]);\n    if (!result.success) {\n      // Container might already be stopped, which is fine\n      console.warn(`Warning: Could not stop container ${containerId}: ${result.stderr}`);\n    }\n  }\n\n  async remove(containerId: string): Promise<void> {\n    const result = safeDockerCommand(['rm', '-f', containerId]);\n    if (!result.success) {\n      // Container might already be removed, which is fine\n      console.warn(`Warning: Could not remove container ${containerId}: ${result.stderr}`);\n    }\n  }\n\n  async exec(containerId: string, command: string[]): Promise<ContainerResult> {\n    const startTime = Date.now();\n\n    const dockerArgs = ['exec', containerId, ...command];\n\n    try {\n      const result = await safeSpawn('docker', dockerArgs);\n      const duration = Date.now() - startTime;\n\n      return {\n        success: result.success,\n        output: result.stdout,\n        error: result.stderr,\n        exitCode: result.code || 0,\n        duration,\n      };\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        exitCode: 1,\n        duration,\n      };\n    }\n  }\n\n  async logs(containerId: string): Promise<string> {\n    const result = safeDockerCommand(['logs', containerId]);\n    if (!result.success) {\n      throw new Error(`Failed to get logs for container ${containerId}: ${result.stderr}`);\n    }\n    return result.stdout;\n  }\n\n  private getImageForRuntime(runtime: string): string {\n    switch (runtime) {\n      case 'claude':\n      case 'cursor':\n        return 'jbcom/agentic-control:latest';\n      case 'custom':\n        return 'jbcom/agentic-control:latest';\n      default:\n        return 'jbcom/agentic-control:latest';\n    }\n  }\n}\n","/**\n * Claude runtime adapter for sandbox execution\n */\n\nimport type { AgentOutput, RuntimeAdapter, RuntimeOptions } from '../types.js';\n\nexport class ClaudeRuntime implements RuntimeAdapter {\n  readonly name = 'claude';\n  readonly image = 'jbcom/agentic-control:latest';\n\n  prepareCommand(prompt: string, options: RuntimeOptions): string[] {\n    const command = ['npx', '@anthropic-ai/claude-agent-sdk', 'query', '--prompt', prompt];\n\n    if (options.timeout) {\n      command.push('--timeout', options.timeout.toString());\n    }\n\n    return command;\n  }\n\n  parseOutput(stdout: string, stderr: string): AgentOutput {\n    try {\n      // Try to parse as JSON first\n      const parsed = JSON.parse(stdout);\n      return {\n        result: parsed.result || stdout,\n        files: parsed.files || [],\n        error: stderr || parsed.error,\n      };\n    } catch {\n      // Fallback to plain text\n      return {\n        result: stdout,\n        files: [],\n        error: stderr,\n      };\n    }\n  }\n\n  async validateEnvironment(): Promise<boolean> {\n    return !!process.env.ANTHROPIC_API_KEY;\n  }\n}\n","/**\n * Cursor runtime adapter for sandbox execution\n */\n\nimport type { AgentOutput, RuntimeAdapter, RuntimeOptions } from '../types.js';\n\nexport class CursorRuntime implements RuntimeAdapter {\n  readonly name = 'cursor';\n  readonly image = 'jbcom/agentic-control:latest';\n\n  prepareCommand(prompt: string, options: RuntimeOptions): string[] {\n    const command = ['cursor-agent', 'run', '--task', prompt];\n\n    if (options.timeout) {\n      command.push('--timeout', options.timeout.toString());\n    }\n\n    return command;\n  }\n\n  parseOutput(stdout: string, stderr: string): AgentOutput {\n    try {\n      // Try to parse as JSON first\n      const parsed = JSON.parse(stdout);\n      return {\n        result: parsed.result || stdout,\n        files: parsed.files || [],\n        error: stderr || parsed.error,\n      };\n    } catch {\n      // Fallback to plain text\n      return {\n        result: stdout,\n        files: [],\n        error: stderr,\n      };\n    }\n  }\n\n  async validateEnvironment(): Promise<boolean> {\n    return !!process.env.CURSOR_API_KEY;\n  }\n}\n","/**\n * Main sandbox executor for running AI agents in containers\n */\n\nimport { ContainerManager } from './container.js';\nimport { ClaudeRuntime, CursorRuntime } from './runtime/index.js';\nimport type { ContainerResult, RuntimeAdapter, SandboxOptions } from './types.js';\n\nexport class SandboxExecutor {\n  private containerManager: ContainerManager;\n  private runtimes: Map<string, RuntimeAdapter>;\n\n  constructor() {\n    this.containerManager = new ContainerManager();\n    this.runtimes = new Map<string, RuntimeAdapter>([\n      ['claude', new ClaudeRuntime()],\n      ['cursor', new CursorRuntime()],\n    ]);\n  }\n\n  async execute(options: SandboxOptions): Promise<ContainerResult> {\n    const runtime = this.runtimes.get(options.runtime);\n    if (!runtime) {\n      throw new Error(`Unknown runtime: ${options.runtime}`);\n    }\n\n    // Validate environment\n    const isValid = await runtime.validateEnvironment();\n    if (!isValid) {\n      throw new Error(`Environment validation failed for runtime: ${options.runtime}`);\n    }\n\n    const containerId = await this.containerManager.create({\n      runtime: options.runtime,\n      workspace: options.workspace,\n      outputDir: options.outputDir,\n      memory: options.memory,\n      timeout: options.timeout,\n      env: options.env,\n    });\n\n    try {\n      await this.containerManager.start(containerId);\n      const command = runtime.prepareCommand(options.prompt, {\n        timeout: options.timeout,\n        memory: options.memory,\n        env: options.env,\n      });\n\n      const result = await this.containerManager.exec(containerId, command);\n\n      // Parse the output using the runtime adapter\n      if (result.success && result.output) {\n        const parsed = runtime.parseOutput(result.output, result.error || '');\n        return {\n          ...result,\n          output: JSON.stringify(parsed),\n        };\n      }\n\n      return result;\n    } finally {\n      await this.containerManager.stop(containerId);\n      await this.containerManager.remove(containerId);\n    }\n  }\n\n  async executeFleet(options: SandboxOptions[]): Promise<ContainerResult[]> {\n    // Execute all sandboxes in parallel\n    const promises = options.map((option) => this.execute(option));\n    return Promise.all(promises);\n  }\n}\n"]}