{"version":3,"sources":["../../src/core/tokens.ts","../../src/core/errors.ts","../../src/core/validation.ts","../../src/core/config.ts","../../src/github/client.ts","../../src/fleet/cursor-api.ts","../../src/core/providers.ts","../../src/triage/analyzer.ts","../../src/handoff/manager.ts","../../src/core/security.ts","../../src/core/subprocess.ts","../../src/sandbox/container.ts","../../src/sandbox/runtime/claude.ts","../../src/sandbox/runtime/cursor.ts","../../src/sandbox/executor.ts","../../src/triage/agent.ts","../../src/triage/pr-triage-agent.ts","../../src/triage/types.ts"],"names":["config","loadEnvConfig","resolve","provider","z","spawnSync","sanitizeError","randomUUID","FeedbackSeveritySchema","FeedbackItemSchema","CIStatusSchema"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Intelligent Token Management for Multi-Organization GitHub Access\n *\n * This module provides automatic token switching based on repository organization.\n * ALL configuration is user-provided - no hardcoded organizations or tokens.\n *\n * Configuration methods (in priority order):\n * 1. Programmatic: setTokenConfig() / addOrganization()\n * 2. Config file: agentic.config.json with \"tokens\" section\n * 3. Environment variables: AGENTIC_ORG_<NAME>_TOKEN pattern\n *\n * @example Config file (agentic.config.json):\n * ```json\n * {\n *   \"tokens\": {\n *     \"organizations\": {\n *       \"MyOrg\": { \"name\": \"MyOrg\", \"tokenEnvVar\": \"GITHUB_MYORG_TOKEN\" },\n *       \"AnotherOrg\": { \"name\": \"AnotherOrg\", \"tokenEnvVar\": \"ANOTHER_TOKEN\" }\n *     },\n *     \"defaultTokenEnvVar\": \"GITHUB_TOKEN\",\n *     \"prReviewTokenEnvVar\": \"GITHUB_TOKEN\"\n *   }\n * }\n * ```\n *\n * @example Environment variables:\n * ```bash\n * # Define org-to-token mappings\n * export AGENTIC_ORG_MYORG_TOKEN=GITHUB_MYORG_TOKEN\n * export AGENTIC_ORG_ANOTHER_TOKEN=ANOTHER_ORG_PAT\n *\n * # Override defaults\n * export AGENTIC_DEFAULT_TOKEN=GITHUB_TOKEN\n * export AGENTIC_PR_REVIEW_TOKEN=GITHUB_TOKEN\n * ```\n */\n\nimport type { OrganizationConfig, Result, TokenConfig } from './types.js';\n\n// ============================================\n// Configuration State (NO HARDCODED VALUES)\n// ============================================\n\n/**\n * Default token configuration - uses standard GITHUB_TOKEN\n * Users MUST configure their own organizations\n */\nconst DEFAULT_CONFIG: TokenConfig = {\n  organizations: {}, // Empty by default - users configure their own\n  defaultTokenEnvVar: 'GITHUB_TOKEN',\n  prReviewTokenEnvVar: 'GITHUB_TOKEN',\n};\n\nlet currentConfig: TokenConfig = { ...DEFAULT_CONFIG };\n\n// ============================================\n// Environment Configuration Loading\n// ============================================\n\n/**\n * Load organization configs from environment variables\n *\n * Pattern: AGENTIC_ORG_<NAME>_TOKEN=<TOKEN_ENV_VAR_NAME>\n *\n * @example\n * AGENTIC_ORG_MYCOMPANY_TOKEN=GITHUB_MYCOMPANY_TOKEN\n * This maps \"mycompany\" org to use the value from GITHUB_MYCOMPANY_TOKEN env var\n */\nfunction loadEnvConfig(): void {\n  const orgPattern = /^AGENTIC_ORG_([A-Z0-9_]+)_TOKEN$/;\n\n  for (const [key, value] of Object.entries(process.env)) {\n    const match = key.match(orgPattern);\n    if (match?.[1] && value) {\n      // Convert UPPER_CASE to kebab-case for org name\n      const orgName = match[1].toLowerCase().replace(/_/g, '-');\n      if (!currentConfig.organizations[orgName]) {\n        currentConfig.organizations[orgName] = {\n          name: orgName,\n          tokenEnvVar: value,\n        };\n      }\n    }\n  }\n\n  // Override PR review token if specified\n  if (process.env.AGENTIC_PR_REVIEW_TOKEN) {\n    currentConfig.prReviewTokenEnvVar = process.env.AGENTIC_PR_REVIEW_TOKEN;\n  }\n\n  // Override default token if specified\n  if (process.env.AGENTIC_DEFAULT_TOKEN) {\n    currentConfig.defaultTokenEnvVar = process.env.AGENTIC_DEFAULT_TOKEN;\n  }\n}\n\n// Load env config on module initialization\nloadEnvConfig();\n\n// ============================================\n// Public Configuration API\n// ============================================\n\n/**\n * Get the current token configuration\n */\nexport function getTokenConfig(): TokenConfig {\n  return { ...currentConfig };\n}\n\n/**\n * Update the token configuration\n *\n * @example\n * setTokenConfig({\n *   organizations: {\n *     \"my-org\": { name: \"my-org\", tokenEnvVar: \"MY_ORG_TOKEN\" }\n *   },\n *   prReviewTokenEnvVar: \"PR_REVIEW_TOKEN\"\n * });\n */\nexport function setTokenConfig(config: Partial<TokenConfig>): void {\n  currentConfig = {\n    ...currentConfig,\n    ...config,\n    organizations: {\n      ...currentConfig.organizations,\n      ...config.organizations,\n    },\n  };\n}\n\n/**\n * Reset configuration to defaults (useful for testing)\n */\nexport function resetTokenConfig(): void {\n  currentConfig = { ...DEFAULT_CONFIG, organizations: {} };\n  loadEnvConfig();\n}\n\n/**\n * Add or update an organization configuration\n *\n * @example\n * addOrganization({\n *   name: \"my-company\",\n *   tokenEnvVar: \"GITHUB_MYCOMPANY_TOKEN\",\n *   defaultBranch: \"main\",\n *   isEnterprise: true\n * });\n */\nexport function addOrganization(org: OrganizationConfig): void {\n  currentConfig.organizations[org.name] = org;\n}\n\n/**\n * Remove an organization configuration\n */\nexport function removeOrganization(orgName: string): void {\n  delete currentConfig.organizations[orgName];\n}\n\n// ============================================\n// Organization Extraction\n// ============================================\n\n/**\n * Extract organization name from a repository URL or full name\n * Uses a safe regex pattern to prevent ReDoS attacks\n *\n * @example\n * extractOrg(\"https://github.com/my-org/my-repo\") // \"my-org\"\n * extractOrg(\"my-org/my-repo\") // \"my-org\"\n * extractOrg(\"git@github.com:my-org/my-repo.git\") // \"my-org\"\n */\nexport function extractOrg(repoUrl: string): string | null {\n  // Handle full GitHub URLs - safe pattern with character class restriction\n  const urlMatch = repoUrl.match(/github\\.com[/:]([a-zA-Z0-9_.-]+)/);\n  if (urlMatch?.[1]) {\n    return urlMatch[1];\n  }\n\n  // Handle owner/repo format\n  const shortMatch = repoUrl.match(/^([a-zA-Z0-9_.-]+)\\//);\n  if (shortMatch?.[1]) {\n    return shortMatch[1];\n  }\n\n  return null;\n}\n\n// ============================================\n// Token Resolution\n// ============================================\n\n/**\n * Get the token environment variable name for a given organization\n * Returns the default if org is not configured\n *\n * @param org - Organization name (case-insensitive)\n */\nexport function getTokenEnvVar(org: string): string {\n  // Try exact match first\n  const config = currentConfig.organizations[org];\n  if (config?.tokenEnvVar) {\n    return config.tokenEnvVar;\n  }\n\n  // Try case-insensitive match\n  const lowerOrg = org.toLowerCase();\n  for (const [key, value] of Object.entries(currentConfig.organizations)) {\n    if (key.toLowerCase() === lowerOrg && value.tokenEnvVar) {\n      return value.tokenEnvVar;\n    }\n  }\n\n  return currentConfig.defaultTokenEnvVar;\n}\n\n/**\n * Get the actual token value for an organization\n *\n * @param org - Organization name\n * @returns Token value or undefined if not set\n */\nexport function getTokenForOrg(org: string): string | undefined {\n  const envVar = getTokenEnvVar(org);\n  return process.env[envVar];\n}\n\n/**\n * Get the token for a repository URL\n * Automatically extracts the organization and returns the appropriate token\n *\n * @param repoUrl - Repository URL or owner/repo format\n * @returns Token value or undefined if not set\n *\n * @example\n * // If configured: addOrganization({ name: \"myorg\", tokenEnvVar: \"MYORG_TOKEN\" })\n * getTokenForRepo(\"https://github.com/myorg/my-repo\")\n * // Returns value of MYORG_TOKEN\n */\nexport function getTokenForRepo(repoUrl: string): string | undefined {\n  const org = extractOrg(repoUrl);\n  if (!org) {\n    return process.env[currentConfig.defaultTokenEnvVar];\n  }\n  return getTokenForOrg(org);\n}\n\n/**\n * Get the token that should be used for PR reviews\n * Ensures a consistent identity across all PR interactions\n *\n * @returns Token value or undefined if not set\n */\nexport function getPRReviewToken(): string | undefined {\n  return process.env[currentConfig.prReviewTokenEnvVar];\n}\n\n/**\n * Get the PR review token environment variable name\n */\nexport function getPRReviewTokenEnvVar(): string {\n  return currentConfig.prReviewTokenEnvVar;\n}\n\n// ============================================\n// Validation\n// ============================================\n\n/**\n * Validate that required tokens are available\n *\n * @param orgs - Organization names to validate (optional, validates all configured if not specified)\n * @returns Validation result with any missing tokens\n */\nexport function validateTokens(orgs?: string[]): Result<string[]> {\n  const missing: string[] = [];\n  const orgsToCheck = orgs ?? Object.keys(currentConfig.organizations);\n\n  for (const org of orgsToCheck) {\n    const token = getTokenForOrg(org);\n    if (!token) {\n      const envVar = getTokenEnvVar(org);\n      missing.push(`${org}: ${envVar} not set`);\n    }\n  }\n\n  // Check PR review token\n  if (!getPRReviewToken()) {\n    missing.push(`PR Review: ${currentConfig.prReviewTokenEnvVar} not set`);\n  }\n\n  // Check default token\n  if (!process.env[currentConfig.defaultTokenEnvVar]) {\n    missing.push(`Default: ${currentConfig.defaultTokenEnvVar} not set`);\n  }\n\n  return {\n    success: missing.length === 0,\n    data: missing,\n    error: missing.length > 0 ? `Missing tokens: ${missing.join(', ')}` : undefined,\n  };\n}\n\n// ============================================\n// Organization Configuration Access\n// ============================================\n\n/**\n * Get organization configuration (case-insensitive)\n */\nexport function getOrgConfig(org: string): OrganizationConfig | undefined {\n  // Try exact match first\n  if (currentConfig.organizations[org]) {\n    return currentConfig.organizations[org];\n  }\n\n  // Try case-insensitive match\n  const lowerOrg = org.toLowerCase();\n  for (const [key, value] of Object.entries(currentConfig.organizations)) {\n    if (key.toLowerCase() === lowerOrg) {\n      return value;\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Get all configured organizations\n */\nexport function getConfiguredOrgs(): string[] {\n  return Object.keys(currentConfig.organizations);\n}\n\n/**\n * Check if an organization is configured (case-insensitive)\n */\nexport function isOrgConfigured(org: string): boolean {\n  if (org in currentConfig.organizations) {\n    return true;\n  }\n\n  const lowerOrg = org.toLowerCase();\n  for (const key of Object.keys(currentConfig.organizations)) {\n    if (key.toLowerCase() === lowerOrg) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n// ============================================\n// Environment Helpers for Subprocesses\n// ============================================\n\n/**\n * Create environment variables object for a subprocess targeting a specific org\n * Useful when spawning child processes that need the correct GitHub token\n *\n * @param repoUrl - Repository URL to get token for\n * @returns Object with GH_TOKEN and GITHUB_TOKEN set\n *\n * @example\n * import { spawnSync } from 'node:child_process';\n * const proc = spawnSync('gh', ['pr', 'list'], {\n *   env: { ...process.env, ...getEnvForRepo(\"owner/repo\") }\n * });\n */\nexport function getEnvForRepo(repoUrl: string): Record<string, string> {\n  const token = getTokenForRepo(repoUrl);\n  if (!token) {\n    return {};\n  }\n  return {\n    GH_TOKEN: token,\n    GITHUB_TOKEN: token,\n  };\n}\n\n/**\n * Create environment variables for PR review operations\n * Uses the configured PR review identity\n *\n * @returns Object with GH_TOKEN and GITHUB_TOKEN set for PR review\n */\nexport function getEnvForPRReview(): Record<string, string> {\n  const token = getPRReviewToken();\n  if (!token) {\n    return {};\n  }\n  return {\n    GH_TOKEN: token,\n    GITHUB_TOKEN: token,\n  };\n}\n\n// ============================================\n// Convenience Utilities\n// ============================================\n\n/**\n * Check if we have a valid token for an organization\n */\nexport function hasTokenForOrg(org: string): boolean {\n  return !!getTokenForOrg(org);\n}\n\n/**\n * Check if we have a valid token for a repository\n */\nexport function hasTokenForRepo(repoUrl: string): boolean {\n  return !!getTokenForRepo(repoUrl);\n}\n\n/**\n * Get a summary of token availability for debugging/display\n */\nexport function getTokenSummary(): Record<\n  string,\n  { envVar: string; available: boolean; configured: boolean }\n> {\n  const summary: Record<string, { envVar: string; available: boolean; configured: boolean }> = {};\n\n  for (const org of getConfiguredOrgs()) {\n    const envVar = getTokenEnvVar(org);\n    summary[org] = {\n      envVar,\n      available: !!process.env[envVar],\n      configured: true,\n    };\n  }\n\n  summary._default = {\n    envVar: currentConfig.defaultTokenEnvVar,\n    available: !!process.env[currentConfig.defaultTokenEnvVar],\n    configured: true,\n  };\n\n  summary._pr_review = {\n    envVar: currentConfig.prReviewTokenEnvVar,\n    available: !!getPRReviewToken(),\n    configured: true,\n  };\n\n  return summary;\n}\n","/**\n * Typed error classes for agentic-control\n */\n\nexport enum SandboxErrorCode {\n  CONTAINER_CREATE_FAILED = 'CONTAINER_CREATE_FAILED',\n  CONTAINER_START_FAILED = 'CONTAINER_START_FAILED',\n  EXECUTION_TIMEOUT = 'EXECUTION_TIMEOUT',\n  MEMORY_LIMIT_EXCEEDED = 'MEMORY_LIMIT_EXCEEDED',\n  WORKSPACE_MOUNT_FAILED = 'WORKSPACE_MOUNT_FAILED',\n  OUTPUT_EXTRACTION_FAILED = 'OUTPUT_EXTRACTION_FAILED',\n  RUNTIME_NOT_FOUND = 'RUNTIME_NOT_FOUND',\n}\n\nexport class SandboxError extends Error {\n  constructor(\n    message: string,\n    public code: SandboxErrorCode,\n    public containerId?: string,\n    public override cause?: Error\n  ) {\n    super(message);\n    this.name = 'SandboxError';\n  }\n}\n\nexport enum DockerErrorCode {\n  BUILD_FAILED = 'BUILD_FAILED',\n  PUSH_FAILED = 'PUSH_FAILED',\n  PLATFORM_NOT_SUPPORTED = 'PLATFORM_NOT_SUPPORTED',\n  REGISTRY_AUTH_FAILED = 'REGISTRY_AUTH_FAILED',\n}\n\nexport class DockerBuildError extends Error {\n  constructor(\n    message: string,\n    public code: DockerErrorCode,\n    public dockerfile?: string,\n    public override cause?: Error\n  ) {\n    super(message);\n    this.name = 'DockerBuildError';\n  }\n}\n\nexport enum ConfigErrorCode {\n  INVALID_SCHEMA = 'INVALID_SCHEMA',\n  MISSING_REQUIRED_FIELD = 'MISSING_REQUIRED_FIELD',\n  INVALID_VALUE = 'INVALID_VALUE',\n  FILE_NOT_FOUND = 'FILE_NOT_FOUND',\n}\n\nexport class ConfigurationError extends Error {\n  constructor(\n    message: string,\n    public code: ConfigErrorCode,\n    public field?: string,\n    public override cause?: Error\n  ) {\n    super(message);\n    this.name = 'ConfigurationError';\n  }\n}\n","/**\n * Configuration validation using Zod schemas\n */\n\nimport { z } from 'zod';\nimport { ConfigErrorCode, ConfigurationError } from './errors.js';\n\n// ============================================\n// Base Schemas\n// ============================================\n\nconst TokenOrgSchema = z.object({\n  name: z.string().min(1).max(39),\n  tokenEnvVar: z.string().min(1),\n});\n\nconst TokenConfigSchema = z.object({\n  organizations: z.record(z.string(), TokenOrgSchema).optional(),\n  defaultTokenEnvVar: z.string().optional(),\n  prReviewTokenEnvVar: z.string().optional(),\n});\n\nconst FleetConfigSchema = z.object({\n  autoCreatePr: z.boolean().optional(),\n  openAsCursorGithubApp: z.boolean().optional(),\n  skipReviewerRequest: z.boolean().optional(),\n});\n\nconst TriageConfigSchema = z.object({\n  provider: z.enum(['anthropic', 'openai', 'google', 'mistral', 'azure']).optional(),\n  model: z.string().optional(),\n  apiKeyEnvVar: z.string().optional(),\n});\n\nconst MCPServerConfigSchema = z.object({\n  enabled: z.boolean().optional(),\n  tokenEnvVar: z.string().optional(),\n  tokenEnvVarFallbacks: z.array(z.string()).optional(),\n  mode: z.enum(['stdio', 'proxy']).optional(),\n  command: z.string().optional(),\n  args: z.array(z.string()).optional(),\n  proxyUrl: z.string().url().optional(),\n});\n\nconst MCPConfigSchema = z\n  .object({\n    cursor: MCPServerConfigSchema.optional(),\n    github: MCPServerConfigSchema.optional(),\n    context7: MCPServerConfigSchema.optional(),\n    '21st-magic': MCPServerConfigSchema.optional(),\n  })\n  .catchall(MCPServerConfigSchema);\n\nconst CursorConfigSchema = z.object({\n  apiKeyEnvVar: z.string().optional(),\n  baseUrl: z.string().url().optional(),\n});\n\n// ============================================\n// Main Configuration Schema\n// ============================================\n\nexport const AgenticConfigSchema = z.object({\n  tokens: TokenConfigSchema.optional(),\n  defaultRepository: z.string().optional(),\n  coordinationPr: z.number().int().positive().optional(),\n  logLevel: z.enum(['debug', 'info', 'warn', 'error']).optional(),\n  verbose: z.boolean().optional(),\n  cursor: CursorConfigSchema.optional(),\n  fleet: FleetConfigSchema.optional(),\n  triage: TriageConfigSchema.optional(),\n  mcp: MCPConfigSchema.optional(),\n});\n\n// ============================================\n// Validation Functions\n// ============================================\n\n/**\n * Validate configuration object against schema\n */\nexport function validateConfig(config: unknown): void {\n  try {\n    AgenticConfigSchema.parse(config);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      const firstIssue = error.issues[0];\n      if (firstIssue) {\n        const field = firstIssue.path.join('.');\n        const message = `Invalid configuration at '${field}': ${firstIssue.message}`;\n        throw new ConfigurationError(message, ConfigErrorCode.INVALID_SCHEMA, field);\n      }\n      throw new ConfigurationError('Invalid configuration', ConfigErrorCode.INVALID_SCHEMA);\n    }\n    throw error;\n  }\n}\n\n/**\n * Validate environment variable exists and is not empty\n */\nexport function validateEnvVar(envVar: string, description?: string): string {\n  const value = process.env[envVar];\n\n  if (!value || value.trim() === '') {\n    const desc = description ?? envVar;\n    throw new ConfigurationError(\n      `Missing required environment variable: ${envVar}. Please set ${desc} to continue.`,\n      ConfigErrorCode.MISSING_REQUIRED_FIELD,\n      envVar\n    );\n  }\n\n  return value.trim();\n}\n\n/**\n * Validate environment variable with clear error message\n */\nexport function validateEnvVarWithMessage(envVar: string, purpose: string): string {\n  const value = process.env[envVar];\n\n  if (!value || value.trim() === '') {\n    throw new ConfigurationError(\n      `${purpose} requires ${envVar} environment variable. Please set it and try again.`,\n      ConfigErrorCode.MISSING_REQUIRED_FIELD,\n      envVar\n    );\n  }\n\n  return value.trim();\n}\n\n/**\n * Validate repository format (owner/repo)\n */\nexport function validateRepository(repo: string): void {\n  const repoPattern = /^[a-zA-Z0-9._-]+\\/[a-zA-Z0-9._-]+$/;\n\n  if (!repoPattern.test(repo)) {\n    throw new ConfigurationError(\n      `Invalid repository format: ${repo}. Expected format: owner/repo`,\n      ConfigErrorCode.INVALID_VALUE,\n      'repository'\n    );\n  }\n}\n\n/**\n * Validate git reference format\n */\nexport function validateGitRef(ref: string): void {\n  if (!/^[a-zA-Z0-9._/-]+$/.test(ref)) {\n    throw new ConfigurationError(\n      `Invalid git reference format: ${ref}`,\n      ConfigErrorCode.INVALID_VALUE,\n      'gitRef'\n    );\n  }\n\n  if (ref.length > 200) {\n    throw new ConfigurationError(\n      `Git reference too long: ${ref} (max 200 characters)`,\n      ConfigErrorCode.INVALID_VALUE,\n      'gitRef'\n    );\n  }\n}\n\n/**\n * Validate positive integer\n */\nexport function validatePositiveInt(value: string, field: string): number {\n  const parsed = Number.parseInt(value, 10);\n\n  if (Number.isNaN(parsed) || parsed <= 0) {\n    throw new ConfigurationError(\n      `${field} must be a positive integer, got: ${value}`,\n      ConfigErrorCode.INVALID_VALUE,\n      field\n    );\n  }\n\n  return parsed;\n}\n","/**\n * Configuration Management for agentic-control\n *\n * Uses cosmiconfig for standard config file discovery and loading.\n * Searches for configuration in:\n *   - agentic.config.json\n *   - agentic.config.js\n *   - agentic.config.cjs\n *   - .agenticrc\n *   - .agenticrc.json\n *   - package.json \"agentic\" key\n *\n * Priority: CLI args > env vars > config file > defaults\n *\n * @example Config file (agentic.config.json):\n * ```json\n * {\n *   \"tokens\": {\n *     \"organizations\": {\n *       \"my-org\": { \"name\": \"my-org\", \"tokenEnvVar\": \"MY_ORG_TOKEN\" }\n *     }\n *   },\n *   \"defaultModel\": \"claude-sonnet-4-20250514\",\n *   \"fleet\": {\n *     \"autoCreatePr\": true\n *   }\n * }\n * ```\n */\n\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { setTokenConfig } from './tokens.js';\nimport type { TokenConfig } from './types.js';\nimport { validateConfig } from './validation.js';\n\n// ============================================\n// Configuration Types\n// ============================================\n\nexport interface FleetConfig {\n  /** Auto-create PR when agent completes */\n  autoCreatePr?: boolean;\n  /** Open PR as Cursor GitHub App */\n  openAsCursorGithubApp?: boolean;\n  /** Skip adding user as reviewer */\n  skipReviewerRequest?: boolean;\n}\n\nexport interface TriageConfig {\n  /** AI provider: anthropic, openai, google, mistral, azure */\n  provider?: string;\n  /** Model ID for the provider */\n  model?: string;\n  /** API key environment variable name */\n  apiKeyEnvVar?: string;\n}\n\nexport interface MCPServerConfig {\n  /** Whether this MCP server is enabled */\n  enabled?: boolean;\n  /** Environment variable name for the API key/token */\n  tokenEnvVar?: string;\n  /** Fallback env vars to try if primary not found */\n  tokenEnvVarFallbacks?: string[];\n  /** Transport mode: stdio or proxy */\n  mode?: 'stdio' | 'proxy';\n  /** Command to run for stdio transport */\n  command?: string;\n  /** Arguments for the command */\n  args?: string[];\n  /** Proxy URL for proxy mode */\n  proxyUrl?: string;\n}\n\nexport interface MCPConfig {\n  /** Cursor Background Agent MCP */\n  cursor?: MCPServerConfig;\n  /** GitHub MCP */\n  github?: MCPServerConfig;\n  /** Context7 documentation MCP */\n  context7?: MCPServerConfig;\n  /** 21st.dev Magic MCP */\n  '21st-magic'?: MCPServerConfig;\n  /** Custom MCP servers */\n  [key: string]: MCPServerConfig | undefined;\n}\n\nexport interface RoleConfig {\n  /** Enable/disable the role */\n  enabled?: boolean;\n  /** Override the system prompt */\n  systemPrompt?: string;\n  /** Model override */\n  model?: string;\n}\n\nexport interface RolesConfig {\n  /** Sage role configuration */\n  sage?: RoleConfig;\n  /** Harvester role configuration */\n  harvester?: RoleConfig;\n  /** Curator role configuration */\n  curator?: RoleConfig;\n  /** Reviewer role configuration */\n  reviewer?: RoleConfig;\n  /** Fixer role configuration */\n  fixer?: RoleConfig;\n  /** Delegator role configuration */\n  delegator?: RoleConfig;\n}\n\nexport interface AgenticConfig {\n  /** Token configuration for multi-org access */\n  tokens?: Partial<TokenConfig>;\n\n  /** Default repository for fleet operations */\n  defaultRepository?: string;\n\n  /** Coordination PR number for fleet communication */\n  coordinationPr?: number;\n\n  /** Log level */\n  logLevel?: 'debug' | 'info' | 'warn' | 'error';\n\n  /** Whether to enable verbose output */\n  verbose?: boolean;\n\n  /** Cursor API configuration */\n  cursor?: {\n    /** API key environment variable name */\n    apiKeyEnvVar?: string;\n    /** Base URL for Cursor API */\n    baseUrl?: string;\n  };\n\n  /** Fleet default options */\n  fleet?: FleetConfig;\n\n  /** Triage (AI analysis) configuration */\n  triage?: TriageConfig;\n\n  /** MCP server configuration */\n  mcp?: MCPConfig;\n\n  /** Roles configuration */\n  roles?: RolesConfig;\n}\n\n// ============================================\n// Cosmiconfig Setup\n// ============================================\n\nconst MODULE_NAME = 'agentic';\n\n// Security: Only allow JSON config files to prevent code execution\n// JavaScript config files could execute arbitrary code during require()\nconst explorer = cosmiconfigSync(MODULE_NAME, {\n  searchPlaces: ['package.json', 'agentic.config.json', '.agenticrc', '.agenticrc.json'],\n  // Security: Disable loaders that execute code\n  loaders: {\n    '.json': (_filepath: string, content: string) => JSON.parse(content),\n  },\n});\n\n// ============================================\n// Configuration State\n// ============================================\n\nlet config: AgenticConfig = {};\nlet configLoaded = false;\nlet configPath: string | null = null;\n\n// ============================================\n// Environment Variable Loading\n// ============================================\n\nfunction loadEnvConfig(): Partial<AgenticConfig> {\n  const envConfig: Partial<AgenticConfig> = {};\n\n  // Build triage config from environment variables\n  const triageFromEnv: Partial<TriageConfig> = {};\n  if (process.env.AGENTIC_MODEL) {\n    triageFromEnv.model = process.env.AGENTIC_MODEL;\n  }\n  if (process.env.AGENTIC_PROVIDER) {\n    triageFromEnv.provider = process.env.AGENTIC_PROVIDER;\n  }\n  if (Object.keys(triageFromEnv).length > 0) {\n    envConfig.triage = triageFromEnv;\n  }\n\n  if (process.env.AGENTIC_REPOSITORY) {\n    envConfig.defaultRepository = process.env.AGENTIC_REPOSITORY;\n  }\n\n  if (process.env.AGENTIC_COORDINATION_PR) {\n    const parsed = Number.parseInt(process.env.AGENTIC_COORDINATION_PR, 10);\n    if (!Number.isNaN(parsed) && parsed > 0) {\n      envConfig.coordinationPr = parsed;\n    }\n  }\n\n  if (process.env.AGENTIC_LOG_LEVEL) {\n    const level = process.env.AGENTIC_LOG_LEVEL.toLowerCase();\n    if (['debug', 'info', 'warn', 'error'].includes(level)) {\n      envConfig.logLevel = level as AgenticConfig['logLevel'];\n    }\n  }\n\n  if (process.env.AGENTIC_VERBOSE === 'true' || process.env.AGENTIC_VERBOSE === '1') {\n    envConfig.verbose = true;\n  }\n\n  return envConfig;\n}\n\n// ============================================\n// Configuration Loading\n// ============================================\n\n/**\n * Deep merge configuration objects\n */\nfunction mergeConfig(base: AgenticConfig, overrides: Partial<AgenticConfig>): AgenticConfig {\n  const result = { ...base };\n\n  for (const [key, value] of Object.entries(overrides)) {\n    if (value === undefined) continue;\n\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      const baseValue = (base as Record<string, unknown>)[key];\n      // Only spread baseValue if it's a non-null object\n      const baseObj =\n        typeof baseValue === 'object' && baseValue !== null && !Array.isArray(baseValue)\n          ? baseValue\n          : {};\n      (result as Record<string, unknown>)[key] = {\n        ...baseObj,\n        ...value,\n      };\n    } else {\n      (result as Record<string, unknown>)[key] = value;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Initialize configuration from all sources\n * Priority: programmatic overrides > env vars > config file\n */\nexport function initConfig(overrides?: Partial<AgenticConfig>): AgenticConfig {\n  // Search for config file using cosmiconfig\n  const result = explorer.search();\n\n  if (result && !result.isEmpty) {\n    // Validate configuration before using it\n    validateConfig(result.config);\n    config = result.config as AgenticConfig;\n    configPath = result.filepath;\n  } else {\n    config = {};\n    configPath = null;\n  }\n\n  // Merge environment variables\n  const envConfig = loadEnvConfig();\n  config = mergeConfig(config, envConfig);\n\n  // Apply programmatic overrides\n  if (overrides) {\n    config = mergeConfig(config, overrides);\n  }\n\n  // Validate final configuration\n  validateConfig(config);\n\n  // Apply token configuration\n  if (config.tokens) {\n    setTokenConfig(config.tokens);\n  }\n\n  configLoaded = true;\n  return config;\n}\n\n/**\n * Load config from a specific file path\n */\nexport function loadConfigFromPath(filepath: string): AgenticConfig {\n  const result = explorer.load(filepath);\n\n  if (result && !result.isEmpty) {\n    // Validate configuration before using it\n    validateConfig(result.config);\n    config = result.config as AgenticConfig;\n    configPath = result.filepath;\n\n    if (config.tokens) {\n      setTokenConfig(config.tokens);\n    }\n\n    configLoaded = true;\n    return config;\n  }\n\n  throw new Error(`Failed to load config from ${filepath}`);\n}\n\n// ============================================\n// Public API\n// ============================================\n\n/**\n * Get the current configuration\n */\nexport function getConfig(): AgenticConfig {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return { ...config };\n}\n\n/**\n * Get path to loaded config file\n */\nexport function getConfigPath(): string | null {\n  return configPath;\n}\n\n/**\n * Update configuration at runtime\n */\nexport function setConfig(updates: Partial<AgenticConfig>): void {\n  config = mergeConfig(config, updates);\n\n  if (updates.tokens) {\n    setTokenConfig(updates.tokens);\n  }\n}\n\n/**\n * Reset configuration (useful for testing)\n */\nexport function resetConfig(): void {\n  config = {};\n  configLoaded = false;\n  configPath = null;\n}\n\n/**\n * Get a specific configuration value\n */\nexport function getConfigValue<K extends keyof AgenticConfig>(key: K): AgenticConfig[K] {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return config[key];\n}\n\n/**\n * Check if verbose mode is enabled\n */\nexport function isVerbose(): boolean {\n  return config.verbose ?? false;\n}\n\n/**\n * Get triage configuration\n */\nexport function getTriageConfig(): TriageConfig {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return (\n    config.triage ?? {\n      provider: 'anthropic',\n      model: 'claude-sonnet-4-20250514',\n      apiKeyEnvVar: 'ANTHROPIC_API_KEY',\n    }\n  );\n}\n\n/**\n * Get the default model for triage operations\n * @deprecated Use getTriageConfig() instead\n */\nexport function getDefaultModel(): string {\n  return getTriageConfig().model ?? 'claude-sonnet-4-20250514';\n}\n\n/**\n * Get fleet defaults\n */\nexport function getFleetDefaults(): FleetConfig {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return config.fleet ?? {};\n}\n\n/**\n * Get the log level\n */\nexport function getLogLevel(): string {\n  return config.logLevel ?? 'info';\n}\n\n/**\n * Get Cursor API key from configured environment variable\n */\nexport function getCursorApiKey(): string | undefined {\n  const envVar = config.cursor?.apiKeyEnvVar ?? 'CURSOR_API_KEY';\n  return process.env[envVar];\n}\n\n/**\n * Get default API key env var for a provider\n */\nexport function getDefaultApiKeyEnvVar(provider?: string): string {\n  switch (provider) {\n    case 'openai':\n      return 'OPENAI_API_KEY';\n    case 'google':\n      return 'GOOGLE_API_KEY';\n    case 'mistral':\n      return 'MISTRAL_API_KEY';\n    case 'azure':\n      return 'AZURE_API_KEY';\n    case 'ollama':\n      return 'OLLAMA_API_KEY';\n    default:\n      return 'ANTHROPIC_API_KEY';\n  }\n}\n\n/**\n * Get triage API key from configured environment variable\n * @param providerOverride - Optional provider to use instead of config value\n */\nexport function getTriageApiKey(providerOverride?: string): string | undefined {\n  const triageConfig = getTriageConfig();\n  const provider = providerOverride ?? triageConfig.provider;\n  const envVar = triageConfig.apiKeyEnvVar ?? getDefaultApiKeyEnvVar(provider);\n  return process.env[envVar];\n}\n\n// ============================================\n// Logging Utilities\n// ============================================\n\nconst LOG_LEVELS = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n};\n\nfunction shouldLog(level: keyof typeof LOG_LEVELS): boolean {\n  const currentLevel = LOG_LEVELS[getLogLevel() as keyof typeof LOG_LEVELS] ?? 1;\n  return LOG_LEVELS[level] >= currentLevel;\n}\n\nexport const log = {\n  debug: (...args: unknown[]): void => {\n    if (shouldLog('debug')) {\n      console.debug('[agentic:debug]', ...args);\n    }\n  },\n  info: (...args: unknown[]): void => {\n    if (shouldLog('info')) {\n      console.log('[agentic:info]', ...args);\n    }\n  },\n  warn: (...args: unknown[]): void => {\n    if (shouldLog('warn')) {\n      console.warn('[agentic:warn]', ...args);\n    }\n  },\n  error: (...args: unknown[]): void => {\n    if (shouldLog('error')) {\n      console.error('[agentic:error]', ...args);\n    }\n  },\n};\n","/**\n * GitHubClient - Unified GitHub API client\n *\n * Provides GitHub API operations with:\n * - Intelligent token switching based on organization\n * - Consistent identity for PR reviews\n * - CI status and feedback collection\n * - Safe git operations (no shell injection)\n *\n * This consolidates the former token-aware client and triage client.\n */\n\nimport { spawnSync } from 'node:child_process';\nimport { Octokit } from '@octokit/rest';\nimport { log } from '../core/config.js';\nimport { extractOrg, getPRReviewToken, getTokenForRepo } from '../core/tokens.js';\nimport type { PRComment, PullRequest, Repository, Result } from '../core/types.js';\nimport type {\n  CICheck,\n  CIStatus,\n  FeedbackItem,\n  FeedbackSeverity,\n  FeedbackStatus,\n} from '../triage/types.js';\n\n// ============================================\n// Octokit Cache (one per token)\n// ============================================\n\nconst octokitCache = new Map<string, Octokit>();\n\nfunction getOctokit(token: string): Octokit {\n  let octokit = octokitCache.get(token);\n  if (!octokit) {\n    octokit = new Octokit({ auth: token });\n    octokitCache.set(token, octokit);\n  }\n  return octokit;\n}\n\n// ============================================\n// Configuration\n// ============================================\n\nexport interface GitHubClientConfig {\n  /** Token for authentication */\n  token?: string;\n  /** Repository owner */\n  owner?: string;\n  /** Repository name */\n  repo?: string;\n}\n\n// ============================================\n// GitHub Client Class\n// ============================================\n\nexport class GitHubClient {\n  private token: string | null;\n  private owner: string | null;\n  private repo: string | null;\n\n  /**\n   * Create a new GitHubClient.\n   *\n   * Can be used in two modes:\n   * 1. With explicit config: new GitHubClient({ token, owner, repo })\n   * 2. Token-aware mode: new GitHubClient() - uses token based on repo\n   */\n  constructor(config: GitHubClientConfig = {}) {\n    this.token = config.token ?? null;\n    this.owner = config.owner ?? null;\n    this.repo = config.repo ?? null;\n  }\n\n  // ============================================\n  // Token Management (Static Methods)\n  // ============================================\n\n  /**\n   * Get an Octokit instance for a repository.\n   * Automatically selects the correct token based on org.\n   */\n  static forRepo(repoUrl: string): Octokit | null {\n    const token = getTokenForRepo(repoUrl);\n    if (!token) {\n      log.warn(`No token available for repo: ${repoUrl}`);\n      return null;\n    }\n    return getOctokit(token);\n  }\n\n  /**\n   * Get an Octokit instance for PR review operations.\n   * Always uses the consistent PR review identity.\n   */\n  static forPRReview(): Octokit | null {\n    const token = getPRReviewToken();\n    if (!token) {\n      log.warn('No PR review token available');\n      return null;\n    }\n    return getOctokit(token);\n  }\n\n  // ============================================\n  // Instance Helpers\n  // ============================================\n\n  private getOctokitInstance(): Octokit {\n    if (this.token) {\n      return getOctokit(this.token);\n    }\n    if (this.owner && this.repo) {\n      const octokit = GitHubClient.forRepo(`${this.owner}/${this.repo}`);\n      if (!octokit) {\n        throw new Error(`No token available for ${this.owner}/${this.repo}`);\n      }\n      return octokit;\n    }\n    throw new Error('GitHubClient requires either token or owner/repo');\n  }\n\n  private ensureRepo(): { owner: string; repo: string } {\n    if (!this.owner || !this.repo) {\n      throw new Error('owner and repo are required for this operation');\n    }\n    return { owner: this.owner, repo: this.repo };\n  }\n\n  // ============================================\n  // Repository Operations (Static)\n  // ============================================\n\n  /**\n   * Get repository information\n   */\n  static async getRepo(owner: string, repo: string): Promise<Result<Repository>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      const { data } = await octokit.repos.get({ owner, repo });\n      return {\n        success: true,\n        data: {\n          owner: data.owner.login,\n          name: data.name,\n          fullName: data.full_name,\n          defaultBranch: data.default_branch,\n          isPrivate: data.private,\n          url: data.html_url,\n        },\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * List repositories for an organization\n   */\n  static async listOrgRepos(\n    org: string,\n    options?: {\n      type?: 'all' | 'public' | 'private' | 'forks' | 'sources' | 'member';\n      perPage?: number;\n    }\n  ): Promise<Result<Repository[]>> {\n    const octokit = GitHubClient.forRepo(`${org}/any`);\n    if (!octokit) {\n      return { success: false, error: `No token available for org: ${org}` };\n    }\n\n    try {\n      const { data } = await octokit.repos.listForOrg({\n        org,\n        type: options?.type ?? 'all',\n        per_page: options?.perPage ?? 100,\n      });\n\n      return {\n        success: true,\n        data: data.map((r) => ({\n          owner: r.owner.login,\n          name: r.name,\n          fullName: r.full_name,\n          defaultBranch: r.default_branch ?? 'main',\n          isPrivate: r.private,\n          url: r.html_url,\n        })),\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  // ============================================\n  // Pull Request Operations\n  // ============================================\n\n  /**\n   * Get pull request information (static version)\n   */\n  static async getPRStatic(\n    owner: string,\n    repo: string,\n    prNumber: number\n  ): Promise<Result<PullRequest>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      const { data } = await octokit.pulls.get({ owner, repo, pull_number: prNumber });\n      return {\n        success: true,\n        data: {\n          number: data.number,\n          title: data.title,\n          body: data.body ?? undefined,\n          state: data.state as 'open' | 'closed',\n          draft: data.draft ?? false,\n          url: data.html_url,\n          headBranch: data.head.ref,\n          baseBranch: data.base.ref,\n          author: data.user?.login ?? 'unknown',\n        },\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Get pull request (instance version with full data)\n   */\n  async getPR(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.get({\n      owner,\n      repo,\n      pull_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * Get files changed in a PR\n   */\n  async getPRFiles(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.listFiles({\n      owner,\n      repo,\n      pull_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * Create a pull request\n   */\n  static async createPR(\n    owner: string,\n    repo: string,\n    options: {\n      title: string;\n      body?: string;\n      head: string;\n      base: string;\n      draft?: boolean;\n    }\n  ): Promise<Result<PullRequest>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      const { data } = await octokit.pulls.create({\n        owner,\n        repo,\n        title: options.title,\n        body: options.body,\n        head: options.head,\n        base: options.base,\n        draft: options.draft,\n      });\n\n      return {\n        success: true,\n        data: {\n          number: data.number,\n          title: data.title,\n          body: data.body ?? undefined,\n          state: data.state as 'open' | 'closed',\n          draft: data.draft ?? false,\n          url: data.html_url,\n          headBranch: data.head.ref,\n          baseBranch: data.base.ref,\n          author: data.user?.login ?? 'unknown',\n        },\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Merge a pull request\n   */\n  static async mergePRStatic(\n    owner: string,\n    repo: string,\n    prNumber: number,\n    options?: {\n      mergeMethod?: 'merge' | 'squash' | 'rebase';\n      commitTitle?: string;\n      commitMessage?: string;\n    }\n  ): Promise<Result<void>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      await octokit.pulls.merge({\n        owner,\n        repo,\n        pull_number: prNumber,\n        merge_method: options?.mergeMethod ?? 'squash',\n        commit_title: options?.commitTitle,\n        commit_message: options?.commitMessage,\n      });\n\n      return { success: true };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Merge a pull request (instance version)\n   */\n  async mergePR(prNumber: number, method: 'merge' | 'squash' | 'rebase' = 'squash') {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.merge({\n      owner,\n      repo,\n      pull_number: prNumber,\n      merge_method: method,\n    });\n    return data;\n  }\n\n  // ============================================\n  // Reviews and Comments\n  // ============================================\n\n  /**\n   * Get reviews on a PR\n   */\n  async getReviews(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.listReviews({\n      owner,\n      repo,\n      pull_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * Get review comments on a PR\n   */\n  async getReviewComments(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.listReviewComments({\n      owner,\n      repo,\n      pull_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * Get issue comments on a PR\n   */\n  async getIssueComments(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.issues.listComments({\n      owner,\n      repo,\n      issue_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * List PR comments (static version)\n   */\n  static async listPRComments(\n    owner: string,\n    repo: string,\n    prNumber: number\n  ): Promise<Result<PRComment[]>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      const { data } = await octokit.issues.listComments({\n        owner,\n        repo,\n        issue_number: prNumber,\n        per_page: 100,\n      });\n\n      return {\n        success: true,\n        data: data.map((c) => ({\n          id: c.id,\n          body: c.body ?? '',\n          author: c.user?.login ?? 'unknown',\n          createdAt: c.created_at,\n          updatedAt: c.updated_at,\n        })),\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Post a PR comment (ALWAYS uses PR review identity)\n   */\n  static async postPRComment(\n    owner: string,\n    repo: string,\n    prNumber: number,\n    body: string\n  ): Promise<Result<PRComment>> {\n    const octokit = GitHubClient.forPRReview();\n    if (!octokit) {\n      return { success: false, error: 'No PR review token available' };\n    }\n\n    try {\n      const { data } = await octokit.issues.createComment({\n        owner,\n        repo,\n        issue_number: prNumber,\n        body,\n      });\n\n      return {\n        success: true,\n        data: {\n          id: data.id,\n          body: data.body ?? '',\n          author: data.user?.login ?? 'unknown',\n          createdAt: data.created_at,\n          updatedAt: data.updated_at,\n        },\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Post a comment (instance version)\n   */\n  async postComment(prNumber: number, body: string) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.issues.createComment({\n      owner,\n      repo,\n      issue_number: prNumber,\n      body,\n    });\n    return data;\n  }\n\n  /**\n   * Reply to a review comment\n   */\n  async replyToComment(prNumber: number, commentId: number, body: string) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.createReplyForReviewComment({\n      owner,\n      repo,\n      pull_number: prNumber,\n      comment_id: commentId,\n      body,\n    });\n    return data;\n  }\n\n  /**\n   * Request a review on a PR (ALWAYS uses PR review identity)\n   */\n  static async requestReview(\n    owner: string,\n    repo: string,\n    prNumber: number,\n    reviewers: string[]\n  ): Promise<Result<void>> {\n    const octokit = GitHubClient.forPRReview();\n    if (!octokit) {\n      return { success: false, error: 'No PR review token available' };\n    }\n\n    try {\n      await octokit.pulls.requestReviewers({\n        owner,\n        repo,\n        pull_number: prNumber,\n        reviewers,\n      });\n\n      return { success: true };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  // ============================================\n  // CI Status\n  // ============================================\n\n  /**\n   * Get CI status for a PR\n   */\n  async getCIStatus(prNumber: number): Promise<CIStatus> {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n\n    const pr = await this.getPR(prNumber);\n    const ref = pr.head.sha;\n\n    const { data: checkRuns } = await octokit.checks.listForRef({\n      owner,\n      repo,\n      ref,\n    });\n\n    const checks: CICheck[] = checkRuns.check_runs.map((run) => ({\n      name: run.name,\n      status: this.mapCheckStatus(run.status, run.conclusion),\n      conclusion: run.conclusion,\n      url: run.html_url ?? '',\n      startedAt: run.started_at,\n      completedAt: run.completed_at,\n    }));\n\n    const failures = checks.filter((c) => c.status === 'failure');\n    const pending = checks.filter((c) => c.status === 'pending' || c.status === 'in_progress');\n\n    return {\n      allPassing: failures.length === 0 && pending.length === 0,\n      anyPending: pending.length > 0,\n      checks,\n      failures,\n    };\n  }\n\n  private mapCheckStatus(status: string, conclusion: string | null): CICheck['status'] {\n    if (status === 'queued' || status === 'pending') return 'pending';\n    if (status === 'in_progress') return 'in_progress';\n    if (conclusion === 'success') return 'success';\n    if (conclusion === 'failure' || conclusion === 'timed_out') return 'failure';\n    if (conclusion === 'skipped' || conclusion === 'cancelled') return 'skipped';\n    return 'pending';\n  }\n\n  // ============================================\n  // Feedback Collection\n  // ============================================\n\n  /**\n   * Collect all feedback on a PR\n   */\n  async collectFeedback(prNumber: number): Promise<FeedbackItem[]> {\n    const [reviewComments, reviews] = await Promise.all([\n      this.getReviewComments(prNumber),\n      this.getReviews(prNumber),\n    ]);\n\n    const feedbackItems: FeedbackItem[] = [];\n\n    // Process inline review comments\n    for (const comment of reviewComments) {\n      const severity = this.inferSeverity(comment.body);\n      feedbackItems.push({\n        id: `comment-${comment.id}`,\n        author: comment.user?.login ?? 'unknown',\n        body: comment.body,\n        path: comment.path,\n        line: comment.line ?? comment.original_line ?? null,\n        severity,\n        status: this.inferStatus(comment),\n        createdAt: comment.created_at,\n        url: comment.html_url,\n        isAutoResolvable: this.isAutoResolvable(comment.body, severity),\n        suggestedAction: this.extractSuggestion(comment.body),\n        resolution: null,\n      });\n    }\n\n    // Process review bodies (summary comments)\n    for (const review of reviews) {\n      if (!review.body || review.body.trim() === '') continue;\n\n      const severity = this.inferSeverity(review.body);\n      feedbackItems.push({\n        id: `review-${review.id}`,\n        author: review.user?.login ?? 'unknown',\n        body: review.body,\n        path: null,\n        line: null,\n        severity,\n        status: 'addressed', // Review summaries are informational\n        createdAt: review.submitted_at ?? new Date().toISOString(),\n        url: review.html_url,\n        isAutoResolvable: false,\n        suggestedAction: null,\n        resolution: null,\n      });\n    }\n\n    return feedbackItems;\n  }\n\n  private inferSeverity(body: string): FeedbackSeverity {\n    const lower = body.toLowerCase();\n\n    if (body.includes('') || body.includes(':stop_sign:') || lower.includes('critical')) {\n      return 'critical';\n    }\n    if (body.includes('medium-priority') || lower.includes('high severity')) {\n      return 'high';\n    }\n    if (body.includes('medium') || lower.includes('should')) {\n      return 'medium';\n    }\n    if (body.includes('nitpick') || body.includes('nit:') || lower.includes('consider')) {\n      return 'low';\n    }\n    if (body.includes('info') || body.includes('note:')) {\n      return 'info';\n    }\n\n    if (lower.includes('error') || lower.includes('bug') || lower.includes('fix')) {\n      return 'high';\n    }\n\n    return 'medium';\n  }\n\n  private inferStatus(comment: { body: string; in_reply_to_id?: number }): FeedbackStatus {\n    if (comment.in_reply_to_id) {\n      return 'addressed';\n    }\n    return 'unaddressed';\n  }\n\n  private isAutoResolvable(body: string, severity: FeedbackSeverity): boolean {\n    if (body.includes('```suggestion')) return true;\n    if (severity === 'low' || severity === 'info') return true;\n\n    const lower = body.toLowerCase();\n    if (lower.includes('formatting') || lower.includes('typo') || lower.includes('spelling')) {\n      return true;\n    }\n\n    return false;\n  }\n\n  private extractSuggestion(body: string): string | null {\n    const suggestionMatch = body.match(/```suggestion\\n([\\s\\S]*?)```/);\n    const suggestion = suggestionMatch?.[1];\n    if (suggestion !== undefined) {\n      return suggestion.trim();\n    }\n    return null;\n  }\n}\n\n// ============================================\n// Safe Git Operations\n// ============================================\n\n/**\n * Clone a repository with appropriate token.\n * Uses spawnSync for safe command execution (no shell injection).\n */\nexport function cloneRepo(repoUrl: string, destPath: string): Result<void> {\n  const token = getTokenForRepo(repoUrl);\n  if (!token) {\n    return { success: false, error: `No token available for repo: ${repoUrl}` };\n  }\n\n  let cloneUrl = repoUrl;\n  if (cloneUrl.startsWith('https://github.com/')) {\n    cloneUrl = cloneUrl.replace('https://github.com/', `https://oauth2:${token}@github.com/`);\n  } else if (!cloneUrl.includes('@') && !cloneUrl.startsWith('https://')) {\n    const org = extractOrg(repoUrl);\n    const repoName = repoUrl.replace(`${org}/`, '');\n    cloneUrl = `https://oauth2:${token}@github.com/${org}/${repoName}.git`;\n  }\n\n  const proc = spawnSync('git', ['clone', cloneUrl, destPath], {\n    encoding: 'utf-8',\n    stdio: 'pipe',\n    timeout: 120000,\n  });\n\n  if (proc.error) {\n    return { success: false, error: `Git clone error: ${proc.error.message}` };\n  }\n\n  if (proc.status !== 0) {\n    const errorOutput = (proc.stderr || 'Unknown error').replace(\n      /oauth2:[^@]+@/g,\n      'oauth2:[REDACTED]@'\n    );\n    return { success: false, error: `Git clone failed: ${errorOutput}` };\n  }\n\n  return { success: true };\n}\n\n/**\n * Validate a git ref/branch name to prevent injection\n */\nexport function isValidGitRef(ref: string): boolean {\n  return /^[a-zA-Z0-9._/-]+$/.test(ref) && ref.length <= 200;\n}\n\n/**\n * Validate owner/repo format\n */\nexport function isValidRepoFormat(repo: string): boolean {\n  return /^[a-zA-Z0-9._-]+\\/[a-zA-Z0-9._-]+$/.test(repo) && repo.length <= 200;\n}\n\n// ============================================\n// Configuration Type Export\n// ============================================\n\nexport type { GitHubClientConfig as GitHubConfig };\n","/**\n * CursorAPI - Direct HTTP client for Cursor Background Agent API\n *\n * Bypasses MCP for direct API access with better performance and reliability.\n * Adapted from cursor-fleet with enhanced error handling.\n */\n\nimport { log } from '../core/config.js';\nimport type { Agent, Conversation, Repository, Result } from '../core/types.js';\n\n/** Default API base URL - configurable for testing/staging */\nconst DEFAULT_BASE_URL = 'https://api.cursor.com/v0';\n\n/** Retryable HTTP status codes */\nconst RETRYABLE_STATUS_CODES = [429, 500, 502, 503, 504];\n\n/** Default maximum number of retries */\nconst DEFAULT_MAX_RETRIES = 3;\n\n/** Default initial retry delay in milliseconds */\nconst DEFAULT_RETRY_DELAY = 1000;\n\n/** Validation regex for agent IDs (alphanumeric with hyphens) */\nconst AGENT_ID_PATTERN = /^[a-zA-Z0-9-]+$/;\n\n/** Maximum prompt text length */\nconst MAX_PROMPT_LENGTH = 100000;\n\n/** Maximum repository name length */\nconst MAX_REPO_LENGTH = 200;\n\nexport interface CursorAPIOptions {\n  /** API key (defaults to CURSOR_API_KEY env var) */\n  apiKey?: string;\n  /** Request timeout in milliseconds (default: 60000) */\n  timeout?: number;\n  /** API base URL (default: https://api.cursor.com/v0) */\n  baseUrl?: string;\n  /** Maximum number of retries for transient errors (default: 3) */\n  maxRetries?: number;\n  /** Initial delay for exponential backoff in ms (default: 1000) */\n  retryDelay?: number;\n}\n\n/**\n * Validates an agent ID to prevent injection attacks\n */\nfunction validateAgentId(agentId: string): void {\n  if (!agentId || typeof agentId !== 'string') {\n    throw new Error('Agent ID is required and must be a string');\n  }\n  if (agentId.length > 100) {\n    throw new Error('Agent ID exceeds maximum length (100 characters)');\n  }\n  if (!AGENT_ID_PATTERN.test(agentId)) {\n    throw new Error('Agent ID contains invalid characters (only alphanumeric and hyphens allowed)');\n  }\n}\n\n/**\n * Validates prompt text\n */\nfunction validatePromptText(text: string): void {\n  if (!text || typeof text !== 'string') {\n    throw new Error('Prompt text is required and must be a string');\n  }\n  if (text.trim().length === 0) {\n    throw new Error('Prompt text cannot be empty');\n  }\n  if (text.length > MAX_PROMPT_LENGTH) {\n    throw new Error(`Prompt text exceeds maximum length (${MAX_PROMPT_LENGTH} characters)`);\n  }\n}\n\n/**\n * Validates repository name\n */\nfunction validateRepository(repository: string): void {\n  if (!repository || typeof repository !== 'string') {\n    throw new Error('Repository is required and must be a string');\n  }\n  if (repository.length > MAX_REPO_LENGTH) {\n    throw new Error(`Repository name exceeds maximum length (${MAX_REPO_LENGTH} characters)`);\n  }\n  // Basic format check: owner/repo or URL\n  if (!repository.includes('/')) {\n    throw new Error(\"Repository must be in format 'owner/repo' or a valid URL\");\n  }\n}\n\n/**\n * Validates webhook URL to prevent SSRF attacks\n * Only allows HTTPS URLs to external hosts\n */\nfunction validateWebhookUrl(url: string): void {\n  if (!url || typeof url !== 'string') {\n    throw new Error('Webhook URL is required and must be a string');\n  }\n\n  let parsed: URL;\n  try {\n    parsed = new URL(url);\n  } catch {\n    throw new Error('Webhook URL is not a valid URL');\n  }\n\n  // Security: Only allow HTTPS\n  if (parsed.protocol !== 'https:') {\n    throw new Error('Webhook URL must use HTTPS protocol');\n  }\n\n  // Security: Block internal/private IP ranges\n  const hostname = parsed.hostname.toLowerCase();\n  const blockedPatterns = [\n    /^localhost$/i,\n    /^127\\./,\n    /^10\\./,\n    /^172\\.(1[6-9]|2[0-9]|3[0-1])\\./,\n    /^192\\.168\\./,\n    /^169\\.254\\./,\n    /^0\\./,\n    /^\\[::1\\]$/,\n    /^\\[fc/i,\n    /^\\[fd/i,\n    /^\\[fe80:/i,\n    /^metadata\\./i,\n    /^internal\\./i,\n    /\\.local$/i,\n    /\\.internal$/i,\n  ];\n\n  for (const pattern of blockedPatterns) {\n    if (pattern.test(hostname)) {\n      throw new Error('Webhook URL cannot point to internal/private addresses');\n    }\n  }\n\n  // Security: Block common cloud metadata endpoints\n  if (hostname === '169.254.169.254' || hostname.includes('metadata.google')) {\n    throw new Error('Webhook URL cannot point to cloud metadata services');\n  }\n}\n\n/**\n * Sanitizes error messages to prevent sensitive data leakage\n */\nfunction sanitizeError(error: unknown): string {\n  const message = error instanceof Error ? error.message : String(error);\n  // Remove potential API keys, tokens, or sensitive patterns\n  return message\n    .replace(/Bearer\\s+[a-zA-Z0-9._-]+/gi, 'Bearer [REDACTED]')\n    .replace(/api[_-]?key[=:]\\s*[\"']?[a-zA-Z0-9._-]+[\"']?/gi, 'api_key=[REDACTED]')\n    .replace(/token[=:]\\s*[\"']?[a-zA-Z0-9._-]+[\"']?/gi, 'token=[REDACTED]');\n}\n\nexport class CursorAPI {\n  private readonly apiKey: string;\n  private readonly timeout: number;\n  private readonly baseUrl: string;\n  private readonly maxRetries: number;\n  private readonly retryDelay: number;\n\n  constructor(options: CursorAPIOptions = {}) {\n    // Check for API key in order: options, CURSOR_API_KEY\n    this.apiKey = options.apiKey ?? process.env.CURSOR_API_KEY ?? '';\n    this.timeout = options.timeout ?? 60000;\n    // Security: Only allow baseUrl via explicit programmatic configuration\n    // Do NOT allow env var override to prevent SSRF attacks\n    this.baseUrl = options.baseUrl ?? DEFAULT_BASE_URL;\n    this.maxRetries = options.maxRetries ?? DEFAULT_MAX_RETRIES;\n    this.retryDelay = options.retryDelay ?? DEFAULT_RETRY_DELAY;\n\n    if (!this.apiKey) {\n      throw new Error('CURSOR_API_KEY is required. Set it in environment or pass to constructor.');\n    }\n  }\n\n  /**\n   * Check if API key is available\n   */\n  static isAvailable(): boolean {\n    return !!process.env.CURSOR_API_KEY;\n  }\n\n  private async request<T>(\n    endpoint: string,\n    method: string = 'GET',\n    body?: object,\n    attempt: number = 0\n  ): Promise<Result<T>> {\n    const url = `${this.baseUrl}${endpoint}`;\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), this.timeout);\n\n    try {\n      const response = await fetch(url, {\n        method,\n        headers: {\n          Authorization: `Bearer ${this.apiKey}`,\n          'Content-Type': 'application/json',\n        },\n        body: body ? JSON.stringify(body) : undefined,\n        signal: controller.signal,\n      });\n\n      if (!response.ok) {\n        // Check if we should retry\n        if (attempt < this.maxRetries && RETRYABLE_STATUS_CODES.includes(response.status)) {\n          const delay = this.retryDelay * 2 ** attempt;\n          log.warn(\n            `API Error ${response.status} on ${method} ${endpoint}. Retrying in ${delay}ms... (Attempt ${attempt + 1}/${this.maxRetries})`\n          );\n          await new Promise((resolve) => setTimeout(resolve, delay));\n          return this.request<T>(endpoint, method, body, attempt + 1);\n        }\n\n        const errorText = await response.text();\n        let details: string;\n        try {\n          const parsed = JSON.parse(errorText);\n          details = parsed.message || parsed.error || 'Unknown API error';\n        } catch {\n          details = sanitizeError(errorText);\n        }\n\n        return {\n          success: false,\n          error: `API Error ${response.status}: ${details}`,\n        };\n      }\n\n      // Handle empty responses (e.g., 204 No Content)\n      const contentType = response.headers.get('content-type');\n      if (!contentType || !contentType.includes('application/json')) {\n        return { success: true, data: {} as T };\n      }\n\n      const text = await response.text();\n      if (!text || text.trim() === '') {\n        return { success: true, data: {} as T };\n      }\n\n      try {\n        const data = JSON.parse(text) as T;\n        return { success: true, data };\n      } catch {\n        return {\n          success: false,\n          error: 'Invalid JSON response from API',\n        };\n      }\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        // Timeouts are also retryable\n        if (attempt < this.maxRetries) {\n          const delay = this.retryDelay * 2 ** attempt;\n          log.warn(\n            `Request timeout on ${method} ${endpoint}. Retrying in ${delay}ms... (Attempt ${attempt + 1}/${this.maxRetries})`\n          );\n          await new Promise((resolve) => setTimeout(resolve, delay));\n          return this.request<T>(endpoint, method, body, attempt + 1);\n        }\n        return { success: false, error: `Request timeout after ${this.timeout}ms` };\n      }\n\n      // Network errors (TypeError) or specific connection errors are also retryable\n      if (\n        attempt < this.maxRetries &&\n        (error instanceof TypeError ||\n          (error instanceof Error &&\n            (error.message.includes('network') ||\n              error.message.includes('fetch') ||\n              error.message.includes('connection'))))\n      ) {\n        const delay = this.retryDelay * 2 ** attempt;\n        log.warn(\n          `Network error on ${method} ${endpoint}: ${sanitizeError(error)}. Retrying in ${delay}ms... (Attempt ${attempt + 1}/${this.maxRetries})`\n        );\n        await new Promise((resolve) => setTimeout(resolve, delay));\n        return this.request<T>(endpoint, method, body, attempt + 1);\n      }\n\n      return { success: false, error: sanitizeError(error) };\n    } finally {\n      clearTimeout(timeoutId);\n    }\n  }\n\n  /**\n   * List all agents\n   */\n  async listAgents(): Promise<Result<Agent[]>> {\n    const result = await this.request<{ agents: Agent[]; nextCursor?: string }>('/agents');\n    if (!result.success) return { success: false, error: result.error };\n    return { success: true, data: result.data?.agents ?? [] };\n  }\n\n  /**\n   * Get status of a specific agent\n   */\n  async getAgentStatus(agentId: string): Promise<Result<Agent>> {\n    validateAgentId(agentId);\n    const encodedId = encodeURIComponent(agentId);\n    return this.request<Agent>(`/agents/${encodedId}`);\n  }\n\n  /**\n   * Get conversation history for an agent\n   */\n  async getAgentConversation(agentId: string): Promise<Result<Conversation>> {\n    validateAgentId(agentId);\n    const encodedId = encodeURIComponent(agentId);\n    return this.request<Conversation>(`/agents/${encodedId}/conversation`);\n  }\n\n  /**\n   * Launch a new agent\n   *\n   * API Spec: https://cursor.com/docs/cloud-agent/api/endpoints\n   */\n  async launchAgent(options: {\n    prompt: {\n      text: string;\n      images?: Array<{ data: string; dimension?: { width: number; height: number } }>;\n    };\n    source: {\n      repository: string;\n      ref?: string;\n    };\n    target?: {\n      autoCreatePr?: boolean;\n      branchName?: string;\n      openAsCursorGithubApp?: boolean;\n      skipReviewerRequest?: boolean;\n    };\n    webhook?: {\n      url: string;\n      secret?: string;\n    };\n  }): Promise<Result<Agent>> {\n    validatePromptText(options.prompt.text);\n    validateRepository(options.source.repository);\n\n    if (options.source.ref !== undefined) {\n      if (typeof options.source.ref !== 'string' || options.source.ref.length > 200) {\n        throw new Error('Invalid ref: must be a string under 200 characters');\n      }\n    }\n\n    // Security: Validate webhook URL to prevent SSRF\n    if (options.webhook?.url) {\n      validateWebhookUrl(options.webhook.url);\n    }\n\n    return this.request<Agent>('/agents', 'POST', options);\n  }\n\n  /**\n   * Send a follow-up message to an agent\n   */\n  async addFollowup(agentId: string, prompt: { text: string }): Promise<Result<void>> {\n    validateAgentId(agentId);\n    validatePromptText(prompt.text);\n    const encodedId = encodeURIComponent(agentId);\n    return this.request<void>(`/agents/${encodedId}/followup`, 'POST', { prompt });\n  }\n\n  /**\n   * List available repositories\n   */\n  async listRepositories(): Promise<Result<Repository[]>> {\n    const result = await this.request<{ repositories: Repository[] }>('/repositories');\n    if (!result.success) return { success: false, error: result.error };\n    return { success: true, data: result.data?.repositories ?? [] };\n  }\n\n  /**\n   * List available models\n   *\n   * API Spec: https://cursor.com/docs/cloud-agent/api/endpoints#list-models\n   */\n  async listModels(): Promise<Result<string[]>> {\n    const result = await this.request<{ models: string[] }>('/models');\n    if (!result.success) return { success: false, error: result.error };\n    return { success: true, data: result.data?.models ?? [] };\n  }\n}\n","/**\n * AI Provider Loading - Shared provider utilities\n *\n * Supports multiple AI providers via Vercel AI SDK:\n * - anthropic (@ai-sdk/anthropic)\n * - openai (@ai-sdk/openai)\n * - google (@ai-sdk/google)\n * - mistral (@ai-sdk/mistral)\n * - azure (@ai-sdk/azure)\n * - ollama (ai-sdk-ollama) - for Ollama Cloud and local Ollama\n *\n * Install the provider you need:\n *   pnpm add @ai-sdk/anthropic\n *   pnpm add ai-sdk-ollama  # for Ollama support\n */\n\nimport { getDefaultApiKeyEnvVar, getTriageConfig } from './config.js';\n\n// ============================================\n// Types\n// ============================================\n\nexport type ProviderFactory = (config: { apiKey: string }) => unknown;\nexport type ModelFactory = (model: string) => unknown;\n\nexport type SupportedProvider = 'anthropic' | 'openai' | 'google' | 'mistral' | 'azure' | 'ollama';\n\nexport interface ProviderConfig {\n  package: string;\n  factory: string;\n}\n\n// ============================================\n// Provider Configuration\n// ============================================\n\n/**\n * Security: Explicit allowlist of supported providers and their packages.\n * Dynamic imports are only allowed for these pre-defined packages.\n */\nexport const PROVIDER_CONFIG: Record<SupportedProvider, ProviderConfig> = {\n  anthropic: { package: '@ai-sdk/anthropic', factory: 'createAnthropic' },\n  openai: { package: '@ai-sdk/openai', factory: 'createOpenAI' },\n  google: { package: '@ai-sdk/google', factory: 'createGoogleGenerativeAI' },\n  mistral: { package: '@ai-sdk/mistral', factory: 'createMistral' },\n  azure: { package: '@ai-sdk/azure', factory: 'createAzure' },\n  ollama: { package: 'ai-sdk-ollama', factory: 'createOllama' },\n} as const;\n\n/**\n * Ollama-specific configuration\n */\nexport const OLLAMA_CONFIG = {\n  /** Default model for Ollama Cloud (qwen3-coder has excellent tool support) */\n  defaultModel: 'qwen3-coder:480b-cloud',\n  /** Ollama Cloud API URL (SDK appends /api paths automatically) */\n  cloudHost: 'https://ollama.com',\n  /** Local Ollama API URL (SDK appends /api paths automatically) */\n  localHost: 'http://localhost:11434',\n  /** Enable reliable object generation with automatic JSON repair (v3.0.0+) */\n  reliableObjectGeneration: true,\n  /** Object generation options for better reliability */\n  objectGenerationOptions: {\n    /** Enable automatic JSON repair for malformed outputs */\n    enableTextRepair: true,\n    /** Maximum retries for object generation */\n    maxRetries: 3,\n  },\n} as const;\n\n/**\n * Check if a provider name is valid\n */\nexport function isValidProvider(name: string): name is SupportedProvider {\n  return name in PROVIDER_CONFIG;\n}\n\n/**\n * Get list of supported provider names\n */\nexport function getSupportedProviders(): SupportedProvider[] {\n  return Object.keys(PROVIDER_CONFIG) as SupportedProvider[];\n}\n\n// ============================================\n// Provider Loading\n// ============================================\n\n/**\n * Load an AI provider dynamically.\n *\n * @param providerName - Name of the provider (anthropic, openai, etc.)\n * @param apiKey - API key for the provider\n * @returns A function that creates a model instance\n * @throws Error if provider is unknown or package not installed\n */\nexport async function loadProvider(providerName: string, apiKey: string): Promise<ModelFactory> {\n  // Security: Validate provider name against explicit allowlist\n  if (!isValidProvider(providerName)) {\n    throw new Error(\n      `Unknown provider: ${providerName}\\n` +\n        `Supported providers: ${getSupportedProviders().join(', ')}`\n    );\n  }\n\n  const config = PROVIDER_CONFIG[providerName];\n\n  try {\n    // Security: Only import from pre-defined allowlist - no user input in import path\n    let module: Record<string, unknown>;\n    switch (providerName) {\n      case 'anthropic':\n        module = await import('@ai-sdk/anthropic');\n        break;\n      case 'openai':\n        module = await import('@ai-sdk/openai');\n        break;\n      case 'google':\n        module = await import('@ai-sdk/google');\n        break;\n      case 'mistral':\n        module = await import('@ai-sdk/mistral');\n        break;\n      case 'azure':\n        module = await import('@ai-sdk/azure');\n        break;\n      case 'ollama':\n        module = await import('ai-sdk-ollama');\n        break;\n      default:\n        // This should never happen due to isValidProvider check above\n        throw new Error(`Provider ${providerName} not implemented`);\n    }\n\n    const factory = module[config.factory] as ProviderFactory;\n\n    if (typeof factory !== 'function') {\n      throw new Error(`Factory ${config.factory} not found in ${config.package}`);\n    }\n\n    // Ollama provider has different config structure (ai-sdk-ollama v3.0.0+)\n    if (providerName === 'ollama') {\n      // Determine host URL based on API key presence\n      const host =\n        process.env.OLLAMA_HOST || (apiKey ? OLLAMA_CONFIG.cloudHost : OLLAMA_CONFIG.localHost);\n      // Normalize URL to remove any trailing slashes or /api path (SDK appends /api automatically)\n      const normalizedHost = host.replace(/\\/api\\/?$/, '').replace(/\\/$/, '');\n\n      // ai-sdk-ollama v3.0.0+ configuration with reliable object generation\n      type OllamaProviderFactory = (config: {\n        baseURL: string;\n        headers?: { Authorization: string };\n      }) => unknown;\n\n      // Model factory type with v3 options\n      type OllamaModelFactory = (\n        model: string,\n        options?: {\n          structuredOutputs?: boolean;\n          reliableObjectGeneration?: boolean;\n          objectGenerationOptions?: {\n            enableTextRepair?: boolean;\n            maxRetries?: number;\n          };\n        }\n      ) => unknown;\n\n      const provider = (factory as unknown as OllamaProviderFactory)({\n        baseURL: normalizedHost,\n        headers: apiKey ? { Authorization: `Bearer ${apiKey}` } : undefined,\n      });\n\n      // Return a model factory that applies reliability settings by default\n      return (model: string) =>\n        (provider as OllamaModelFactory)(model, {\n          // Enable reliable object generation with automatic JSON repair\n          reliableObjectGeneration: OLLAMA_CONFIG.reliableObjectGeneration,\n          objectGenerationOptions: OLLAMA_CONFIG.objectGenerationOptions,\n        });\n    }\n\n    const provider = factory({ apiKey });\n    return (model: string) => (provider as ModelFactory)(model);\n  } catch (err) {\n    if ((err as NodeJS.ErrnoException).code === 'ERR_MODULE_NOT_FOUND') {\n      throw new Error(\n        `Provider package not installed: ${config.package}\\n` +\n          `Install it with: pnpm add ${config.package}`\n      );\n    }\n    throw err;\n  }\n}\n\n// ============================================\n// Provider Instance Management\n// ============================================\n\n/**\n * Cached provider instances to avoid re-loading\n */\nconst providerCache = new Map<string, ModelFactory>();\n\n/**\n * Get or create a cached provider instance.\n *\n * @param providerName - Name of the provider\n * @param apiKey - API key for the provider\n * @returns A function that creates a model instance\n */\nexport async function getOrLoadProvider(\n  providerName: string,\n  apiKey: string\n): Promise<ModelFactory> {\n  const cacheKey = `${providerName}:${apiKey.slice(0, 8)}`;\n\n  let provider = providerCache.get(cacheKey);\n  if (!provider) {\n    provider = await loadProvider(providerName, apiKey);\n    providerCache.set(cacheKey, provider);\n  }\n\n  return provider;\n}\n\n/**\n * Clear the provider cache (useful for testing)\n */\nexport function clearProviderCache(): void {\n  providerCache.clear();\n}\n\n// ============================================\n// Configuration Helpers\n// ============================================\n\nexport interface ProviderOptions {\n  /** AI provider: anthropic, openai, google, mistral, azure, ollama */\n  provider?: string;\n  /** Model to use */\n  model?: string;\n  /** API key (defaults to provider-specific env var) */\n  apiKey?: string;\n}\n\n/**\n * Resolve provider options with defaults from config.\n *\n * @param options - User-provided options\n * @returns Resolved provider name, model, and API key\n * @throws Error if API key is not available\n */\nexport function resolveProviderOptions(options: ProviderOptions = {}): {\n  providerName: string;\n  model: string;\n  apiKey: string;\n} {\n  const triageConfig = getTriageConfig();\n\n  const providerName = options.provider ?? triageConfig.provider ?? 'anthropic';\n  const model = options.model ?? triageConfig.model ?? 'claude-sonnet-4-20250514';\n\n  // Determine the correct API key\n  const effectiveProvider = options.provider ?? triageConfig.provider ?? 'anthropic';\n  const envVarName =\n    options.provider && options.provider !== triageConfig.provider\n      ? getDefaultApiKeyEnvVar(effectiveProvider)\n      : (triageConfig.apiKeyEnvVar ?? getDefaultApiKeyEnvVar(effectiveProvider));\n\n  const apiKey = options.apiKey ?? process.env[envVarName] ?? '';\n\n  if (!apiKey) {\n    const hint = getDefaultApiKeyEnvVar(effectiveProvider);\n    throw new Error(\n      `API key required for ${providerName} provider.\\n` +\n        `Set ${hint} environment variable or pass apiKey option.`\n    );\n  }\n\n  return { providerName, model, apiKey };\n}\n","/**\n * Analyzer - Unified AI-powered analysis\n *\n * Combines conversation analysis, PR triage, and code review into one class.\n * Supports multiple AI providers via Vercel AI SDK.\n *\n * This consolidates the former AIAnalyzer and PRAnalyzer classes.\n */\n\nimport { spawnSync } from 'node:child_process';\nimport { generateObject, generateText } from 'ai';\nimport { z } from 'zod';\nimport { getConfig, log } from '../core/config.js';\nimport {\n  getOrLoadProvider,\n  type ModelFactory,\n  type ProviderOptions,\n  resolveProviderOptions,\n} from '../core/providers.js';\nimport { getEnvForPRReview } from '../core/tokens.js';\nimport type {\n  AnalysisResult,\n  CodeReviewResult,\n  Conversation,\n  ConversationMessage,\n  Blocker as CoreBlocker,\n  TriageResult as CoreTriageResult,\n  ReviewImprovement,\n  ReviewIssue,\n  Task,\n} from '../core/types.js';\nimport type { Blocker, CIStatus, FeedbackItem, PRStatus, TriageResult } from './types.js';\n\n// ============================================\n// Schemas for Structured AI Output\n// ============================================\n\nconst TaskAnalysisSchema = z.object({\n  completedTasks: z.array(\n    z.object({\n      id: z.string(),\n      title: z.string(),\n      description: z.string().optional(),\n      priority: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n      category: z.enum([\n        'bug',\n        'feature',\n        'security',\n        'performance',\n        'documentation',\n        'infrastructure',\n        'dependency',\n        'ci',\n        'other',\n      ]),\n      status: z.literal('completed'),\n      evidence: z.string().optional(),\n      prNumber: z.number().nullable().optional(),\n    })\n  ),\n  outstandingTasks: z.array(\n    z.object({\n      id: z.string(),\n      title: z.string(),\n      description: z.string().optional(),\n      priority: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n      category: z.enum([\n        'bug',\n        'feature',\n        'security',\n        'performance',\n        'documentation',\n        'infrastructure',\n        'dependency',\n        'ci',\n        'other',\n      ]),\n      status: z.enum(['pending', 'in_progress', 'blocked']),\n      blockers: z.array(z.string()).optional(),\n      suggestedLabels: z.array(z.string()).optional(),\n    })\n  ),\n  blockers: z.array(\n    z.object({\n      issue: z.string(),\n      severity: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n      suggestedResolution: z.string().optional(),\n    })\n  ),\n  summary: z.string(),\n  recommendations: z.array(z.string()),\n});\n\nconst CodeReviewSchema = z.object({\n  issues: z.array(\n    z.object({\n      file: z.string(),\n      line: z.number().optional(),\n      severity: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n      category: z.enum([\n        'bug',\n        'security',\n        'performance',\n        'style',\n        'logic',\n        'documentation',\n        'test',\n        'other',\n      ]),\n      description: z.string(),\n      suggestedFix: z.string().optional(),\n    })\n  ),\n  improvements: z.array(\n    z.object({\n      area: z.string(),\n      suggestion: z.string(),\n      effort: z.enum(['low', 'medium', 'high']),\n    })\n  ),\n  overallAssessment: z.string(),\n  readyToMerge: z.boolean(),\n  mergeBlockers: z.array(z.string()),\n});\n\nconst QuickTriageSchema = z.object({\n  priority: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n  category: z.enum([\n    'bug',\n    'feature',\n    'security',\n    'performance',\n    'documentation',\n    'infrastructure',\n    'dependency',\n    'ci',\n    'other',\n  ]),\n  summary: z.string(),\n  suggestedAction: z.string(),\n  confidence: z.number().min(0).max(1),\n});\n\n// ============================================\n// Types\n// ============================================\n\nexport interface AnalyzerOptions extends ProviderOptions {\n  /** Repository for GitHub operations (required for issue creation) */\n  repo?: string;\n}\n\n/**\n * Interface for GitHub client - allows dependency injection\n */\nexport interface GitHubClientInterface {\n  getPR(prNumber: number): Promise<{\n    html_url: string;\n    title: string;\n    merged: boolean;\n    state: string;\n    mergeable: boolean | null;\n    mergeable_state: string;\n  }>;\n  getCIStatus(prNumber: number): Promise<CIStatus>;\n  collectFeedback(prNumber: number): Promise<FeedbackItem[]>;\n  getPRFiles(prNumber: number): Promise<Array<{ filename: string }>>;\n}\n\n// ============================================\n// Analyzer Class\n// ============================================\n\nexport class Analyzer {\n  private providerName: string;\n  private model: string;\n  private apiKey: string;\n  private repo: string | undefined;\n  private providerFn: ModelFactory | null = null;\n\n  constructor(options: AnalyzerOptions = {}) {\n    const resolved = resolveProviderOptions(options);\n    this.providerName = resolved.providerName;\n    this.model = resolved.model;\n    this.apiKey = resolved.apiKey;\n    this.repo = options.repo ?? getConfig().defaultRepository;\n  }\n\n  private async getModel(): Promise<unknown> {\n    if (!this.providerFn) {\n      this.providerFn = await getOrLoadProvider(this.providerName, this.apiKey);\n    }\n    return this.providerFn(this.model);\n  }\n\n  /**\n   * Set the repository for GitHub operations\n   */\n  setRepo(repo: string): void {\n    this.repo = repo;\n  }\n\n  // ============================================\n  // Conversation Analysis\n  // ============================================\n\n  /**\n   * Analyze a conversation to extract completed/outstanding tasks\n   */\n  async analyzeConversation(conversation: Conversation): Promise<AnalysisResult> {\n    const messages = conversation.messages || [];\n    const conversationText = this.prepareConversationText(messages);\n\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: TaskAnalysisSchema,\n      prompt: `Analyze this agent conversation and extract:\n1. COMPLETED TASKS - What was actually finished and merged/deployed\n2. OUTSTANDING TASKS - What remains to be done\n3. BLOCKERS - Any issues preventing progress\n4. SUMMARY - Brief overall assessment\n5. RECOMMENDATIONS - What should be done next\n\nBe thorough and specific. Reference PR numbers, file paths, and specific changes where possible.\nGenerate unique IDs for tasks (e.g., task-001, task-002).\n\nCONVERSATION:\n${conversationText}`,\n    });\n\n    // Map to our types\n    const completedTasks: Task[] = object.completedTasks.map((t) => ({\n      id: t.id,\n      title: t.title,\n      description: t.description,\n      priority: t.priority,\n      category: t.category,\n      status: 'completed' as const,\n    }));\n\n    const outstandingTasks: Task[] = object.outstandingTasks.map((t) => ({\n      id: t.id,\n      title: t.title,\n      description: t.description,\n      priority: t.priority,\n      category: t.category,\n      status: t.status === 'blocked' ? ('blocked' as const) : ('pending' as const),\n      blockers: t.blockers,\n    }));\n\n    const blockers: CoreBlocker[] = object.blockers.map((b) => ({\n      issue: b.issue,\n      severity: b.severity,\n      suggestedResolution: b.suggestedResolution,\n    }));\n\n    return {\n      summary: object.summary,\n      completedTasks,\n      outstandingTasks,\n      blockers,\n      recommendations: object.recommendations,\n    };\n  }\n\n  // ============================================\n  // Code Review\n  // ============================================\n\n  /**\n   * Review code changes and identify issues\n   */\n  async reviewCode(diff: string, context?: string): Promise<CodeReviewResult> {\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: CodeReviewSchema,\n      prompt: `Review this code diff and identify:\n1. ISSUES - Security, bugs, performance problems\n2. IMPROVEMENTS - Suggestions for better code\n3. OVERALL ASSESSMENT - Is this ready to merge?\n\nBe specific about file paths and line numbers.\nFocus on real issues, not style nitpicks.\n\n${context ? `CONTEXT:\\n${context}\\n\\n` : ''}DIFF:\n${diff}`,\n    });\n\n    const issues: ReviewIssue[] = object.issues.map((i) => ({\n      file: i.file,\n      line: i.line,\n      severity: i.severity,\n      category: i.category,\n      description: i.description,\n      suggestedFix: i.suggestedFix,\n    }));\n\n    const improvements: ReviewImprovement[] = object.improvements.map((i) => ({\n      area: i.area,\n      suggestion: i.suggestion,\n      effort: i.effort,\n    }));\n\n    return {\n      readyToMerge: object.readyToMerge,\n      mergeBlockers: object.mergeBlockers,\n      issues,\n      improvements,\n      overallAssessment: object.overallAssessment,\n    };\n  }\n\n  // ============================================\n  // Quick Triage\n  // ============================================\n\n  /**\n   * Quick triage - fast assessment of what needs attention\n   */\n  async quickTriage(input: string): Promise<CoreTriageResult> {\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: QuickTriageSchema,\n      prompt: `Quickly triage this input and determine:\n1. Priority level (critical/high/medium/low/info)\n2. Category (bug, feature, documentation, infrastructure, etc.)\n3. Brief summary\n4. Suggested immediate action\n5. Confidence level (0-1)\n\nINPUT:\n${input}`,\n    });\n\n    return {\n      priority: object.priority,\n      category: object.category,\n      summary: object.summary,\n      suggestedAction: object.suggestedAction,\n      confidence: object.confidence,\n    };\n  }\n\n  // ============================================\n  // PR Analysis\n  // ============================================\n\n  /**\n   * Analyze a Pull Request for triage\n   */\n  async analyzePR(github: GitHubClientInterface, prNumber: number): Promise<TriageResult> {\n    // Gather all data\n    const [pr, ci, feedback] = await Promise.all([\n      github.getPR(prNumber),\n      github.getCIStatus(prNumber),\n      github.collectFeedback(prNumber),\n    ]);\n\n    // Analyze feedback for unaddressed items\n    const analyzedFeedback = await this.analyzeFeedback(feedback);\n    const unaddressedFeedback = analyzedFeedback.filter((f) => f.status === 'unaddressed');\n\n    // Identify blockers\n    const blockers = await this.identifyBlockers(pr, ci, unaddressedFeedback);\n\n    // Determine status\n    const status = this.determineStatus(pr, ci, blockers, unaddressedFeedback);\n\n    // Generate next actions\n    const nextActions = this.generateNextActions(status, blockers, unaddressedFeedback);\n\n    // Generate summary\n    const summary = await this.generatePRSummary(pr, ci, blockers, unaddressedFeedback);\n\n    return {\n      prNumber,\n      prUrl: pr.html_url,\n      prTitle: pr.title,\n      status,\n      ci,\n      feedback: {\n        total: feedback.length,\n        unaddressed: unaddressedFeedback.length,\n        items: analyzedFeedback,\n      },\n      blockers,\n      nextActions,\n      summary,\n      timestamp: new Date().toISOString(),\n    };\n  }\n\n  /**\n   * Generate a response for feedback (fix or justification)\n   */\n  async generateFeedbackResponse(\n    feedback: FeedbackItem,\n    context: { prTitle: string; files: string[] }\n  ): Promise<{ type: 'fix' | 'justification'; content: string }> {\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: z.object({\n        type: z.enum(['fix', 'justification']),\n        content: z.string(),\n        reasoning: z.string(),\n      }),\n      prompt: `Determine how to address this PR feedback.\n\nPR: ${context.prTitle}\nFiles changed: ${context.files.join(', ')}\n\nFeedback from ${feedback.author}:\n${feedback.body}\n\n${feedback.path ? `File: ${feedback.path}` : ''}\n${feedback.line ? `Line: ${feedback.line}` : ''}\n\nOptions:\n1. \"fix\" - Generate code/text to fix the issue\n2. \"justification\" - Explain why this feedback should not be implemented\n\nChoose \"fix\" if:\n- There's a clear suggestion to implement\n- The issue is valid and should be fixed\n- It's a straightforward change\n\nChoose \"justification\" if:\n- The feedback is a false positive\n- It conflicts with project conventions\n- It's out of scope for this PR\n\nProvide the content (code fix or justification text) and your reasoning.`,\n    });\n\n    return {\n      type: object.type,\n      content: object.content,\n    };\n  }\n\n  // ============================================\n  // Issue Creation\n  // ============================================\n\n  /**\n   * Create GitHub issues from analysis.\n   * Always uses PR review token for consistent identity.\n   */\n  async createIssuesFromAnalysis(\n    analysis: AnalysisResult,\n    options?: {\n      dryRun?: boolean;\n      labels?: string[];\n      assignCopilot?: boolean;\n      repo?: string;\n    }\n  ): Promise<string[]> {\n    const repo = options?.repo ?? this.repo;\n    if (!repo) {\n      throw new Error(\n        'Repository is required for issue creation. Set via:\\n' +\n          \"  - Analyzer constructor: new Analyzer({ repo: 'owner/repo' })\\n\" +\n          '  - setRepo() method\\n' +\n          \"  - createIssuesFromAnalysis() options: { repo: 'owner/repo' }\\n\" +\n          '  - Config file: defaultRepository in agentic.config.json'\n      );\n    }\n\n    const createdIssues: string[] = [];\n    const env = { ...process.env, ...getEnvForPRReview() };\n\n    for (const task of analysis.outstandingTasks) {\n      const labels: string[] = [...(options?.labels || [])];\n\n      if (options?.assignCopilot !== false) {\n        labels.push('copilot');\n      }\n\n      if (task.priority === 'critical' || task.priority === 'high') {\n        labels.push(`priority:${task.priority}`);\n      }\n\n      const body = `## Summary\n${task.description || task.title}\n\n## Priority\n\\`${task.priority.toUpperCase()}\\`\n\n${task.blockers?.length ? `## Blocked By\\n${task.blockers.join('\\n')}\\n` : ''}\n\n## Acceptance Criteria\n- [ ] Implementation complete\n- [ ] Tests added/updated\n- [ ] Documentation updated if needed\n- [ ] CI passes\n\n## Context for AI Agents\nThis issue was auto-generated from agent session analysis.\n- Follow your project's contribution guidelines\n- Versioning is typically managed automatically  avoid manual version bumps\n\n---\n*Generated by agentic-control Analyzer*`;\n\n      if (options?.dryRun) {\n        log.info(`[DRY RUN] Would create issue: ${task.title}`);\n        createdIssues.push(`[DRY RUN] ${task.title}`);\n        continue;\n      }\n\n      try {\n        // Build args array safely - no shell interpolation\n        const args = ['issue', 'create', '--repo', repo, '--title', task.title, '--body-file', '-'];\n\n        // Add labels if any\n        if (labels.length > 0) {\n          args.push('--label', labels.join(','));\n        }\n\n        // Use spawnSync for safe command execution (no shell injection)\n        const proc = spawnSync('gh', args, {\n          input: body,\n          encoding: 'utf-8',\n          env,\n          maxBuffer: 10 * 1024 * 1024, // 10MB\n        });\n\n        if (proc.error) {\n          throw proc.error;\n        }\n\n        if (proc.status !== 0) {\n          throw new Error(proc.stderr || 'gh issue create failed');\n        }\n\n        const result = proc.stdout.trim();\n        createdIssues.push(result);\n        log.info(` Created issue: ${result}`);\n      } catch (err) {\n        log.error(` Failed to create issue: ${task.title}`, err);\n      }\n    }\n\n    return createdIssues;\n  }\n\n  // ============================================\n  // Report Generation\n  // ============================================\n\n  /**\n   * Generate a comprehensive assessment report\n   */\n  async generateReport(conversation: Conversation): Promise<string> {\n    const analysis = await this.analyzeConversation(conversation);\n\n    return `# Agent Session Assessment Report\n\n## Summary\n${analysis.summary}\n\n## Completed Tasks (${analysis.completedTasks.length})\n${analysis.completedTasks\n  .map(\n    (t) => `\n###  ${t.title}\n${t.description || ''}\n`\n  )\n  .join('\\n')}\n\n## Outstanding Tasks (${analysis.outstandingTasks.length})\n${analysis.outstandingTasks\n  .map(\n    (t) => `\n###  ${t.title}\n**Priority**: ${t.priority}\n${t.description || ''}\n${t.blockers?.length ? `**Blocked By**: ${t.blockers.join(', ')}` : ''}\n`\n  )\n  .join('\\n')}\n\n## Blockers (${analysis.blockers.length})\n${analysis.blockers\n  .map(\n    (b) => `\n###  ${b.issue}\n**Severity**: ${b.severity}\n**Suggested Resolution**: ${b.suggestedResolution || 'None provided'}\n`\n  )\n  .join('\\n')}\n\n## Recommendations\n${analysis.recommendations.map((r) => `- ${r}`).join('\\n')}\n\n---\n*Generated by agentic-control Analyzer using ${this.providerName}/${this.model}*\n*Timestamp: ${new Date().toISOString()}*\n`;\n  }\n\n  // ============================================\n  // Private Helper Methods\n  // ============================================\n\n  private prepareConversationText(messages: ConversationMessage[], maxTokens = 100000): string {\n    const maxChars = maxTokens * 4;\n    const APPROX_CHARS_PER_MESSAGE = 500;\n\n    let text = messages\n      .map((m, i) => {\n        const role = m.type === 'user_message' ? 'USER' : 'ASSISTANT';\n        return `[${i + 1}] ${role}:\\n${m.text}\\n`;\n      })\n      .join('\\n---\\n');\n\n    if (text.length > maxChars) {\n      const firstPart = text.slice(0, Math.floor(maxChars * 0.2));\n      const lastPart = text.slice(-Math.floor(maxChars * 0.8));\n      const truncatedChars = text.length - (firstPart.length + lastPart.length);\n      const estimatedMessages = Math.ceil(truncatedChars / APPROX_CHARS_PER_MESSAGE);\n      text = `${firstPart}\\n\\n[... approximately ${estimatedMessages} messages truncated (${truncatedChars} chars) ...]\\n\\n${lastPart}`;\n    }\n\n    return text;\n  }\n\n  private async analyzeFeedback(feedback: FeedbackItem[]): Promise<FeedbackItem[]> {\n    if (feedback.length === 0) return [];\n\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: z.object({\n        items: z.array(\n          z.object({\n            id: z.string(),\n            status: z.enum(['unaddressed', 'addressed', 'dismissed', 'wont_fix']),\n            isAutoResolvable: z.boolean(),\n            suggestedAction: z.string().nullable(),\n          })\n        ),\n      }),\n      prompt: `Analyze these PR feedback items and determine their status.\n\nFeedback items:\n${feedback\n  .map(\n    (f) => `\nID: ${f.id}\nAuthor: ${f.author}\nSeverity: ${f.severity}\nPath: ${f.path ?? 'general'}\nBody: ${f.body}\n---`\n  )\n  .join('\\n')}\n\nFor each item:\n1. Determine if it's addressed (has been fixed/responded to), unaddressed (needs action), dismissed (explicitly dismissed with reason), or wont_fix\n2. Determine if it can be auto-resolved (has suggestion block, is simple fix, etc.)\n3. Suggest the action needed if unaddressed\n\nReturn analysis for each item by ID.`,\n    });\n\n    return feedback.map((item) => {\n      const analysis = object.items.find((a) => a.id === item.id);\n      if (analysis) {\n        return {\n          ...item,\n          status: analysis.status,\n          isAutoResolvable: analysis.isAutoResolvable,\n          suggestedAction: analysis.suggestedAction,\n        };\n      }\n      return item;\n    });\n  }\n\n  private async identifyBlockers(\n    pr: { mergeable: boolean | null; mergeable_state: string },\n    ci: CIStatus,\n    unaddressedFeedback: FeedbackItem[]\n  ): Promise<Blocker[]> {\n    const blockers: Blocker[] = [];\n\n    // CI failures\n    for (const failure of ci.failures) {\n      blockers.push({\n        type: 'ci_failure',\n        description: `CI check \"${failure.name}\" failed`,\n        isAutoResolvable: true,\n        suggestedFix: `Analyze failure logs at ${failure.url} and fix the issue`,\n        url: failure.url,\n        resolved: false,\n      });\n    }\n\n    // Unaddressed critical/high feedback\n    const criticalFeedback = unaddressedFeedback.filter(\n      (f) => f.severity === 'critical' || f.severity === 'high'\n    );\n    if (criticalFeedback.length > 0) {\n      blockers.push({\n        type: 'review_feedback',\n        description: `${criticalFeedback.length} critical/high severity feedback items unaddressed`,\n        isAutoResolvable: criticalFeedback.some((f) => f.isAutoResolvable),\n        suggestedFix: 'Address each feedback item with a fix or justified response',\n        url: null,\n        resolved: false,\n      });\n    }\n\n    // Merge conflicts\n    if (pr.mergeable === false && pr.mergeable_state === 'dirty') {\n      blockers.push({\n        type: 'merge_conflict',\n        description: 'PR has merge conflicts that must be resolved',\n        isAutoResolvable: false,\n        suggestedFix: 'Rebase or merge main branch and resolve conflicts',\n        url: null,\n        resolved: false,\n      });\n    }\n\n    // Branch protection\n    if (pr.mergeable_state === 'blocked') {\n      blockers.push({\n        type: 'branch_protection',\n        description: 'Branch protection rules prevent merge',\n        isAutoResolvable: false,\n        suggestedFix: 'Ensure all required checks pass and approvals are obtained',\n        url: null,\n        resolved: false,\n      });\n    }\n\n    return blockers;\n  }\n\n  private determineStatus(\n    pr: { merged: boolean; state: string },\n    ci: CIStatus,\n    blockers: Blocker[],\n    unaddressedFeedback: FeedbackItem[]\n  ): PRStatus {\n    if (pr.merged) return 'merged';\n    if (pr.state === 'closed') return 'closed';\n\n    const hardBlockers = blockers.filter((b) => !b.isAutoResolvable);\n    if (hardBlockers.length > 0) return 'blocked';\n\n    if (ci.anyPending) return 'needs_ci';\n\n    if (ci.failures.length > 0 || unaddressedFeedback.length > 0) {\n      return 'needs_work';\n    }\n\n    if (ci.allPassing && unaddressedFeedback.length === 0) {\n      return 'ready_to_merge';\n    }\n\n    return 'needs_review';\n  }\n\n  private generateNextActions(\n    status: PRStatus,\n    blockers: Blocker[],\n    unaddressedFeedback: FeedbackItem[]\n  ): TriageResult['nextActions'] {\n    const actions: TriageResult['nextActions'] = [];\n\n    if (status === 'needs_work') {\n      const ciBlockers = blockers.filter((b) => b.type === 'ci_failure');\n      for (const blocker of ciBlockers) {\n        actions.push({\n          action: `Fix CI failure: ${blocker.description}`,\n          priority: 'critical',\n          automated: true,\n          reason: 'CI must pass before merge',\n        });\n      }\n\n      for (const feedback of unaddressedFeedback) {\n        actions.push({\n          action: feedback.isAutoResolvable\n            ? `Auto-fix: ${feedback.suggestedAction ?? feedback.body.slice(0, 100)}`\n            : `Address feedback from ${feedback.author}: ${feedback.body.slice(0, 100)}`,\n          priority: feedback.severity,\n          automated: feedback.isAutoResolvable,\n          reason: `${feedback.severity} severity feedback requires resolution`,\n        });\n      }\n    }\n\n    if (status === 'needs_review') {\n      actions.push({\n        action: 'Request AI reviews: /gemini review, /q review',\n        priority: 'high',\n        automated: true,\n        reason: 'AI review required before merge',\n      });\n    }\n\n    if (status === 'ready_to_merge') {\n      actions.push({\n        action: 'Merge PR',\n        priority: 'high',\n        automated: false,\n        reason: 'All checks pass and feedback addressed',\n      });\n    }\n\n    return actions;\n  }\n\n  private async generatePRSummary(\n    pr: { title: string },\n    ci: CIStatus,\n    blockers: Blocker[],\n    unaddressedFeedback: FeedbackItem[]\n  ): Promise<string> {\n    const { text } = await generateText({\n      model: (await this.getModel()) as Parameters<typeof generateText>[0]['model'],\n      prompt: `Generate a concise summary of this PR's triage status.\n\nPR: ${pr.title}\nCI: ${ci.allPassing ? ' All passing' : ci.anyPending ? ' Pending' : ` ${ci.failures.length} failures`}\nBlockers: ${blockers.length > 0 ? blockers.map((b) => b.description).join(', ') : 'None'}\nUnaddressed feedback: ${unaddressedFeedback.length} items\n\nWrite 2-3 sentences summarizing the current state and what needs to happen next.`,\n    });\n\n    return text;\n  }\n}\n\n// ============================================\n// Legacy Aliases for backwards compatibility\n// ============================================\n\n/** @deprecated Use Analyzer instead */\nexport { Analyzer as AIAnalyzer };\nexport type { AnalyzerOptions as AIAnalyzerOptions };\n","/**\n * Station-to-Station Handoff Protocol\n *\n * Enables seamless agent continuity:\n * 1. Current agent completes scope of work\n * 2. Spawns successor agent (not sub-agent - its own master)\n * 3. Successor confirms health via fleet tooling\n * 4. Successor retrieves predecessor's conversation\n * 5. Successor merges predecessor's PR\n * 6. Successor opens own PR and continues work\n *\n * All configuration is user-provided - no hardcoded values.\n */\n\nimport { spawnSync } from 'node:child_process';\nimport { randomUUID } from 'node:crypto';\nimport { existsSync, mkdirSync, writeFileSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { getConfig, log } from '../core/config.js';\nimport { getEnvForRepo } from '../core/tokens.js';\nimport type { HandoffContext, HandoffOptions, HandoffResult, Result } from '../core/types.js';\nimport { CursorAPI } from '../fleet/cursor-api.js';\nimport { AIAnalyzer } from '../triage/analyzer.js';\n\n// ============================================\n// Types\n// ============================================\n\nexport type MergeMethod = 'merge' | 'squash' | 'rebase';\n\nexport interface TakeoverOptions {\n  admin?: boolean;\n  auto?: boolean;\n  mergeMethod?: MergeMethod;\n  deleteBranch?: boolean;\n}\n\n// ============================================\n// Validation Helpers\n// ============================================\n\n/**\n * Validate branch name to prevent injection\n */\nfunction isValidBranchName(branch: string): boolean {\n  return /^[a-zA-Z0-9._/-]+$/.test(branch) && branch.length <= 200;\n}\n\n// isValidGitRef is available from github/client.ts if needed\n\n// ============================================\n// Handoff Manager\n// ============================================\n\nexport class HandoffManager {\n  private api: CursorAPI | null;\n  private analyzer: AIAnalyzer | null;\n  private repo: string | undefined;\n\n  constructor(options?: { cursorApiKey?: string; anthropicKey?: string; repo?: string }) {\n    // Initialize Cursor API if available\n    try {\n      this.api = new CursorAPI({ apiKey: options?.cursorApiKey });\n    } catch {\n      this.api = null;\n      log.warn('Cursor API not available for handoff operations');\n    }\n\n    // Initialize AI Analyzer if available\n    try {\n      this.analyzer = new AIAnalyzer({ apiKey: options?.anthropicKey });\n    } catch {\n      this.analyzer = null;\n      log.warn('AI Analyzer not available for handoff analysis');\n    }\n\n    // No hardcoded default - repo must be explicitly configured\n    this.repo = options?.repo ?? getConfig().defaultRepository;\n  }\n\n  /**\n   * Set the repository for GitHub operations\n   */\n  setRepo(repo: string): void {\n    this.repo = repo;\n  }\n\n  /**\n   * Initiate handoff to successor agent\n   */\n  async initiateHandoff(predecessorId: string, options: HandoffOptions): Promise<HandoffResult> {\n    log.info('=== Station-to-Station Handoff Initiated ===');\n\n    if (!this.api) {\n      return { success: false, error: 'Cursor API not available' };\n    }\n\n    // 1. Analyze predecessor's conversation\n    log.info(' Analyzing predecessor conversation...');\n    const convResult = await this.api.getAgentConversation(predecessorId);\n    if (!convResult.success || !convResult.data) {\n      return { success: false, error: `Failed to get conversation: ${convResult.error}` };\n    }\n\n    let completedWork: string[] = [];\n    let outstandingTasks: string[] = options.tasks ?? [];\n    let decisions: string[] = [];\n\n    // Use AI analysis if available\n    if (this.analyzer) {\n      try {\n        const analysis = await this.analyzer.analyzeConversation(convResult.data);\n        completedWork = analysis.completedTasks.map((t) => t.title);\n        outstandingTasks = [\n          ...analysis.outstandingTasks.map((t) => `[${t.priority}] ${t.title}`),\n          ...outstandingTasks,\n        ];\n        decisions = analysis.recommendations;\n      } catch (err) {\n        log.warn('AI analysis failed, using minimal context:', err);\n      }\n    }\n\n    // 2. Build handoff context - use crypto.randomUUID() for unique IDs\n    const handoffContext: HandoffContext = {\n      predecessorId,\n      predecessorPr: options.currentPr,\n      predecessorBranch: options.currentBranch,\n      handoffTime: new Date().toISOString(),\n      completedWork: completedWork.map((w) => ({\n        id: `completed-${randomUUID()}`,\n        title: w,\n        description: w,\n        priority: 'medium' as const,\n        category: 'other' as const,\n        status: 'completed' as const,\n      })),\n      outstandingTasks: outstandingTasks.map((t) => ({\n        id: `task-${randomUUID()}`,\n        title: t,\n        description: t,\n        priority: 'medium' as const,\n        category: 'other' as const,\n        status: 'pending' as const,\n      })),\n      decisions,\n    };\n\n    // 3. Save handoff context\n    const handoffDir = join('.cursor', 'handoff', predecessorId);\n    if (!existsSync(handoffDir)) {\n      mkdirSync(handoffDir, { recursive: true });\n    }\n    writeFileSync(join(handoffDir, 'context.json'), JSON.stringify(handoffContext, null, 2));\n\n    // 4. Build successor prompt\n    const successorPrompt = this.buildSuccessorPrompt(handoffContext, options);\n\n    // 5. Spawn successor agent\n    log.info(' Spawning successor agent...');\n    const spawnResult = await this.api.launchAgent({\n      prompt: { text: successorPrompt },\n      source: {\n        repository: options.repository,\n        ref: options.ref ?? 'main',\n      },\n    });\n\n    if (!spawnResult.success || !spawnResult.data) {\n      return { success: false, error: `Failed to spawn successor: ${spawnResult.error}` };\n    }\n\n    const successorId = spawnResult.data.id;\n    log.info(` Successor spawned: ${successorId}`);\n\n    // 6. Wait for health check\n    log.info(' Waiting for successor health confirmation...');\n    const healthCheckResult = await this.waitForHealthCheck(\n      successorId,\n      options.healthCheckTimeout ?? 300000\n    );\n\n    return {\n      success: true,\n      successorId,\n      successorHealthy: healthCheckResult.healthy,\n    };\n  }\n\n  /**\n   * Called by successor to confirm health\n   */\n  async confirmHealthAndBegin(successorId: string, predecessorId: string): Promise<void> {\n    if (!this.api) {\n      throw new Error('Cursor API not available');\n    }\n\n    await this.api.addFollowup(predecessorId, {\n      text: ` HANDOFF CONFIRMED\n\nSuccessor agent ${successorId} is healthy and beginning work.\n\nI will now:\n1. Review your conversation history\n2. Merge your PR\n3. Open my own PR\n4. Continue the outstanding tasks\n\nYou can safely conclude your session.\n\n@cursor  HANDOFF: ${successorId} confirmed healthy`,\n    });\n  }\n\n  /**\n   * Called by successor to merge predecessor and take over\n   */\n  async takeover(\n    predecessorId: string,\n    predecessorPr: number,\n    newBranchName: string,\n    options?: TakeoverOptions\n  ): Promise<Result<void>> {\n    log.info('=== Successor Takeover ===');\n\n    if (!this.repo) {\n      return {\n        success: false,\n        error: 'Repository is required. Set via constructor options or setRepo()',\n      };\n    }\n\n    // Validate inputs to prevent injection\n    if (!isValidBranchName(newBranchName)) {\n      return { success: false, error: 'Invalid branch name format' };\n    }\n\n    if (options?.admin && options?.auto) {\n      return { success: false, error: 'Cannot use --admin and --auto simultaneously' };\n    }\n\n    // Use appropriate token for the repo\n    const env = { ...process.env, ...getEnvForRepo(this.repo) };\n\n    // 1. Merge predecessor's PR using spawnSync (no shell injection)\n    log.info(` Merging predecessor PR #${predecessorPr}...`);\n    try {\n      const mergeMethod = options?.mergeMethod ?? 'squash';\n      const deleteBranch = options?.deleteBranch !== false;\n\n      // Build args array safely\n      const mergeArgs = [\n        'pr',\n        'merge',\n        String(predecessorPr),\n        `--${mergeMethod}`,\n        '--repo',\n        this.repo,\n      ];\n\n      if (deleteBranch) {\n        mergeArgs.push('--delete-branch');\n      }\n\n      if (options?.admin) {\n        mergeArgs.push('--admin');\n      } else if (options?.auto) {\n        mergeArgs.push('--auto');\n      }\n\n      const mergeProc = spawnSync('gh', mergeArgs, { encoding: 'utf-8', env });\n      if (mergeProc.error || mergeProc.status !== 0) {\n        return {\n          success: false,\n          error: `Failed to merge PR: ${mergeProc.stderr || mergeProc.error}`,\n        };\n      }\n      log.info(' Predecessor PR merged');\n    } catch (err) {\n      return { success: false, error: `Failed to merge PR: ${err}` };\n    }\n\n    // 2. Pull latest main using spawnSync\n    log.info(' Pulling latest main...');\n    try {\n      // First checkout main\n      const checkoutMain = spawnSync('git', ['checkout', 'main'], { encoding: 'utf-8' });\n      if (checkoutMain.error || checkoutMain.status !== 0) {\n        return {\n          success: false,\n          error: `Failed to checkout main: ${checkoutMain.stderr || checkoutMain.error}`,\n        };\n      }\n\n      // Then pull\n      const pullProc = spawnSync('git', ['pull'], { encoding: 'utf-8' });\n      if (pullProc.error || pullProc.status !== 0) {\n        return {\n          success: false,\n          error: `Failed to pull main: ${pullProc.stderr || pullProc.error}`,\n        };\n      }\n    } catch (err) {\n      return { success: false, error: `Failed to pull main: ${err}` };\n    }\n\n    // 3. Create own branch using spawnSync (with validated branch name)\n    log.info(` Creating branch: ${newBranchName}...`);\n    try {\n      const branchProc = spawnSync('git', ['checkout', '-b', newBranchName], {\n        encoding: 'utf-8',\n      });\n      if (branchProc.error || branchProc.status !== 0) {\n        return {\n          success: false,\n          error: `Failed to create branch: ${branchProc.stderr || branchProc.error}`,\n        };\n      }\n    } catch (err) {\n      return { success: false, error: `Failed to create branch: ${err}` };\n    }\n\n    // 4. Notify predecessor\n    if (this.api) {\n      await this.api.addFollowup(predecessorId, {\n        text: ` TAKEOVER COMPLETE\n\nI have:\n1. Merged your PR #${predecessorPr}\n2. Created my own branch: ${newBranchName}\n3. Loaded your context\n\nYour session is now complete. Thank you!\n\n@cursor  DONE: ${predecessorId} successfully handed off`,\n      });\n    }\n\n    log.info(' Takeover complete');\n    return { success: true };\n  }\n\n  /**\n   * Build successor prompt\n   */\n  private buildSuccessorPrompt(context: HandoffContext, options: HandoffOptions): string {\n    return `# STATION-TO-STATION HANDOFF\n\nYou are a SUCCESSOR AGENT taking over from predecessor ${context.predecessorId}.\n\n## CRITICAL FIRST STEPS\n\n1. **IMMEDIATELY** send health confirmation:\n   \\`\\`\\`\n   agentic handoff confirm ${context.predecessorId}\n   \\`\\`\\`\n\n2. **LOAD** predecessor context from:\n   \\`.cursor/handoff/${context.predecessorId}/\\`\n\n3. **TAKEOVER** from predecessor:\n   \\`\\`\\`\n   agentic handoff takeover ${context.predecessorId} ${context.predecessorPr} successor/continue-work-$(date +%Y%m%d)\n   \\`\\`\\`\n\n4. **CREATE YOUR OWN HOLD-OPEN PR** and continue work.\n\n## PREDECESSOR SUMMARY\n\n### Completed Work\n${context.completedWork.map((t) => `- ${t.title}`).join('\\n')}\n\n### Outstanding Tasks (YOUR WORK)\n${context.outstandingTasks.map((t) => `- ${t.title}`).join('\\n')}\n\n### Recommendations\n${context.decisions.map((d) => `- ${d}`).join('\\n')}\n\n## IMPORTANT\n\n- You are NOT a sub-agent - you are an independent master agent\n- Predecessor PR #${context.predecessorPr} on branch \\`${context.predecessorBranch}\\`\n- Repository: ${options.repository}\n- Handoff time: ${context.handoffTime}\n\nBEGIN by sending health confirmation NOW.\n`;\n  }\n\n  /**\n   * Wait for health check from successor\n   */\n  private async waitForHealthCheck(\n    successorId: string,\n    timeout: number\n  ): Promise<{ healthy: boolean }> {\n    if (!this.api) {\n      return { healthy: false };\n    }\n\n    const start = Date.now();\n    const interval = 15000;\n\n    while (Date.now() - start < timeout) {\n      const status = await this.api.getAgentStatus(successorId);\n\n      if (status.success && status.data) {\n        if (status.data.status === 'RUNNING') {\n          const conv = await this.api.getAgentConversation(successorId);\n          if (conv.success && conv.data) {\n            const messages = conv.data.messages || [];\n            for (const msg of messages) {\n              if (msg.text?.includes('HANDOFF CONFIRMED')) {\n                return { healthy: true };\n              }\n            }\n          }\n        } else if (status.data.status === 'FAILED') {\n          return { healthy: false };\n        }\n      }\n\n      await new Promise((r) => setTimeout(r, interval));\n    }\n\n    return { healthy: false };\n  }\n}\n","/**\n * Security utilities for safe error reporting and token sanitization\n */\n\n/**\n * Sanitize error messages to remove sensitive tokens\n */\nexport function sanitizeError(error: string | Error): string {\n  const message = error instanceof Error ? error.message : error;\n\n  // Patterns for common token formats\n  const tokenPatterns = [\n    // GitHub tokens: ghp_, gho_, ghu_, ghs_, ghr_\n    /gh[pous]_[A-Za-z0-9_]{36,}/g,\n    // GitHub fine-grained tokens: github_pat_\n    /github_pat_[A-Za-z0-9_]{82}/g,\n    // Anthropic API keys: sk-ant-\n    /sk-ant-[A-Za-z0-9_-]{95,}/g,\n    // OpenAI API keys: sk-\n    /sk-[A-Za-z0-9]{48,}/g,\n    // Generic API key patterns\n    /[A-Za-z0-9_-]{32,}/g,\n  ];\n\n  let sanitized = message;\n\n  for (const pattern of tokenPatterns) {\n    sanitized = sanitized.replace(pattern, '[REDACTED_TOKEN]');\n  }\n\n  return sanitized;\n}\n\n/**\n * Sanitize environment variables from error messages\n */\nexport function sanitizeEnvironment(\n  env: Record<string, string | undefined>\n): Record<string, string> {\n  const sanitized: Record<string, string> = {};\n\n  for (const [key, value] of Object.entries(env)) {\n    if (value === undefined) {\n      sanitized[key] = 'undefined';\n    } else if (\n      key.toLowerCase().includes('token') ||\n      key.toLowerCase().includes('key') ||\n      key.toLowerCase().includes('secret')\n    ) {\n      sanitized[key] = value ? '[REDACTED]' : '(not set)';\n    } else {\n      sanitized[key] = value;\n    }\n  }\n\n  return sanitized;\n}\n\n/**\n * Create a safe error for logging that removes sensitive information\n */\nexport function createSafeError(message: string, originalError?: Error): Error {\n  const sanitizedMessage = sanitizeError(message);\n  const error = new Error(sanitizedMessage);\n\n  if (originalError) {\n    error.cause = new Error(sanitizeError(originalError.message));\n    error.stack = originalError.stack ? sanitizeError(originalError.stack) : undefined;\n  }\n\n  return error;\n}\n\n/**\n * Safe console logging that sanitizes output\n */\nexport const safeConsole = {\n  log: (message: string, ...args: unknown[]) => {\n    console.log(\n      sanitizeError(message),\n      ...args.map((arg) => (typeof arg === 'string' ? sanitizeError(arg) : arg))\n    );\n  },\n\n  error: (message: string, ...args: unknown[]) => {\n    console.error(\n      sanitizeError(message),\n      ...args.map((arg) => (typeof arg === 'string' ? sanitizeError(arg) : arg))\n    );\n  },\n\n  warn: (message: string, ...args: unknown[]) => {\n    console.warn(\n      sanitizeError(message),\n      ...args.map((arg) => (typeof arg === 'string' ? sanitizeError(arg) : arg))\n    );\n  },\n};\n","/**\n * Safe subprocess execution utilities\n */\n\nimport { type SpawnOptions, type SpawnSyncOptions, spawn, spawnSync } from 'node:child_process';\nimport { sanitizeError } from './security.js';\n\n// ============================================\n// Safe Execution Functions\n// ============================================\n\n/**\n * Safely execute a command with array-based arguments (no shell interpolation)\n */\nexport function safeSpawnSync(\n  command: string,\n  args: string[] = [],\n  options: SpawnSyncOptions = {}\n): { success: boolean; stdout: string; stderr: string; code: number | null } {\n  // Validate inputs\n  if (typeof command !== 'string' || command.trim() === '') {\n    throw new Error('Command must be a non-empty string');\n  }\n\n  if (!Array.isArray(args)) {\n    throw new Error('Arguments must be an array');\n  }\n\n  // Ensure we don't use shell\n  const safeOptions: SpawnSyncOptions = {\n    ...options,\n    shell: false, // Explicitly disable shell to prevent injection\n    encoding: 'utf-8',\n  };\n\n  try {\n    const result = spawnSync(command, args, safeOptions);\n\n    return {\n      success: result.status === 0,\n      stdout: result.stdout?.toString() ?? '',\n      stderr: result.stderr?.toString() ?? '',\n      code: result.status,\n    };\n  } catch (error) {\n    const sanitizedError = sanitizeError(error instanceof Error ? error.message : String(error));\n    throw new Error(`Command execution failed: ${sanitizedError}`);\n  }\n}\n\n/**\n * Safely execute a command asynchronously with array-based arguments\n */\nexport function safeSpawn(\n  command: string,\n  args: string[] = [],\n  options: SpawnOptions = {}\n): Promise<{ success: boolean; stdout: string; stderr: string; code: number | null }> {\n  return new Promise((resolve, reject) => {\n    // Validate inputs\n    if (typeof command !== 'string' || command.trim() === '') {\n      reject(new Error('Command must be a non-empty string'));\n      return;\n    }\n\n    if (!Array.isArray(args)) {\n      reject(new Error('Arguments must be an array'));\n      return;\n    }\n\n    // Ensure we don't use shell\n    const safeOptions: SpawnOptions = {\n      ...options,\n      shell: false, // Explicitly disable shell to prevent injection\n    };\n\n    const child = spawn(command, args, safeOptions);\n\n    let stdout = '';\n    let stderr = '';\n\n    child.stdout?.on('data', (data) => {\n      stdout += data.toString();\n    });\n\n    child.stderr?.on('data', (data) => {\n      stderr += data.toString();\n    });\n\n    child.on('close', (code) => {\n      resolve({\n        success: code === 0,\n        stdout,\n        stderr,\n        code,\n      });\n    });\n\n    child.on('error', (error) => {\n      const sanitizedError = sanitizeError(error.message);\n      reject(new Error(`Command execution failed: ${sanitizedError}`));\n    });\n  });\n}\n\n/**\n * Validate command arguments to prevent injection\n */\nexport function validateCommandArgs(args: string[]): void {\n  for (const arg of args) {\n    if (typeof arg !== 'string') {\n      throw new Error('All command arguments must be strings');\n    }\n\n    // Check for potentially dangerous characters that could be used for injection\n    if (arg.includes('\\n') || arg.includes('\\r')) {\n      throw new Error('Command arguments cannot contain newline characters');\n    }\n\n    // Check for null bytes (common injection technique)\n    if (arg.includes('\\0')) {\n      throw new Error('Command arguments cannot contain null bytes');\n    }\n  }\n}\n\n/**\n * Safely execute git commands with validation\n */\nexport function safeGitCommand(args: string[], options: SpawnSyncOptions = {}) {\n  // Validate git arguments\n  validateCommandArgs(args);\n\n  // Additional git-specific validation\n  const allowedGitCommands = [\n    'diff',\n    'log',\n    'show',\n    'status',\n    'branch',\n    'remote',\n    'config',\n    'rev-parse',\n    'ls-remote',\n    'fetch',\n    'pull',\n    'push',\n    'clone',\n    'checkout',\n    'merge',\n    'rebase',\n    'commit',\n    'add',\n    'reset',\n  ];\n\n  const firstArg = args[0];\n  if (!firstArg || !allowedGitCommands.includes(firstArg)) {\n    throw new Error(`Git command not allowed: ${firstArg ?? '(empty)'}`);\n  }\n\n  return safeSpawnSync('git', args, options);\n}\n\n/**\n * Safely execute docker commands with validation\n */\nexport function safeDockerCommand(args: string[], options: SpawnSyncOptions = {}) {\n  // Validate docker arguments\n  validateCommandArgs(args);\n\n  // Additional docker-specific validation\n  const allowedDockerCommands = [\n    'build',\n    'run',\n    'exec',\n    'ps',\n    'images',\n    'pull',\n    'push',\n    'start',\n    'stop',\n    'restart',\n    'rm',\n    'rmi',\n    'logs',\n    'inspect',\n    'create',\n    'cp',\n    'stats',\n    'top',\n    'version',\n    'info',\n  ];\n\n  const firstArg = args[0];\n  if (!firstArg || !allowedDockerCommands.includes(firstArg)) {\n    throw new Error(`Docker command not allowed: ${firstArg ?? '(empty)'}`);\n  }\n\n  return safeSpawnSync('docker', args, options);\n}\n","/**\n * Docker container lifecycle management\n */\n\nimport { randomUUID } from 'node:crypto';\nimport { safeDockerCommand, safeSpawn } from '../core/subprocess.js';\nimport type { ContainerConfig, ContainerResult } from './types.js';\n\nexport class ContainerManager {\n  async create(config: ContainerConfig): Promise<string> {\n    const containerId = `agentic-sandbox-${randomUUID().slice(0, 8)}`;\n\n    const dockerArgs = [\n      'create',\n      '--name',\n      containerId,\n      '--rm',\n      '--workdir',\n      '/workspace',\n      '-v',\n      `${config.workspace}:/workspace:ro`,\n      '-v',\n      `${config.outputDir}:/output`,\n    ];\n\n    // Add memory limit if specified\n    if (config.memory) {\n      dockerArgs.push('-m', `${config.memory}m`);\n    }\n\n    // Add environment variables\n    if (config.env) {\n      for (const [key, value] of Object.entries(config.env)) {\n        dockerArgs.push('-e', `${key}=${value}`);\n      }\n    }\n\n    // Use the appropriate image based on runtime\n    const image = this.getImageForRuntime(config.runtime);\n    dockerArgs.push(image);\n\n    const result = safeDockerCommand(dockerArgs);\n    if (!result.success) {\n      throw new Error(`Failed to create container: ${result.stderr}`);\n    }\n\n    return containerId;\n  }\n\n  async start(containerId: string): Promise<void> {\n    const result = safeDockerCommand(['start', containerId]);\n    if (!result.success) {\n      throw new Error(`Failed to start container ${containerId}: ${result.stderr}`);\n    }\n  }\n\n  async stop(containerId: string): Promise<void> {\n    const result = safeDockerCommand(['stop', containerId]);\n    if (!result.success) {\n      // Container might already be stopped, which is fine\n      console.warn(`Warning: Could not stop container ${containerId}: ${result.stderr}`);\n    }\n  }\n\n  async remove(containerId: string): Promise<void> {\n    const result = safeDockerCommand(['rm', '-f', containerId]);\n    if (!result.success) {\n      // Container might already be removed, which is fine\n      console.warn(`Warning: Could not remove container ${containerId}: ${result.stderr}`);\n    }\n  }\n\n  async exec(containerId: string, command: string[]): Promise<ContainerResult> {\n    const startTime = Date.now();\n\n    const dockerArgs = ['exec', containerId, ...command];\n\n    try {\n      const result = await safeSpawn('docker', dockerArgs);\n      const duration = Date.now() - startTime;\n\n      return {\n        success: result.success,\n        output: result.stdout,\n        error: result.stderr,\n        exitCode: result.code || 0,\n        duration,\n      };\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        exitCode: 1,\n        duration,\n      };\n    }\n  }\n\n  async logs(containerId: string): Promise<string> {\n    const result = safeDockerCommand(['logs', containerId]);\n    if (!result.success) {\n      throw new Error(`Failed to get logs for container ${containerId}: ${result.stderr}`);\n    }\n    return result.stdout;\n  }\n\n  private getImageForRuntime(runtime: string): string {\n    switch (runtime) {\n      case 'claude':\n      case 'cursor':\n        return 'jbcom/agentic-control:latest';\n      case 'custom':\n        return 'jbcom/agentic-control:latest';\n      default:\n        return 'jbcom/agentic-control:latest';\n    }\n  }\n}\n","/**\n * Claude runtime adapter for sandbox execution\n */\n\nimport type { AgentOutput, RuntimeAdapter, RuntimeOptions } from '../types.js';\n\nexport class ClaudeRuntime implements RuntimeAdapter {\n  readonly name = 'claude';\n  readonly image = 'jbcom/agentic-control:latest';\n\n  prepareCommand(prompt: string, options: RuntimeOptions): string[] {\n    const command = ['npx', '@anthropic-ai/claude-agent-sdk', 'query', '--prompt', prompt];\n\n    if (options.timeout) {\n      command.push('--timeout', options.timeout.toString());\n    }\n\n    return command;\n  }\n\n  parseOutput(stdout: string, stderr: string): AgentOutput {\n    try {\n      // Try to parse as JSON first\n      const parsed = JSON.parse(stdout);\n      return {\n        result: parsed.result || stdout,\n        files: parsed.files || [],\n        error: stderr || parsed.error,\n      };\n    } catch {\n      // Fallback to plain text\n      return {\n        result: stdout,\n        files: [],\n        error: stderr,\n      };\n    }\n  }\n\n  async validateEnvironment(): Promise<boolean> {\n    return !!process.env.ANTHROPIC_API_KEY;\n  }\n}\n","/**\n * Cursor runtime adapter for sandbox execution\n */\n\nimport type { AgentOutput, RuntimeAdapter, RuntimeOptions } from '../types.js';\n\nexport class CursorRuntime implements RuntimeAdapter {\n  readonly name = 'cursor';\n  readonly image = 'jbcom/agentic-control:latest';\n\n  prepareCommand(prompt: string, options: RuntimeOptions): string[] {\n    const command = ['cursor-agent', 'run', '--task', prompt];\n\n    if (options.timeout) {\n      command.push('--timeout', options.timeout.toString());\n    }\n\n    return command;\n  }\n\n  parseOutput(stdout: string, stderr: string): AgentOutput {\n    try {\n      // Try to parse as JSON first\n      const parsed = JSON.parse(stdout);\n      return {\n        result: parsed.result || stdout,\n        files: parsed.files || [],\n        error: stderr || parsed.error,\n      };\n    } catch {\n      // Fallback to plain text\n      return {\n        result: stdout,\n        files: [],\n        error: stderr,\n      };\n    }\n  }\n\n  async validateEnvironment(): Promise<boolean> {\n    return !!process.env.CURSOR_API_KEY;\n  }\n}\n","/**\n * Main sandbox executor for running AI agents in containers\n */\n\nimport { ContainerManager } from './container.js';\nimport { ClaudeRuntime, CursorRuntime } from './runtime/index.js';\nimport type { ContainerResult, RuntimeAdapter, SandboxOptions } from './types.js';\n\nexport class SandboxExecutor {\n  private containerManager: ContainerManager;\n  private runtimes: Map<string, RuntimeAdapter>;\n\n  constructor() {\n    this.containerManager = new ContainerManager();\n    this.runtimes = new Map<string, RuntimeAdapter>([\n      ['claude', new ClaudeRuntime()],\n      ['cursor', new CursorRuntime()],\n    ]);\n  }\n\n  async execute(options: SandboxOptions): Promise<ContainerResult> {\n    const runtime = this.runtimes.get(options.runtime);\n    if (!runtime) {\n      throw new Error(`Unknown runtime: ${options.runtime}`);\n    }\n\n    // Validate environment\n    const isValid = await runtime.validateEnvironment();\n    if (!isValid) {\n      throw new Error(`Environment validation failed for runtime: ${options.runtime}`);\n    }\n\n    const containerId = await this.containerManager.create({\n      runtime: options.runtime,\n      workspace: options.workspace,\n      outputDir: options.outputDir,\n      memory: options.memory,\n      timeout: options.timeout,\n      env: options.env,\n    });\n\n    try {\n      await this.containerManager.start(containerId);\n      const command = runtime.prepareCommand(options.prompt, {\n        timeout: options.timeout,\n        memory: options.memory,\n        env: options.env,\n      });\n\n      const result = await this.containerManager.exec(containerId, command);\n\n      // Parse the output using the runtime adapter\n      if (result.success && result.output) {\n        const parsed = runtime.parseOutput(result.output, result.error || '');\n        return {\n          ...result,\n          output: JSON.stringify(parsed),\n        };\n      }\n\n      return result;\n    } finally {\n      await this.containerManager.stop(containerId);\n      await this.containerManager.remove(containerId);\n    }\n  }\n\n  async executeFleet(options: SandboxOptions[]): Promise<ContainerResult[]> {\n    // Execute all sandboxes in parallel\n    const promises = options.map((option) => this.execute(option));\n    return Promise.all(promises);\n  }\n}\n","/**\n * Agent - Unified AI-powered development agent\n *\n * A single, comprehensive agent that handles all agentic tasks:\n * - Code operations (bash, file editing, git)\n * - MCP integrations (Cursor, GitHub, Context7)\n * - Extended thinking/reasoning\n * - Web search\n * - Structured output\n * - Tool approval for sensitive operations\n *\n * This consolidates CodeAgent, EnhancedAgent, and UnifiedAgent into one class.\n */\n\nimport { execFileSync, execSync } from 'node:child_process';\nimport { existsSync, mkdirSync, readFileSync, unlinkSync, writeFileSync } from 'node:fs';\nimport { dirname } from 'node:path';\nimport { type AnthropicProviderOptions, anthropic } from '@ai-sdk/anthropic';\nimport { generateObject, generateText, stepCountIs, streamText, type ToolSet, tool } from 'ai';\nimport { z } from 'zod';\nimport {\n  closeMCPClients,\n  getMCPTools,\n  initializeMCPClients,\n  type MCPClientConfig,\n  type MCPClients,\n} from './mcp-clients.js';\nimport { assessCommandSafety, validatePath } from './security.js';\n\n// \n// Configuration Types\n// \n\nexport interface AgentConfig {\n  /** Working directory for file operations (sandbox root) */\n  workingDirectory?: string;\n  /** Maximum steps for multi-step tool calls */\n  maxSteps?: number;\n  /** MCP client configuration */\n  mcp?: MCPClientConfig;\n  /** Model to use */\n  model?: 'claude-sonnet-4-20250514' | 'claude-opus-4-20250514' | string;\n  /** Enable verbose logging */\n  verbose?: boolean;\n  /** Enable extended thinking/reasoning for complex tasks */\n  reasoning?: {\n    enabled: boolean;\n    /** Token budget for thinking (default: 12000) */\n    budgetTokens?: number;\n  };\n  /** Enable web search capability */\n  webSearch?: {\n    enabled: boolean;\n    /** Max number of searches per request */\n    maxUses?: number;\n    /** Allowed domains for search */\n    allowedDomains?: string[];\n    /** Blocked domains */\n    blockedDomains?: string[];\n  };\n  /** Tool approval settings */\n  approval?: {\n    /** Tools requiring approval before execution */\n    requireApproval?: string[];\n    /** Callback to handle approval requests */\n    onApprovalRequest?: (toolName: string, input: unknown) => Promise<boolean>;\n  };\n}\n\nexport interface AgentResult {\n  success: boolean;\n  result: string;\n  reasoning?: string;\n  steps: AgentStep[];\n  usage?: {\n    inputTokens: number;\n    outputTokens: number;\n    totalTokens: number;\n  };\n}\n\nexport interface AgentStep {\n  toolName: string;\n  input: unknown;\n  output: string;\n  timestamp: Date;\n  approved?: boolean;\n}\n\n// \n// Structured Output Schemas\n// \n\nexport const TaskAnalysisSchema = z.object({\n  complexity: z.enum(['simple', 'moderate', 'complex']).describe('Task complexity assessment'),\n  estimatedSteps: z.number().describe('Estimated number of steps to complete'),\n  requiresWebSearch: z.boolean().describe('Whether web search might help'),\n  requiresReasoning: z.boolean().describe('Whether extended thinking would help'),\n  subtasks: z.array(\n    z.object({\n      description: z.string(),\n      priority: z.enum(['critical', 'high', 'medium', 'low']),\n      tools: z.array(z.string()).describe('Tools likely needed'),\n    })\n  ),\n  risks: z.array(z.string()).describe('Potential risks or blockers'),\n});\n\nexport type TaskAnalysis = z.infer<typeof TaskAnalysisSchema>;\n\n// \n// Agent Class\n// \n\nexport class Agent {\n  private config: Required<Omit<AgentConfig, 'mcp' | 'reasoning' | 'webSearch' | 'approval'>> & {\n    mcp?: MCPClientConfig;\n    reasoning?: AgentConfig['reasoning'];\n    webSearch?: AgentConfig['webSearch'];\n    approval?: AgentConfig['approval'];\n  };\n  private mcpClients: MCPClients | null = null;\n  private initialized = false;\n  /** Promise-based lock to prevent concurrent initialization race conditions */\n  private initializationPromise: Promise<void> | null = null;\n\n  constructor(config: AgentConfig = {}) {\n    this.config = {\n      workingDirectory: config.workingDirectory ?? process.cwd(),\n      maxSteps: config.maxSteps ?? 25,\n      model: config.model ?? 'claude-sonnet-4-20250514',\n      verbose: config.verbose ?? false,\n      mcp: config.mcp,\n      reasoning: config.reasoning,\n      webSearch: config.webSearch,\n      approval: config.approval,\n    };\n  }\n\n  // \n  // Lifecycle\n  // \n\n  /**\n   * Initialize MCP clients and prepare the agent.\n   * Thread-safe: concurrent calls will wait for the same initialization to complete.\n   */\n  async initialize(): Promise<void> {\n    // Fast path: already initialized\n    if (this.initialized) return;\n\n    // If initialization is in progress, wait for it to complete\n    if (this.initializationPromise) {\n      return this.initializationPromise;\n    }\n\n    // Start initialization and store the promise so concurrent calls can wait\n    this.initializationPromise = this.doInitialize();\n\n    try {\n      await this.initializationPromise;\n    } catch (error) {\n      // Reset on failure so retry is possible\n      this.initializationPromise = null;\n      throw error;\n    }\n  }\n\n  /**\n   * Internal initialization logic - only called once due to promise lock\n   */\n  private async doInitialize(): Promise<void> {\n    this.log(' Initializing Agent...');\n\n    if (this.config.mcp) {\n      this.mcpClients = await initializeMCPClients(this.config.mcp);\n    }\n\n    this.initialized = true;\n    this.log(' Agent initialized');\n  }\n\n  /**\n   * Close all connections and clean up\n   */\n  async close(): Promise<void> {\n    if (this.mcpClients) {\n      await closeMCPClients(this.mcpClients);\n      this.mcpClients = null;\n    }\n    this.initialized = false;\n  }\n\n  // \n  // Core Execution Methods\n  // \n\n  /**\n   * Execute a task with full tool access\n   */\n  async execute(\n    task: string,\n    options?: {\n      enableReasoning?: boolean;\n      enableWebSearch?: boolean;\n    }\n  ): Promise<AgentResult> {\n    await this.initialize();\n\n    const steps: AgentStep[] = [];\n    const recordStep = (toolName: string, input: unknown, output: string, approved?: boolean) => {\n      steps.push({ toolName, input, output, timestamp: new Date(), approved });\n      if (this.config.verbose) {\n        console.log(\n          `   ${toolName}:`,\n          typeof input === 'string' ? input.slice(0, 100) : JSON.stringify(input).slice(0, 100)\n        );\n      }\n    };\n\n    // Build tool set\n    const tools = await this.buildToolSet(recordStep);\n\n    // Add web search if enabled\n    if ((options?.enableWebSearch ?? this.config.webSearch?.enabled) && this.config.webSearch) {\n      const webSearchTool = anthropic.tools.webSearch_20250305({\n        maxUses: this.config.webSearch.maxUses ?? 5,\n        allowedDomains: this.config.webSearch.allowedDomains,\n        blockedDomains: this.config.webSearch.blockedDomains,\n      });\n      (tools as Record<string, unknown>).web_search = webSearchTool;\n    }\n\n    // Build provider options\n    const providerOptions: { anthropic?: AnthropicProviderOptions } = {};\n\n    if ((options?.enableReasoning ?? this.config.reasoning?.enabled) && this.config.reasoning) {\n      providerOptions.anthropic = {\n        thinking: {\n          type: 'enabled',\n          budgetTokens: this.config.reasoning.budgetTokens ?? 12000,\n        },\n      };\n    }\n\n    try {\n      const result = await generateText({\n        model: anthropic(this.config.model),\n        tools,\n        stopWhen: stepCountIs(this.config.maxSteps),\n        system: this.getSystemPrompt(),\n        prompt: task,\n        providerOptions: Object.keys(providerOptions).length > 0 ? providerOptions : undefined,\n      });\n\n      return {\n        success: true,\n        result: result.text,\n        reasoning: result.reasoning?.map((r) => r.text).join('\\n'),\n        steps,\n        usage: result.usage\n          ? {\n              inputTokens: result.usage.inputTokens ?? 0,\n              outputTokens: result.usage.outputTokens ?? 0,\n              totalTokens: result.usage.totalTokens ?? 0,\n            }\n          : undefined,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        result: error instanceof Error ? error.message : String(error),\n        steps,\n      };\n    }\n  }\n\n  /**\n   * Execute a task with streaming output.\n   * Note: Currently only yields text chunks. Reasoning chunks are not yet supported\n   * by the streaming API even when extended thinking is enabled.\n   */\n  async *stream(task: string): AsyncGenerator<{ type: 'text'; content: string }> {\n    await this.initialize();\n\n    const steps: AgentStep[] = [];\n    const recordStep = (toolName: string, input: unknown, output: string) => {\n      steps.push({ toolName, input, output, timestamp: new Date() });\n    };\n\n    const tools = await this.buildToolSet(recordStep);\n\n    // Build provider options for reasoning\n    const providerOptions: { anthropic?: AnthropicProviderOptions } = {};\n    if (this.config.reasoning?.enabled) {\n      providerOptions.anthropic = {\n        thinking: {\n          type: 'enabled',\n          budgetTokens: this.config.reasoning.budgetTokens ?? 12000,\n        },\n      };\n    }\n\n    const result = streamText({\n      model: anthropic(this.config.model),\n      tools,\n      stopWhen: stepCountIs(this.config.maxSteps),\n      system: this.getSystemPrompt(),\n      prompt: task,\n      providerOptions: Object.keys(providerOptions).length > 0 ? providerOptions : undefined,\n    });\n\n    for await (const chunk of result.textStream) {\n      yield { type: 'text', content: chunk };\n    }\n  }\n\n  /**\n   * Execute with structured output - combine tool use with schema-constrained response\n   */\n  async executeWithOutput<T extends z.ZodTypeAny>(\n    task: string,\n    outputSchema: T\n  ): Promise<{\n    success: boolean;\n    output?: z.infer<T>;\n    error?: string;\n    steps: AgentStep[];\n    usage?: AgentResult['usage'];\n  }> {\n    await this.initialize();\n\n    const steps: AgentStep[] = [];\n    const recordStep = (toolName: string, input: unknown, output: string) => {\n      steps.push({ toolName, input, output, timestamp: new Date() });\n    };\n\n    const tools = await this.buildToolSet(recordStep);\n\n    try {\n      // First, use tools to gather information\n      const gatherResult = await generateText({\n        model: anthropic(this.config.model),\n        tools,\n        stopWhen: stepCountIs(Math.floor(this.config.maxSteps / 2)),\n        system: this.getSystemPrompt(),\n        prompt: task,\n      });\n\n      // Then, generate structured output\n      const structured = await generateObject({\n        model: anthropic(this.config.model),\n        schema: outputSchema,\n        prompt: `Based on this information, provide a structured response:\n\n${gatherResult.text}\n\nOriginal task: ${task}`,\n      });\n\n      return {\n        success: true,\n        output: structured.object as z.infer<T>,\n        steps,\n        usage: gatherResult.usage\n          ? {\n              inputTokens: gatherResult.usage.inputTokens ?? 0,\n              outputTokens: gatherResult.usage.outputTokens ?? 0,\n              totalTokens: gatherResult.usage.totalTokens ?? 0,\n            }\n          : undefined,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        steps,\n      };\n    }\n  }\n\n  // \n  // Task Analysis\n  // \n\n  /**\n   * Analyze a task before executing to determine optimal approach\n   */\n  async analyzeTask(task: string): Promise<TaskAnalysis> {\n    const analysis = await generateObject({\n      model: anthropic(this.config.model),\n      schema: TaskAnalysisSchema,\n      prompt: `Analyze this task and provide a structured assessment:\n\nTask: ${task}\n\nConsider:\n1. How complex is this task?\n2. How many steps might it take?\n3. Would web search help gather current information?\n4. Would extended thinking/reasoning help with complex logic?\n5. What are the subtasks and their priorities?\n6. What are potential risks or blockers?`,\n    });\n\n    return analysis.object;\n  }\n\n  // \n  // Convenience Methods\n  // \n\n  /**\n   * Fix a specific file based on feedback\n   */\n  async fixFile(\n    filePath: string,\n    feedback: string,\n    suggestion?: string\n  ): Promise<{\n    success: boolean;\n    result: string;\n    diff?: string;\n  }> {\n    const task = suggestion\n      ? `Fix the file ${filePath} based on this feedback:\n${feedback}\n\nApply this suggested change:\n${suggestion}`\n      : `Fix the file ${filePath} based on this feedback:\n${feedback}\n\nAnalyze the file, understand the issue, and make the appropriate fix.`;\n\n    const result = await this.execute(task);\n\n    // Get diff if we made changes\n    let diff: string | undefined;\n    if (result.success) {\n      try {\n        diff = execFileSync('git', ['diff', filePath], {\n          cwd: this.config.workingDirectory,\n          encoding: 'utf-8',\n        });\n      } catch {\n        // No diff available\n      }\n    }\n\n    return {\n      success: result.success,\n      result: result.result,\n      diff,\n    };\n  }\n\n  /**\n   * Run tests and fix failures\n   */\n  async fixTests(testCommand: string = 'npm test'): Promise<{\n    success: boolean;\n    result: string;\n    iterations: number;\n  }> {\n    const task = `Run the tests with \"${testCommand}\" and fix any failures.\n\nProcess:\n1. Run the test command\n2. If tests fail, analyze the failure\n3. Fix the code causing the failure\n4. Re-run tests\n5. Repeat until all tests pass or you've tried 5 times`;\n\n    const result = await this.execute(task);\n\n    // Count iterations from steps\n    const testRuns = result.steps.filter(\n      (s) =>\n        s.toolName === 'bash' &&\n        typeof s.input === 'object' &&\n        s.input !== null &&\n        'command' in s.input &&\n        String(s.input.command).includes('test')\n    ).length;\n\n    return {\n      success: result.success,\n      result: result.result,\n      iterations: testRuns,\n    };\n  }\n\n  /**\n   * Commit changes with a message\n   */\n  async commitChanges(message: string): Promise<{\n    success: boolean;\n    commitSha?: string;\n  }> {\n    const result = await this.execute(\n      `Stage all changes and commit with message: \"${message}\"\n      \nUse these commands:\n1. git add -A\n2. git commit -m \"${message}\"\n3. Output the commit SHA`\n    );\n\n    // Extract commit SHA from steps\n    const commitStep = result.steps.find(\n      (s) => s.toolName === 'bash' && s.output.includes('commit')\n    );\n\n    let commitSha: string | undefined;\n    if (commitStep) {\n      const shaMatch = commitStep.output.match(/\\[[\\w-]+ ([a-f0-9]+)\\]/);\n      if (shaMatch) {\n        commitSha = shaMatch[1];\n      }\n    }\n\n    return {\n      success: result.success,\n      commitSha,\n    };\n  }\n\n  // \n  // Tool Building\n  // \n\n  /**\n   * Build the complete tool set\n   */\n  private async buildToolSet(\n    recordStep: (name: string, input: unknown, output: string, approved?: boolean) => void\n  ): Promise<ToolSet> {\n    const requiresApproval = (toolName: string): boolean => {\n      return this.config.approval?.requireApproval?.includes(toolName) ?? false;\n    };\n\n    const checkApproval = async (toolName: string, input: unknown): Promise<boolean> => {\n      if (!requiresApproval(toolName)) return true;\n      if (!this.config.approval?.onApprovalRequest) return true;\n      return this.config.approval.onApprovalRequest(toolName, input);\n    };\n\n    // Bash tool with security checks\n    const bashTool = anthropic.tools.bash_20250124({\n      execute: async ({ command, restart }) => {\n        if (restart) {\n          recordStep('bash', { restart: true }, 'Shell restarted');\n          return 'Shell restarted';\n        }\n\n        // Assess command safety\n        const safety = assessCommandSafety(command);\n        const needsApproval = requiresApproval('bash') || !safety.safe;\n\n        if (needsApproval) {\n          const approved = await checkApproval('bash', { command, risks: safety.risks });\n          if (!approved) {\n            recordStep('bash', { command }, 'Command rejected by approval', false);\n            return 'Command rejected by approval policy';\n          }\n        }\n\n        try {\n          const output = execSync(command, {\n            cwd: this.config.workingDirectory,\n            encoding: 'utf-8',\n            maxBuffer: 10 * 1024 * 1024,\n            timeout: 120000,\n          });\n\n          recordStep('bash', { command }, output, true);\n          return output;\n        } catch (error) {\n          const errorMsg = error instanceof Error ? error.message : String(error);\n          recordStep('bash', { command }, `Error: ${errorMsg}`);\n          return `Error: ${errorMsg}`;\n        }\n      },\n    });\n\n    // Text editor tool with path validation\n    const textEditorTool = anthropic.tools.textEditor_20250124({\n      execute: async ({ command, path, file_text, insert_line, new_str, old_str, view_range }) => {\n        // Security: Validate path to prevent path traversal attacks\n        const pathValidation = validatePath(path, this.config.workingDirectory);\n        if (!pathValidation.valid) {\n          recordStep(\n            'str_replace_editor',\n            { command, path },\n            `Security Error: ${pathValidation.error}`\n          );\n          return `Security Error: ${pathValidation.error}`;\n        }\n        const fullPath = pathValidation.resolvedPath;\n\n        try {\n          let result: string;\n\n          switch (command) {\n            case 'view': {\n              if (!existsSync(fullPath)) {\n                result = `Error: File not found: ${path}`;\n              } else {\n                const content = readFileSync(fullPath, 'utf-8');\n                const lines = content.split('\\n');\n\n                const start = view_range?.[0];\n                const end = view_range?.[1];\n                if (start !== undefined && end !== undefined) {\n                  const selectedLines = lines.slice(start - 1, end);\n                  result = selectedLines.map((line, i) => `${start + i}: ${line}`).join('\\n');\n                } else {\n                  result = lines.map((line, i) => `${i + 1}: ${line}`).join('\\n');\n                }\n              }\n              break;\n            }\n\n            case 'create': {\n              if (!file_text) {\n                result = 'Error: file_text is required for create command';\n              } else {\n                const dir = dirname(fullPath);\n                if (!existsSync(dir)) mkdirSync(dir, { recursive: true });\n                writeFileSync(fullPath, file_text);\n                result = `Created file: ${path}`;\n              }\n              break;\n            }\n\n            case 'str_replace': {\n              if (!old_str || new_str === undefined) {\n                result = 'Error: old_str and new_str are required for str_replace';\n              } else if (!existsSync(fullPath)) {\n                result = `Error: File not found: ${path}`;\n              } else {\n                const content = readFileSync(fullPath, 'utf-8');\n                if (!content.includes(old_str)) {\n                  result = `Error: old_str not found in file`;\n                } else {\n                  const newContent = content.replace(old_str, new_str);\n                  writeFileSync(fullPath, newContent);\n                  result = `Replaced text in ${path}`;\n                }\n              }\n              break;\n            }\n\n            case 'insert': {\n              if (insert_line === undefined || new_str === undefined) {\n                result = 'Error: insert_line and new_str are required for insert';\n              } else if (!existsSync(fullPath)) {\n                result = `Error: File not found: ${path}`;\n              } else {\n                const content = readFileSync(fullPath, 'utf-8');\n                const lines = content.split('\\n');\n                lines.splice(insert_line, 0, new_str);\n                writeFileSync(fullPath, lines.join('\\n'));\n                result = `Inserted text at line ${insert_line} in ${path}`;\n              }\n              break;\n            }\n\n            default:\n              result = `Unknown command: ${command}`;\n          }\n\n          recordStep('str_replace_editor', { command, path }, result);\n          return result;\n        } catch (error) {\n          const errorMsg = error instanceof Error ? error.message : String(error);\n          recordStep('str_replace_editor', { command, path }, `Error: ${errorMsg}`);\n          return `Error: ${errorMsg}`;\n        }\n      },\n    });\n\n    const tools: ToolSet = {\n      bash: bashTool,\n      str_replace_editor: textEditorTool,\n    } as ToolSet;\n\n    // Git status tool\n    tools.git_status = tool({\n      description: 'Get current git status including branch, staged files, and modified files',\n      inputSchema: z.object({}),\n      execute: async () => {\n        try {\n          const status = execSync('git status --porcelain -b', {\n            cwd: this.config.workingDirectory,\n            encoding: 'utf-8',\n          });\n          recordStep('git_status', {}, status);\n          return status;\n        } catch (error) {\n          const msg = error instanceof Error ? error.message : String(error);\n          recordStep('git_status', {}, `Error: ${msg}`);\n          return `Error: ${msg}`;\n        }\n      },\n    });\n\n    // Git diff tool with path validation\n    tools.git_diff = tool({\n      description: 'Get git diff for staged or unstaged changes',\n      inputSchema: z.object({\n        staged: z.boolean().optional().describe('Show staged changes only'),\n        file: z.string().optional().describe('Specific file to diff'),\n      }),\n      execute: async ({ staged, file }) => {\n        try {\n          const args = staged ? ['--cached'] : [];\n          if (file) {\n            // Security: Validate file path\n            const pathValidation = validatePath(file, this.config.workingDirectory);\n            if (!pathValidation.valid) {\n              recordStep('git_diff', { staged, file }, `Security Error: ${pathValidation.error}`);\n              return `Security Error: ${pathValidation.error}`;\n            }\n            // Use -- to separate paths from options (git best practice)\n            args.push('--', file);\n          }\n          const diff = execSync(`git diff ${args.join(' ')}`, {\n            cwd: this.config.workingDirectory,\n            encoding: 'utf-8',\n          });\n          recordStep('git_diff', { staged, file }, diff || '(no changes)');\n          return diff || '(no changes)';\n        } catch (error) {\n          const msg = error instanceof Error ? error.message : String(error);\n          recordStep('git_diff', { staged, file }, `Error: ${msg}`);\n          return `Error: ${msg}`;\n        }\n      },\n    });\n\n    // File delete tool with approval and path validation\n    tools.delete_file = tool({\n      description: 'Delete a file (may require approval)',\n      inputSchema: z.object({\n        path: z.string().describe('Path to the file to delete'),\n      }),\n      execute: async ({ path }) => {\n        // Security: Validate path to prevent path traversal attacks\n        const pathValidation = validatePath(path, this.config.workingDirectory);\n        if (!pathValidation.valid) {\n          recordStep('delete_file', { path }, `Security Error: ${pathValidation.error}`, false);\n          return `Security Error: ${pathValidation.error}`;\n        }\n        const fullPath = pathValidation.resolvedPath;\n\n        // Always check approval for delete operations\n        const approved = await checkApproval('delete_file', { path });\n        if (!approved) {\n          recordStep('delete_file', { path }, 'Delete rejected by approval', false);\n          return 'Delete operation rejected by approval policy';\n        }\n\n        try {\n          if (!existsSync(fullPath)) {\n            recordStep('delete_file', { path }, `File not found: ${path}`);\n            return `File not found: ${path}`;\n          }\n          unlinkSync(fullPath);\n          recordStep('delete_file', { path }, `Deleted: ${path}`, true);\n          return `Successfully deleted: ${path}`;\n        } catch (error) {\n          const msg = error instanceof Error ? error.message : String(error);\n          recordStep('delete_file', { path }, `Error: ${msg}`);\n          return `Error: ${msg}`;\n        }\n      },\n    });\n\n    // Add MCP tools if available\n    if (this.mcpClients) {\n      const mcpTools = await getMCPTools(this.mcpClients);\n      Object.assign(tools, mcpTools);\n    }\n\n    return tools as ToolSet;\n  }\n\n  // \n  // System Prompt\n  // \n\n  /**\n   * Get the system prompt for the agent\n   */\n  private getSystemPrompt(): string {\n    const features: string[] = [];\n\n    if (this.config.reasoning?.enabled) {\n      features.push('- Extended thinking enabled for complex reasoning');\n    }\n    if (this.config.webSearch?.enabled) {\n      features.push('- Web search available for current information');\n    }\n    if (this.mcpClients) {\n      features.push('- MCP integrations (Cursor, GitHub, Context7) available');\n    }\n\n    return `You are an expert software development agent with access to powerful tools.\n\n## Your Capabilities\n\n### Code Operations (Anthropic Tools)\n- **bash**: Execute shell commands for git, tests, builds, etc.\n- **str_replace_editor**: View and edit files with precision\n- **delete_file**: Delete files (may require approval)\n\n### Git Utilities\n- **git_status**: Quick git status check\n- **git_diff**: View changes in working directory\n\n${features.length > 0 ? `### Special Features\\n${features.join('\\n')}` : ''}\n\n### MCP Integrations (when available)\n- **Cursor Agent MCP**: Spawn and manage background agents\n- **GitHub MCP**: PR/issue management, code search\n- **Context7 MCP**: Up-to-date library documentation\n\n## Working Directory\n${this.config.workingDirectory}\n\n## Guidelines\n\n1. **Be thorough**: Verify your changes work before reporting success\n2. **Use appropriate tools**: Prefer MCP tools for GitHub operations\n3. **Handle errors gracefully**: Try to understand and fix failures\n4. **Document your actions**: Explain what you're doing\n5. **Test your changes**: Run tests and linting after code changes\n${this.config.approval?.requireApproval?.length ? '\\n6. **Respect approval policies**: Some operations require user approval' : ''}\n\n## When Triaging PRs\n1. First understand the current state (CI status, feedback, changes)\n2. Identify all blockers and unaddressed feedback\n3. Fix issues systematically, starting with CI failures\n4. Commit and push changes\n5. Verify CI passes after your changes`;\n  }\n\n  private log(message: string): void {\n    if (this.config.verbose) {\n      console.log(message);\n    }\n  }\n}\n\n// \n// Convenience Functions\n// \n\n/**\n * Run a one-shot task with the agent\n */\nexport async function runTask(task: string, config?: AgentConfig): Promise<AgentResult> {\n  const agent = new Agent(config);\n  try {\n    return await agent.execute(task);\n  } finally {\n    await agent.close();\n  }\n}\n\n/**\n * Run a task with pre-analysis to determine optimal configuration\n */\nexport async function runSmartTask(\n  task: string,\n  config?: Omit<AgentConfig, 'reasoning' | 'webSearch'>\n): Promise<AgentResult> {\n  const agent = new Agent({\n    ...config,\n    reasoning: { enabled: false }, // Disable for analysis\n    webSearch: { enabled: false },\n  });\n\n  try {\n    // First, analyze the task\n    const analysis = await agent.analyzeTask(task);\n\n    console.log(` Task Analysis:`);\n    console.log(`   Complexity: ${analysis.complexity}`);\n    console.log(`   Estimated steps: ${analysis.estimatedSteps}`);\n    console.log(`   Needs reasoning: ${analysis.requiresReasoning}`);\n    console.log(`   Needs web search: ${analysis.requiresWebSearch}`);\n\n    // Execute with optimal settings\n    return await agent.execute(task, {\n      enableReasoning: analysis.requiresReasoning,\n      enableWebSearch: analysis.requiresWebSearch,\n    });\n  } finally {\n    await agent.close();\n  }\n}\n","/**\n * PR Triage Agent\n *\n * Specialized agent for triaging and resolving Pull Requests.\n * Combines MCP tools with AI analysis to:\n * - Analyze PR state and feedback\n * - Identify and fix blockers\n * - Address reviewer comments\n * - Ensure CI passes\n * - Prepare PRs for merge\n */\n\nimport { anthropic } from '@ai-sdk/anthropic';\nimport { generateObject, generateText, stepCountIs } from 'ai';\nimport { z } from 'zod';\nimport { Agent, type AgentConfig, type AgentResult } from './agent.js';\nimport {\n  closeMCPClients,\n  getMCPTools,\n  initializeMCPClients,\n  type MCPClients,\n} from './mcp-clients.js';\n\n// \n// Schemas for structured AI output\n// \n\nconst FeedbackSeveritySchema = z.enum(['critical', 'high', 'medium', 'low', 'suggestion']);\n\nconst FeedbackItemSchema = z.object({\n  id: z.string(),\n  source: z.string().describe('Who provided this feedback (e.g., gemini-code-assist, copilot)'),\n  severity: FeedbackSeveritySchema,\n  category: z.enum([\n    'bug',\n    'security',\n    'performance',\n    'style',\n    'documentation',\n    'suggestion',\n    'question',\n  ]),\n  file: z.string().optional(),\n  line: z.number().optional(),\n  content: z.string(),\n  suggestion: z.string().optional().describe('Specific fix suggestion if provided'),\n  addressed: z.boolean(),\n  addressedBy: z.string().optional().describe('How it was addressed (commit SHA, response, etc.)'),\n});\n\nconst CIStatusSchema = z.object({\n  status: z.enum(['passing', 'failing', 'pending', 'unknown']),\n  checks: z.array(\n    z.object({\n      name: z.string(),\n      status: z.enum(['success', 'failure', 'pending', 'skipped']),\n      url: z.string().optional(),\n      summary: z.string().optional(),\n    })\n  ),\n  failureReasons: z.array(z.string()),\n});\n\nconst PRAnalysisSchema = z.object({\n  prNumber: z.number(),\n  prUrl: z.string(),\n  prTitle: z.string(),\n  status: z.enum(['ready', 'needs_work', 'blocked', 'waiting_ci', 'waiting_review']),\n  ci: CIStatusSchema,\n  feedback: z.object({\n    total: z.number(),\n    unaddressed: z.number(),\n    critical: z.number(),\n    items: z.array(FeedbackItemSchema),\n  }),\n  blockers: z.array(\n    z.object({\n      type: z.enum([\n        'ci_failure',\n        'unaddressed_feedback',\n        'merge_conflict',\n        'missing_approval',\n        'other',\n      ]),\n      description: z.string(),\n      autoResolvable: z.boolean(),\n      suggestedFix: z.string().optional(),\n    })\n  ),\n  summary: z.string(),\n  nextActions: z.array(\n    z.object({\n      action: z.string(),\n      priority: z.enum(['critical', 'high', 'medium', 'low']),\n      automated: z.boolean(),\n      reason: z.string(),\n    })\n  ),\n});\n\nexport type PRAnalysis = z.infer<typeof PRAnalysisSchema>;\nexport type FeedbackItem = z.infer<typeof FeedbackItemSchema>;\n\n// \n// PR Triage Agent\n// \n\nexport interface PRTriageConfig extends AgentConfig {\n  /** Repository in format owner/repo */\n  repository: string;\n}\n\nexport class PRTriageAgent {\n  private config: PRTriageConfig;\n  private agent: Agent;\n  private mcpClients: MCPClients | null = null;\n  private initialized = false;\n  /** Promise-based lock to prevent concurrent initialization race conditions */\n  private initializationPromise: Promise<void> | null = null;\n\n  constructor(config: PRTriageConfig) {\n    this.config = config;\n    this.agent = new Agent(config);\n  }\n\n  /**\n   * Initialize the agent and MCP clients.\n   * Thread-safe: concurrent calls will wait for the same initialization to complete.\n   */\n  async initialize(): Promise<void> {\n    // Fast path: already initialized\n    if (this.initialized) return;\n\n    // If initialization is in progress, wait for it to complete\n    if (this.initializationPromise) {\n      return this.initializationPromise;\n    }\n\n    // Start initialization and store the promise so concurrent calls can wait\n    this.initializationPromise = this.doInitialize();\n\n    try {\n      await this.initializationPromise;\n    } catch (error) {\n      // Reset on failure so retry is possible\n      this.initializationPromise = null;\n      throw error;\n    }\n  }\n\n  /**\n   * Internal initialization logic - only called once due to promise lock\n   */\n  private async doInitialize(): Promise<void> {\n    await this.agent.initialize();\n    this.mcpClients = await initializeMCPClients(this.config.mcp);\n    this.initialized = true;\n  }\n\n  async close(): Promise<void> {\n    await this.agent.close();\n    if (this.mcpClients) {\n      await closeMCPClients(this.mcpClients);\n      this.mcpClients = null;\n    }\n    this.initialized = false;\n  }\n\n  /**\n   * Analyze a PR and return structured analysis\n   */\n  async analyze(prNumber: number): Promise<PRAnalysis> {\n    await this.initialize();\n\n    const tools = this.mcpClients ? await getMCPTools(this.mcpClients) : {};\n\n    // Use AI with tools to gather PR information\n    const gatherResult = await generateText({\n      model: anthropic('claude-sonnet-4-20250514'),\n      tools,\n      stopWhen: stepCountIs(10),\n      system: `You are a PR analysis assistant. Gather all relevant information about the PR.`,\n      prompt: `Analyze PR #${prNumber} in repository ${this.config.repository}.\n\nGather:\n1. PR title, description, and current state\n2. CI/check status (all checks)\n3. All review comments and feedback\n4. Recent commits\n5. Any merge conflicts\n\nUse the available tools to get this information.`,\n    });\n\n    // Now generate structured analysis\n    const analysis = await generateObject({\n      model: anthropic('claude-sonnet-4-20250514'),\n      schema: PRAnalysisSchema,\n      prompt: `Based on this PR information, generate a structured analysis:\n\n${gatherResult.text}\n\nAnalyze:\n- Overall PR status\n- CI status and any failures\n- All feedback items (categorize by severity)\n- Blockers preventing merge\n- Recommended next actions\n\nBe thorough - identify ALL unaddressed feedback items.`,\n    });\n\n    return analysis.object;\n  }\n\n  /**\n   * Generate a human-readable triage report\n   */\n  async generateReport(prNumber: number): Promise<string> {\n    const analysis = await this.analyze(prNumber);\n    return this.formatReport(analysis);\n  }\n\n  /**\n   * Automatically resolve all auto-resolvable issues\n   */\n  async resolve(prNumber: number): Promise<AgentResult> {\n    const analysis = await this.analyze(prNumber);\n\n    const autoResolvable = analysis.blockers.filter((b) => b.autoResolvable);\n    const unaddressedFeedback = analysis.feedback.items.filter((f) => !f.addressed);\n\n    if (autoResolvable.length === 0 && unaddressedFeedback.length === 0) {\n      return {\n        success: true,\n        result: 'No issues to resolve - PR appears ready',\n        steps: [],\n      };\n    }\n\n    // Build resolution task\n    const task = `Resolve issues in PR #${prNumber} (${this.config.repository}):\n\n## Blockers to Fix\n${autoResolvable\n  .map(\n    (b, i) => `${i + 1}. [${b.type}] ${b.description}\n   Suggested fix: ${b.suggestedFix || 'Analyze and fix'}`\n  )\n  .join('\\n\\n')}\n\n## Unaddressed Feedback\n${unaddressedFeedback\n  .map(\n    (f, i) => `${i + 1}. [${f.severity}] ${f.source}: ${f.content}\n   File: ${f.file || 'N/A'}${f.line ? `:${f.line}` : ''}\n   ${f.suggestion ? `Suggestion: ${f.suggestion}` : ''}`\n  )\n  .join('\\n\\n')}\n\n## Instructions\n1. Fix each issue in order of severity (critical > high > medium > low)\n2. For each fix:\n   a. Make the code change\n   b. Verify it doesn't break anything (run tests if applicable)\n   c. Commit with a clear message\n3. Push all changes when done\n4. Report what was fixed and what couldn't be auto-fixed`;\n\n    return await this.agent.execute(task);\n  }\n\n  /**\n   * Run the complete triage workflow until PR is ready\n   */\n  async runUntilReady(\n    prNumber: number,\n    options: {\n      maxIterations?: number;\n      requestReviews?: boolean;\n      autoMerge?: boolean;\n    } = {}\n  ): Promise<{\n    success: boolean;\n    finalStatus: PRAnalysis['status'];\n    iterations: number;\n    report: string;\n  }> {\n    const maxIterations = options.maxIterations ?? 5;\n    let iterations = 0;\n    let lastAnalysis: PRAnalysis | null = null;\n\n    while (iterations < maxIterations) {\n      iterations++;\n      console.log(`\\n Triage iteration ${iterations}/${maxIterations}`);\n\n      // Analyze current state\n      const analysis = await this.analyze(prNumber);\n      lastAnalysis = analysis;\n\n      console.log(`   Status: ${analysis.status}`);\n      console.log(`   CI: ${analysis.ci.status}`);\n      console.log(`   Unaddressed feedback: ${analysis.feedback.unaddressed}`);\n\n      // Check if ready\n      if (analysis.status === 'ready') {\n        if (options.requestReviews) {\n          await this.agent.execute(`Request reviews for PR #${prNumber} if not already requested`);\n        }\n\n        if (options.autoMerge) {\n          await this.agent.execute(\n            `Merge PR #${prNumber} using squash merge and delete the branch`\n          );\n        }\n\n        return {\n          success: true,\n          finalStatus: 'ready',\n          iterations,\n          report: this.formatReport(analysis),\n        };\n      }\n\n      // Check if blocked by non-auto-resolvable issues\n      const nonResolvableBlockers = analysis.blockers.filter((b) => !b.autoResolvable);\n      if (nonResolvableBlockers.length > 0 && analysis.blockers.every((b) => !b.autoResolvable)) {\n        return {\n          success: false,\n          finalStatus: 'blocked',\n          iterations,\n          report:\n            this.formatReport(analysis) +\n            `\\n\\n## Cannot Auto-Resolve\\n` +\n            nonResolvableBlockers.map((b) => `- ${b.description}`).join('\\n'),\n        };\n      }\n\n      // Try to resolve issues\n      const resolution = await this.resolve(prNumber);\n\n      if (!resolution.success) {\n        console.log(`    Resolution failed: ${resolution.result}`);\n      }\n\n      // Wait for CI if needed\n      if (analysis.ci.status === 'pending') {\n        console.log('    Waiting for CI...');\n        await this.waitForCI(prNumber);\n      }\n    }\n\n    return {\n      success: false,\n      finalStatus: lastAnalysis?.status ?? 'needs_work',\n      iterations,\n      report: lastAnalysis ? this.formatReport(lastAnalysis) : 'Analysis failed',\n    };\n  }\n\n  /**\n   * Wait for CI to complete\n   */\n  private async waitForCI(prNumber: number, timeout = 300000): Promise<void> {\n    const startTime = Date.now();\n    const pollInterval = 30000;\n\n    while (Date.now() - startTime < timeout) {\n      await new Promise((resolve) => setTimeout(resolve, pollInterval));\n\n      const analysis = await this.analyze(prNumber);\n      if (analysis.ci.status !== 'pending') {\n        return;\n      }\n    }\n  }\n\n  /**\n   * Format analysis as a readable report\n   */\n  private formatReport(analysis: PRAnalysis): string {\n    const statusEmoji = {\n      ready: '',\n      needs_work: '',\n      blocked: '',\n      waiting_ci: '',\n      waiting_review: '',\n    };\n\n    const severityEmoji = {\n      critical: '',\n      high: '',\n      medium: '',\n      low: '',\n      suggestion: '',\n    };\n\n    let report = `# PR Triage Report: #${analysis.prNumber}\n\n## ${statusEmoji[analysis.status]} Status: ${analysis.status.toUpperCase()}\n\n**${analysis.prTitle}**\n${analysis.prUrl}\n\n## CI Status: ${analysis.ci.status}\n${analysis.ci.checks.map((c) => `- ${c.status === 'success' ? '' : c.status === 'failure' ? '' : ''} ${c.name}`).join('\\n')}\n${analysis.ci.failureReasons.length > 0 ? `\\n### Failures:\\n${analysis.ci.failureReasons.map((r) => `- ${r}`).join('\\n')}` : ''}\n\n## Feedback Summary\n- Total: ${analysis.feedback.total}\n- Unaddressed: ${analysis.feedback.unaddressed}\n- Critical: ${analysis.feedback.critical}\n\n`;\n\n    if (analysis.feedback.items.length > 0) {\n      report += `### Feedback Items\\n`;\n      for (const item of analysis.feedback.items) {\n        const status = item.addressed ? '' : '';\n        report += `${status} ${severityEmoji[item.severity]} **${item.source}** [${item.category}]\n   ${item.content.slice(0, 200)}${item.content.length > 200 ? '...' : ''}\n   ${item.file ? ` ${item.file}${item.line ? `:${item.line}` : ''}` : ''}\n   ${item.addressed ? ` Addressed: ${item.addressedBy}` : ''}\n\n`;\n      }\n    }\n\n    if (analysis.blockers.length > 0) {\n      report += `##  Blockers\\n`;\n      for (const blocker of analysis.blockers) {\n        const autoIcon = blocker.autoResolvable ? '' : '';\n        report += `${autoIcon} **${blocker.type}**: ${blocker.description}\n   ${blocker.suggestedFix ? ` Fix: ${blocker.suggestedFix}` : ''}\n\n`;\n      }\n    }\n\n    report += `##  Next Actions\\n`;\n    for (const action of analysis.nextActions) {\n      const autoIcon = action.automated ? '' : '';\n      report += `${autoIcon} [${action.priority}] ${action.action}\n   ${action.reason}\n\n`;\n    }\n\n    report += `---\n*${analysis.summary}*`;\n\n    return report;\n  }\n}\n\n/**\n * Convenience function for quick PR triage\n */\nexport async function triagePR(\n  repository: string,\n  prNumber: number,\n  options?: Partial<PRTriageConfig>\n): Promise<PRAnalysis> {\n  const agent = new PRTriageAgent({\n    repository,\n    ...options,\n  });\n\n  try {\n    return await agent.analyze(prNumber);\n  } finally {\n    await agent.close();\n  }\n}\n","import { z } from 'zod';\n\n// ============================================================================\n// Core Triage Types\n// ============================================================================\n\n/**\n * Severity levels for feedback items.\n * Used to prioritize which feedback needs immediate attention.\n *\n * @remarks\n * - `critical` - Must be addressed before merge, blocks deployment\n * - `high` - Should be addressed before merge\n * - `medium` - Should be addressed, but not blocking\n * - `low` - Nice to have improvements\n * - `info` - Informational comments, no action required\n */\nexport const FeedbackSeveritySchema = z.enum(['critical', 'high', 'medium', 'low', 'info']);\n\n/** Severity level for feedback items */\nexport type FeedbackSeverity = z.infer<typeof FeedbackSeveritySchema>;\n\n/**\n * Status of a feedback item indicating whether it has been addressed.\n *\n * @remarks\n * - `unaddressed` - Feedback has not been addressed yet\n * - `addressed` - Feedback has been addressed with code changes\n * - `dismissed` - Feedback was reviewed and dismissed as not applicable\n * - `wont_fix` - Feedback acknowledged but won't be fixed in this PR\n */\nexport const FeedbackStatusSchema = z.enum(['unaddressed', 'addressed', 'dismissed', 'wont_fix']);\n\n/** Status of a feedback item */\nexport type FeedbackStatus = z.infer<typeof FeedbackStatusSchema>;\n\n/**\n * Types of blockers that can prevent a PR from being merged.\n *\n * @remarks\n * - `ci_failure` - One or more CI checks have failed\n * - `review_feedback` - Unaddressed review comments\n * - `merge_conflict` - Branch has conflicts with base branch\n * - `missing_approval` - Required approvals not yet received\n * - `branch_protection` - Branch protection rules not satisfied\n * - `stale_branch` - Branch is significantly behind base branch\n */\nexport const BlockerTypeSchema = z.enum([\n  'ci_failure',\n  'review_feedback',\n  'merge_conflict',\n  'missing_approval',\n  'branch_protection',\n  'stale_branch',\n]);\n\n/** Type of blocker preventing PR merge */\nexport type BlockerType = z.infer<typeof BlockerTypeSchema>;\n\n/**\n * Overall status of a pull request in the triage workflow.\n *\n * @remarks\n * - `needs_work` - Has unaddressed blockers requiring code changes\n * - `needs_review` - Waiting for AI or human review\n * - `needs_ci` - Waiting for CI checks to complete\n * - `ready_to_merge` - All checks pass, feedback addressed, ready to merge\n * - `blocked` - Cannot proceed without human intervention\n * - `merged` - PR has been merged\n * - `closed` - PR was closed without merging\n */\nexport const PRStatusSchema = z.enum([\n  'needs_work',\n  'needs_review',\n  'needs_ci',\n  'ready_to_merge',\n  'blocked',\n  'merged',\n  'closed',\n]);\n\n/** Overall status of a pull request */\nexport type PRStatus = z.infer<typeof PRStatusSchema>;\n\n// ============================================================================\n// Feedback Item\n// ============================================================================\n\n/**\n * Schema for a feedback item from a PR review.\n * Represents a single comment or suggestion from a reviewer.\n */\nexport const FeedbackItemSchema = z.object({\n  /** Unique identifier for the feedback item */\n  id: z.string(),\n  /** GitHub username of the reviewer */\n  author: z.string(),\n  /** Content of the feedback comment */\n  body: z.string(),\n  /** File path the feedback relates to, if any */\n  path: z.string().nullable(),\n  /** Line number in the file, if applicable */\n  line: z.number().nullable(),\n  /** Severity level of the feedback */\n  severity: FeedbackSeveritySchema,\n  /** Current status of the feedback */\n  status: FeedbackStatusSchema,\n  /** ISO timestamp when the feedback was created */\n  createdAt: z.string(),\n  /** URL to the feedback comment on GitHub */\n  url: z.string(),\n  /** Whether AI can automatically resolve this feedback */\n  isAutoResolvable: z.boolean(),\n  /** AI-suggested action to address the feedback */\n  suggestedAction: z.string().nullable(),\n  /** Description of how the feedback was resolved */\n  resolution: z.string().nullable(),\n});\n\n/**\n * A feedback item from a PR review.\n * Contains the review comment details, severity, status, and AI analysis.\n */\nexport type FeedbackItem = z.infer<typeof FeedbackItemSchema>;\n\n// ============================================================================\n// Blocker\n// ============================================================================\n\n/**\n * Schema for a blocker preventing PR merge.\n * Represents an issue that must be resolved before the PR can be merged.\n */\nexport const BlockerSchema = z.object({\n  /** Type of blocker */\n  type: BlockerTypeSchema,\n  /** Human-readable description of the blocker */\n  description: z.string(),\n  /** Whether AI can automatically resolve this blocker */\n  isAutoResolvable: z.boolean(),\n  /** Suggested fix for the blocker, if available */\n  suggestedFix: z.string().nullable(),\n  /** URL with more information about the blocker */\n  url: z.string().nullable(),\n  /** Whether the blocker has been resolved */\n  resolved: z.boolean(),\n});\n\n/**\n * A blocker preventing PR merge.\n * Includes the blocker type, description, and resolution status.\n */\nexport type Blocker = z.infer<typeof BlockerSchema>;\n\n// ============================================================================\n// CI Status\n// ============================================================================\n\n/**\n * Schema for a single CI check result.\n */\nexport const CICheckSchema = z.object({\n  /** Name of the CI check */\n  name: z.string(),\n  /** Current status of the check */\n  status: z.enum(['pending', 'in_progress', 'success', 'failure', 'skipped']),\n  /** Final conclusion of the check, if completed */\n  conclusion: z.string().nullable(),\n  /** URL to the CI check details */\n  url: z.string(),\n  /** ISO timestamp when the check started */\n  startedAt: z.string().nullable(),\n  /** ISO timestamp when the check completed */\n  completedAt: z.string().nullable(),\n});\n\n/**\n * A single CI check result.\n * Contains the check name, status, and timing information.\n */\nexport type CICheck = z.infer<typeof CICheckSchema>;\n\n/**\n * Schema for the overall CI status of a PR.\n */\nexport const CIStatusSchema = z.object({\n  /** Whether all CI checks are passing */\n  allPassing: z.boolean(),\n  /** Whether any CI checks are still pending */\n  anyPending: z.boolean(),\n  /** List of all CI checks */\n  checks: z.array(CICheckSchema),\n  /** List of failed CI checks */\n  failures: z.array(CICheckSchema),\n});\n\n/**\n * Overall CI status for a pull request.\n * Aggregates all CI check results with convenience flags.\n */\nexport type CIStatus = z.infer<typeof CIStatusSchema>;\n\n// ============================================================================\n// Triage Result\n// ============================================================================\n\n/**\n * Schema for the complete triage result of a PR.\n * This is the main output of the triage process.\n */\nexport const TriageResultSchema = z.object({\n  /** PR number */\n  prNumber: z.number(),\n  /** URL to the PR on GitHub */\n  prUrl: z.string(),\n  /** Title of the PR */\n  prTitle: z.string(),\n  /** Overall status of the PR */\n  status: PRStatusSchema,\n  /** CI check status */\n  ci: CIStatusSchema,\n  /** Feedback summary and items */\n  feedback: z.object({\n    /** Total number of feedback items */\n    total: z.number(),\n    /** Number of unaddressed feedback items */\n    unaddressed: z.number(),\n    /** List of all feedback items */\n    items: z.array(FeedbackItemSchema),\n  }),\n  /** List of blockers preventing merge */\n  blockers: z.array(BlockerSchema),\n  /** Recommended next actions */\n  nextActions: z.array(\n    z.object({\n      /** Action to take */\n      action: z.string(),\n      /** Priority of the action */\n      priority: FeedbackSeveritySchema,\n      /** Whether the action can be automated */\n      automated: z.boolean(),\n      /** Reason for the recommended action */\n      reason: z.string(),\n    })\n  ),\n  /** Human-readable summary of the triage result */\n  summary: z.string(),\n  /** ISO timestamp when the triage was performed */\n  timestamp: z.string(),\n});\n\n/**\n * Complete triage result for a pull request.\n * Contains PR status, CI results, feedback, blockers, and recommended actions.\n */\nexport type TriageResult = z.infer<typeof TriageResultSchema>;\n\n// ============================================================================\n// Action Result\n// ============================================================================\n\n/**\n * Schema for the result of an automated action.\n */\nexport const ActionResultSchema = z.object({\n  /** Whether the action succeeded */\n  success: z.boolean(),\n  /** Name of the action that was taken */\n  action: z.string(),\n  /** Description of what was done */\n  description: z.string(),\n  /** Error message if the action failed */\n  error: z.string().nullable(),\n  /** List of file changes made by the action */\n  changes: z\n    .array(\n      z.object({\n        /** Path to the changed file */\n        file: z.string(),\n        /** Type of change */\n        type: z.enum(['created', 'modified', 'deleted']),\n      })\n    )\n    .nullable(),\n  /** Git commit SHA if changes were committed */\n  commitSha: z.string().nullable(),\n});\n\n/**\n * Result of an automated action.\n * Contains success status, description, and any file changes made.\n */\nexport type ActionResult = z.infer<typeof ActionResultSchema>;\n\n// ============================================================================\n// Resolution Plan\n// ============================================================================\n\n/**\n * Schema for a resolution plan to address PR blockers.\n */\nexport const ResolutionPlanSchema = z.object({\n  /** PR number this plan is for */\n  prNumber: z.number(),\n  /** Ordered list of steps to resolve blockers */\n  steps: z.array(\n    z.object({\n      /** Order of this step (1-based) */\n      order: z.number(),\n      /** Action to take */\n      action: z.string(),\n      /** Detailed description of the step */\n      description: z.string(),\n      /** Whether this step can be automated */\n      automated: z.boolean(),\n      /** Estimated time to complete this step */\n      estimatedDuration: z.string(),\n      /** Step orders that must be completed before this step */\n      dependencies: z.array(z.number()),\n    })\n  ),\n  /** Estimated total time to complete the plan */\n  estimatedTotalDuration: z.string(),\n  /** Whether the plan requires human intervention */\n  requiresHumanIntervention: z.boolean(),\n  /** Reason human intervention is required, if applicable */\n  humanInterventionReason: z.string().nullable(),\n});\n\n/**\n * A plan to resolve PR blockers.\n * Contains ordered steps with dependencies and time estimates.\n */\nexport type ResolutionPlan = z.infer<typeof ResolutionPlanSchema>;\n"]}