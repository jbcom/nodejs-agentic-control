{"version":3,"sources":["../../src/core/tokens.ts","../../src/core/errors.ts","../../src/core/validation.ts","../../src/core/config.ts","../../src/github/client.ts","../../src/triage/mcp-clients.ts","../../src/triage/security.ts","../../src/triage/agent.ts","../../src/core/providers.ts","../../src/triage/analyzer.ts","../../src/triage/pr-triage-agent.ts","../../src/triage/resolver.ts","../../src/triage/triage.ts","../../src/triage/types.ts"],"names":["config","loadEnvConfig","createMCPClient","StdioMCPTransport","z","existsSync","dirname","provider","TaskAnalysisSchema","generateObject","spawnSync","generateText","anthropic","stepCountIs","resolve","FeedbackSeveritySchema","FeedbackItemSchema","CIStatusSchema"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * Intelligent Token Management for Multi-Organization GitHub Access\n *\n * This module provides automatic token switching based on repository organization.\n * ALL configuration is user-provided - no hardcoded organizations or tokens.\n *\n * Configuration methods (in priority order):\n * 1. Programmatic: setTokenConfig() / addOrganization()\n * 2. Config file: agentic.config.json with \"tokens\" section\n * 3. Environment variables: AGENTIC_ORG_<NAME>_TOKEN pattern\n *\n * @example Config file (agentic.config.json):\n * ```json\n * {\n *   \"tokens\": {\n *     \"organizations\": {\n *       \"MyOrg\": { \"name\": \"MyOrg\", \"tokenEnvVar\": \"GITHUB_MYORG_TOKEN\" },\n *       \"AnotherOrg\": { \"name\": \"AnotherOrg\", \"tokenEnvVar\": \"ANOTHER_TOKEN\" }\n *     },\n *     \"defaultTokenEnvVar\": \"GITHUB_TOKEN\",\n *     \"prReviewTokenEnvVar\": \"GITHUB_TOKEN\"\n *   }\n * }\n * ```\n *\n * @example Environment variables:\n * ```bash\n * # Define org-to-token mappings\n * export AGENTIC_ORG_MYORG_TOKEN=GITHUB_MYORG_TOKEN\n * export AGENTIC_ORG_ANOTHER_TOKEN=ANOTHER_ORG_PAT\n *\n * # Override defaults\n * export AGENTIC_DEFAULT_TOKEN=GITHUB_TOKEN\n * export AGENTIC_PR_REVIEW_TOKEN=GITHUB_TOKEN\n * ```\n */\n\nimport type { OrganizationConfig, Result, TokenConfig } from './types.js';\n\n// ============================================\n// Configuration State (NO HARDCODED VALUES)\n// ============================================\n\n/**\n * Default token configuration - uses standard GITHUB_TOKEN\n * Users MUST configure their own organizations\n */\nconst DEFAULT_CONFIG: TokenConfig = {\n  organizations: {}, // Empty by default - users configure their own\n  defaultTokenEnvVar: 'GITHUB_TOKEN',\n  prReviewTokenEnvVar: 'GITHUB_TOKEN',\n};\n\nlet currentConfig: TokenConfig = { ...DEFAULT_CONFIG };\n\n// ============================================\n// Environment Configuration Loading\n// ============================================\n\n/**\n * Load organization configs from environment variables\n *\n * Pattern: AGENTIC_ORG_<NAME>_TOKEN=<TOKEN_ENV_VAR_NAME>\n *\n * @example\n * AGENTIC_ORG_MYCOMPANY_TOKEN=GITHUB_MYCOMPANY_TOKEN\n * This maps \"mycompany\" org to use the value from GITHUB_MYCOMPANY_TOKEN env var\n */\nfunction loadEnvConfig(): void {\n  const orgPattern = /^AGENTIC_ORG_([A-Z0-9_]+)_TOKEN$/;\n\n  for (const [key, value] of Object.entries(process.env)) {\n    const match = key.match(orgPattern);\n    if (match?.[1] && value) {\n      // Convert UPPER_CASE to kebab-case for org name\n      const orgName = match[1].toLowerCase().replace(/_/g, '-');\n      if (!currentConfig.organizations[orgName]) {\n        currentConfig.organizations[orgName] = {\n          name: orgName,\n          tokenEnvVar: value,\n        };\n      }\n    }\n  }\n\n  // Override PR review token if specified\n  if (process.env.AGENTIC_PR_REVIEW_TOKEN) {\n    currentConfig.prReviewTokenEnvVar = process.env.AGENTIC_PR_REVIEW_TOKEN;\n  }\n\n  // Override default token if specified\n  if (process.env.AGENTIC_DEFAULT_TOKEN) {\n    currentConfig.defaultTokenEnvVar = process.env.AGENTIC_DEFAULT_TOKEN;\n  }\n}\n\n// Load env config on module initialization\nloadEnvConfig();\n\n// ============================================\n// Public Configuration API\n// ============================================\n\n/**\n * Get the current token configuration\n */\nexport function getTokenConfig(): TokenConfig {\n  return { ...currentConfig };\n}\n\n/**\n * Update the token configuration\n *\n * @example\n * setTokenConfig({\n *   organizations: {\n *     \"my-org\": { name: \"my-org\", tokenEnvVar: \"MY_ORG_TOKEN\" }\n *   },\n *   prReviewTokenEnvVar: \"PR_REVIEW_TOKEN\"\n * });\n */\nexport function setTokenConfig(config: Partial<TokenConfig>): void {\n  currentConfig = {\n    ...currentConfig,\n    ...config,\n    organizations: {\n      ...currentConfig.organizations,\n      ...config.organizations,\n    },\n  };\n}\n\n/**\n * Reset configuration to defaults (useful for testing)\n */\nexport function resetTokenConfig(): void {\n  currentConfig = { ...DEFAULT_CONFIG, organizations: {} };\n  loadEnvConfig();\n}\n\n/**\n * Add or update an organization configuration\n *\n * @example\n * addOrganization({\n *   name: \"my-company\",\n *   tokenEnvVar: \"GITHUB_MYCOMPANY_TOKEN\",\n *   defaultBranch: \"main\",\n *   isEnterprise: true\n * });\n */\nexport function addOrganization(org: OrganizationConfig): void {\n  currentConfig.organizations[org.name] = org;\n}\n\n/**\n * Remove an organization configuration\n */\nexport function removeOrganization(orgName: string): void {\n  delete currentConfig.organizations[orgName];\n}\n\n// ============================================\n// Organization Extraction\n// ============================================\n\n/**\n * Extract organization name from a repository URL or full name\n * Uses a safe regex pattern to prevent ReDoS attacks\n *\n * @example\n * extractOrg(\"https://github.com/my-org/my-repo\") // \"my-org\"\n * extractOrg(\"my-org/my-repo\") // \"my-org\"\n * extractOrg(\"git@github.com:my-org/my-repo.git\") // \"my-org\"\n */\nexport function extractOrg(repoUrl: string): string | null {\n  // Handle full GitHub URLs - safe pattern with character class restriction\n  const urlMatch = repoUrl.match(/github\\.com[/:]([a-zA-Z0-9_.-]+)/);\n  if (urlMatch?.[1]) {\n    return urlMatch[1];\n  }\n\n  // Handle owner/repo format\n  const shortMatch = repoUrl.match(/^([a-zA-Z0-9_.-]+)\\//);\n  if (shortMatch?.[1]) {\n    return shortMatch[1];\n  }\n\n  return null;\n}\n\n// ============================================\n// Token Resolution\n// ============================================\n\n/**\n * Get the token environment variable name for a given organization\n * Returns the default if org is not configured\n *\n * @param org - Organization name (case-insensitive)\n */\nexport function getTokenEnvVar(org: string): string {\n  // Try exact match first\n  const config = currentConfig.organizations[org];\n  if (config?.tokenEnvVar) {\n    return config.tokenEnvVar;\n  }\n\n  // Try case-insensitive match\n  const lowerOrg = org.toLowerCase();\n  for (const [key, value] of Object.entries(currentConfig.organizations)) {\n    if (key.toLowerCase() === lowerOrg && value.tokenEnvVar) {\n      return value.tokenEnvVar;\n    }\n  }\n\n  return currentConfig.defaultTokenEnvVar;\n}\n\n/**\n * Get the actual token value for an organization\n *\n * @param org - Organization name\n * @returns Token value or undefined if not set\n */\nexport function getTokenForOrg(org: string): string | undefined {\n  const envVar = getTokenEnvVar(org);\n  return process.env[envVar];\n}\n\n/**\n * Get the token for a repository URL\n * Automatically extracts the organization and returns the appropriate token\n *\n * @param repoUrl - Repository URL or owner/repo format\n * @returns Token value or undefined if not set\n *\n * @example\n * // If configured: addOrganization({ name: \"myorg\", tokenEnvVar: \"MYORG_TOKEN\" })\n * getTokenForRepo(\"https://github.com/myorg/my-repo\")\n * // Returns value of MYORG_TOKEN\n */\nexport function getTokenForRepo(repoUrl: string): string | undefined {\n  const org = extractOrg(repoUrl);\n  if (!org) {\n    return process.env[currentConfig.defaultTokenEnvVar];\n  }\n  return getTokenForOrg(org);\n}\n\n/**\n * Get the token that should be used for PR reviews\n * Ensures a consistent identity across all PR interactions\n *\n * @returns Token value or undefined if not set\n */\nexport function getPRReviewToken(): string | undefined {\n  return process.env[currentConfig.prReviewTokenEnvVar];\n}\n\n/**\n * Get the PR review token environment variable name\n */\nexport function getPRReviewTokenEnvVar(): string {\n  return currentConfig.prReviewTokenEnvVar;\n}\n\n// ============================================\n// Validation\n// ============================================\n\n/**\n * Validate that required tokens are available\n *\n * @param orgs - Organization names to validate (optional, validates all configured if not specified)\n * @returns Validation result with any missing tokens\n */\nexport function validateTokens(orgs?: string[]): Result<string[]> {\n  const missing: string[] = [];\n  const orgsToCheck = orgs ?? Object.keys(currentConfig.organizations);\n\n  for (const org of orgsToCheck) {\n    const token = getTokenForOrg(org);\n    if (!token) {\n      const envVar = getTokenEnvVar(org);\n      missing.push(`${org}: ${envVar} not set`);\n    }\n  }\n\n  // Check PR review token\n  if (!getPRReviewToken()) {\n    missing.push(`PR Review: ${currentConfig.prReviewTokenEnvVar} not set`);\n  }\n\n  // Check default token\n  if (!process.env[currentConfig.defaultTokenEnvVar]) {\n    missing.push(`Default: ${currentConfig.defaultTokenEnvVar} not set`);\n  }\n\n  return {\n    success: missing.length === 0,\n    data: missing,\n    error: missing.length > 0 ? `Missing tokens: ${missing.join(', ')}` : undefined,\n  };\n}\n\n// ============================================\n// Organization Configuration Access\n// ============================================\n\n/**\n * Get organization configuration (case-insensitive)\n */\nexport function getOrgConfig(org: string): OrganizationConfig | undefined {\n  // Try exact match first\n  if (currentConfig.organizations[org]) {\n    return currentConfig.organizations[org];\n  }\n\n  // Try case-insensitive match\n  const lowerOrg = org.toLowerCase();\n  for (const [key, value] of Object.entries(currentConfig.organizations)) {\n    if (key.toLowerCase() === lowerOrg) {\n      return value;\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Get all configured organizations\n */\nexport function getConfiguredOrgs(): string[] {\n  return Object.keys(currentConfig.organizations);\n}\n\n/**\n * Check if an organization is configured (case-insensitive)\n */\nexport function isOrgConfigured(org: string): boolean {\n  if (org in currentConfig.organizations) {\n    return true;\n  }\n\n  const lowerOrg = org.toLowerCase();\n  for (const key of Object.keys(currentConfig.organizations)) {\n    if (key.toLowerCase() === lowerOrg) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n// ============================================\n// Environment Helpers for Subprocesses\n// ============================================\n\n/**\n * Create environment variables object for a subprocess targeting a specific org\n * Useful when spawning child processes that need the correct GitHub token\n *\n * @param repoUrl - Repository URL to get token for\n * @returns Object with GH_TOKEN and GITHUB_TOKEN set\n *\n * @example\n * import { spawnSync } from 'node:child_process';\n * const proc = spawnSync('gh', ['pr', 'list'], {\n *   env: { ...process.env, ...getEnvForRepo(\"owner/repo\") }\n * });\n */\nexport function getEnvForRepo(repoUrl: string): Record<string, string> {\n  const token = getTokenForRepo(repoUrl);\n  if (!token) {\n    return {};\n  }\n  return {\n    GH_TOKEN: token,\n    GITHUB_TOKEN: token,\n  };\n}\n\n/**\n * Create environment variables for PR review operations\n * Uses the configured PR review identity\n *\n * @returns Object with GH_TOKEN and GITHUB_TOKEN set for PR review\n */\nexport function getEnvForPRReview(): Record<string, string> {\n  const token = getPRReviewToken();\n  if (!token) {\n    return {};\n  }\n  return {\n    GH_TOKEN: token,\n    GITHUB_TOKEN: token,\n  };\n}\n\n// ============================================\n// Convenience Utilities\n// ============================================\n\n/**\n * Check if we have a valid token for an organization\n */\nexport function hasTokenForOrg(org: string): boolean {\n  return !!getTokenForOrg(org);\n}\n\n/**\n * Check if we have a valid token for a repository\n */\nexport function hasTokenForRepo(repoUrl: string): boolean {\n  return !!getTokenForRepo(repoUrl);\n}\n\n/**\n * Get a summary of token availability for debugging/display\n */\nexport function getTokenSummary(): Record<\n  string,\n  { envVar: string; available: boolean; configured: boolean }\n> {\n  const summary: Record<string, { envVar: string; available: boolean; configured: boolean }> = {};\n\n  for (const org of getConfiguredOrgs()) {\n    const envVar = getTokenEnvVar(org);\n    summary[org] = {\n      envVar,\n      available: !!process.env[envVar],\n      configured: true,\n    };\n  }\n\n  summary._default = {\n    envVar: currentConfig.defaultTokenEnvVar,\n    available: !!process.env[currentConfig.defaultTokenEnvVar],\n    configured: true,\n  };\n\n  summary._pr_review = {\n    envVar: currentConfig.prReviewTokenEnvVar,\n    available: !!getPRReviewToken(),\n    configured: true,\n  };\n\n  return summary;\n}\n","/**\n * Typed error classes for agentic-control\n */\n\nexport enum SandboxErrorCode {\n  CONTAINER_CREATE_FAILED = 'CONTAINER_CREATE_FAILED',\n  CONTAINER_START_FAILED = 'CONTAINER_START_FAILED',\n  EXECUTION_TIMEOUT = 'EXECUTION_TIMEOUT',\n  MEMORY_LIMIT_EXCEEDED = 'MEMORY_LIMIT_EXCEEDED',\n  WORKSPACE_MOUNT_FAILED = 'WORKSPACE_MOUNT_FAILED',\n  OUTPUT_EXTRACTION_FAILED = 'OUTPUT_EXTRACTION_FAILED',\n  RUNTIME_NOT_FOUND = 'RUNTIME_NOT_FOUND',\n}\n\nexport class SandboxError extends Error {\n  constructor(\n    message: string,\n    public code: SandboxErrorCode,\n    public containerId?: string,\n    public override cause?: Error\n  ) {\n    super(message);\n    this.name = 'SandboxError';\n  }\n}\n\nexport enum DockerErrorCode {\n  BUILD_FAILED = 'BUILD_FAILED',\n  PUSH_FAILED = 'PUSH_FAILED',\n  PLATFORM_NOT_SUPPORTED = 'PLATFORM_NOT_SUPPORTED',\n  REGISTRY_AUTH_FAILED = 'REGISTRY_AUTH_FAILED',\n}\n\nexport class DockerBuildError extends Error {\n  constructor(\n    message: string,\n    public code: DockerErrorCode,\n    public dockerfile?: string,\n    public override cause?: Error\n  ) {\n    super(message);\n    this.name = 'DockerBuildError';\n  }\n}\n\nexport enum ConfigErrorCode {\n  INVALID_SCHEMA = 'INVALID_SCHEMA',\n  MISSING_REQUIRED_FIELD = 'MISSING_REQUIRED_FIELD',\n  INVALID_VALUE = 'INVALID_VALUE',\n  FILE_NOT_FOUND = 'FILE_NOT_FOUND',\n}\n\nexport class ConfigurationError extends Error {\n  constructor(\n    message: string,\n    public code: ConfigErrorCode,\n    public field?: string,\n    public override cause?: Error\n  ) {\n    super(message);\n    this.name = 'ConfigurationError';\n  }\n}\n","/**\n * Configuration validation using Zod schemas\n */\n\nimport { z } from 'zod';\nimport { ConfigErrorCode, ConfigurationError } from './errors.js';\n\n// ============================================\n// Base Schemas\n// ============================================\n\nconst TokenOrgSchema = z.object({\n  name: z.string().min(1).max(39),\n  tokenEnvVar: z.string().min(1),\n});\n\nconst TokenConfigSchema = z.object({\n  organizations: z.record(z.string(), TokenOrgSchema).optional(),\n  defaultTokenEnvVar: z.string().optional(),\n  prReviewTokenEnvVar: z.string().optional(),\n});\n\nconst FleetConfigSchema = z.object({\n  autoCreatePr: z.boolean().optional(),\n  openAsCursorGithubApp: z.boolean().optional(),\n  skipReviewerRequest: z.boolean().optional(),\n});\n\nconst TriageConfigSchema = z.object({\n  provider: z.enum(['anthropic', 'openai', 'google', 'mistral', 'azure']).optional(),\n  model: z.string().optional(),\n  apiKeyEnvVar: z.string().optional(),\n});\n\nconst MCPServerConfigSchema = z.object({\n  enabled: z.boolean().optional(),\n  tokenEnvVar: z.string().optional(),\n  tokenEnvVarFallbacks: z.array(z.string()).optional(),\n  mode: z.enum(['stdio', 'proxy']).optional(),\n  command: z.string().optional(),\n  args: z.array(z.string()).optional(),\n  proxyUrl: z.string().url().optional(),\n});\n\nconst MCPConfigSchema = z\n  .object({\n    cursor: MCPServerConfigSchema.optional(),\n    github: MCPServerConfigSchema.optional(),\n    context7: MCPServerConfigSchema.optional(),\n    '21st-magic': MCPServerConfigSchema.optional(),\n  })\n  .catchall(MCPServerConfigSchema);\n\nconst CursorConfigSchema = z.object({\n  apiKeyEnvVar: z.string().optional(),\n  baseUrl: z.string().url().optional(),\n});\n\n// ============================================\n// Main Configuration Schema\n// ============================================\n\nexport const AgenticConfigSchema = z.object({\n  tokens: TokenConfigSchema.optional(),\n  defaultRepository: z.string().optional(),\n  coordinationPr: z.number().int().positive().optional(),\n  logLevel: z.enum(['debug', 'info', 'warn', 'error']).optional(),\n  verbose: z.boolean().optional(),\n  cursor: CursorConfigSchema.optional(),\n  fleet: FleetConfigSchema.optional(),\n  triage: TriageConfigSchema.optional(),\n  mcp: MCPConfigSchema.optional(),\n});\n\n// ============================================\n// Validation Functions\n// ============================================\n\n/**\n * Validate configuration object against schema\n */\nexport function validateConfig(config: unknown): void {\n  try {\n    AgenticConfigSchema.parse(config);\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      const firstIssue = error.issues[0];\n      if (firstIssue) {\n        const field = firstIssue.path.join('.');\n        const message = `Invalid configuration at '${field}': ${firstIssue.message}`;\n        throw new ConfigurationError(message, ConfigErrorCode.INVALID_SCHEMA, field);\n      }\n      throw new ConfigurationError('Invalid configuration', ConfigErrorCode.INVALID_SCHEMA);\n    }\n    throw error;\n  }\n}\n\n/**\n * Validate environment variable exists and is not empty\n */\nexport function validateEnvVar(envVar: string, description?: string): string {\n  const value = process.env[envVar];\n\n  if (!value || value.trim() === '') {\n    const desc = description ?? envVar;\n    throw new ConfigurationError(\n      `Missing required environment variable: ${envVar}. Please set ${desc} to continue.`,\n      ConfigErrorCode.MISSING_REQUIRED_FIELD,\n      envVar\n    );\n  }\n\n  return value.trim();\n}\n\n/**\n * Validate environment variable with clear error message\n */\nexport function validateEnvVarWithMessage(envVar: string, purpose: string): string {\n  const value = process.env[envVar];\n\n  if (!value || value.trim() === '') {\n    throw new ConfigurationError(\n      `${purpose} requires ${envVar} environment variable. Please set it and try again.`,\n      ConfigErrorCode.MISSING_REQUIRED_FIELD,\n      envVar\n    );\n  }\n\n  return value.trim();\n}\n\n/**\n * Validate repository format (owner/repo)\n */\nexport function validateRepository(repo: string): void {\n  const repoPattern = /^[a-zA-Z0-9._-]+\\/[a-zA-Z0-9._-]+$/;\n\n  if (!repoPattern.test(repo)) {\n    throw new ConfigurationError(\n      `Invalid repository format: ${repo}. Expected format: owner/repo`,\n      ConfigErrorCode.INVALID_VALUE,\n      'repository'\n    );\n  }\n}\n\n/**\n * Validate git reference format\n */\nexport function validateGitRef(ref: string): void {\n  if (!/^[a-zA-Z0-9._/-]+$/.test(ref)) {\n    throw new ConfigurationError(\n      `Invalid git reference format: ${ref}`,\n      ConfigErrorCode.INVALID_VALUE,\n      'gitRef'\n    );\n  }\n\n  if (ref.length > 200) {\n    throw new ConfigurationError(\n      `Git reference too long: ${ref} (max 200 characters)`,\n      ConfigErrorCode.INVALID_VALUE,\n      'gitRef'\n    );\n  }\n}\n\n/**\n * Validate positive integer\n */\nexport function validatePositiveInt(value: string, field: string): number {\n  const parsed = Number.parseInt(value, 10);\n\n  if (Number.isNaN(parsed) || parsed <= 0) {\n    throw new ConfigurationError(\n      `${field} must be a positive integer, got: ${value}`,\n      ConfigErrorCode.INVALID_VALUE,\n      field\n    );\n  }\n\n  return parsed;\n}\n","/**\n * Configuration Management for agentic-control\n *\n * Uses cosmiconfig for standard config file discovery and loading.\n * Searches for configuration in:\n *   - agentic.config.json\n *   - agentic.config.js\n *   - agentic.config.cjs\n *   - .agenticrc\n *   - .agenticrc.json\n *   - package.json \"agentic\" key\n *\n * Priority: CLI args > env vars > config file > defaults\n *\n * @example Config file (agentic.config.json):\n * ```json\n * {\n *   \"tokens\": {\n *     \"organizations\": {\n *       \"my-org\": { \"name\": \"my-org\", \"tokenEnvVar\": \"MY_ORG_TOKEN\" }\n *     }\n *   },\n *   \"defaultModel\": \"claude-sonnet-4-20250514\",\n *   \"fleet\": {\n *     \"autoCreatePr\": true\n *   }\n * }\n * ```\n */\n\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { setTokenConfig } from './tokens.js';\nimport type { TokenConfig } from './types.js';\nimport { validateConfig } from './validation.js';\n\n// ============================================\n// Configuration Types\n// ============================================\n\nexport interface FleetConfig {\n  /** Auto-create PR when agent completes */\n  autoCreatePr?: boolean;\n  /** Open PR as Cursor GitHub App */\n  openAsCursorGithubApp?: boolean;\n  /** Skip adding user as reviewer */\n  skipReviewerRequest?: boolean;\n}\n\nexport interface TriageConfig {\n  /** AI provider: anthropic, openai, google, mistral, azure */\n  provider?: string;\n  /** Model ID for the provider */\n  model?: string;\n  /** API key environment variable name */\n  apiKeyEnvVar?: string;\n}\n\nexport interface MCPServerConfig {\n  /** Whether this MCP server is enabled */\n  enabled?: boolean;\n  /** Environment variable name for the API key/token */\n  tokenEnvVar?: string;\n  /** Fallback env vars to try if primary not found */\n  tokenEnvVarFallbacks?: string[];\n  /** Transport mode: stdio or proxy */\n  mode?: 'stdio' | 'proxy';\n  /** Command to run for stdio transport */\n  command?: string;\n  /** Arguments for the command */\n  args?: string[];\n  /** Proxy URL for proxy mode */\n  proxyUrl?: string;\n}\n\nexport interface MCPConfig {\n  /** Cursor Background Agent MCP */\n  cursor?: MCPServerConfig;\n  /** GitHub MCP */\n  github?: MCPServerConfig;\n  /** Context7 documentation MCP */\n  context7?: MCPServerConfig;\n  /** 21st.dev Magic MCP */\n  '21st-magic'?: MCPServerConfig;\n  /** Custom MCP servers */\n  [key: string]: MCPServerConfig | undefined;\n}\n\nexport interface RoleConfig {\n  /** Enable/disable the role */\n  enabled?: boolean;\n  /** Override the system prompt */\n  systemPrompt?: string;\n  /** Model override */\n  model?: string;\n}\n\nexport interface RolesConfig {\n  /** Sage role configuration */\n  sage?: RoleConfig;\n  /** Harvester role configuration */\n  harvester?: RoleConfig;\n  /** Curator role configuration */\n  curator?: RoleConfig;\n  /** Reviewer role configuration */\n  reviewer?: RoleConfig;\n  /** Fixer role configuration */\n  fixer?: RoleConfig;\n  /** Delegator role configuration */\n  delegator?: RoleConfig;\n}\n\nexport interface AgenticConfig {\n  /** Token configuration for multi-org access */\n  tokens?: Partial<TokenConfig>;\n\n  /** Default repository for fleet operations */\n  defaultRepository?: string;\n\n  /** Coordination PR number for fleet communication */\n  coordinationPr?: number;\n\n  /** Log level */\n  logLevel?: 'debug' | 'info' | 'warn' | 'error';\n\n  /** Whether to enable verbose output */\n  verbose?: boolean;\n\n  /** Cursor API configuration */\n  cursor?: {\n    /** API key environment variable name */\n    apiKeyEnvVar?: string;\n    /** Base URL for Cursor API */\n    baseUrl?: string;\n  };\n\n  /** Fleet default options */\n  fleet?: FleetConfig;\n\n  /** Triage (AI analysis) configuration */\n  triage?: TriageConfig;\n\n  /** MCP server configuration */\n  mcp?: MCPConfig;\n\n  /** Roles configuration */\n  roles?: RolesConfig;\n}\n\n// ============================================\n// Cosmiconfig Setup\n// ============================================\n\nconst MODULE_NAME = 'agentic';\n\n// Security: Only allow JSON config files to prevent code execution\n// JavaScript config files could execute arbitrary code during require()\nconst explorer = cosmiconfigSync(MODULE_NAME, {\n  searchPlaces: ['package.json', 'agentic.config.json', '.agenticrc', '.agenticrc.json'],\n  // Security: Disable loaders that execute code\n  loaders: {\n    '.json': (_filepath: string, content: string) => JSON.parse(content),\n  },\n});\n\n// ============================================\n// Configuration State\n// ============================================\n\nlet config: AgenticConfig = {};\nlet configLoaded = false;\nlet configPath: string | null = null;\n\n// ============================================\n// Environment Variable Loading\n// ============================================\n\nfunction loadEnvConfig(): Partial<AgenticConfig> {\n  const envConfig: Partial<AgenticConfig> = {};\n\n  // Build triage config from environment variables\n  const triageFromEnv: Partial<TriageConfig> = {};\n  if (process.env.AGENTIC_MODEL) {\n    triageFromEnv.model = process.env.AGENTIC_MODEL;\n  }\n  if (process.env.AGENTIC_PROVIDER) {\n    triageFromEnv.provider = process.env.AGENTIC_PROVIDER;\n  }\n  if (Object.keys(triageFromEnv).length > 0) {\n    envConfig.triage = triageFromEnv;\n  }\n\n  if (process.env.AGENTIC_REPOSITORY) {\n    envConfig.defaultRepository = process.env.AGENTIC_REPOSITORY;\n  }\n\n  if (process.env.AGENTIC_COORDINATION_PR) {\n    const parsed = Number.parseInt(process.env.AGENTIC_COORDINATION_PR, 10);\n    if (!Number.isNaN(parsed) && parsed > 0) {\n      envConfig.coordinationPr = parsed;\n    }\n  }\n\n  if (process.env.AGENTIC_LOG_LEVEL) {\n    const level = process.env.AGENTIC_LOG_LEVEL.toLowerCase();\n    if (['debug', 'info', 'warn', 'error'].includes(level)) {\n      envConfig.logLevel = level as AgenticConfig['logLevel'];\n    }\n  }\n\n  if (process.env.AGENTIC_VERBOSE === 'true' || process.env.AGENTIC_VERBOSE === '1') {\n    envConfig.verbose = true;\n  }\n\n  return envConfig;\n}\n\n// ============================================\n// Configuration Loading\n// ============================================\n\n/**\n * Deep merge configuration objects\n */\nfunction mergeConfig(base: AgenticConfig, overrides: Partial<AgenticConfig>): AgenticConfig {\n  const result = { ...base };\n\n  for (const [key, value] of Object.entries(overrides)) {\n    if (value === undefined) continue;\n\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      const baseValue = (base as Record<string, unknown>)[key];\n      // Only spread baseValue if it's a non-null object\n      const baseObj =\n        typeof baseValue === 'object' && baseValue !== null && !Array.isArray(baseValue)\n          ? baseValue\n          : {};\n      (result as Record<string, unknown>)[key] = {\n        ...baseObj,\n        ...value,\n      };\n    } else {\n      (result as Record<string, unknown>)[key] = value;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Initialize configuration from all sources\n * Priority: programmatic overrides > env vars > config file\n */\nexport function initConfig(overrides?: Partial<AgenticConfig>): AgenticConfig {\n  // Search for config file using cosmiconfig\n  const result = explorer.search();\n\n  if (result && !result.isEmpty) {\n    // Validate configuration before using it\n    validateConfig(result.config);\n    config = result.config as AgenticConfig;\n    configPath = result.filepath;\n  } else {\n    config = {};\n    configPath = null;\n  }\n\n  // Merge environment variables\n  const envConfig = loadEnvConfig();\n  config = mergeConfig(config, envConfig);\n\n  // Apply programmatic overrides\n  if (overrides) {\n    config = mergeConfig(config, overrides);\n  }\n\n  // Validate final configuration\n  validateConfig(config);\n\n  // Apply token configuration\n  if (config.tokens) {\n    setTokenConfig(config.tokens);\n  }\n\n  configLoaded = true;\n  return config;\n}\n\n/**\n * Load config from a specific file path\n */\nexport function loadConfigFromPath(filepath: string): AgenticConfig {\n  const result = explorer.load(filepath);\n\n  if (result && !result.isEmpty) {\n    // Validate configuration before using it\n    validateConfig(result.config);\n    config = result.config as AgenticConfig;\n    configPath = result.filepath;\n\n    if (config.tokens) {\n      setTokenConfig(config.tokens);\n    }\n\n    configLoaded = true;\n    return config;\n  }\n\n  throw new Error(`Failed to load config from ${filepath}`);\n}\n\n// ============================================\n// Public API\n// ============================================\n\n/**\n * Get the current configuration\n */\nexport function getConfig(): AgenticConfig {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return { ...config };\n}\n\n/**\n * Get path to loaded config file\n */\nexport function getConfigPath(): string | null {\n  return configPath;\n}\n\n/**\n * Update configuration at runtime\n */\nexport function setConfig(updates: Partial<AgenticConfig>): void {\n  config = mergeConfig(config, updates);\n\n  if (updates.tokens) {\n    setTokenConfig(updates.tokens);\n  }\n}\n\n/**\n * Reset configuration (useful for testing)\n */\nexport function resetConfig(): void {\n  config = {};\n  configLoaded = false;\n  configPath = null;\n}\n\n/**\n * Get a specific configuration value\n */\nexport function getConfigValue<K extends keyof AgenticConfig>(key: K): AgenticConfig[K] {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return config[key];\n}\n\n/**\n * Check if verbose mode is enabled\n */\nexport function isVerbose(): boolean {\n  return config.verbose ?? false;\n}\n\n/**\n * Get triage configuration\n */\nexport function getTriageConfig(): TriageConfig {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return (\n    config.triage ?? {\n      provider: 'anthropic',\n      model: 'claude-sonnet-4-20250514',\n      apiKeyEnvVar: 'ANTHROPIC_API_KEY',\n    }\n  );\n}\n\n/**\n * Get the default model for triage operations\n * @deprecated Use getTriageConfig() instead\n */\nexport function getDefaultModel(): string {\n  return getTriageConfig().model ?? 'claude-sonnet-4-20250514';\n}\n\n/**\n * Get fleet defaults\n */\nexport function getFleetDefaults(): FleetConfig {\n  if (!configLoaded) {\n    initConfig();\n  }\n  return config.fleet ?? {};\n}\n\n/**\n * Get the log level\n */\nexport function getLogLevel(): string {\n  return config.logLevel ?? 'info';\n}\n\n/**\n * Get Cursor API key from configured environment variable\n */\nexport function getCursorApiKey(): string | undefined {\n  const envVar = config.cursor?.apiKeyEnvVar ?? 'CURSOR_API_KEY';\n  return process.env[envVar];\n}\n\n/**\n * Get default API key env var for a provider\n */\nexport function getDefaultApiKeyEnvVar(provider?: string): string {\n  switch (provider) {\n    case 'openai':\n      return 'OPENAI_API_KEY';\n    case 'google':\n      return 'GOOGLE_API_KEY';\n    case 'mistral':\n      return 'MISTRAL_API_KEY';\n    case 'azure':\n      return 'AZURE_API_KEY';\n    case 'ollama':\n      return 'OLLAMA_API_KEY';\n    default:\n      return 'ANTHROPIC_API_KEY';\n  }\n}\n\n/**\n * Get triage API key from configured environment variable\n * @param providerOverride - Optional provider to use instead of config value\n */\nexport function getTriageApiKey(providerOverride?: string): string | undefined {\n  const triageConfig = getTriageConfig();\n  const provider = providerOverride ?? triageConfig.provider;\n  const envVar = triageConfig.apiKeyEnvVar ?? getDefaultApiKeyEnvVar(provider);\n  return process.env[envVar];\n}\n\n// ============================================\n// Logging Utilities\n// ============================================\n\nconst LOG_LEVELS = {\n  debug: 0,\n  info: 1,\n  warn: 2,\n  error: 3,\n};\n\nfunction shouldLog(level: keyof typeof LOG_LEVELS): boolean {\n  const currentLevel = LOG_LEVELS[getLogLevel() as keyof typeof LOG_LEVELS] ?? 1;\n  return LOG_LEVELS[level] >= currentLevel;\n}\n\nexport const log = {\n  debug: (...args: unknown[]): void => {\n    if (shouldLog('debug')) {\n      console.debug('[agentic:debug]', ...args);\n    }\n  },\n  info: (...args: unknown[]): void => {\n    if (shouldLog('info')) {\n      console.log('[agentic:info]', ...args);\n    }\n  },\n  warn: (...args: unknown[]): void => {\n    if (shouldLog('warn')) {\n      console.warn('[agentic:warn]', ...args);\n    }\n  },\n  error: (...args: unknown[]): void => {\n    if (shouldLog('error')) {\n      console.error('[agentic:error]', ...args);\n    }\n  },\n};\n","/**\n * GitHubClient - Unified GitHub API client\n *\n * Provides GitHub API operations with:\n * - Intelligent token switching based on organization\n * - Consistent identity for PR reviews\n * - CI status and feedback collection\n * - Safe git operations (no shell injection)\n *\n * This consolidates the former token-aware client and triage client.\n */\n\nimport { spawnSync } from 'node:child_process';\nimport { Octokit } from '@octokit/rest';\nimport { log } from '../core/config.js';\nimport { extractOrg, getPRReviewToken, getTokenForRepo } from '../core/tokens.js';\nimport type { PRComment, PullRequest, Repository, Result } from '../core/types.js';\nimport type {\n  CICheck,\n  CIStatus,\n  FeedbackItem,\n  FeedbackSeverity,\n  FeedbackStatus,\n} from '../triage/types.js';\n\n// ============================================\n// Octokit Cache (one per token)\n// ============================================\n\nconst octokitCache = new Map<string, Octokit>();\n\nfunction getOctokit(token: string): Octokit {\n  let octokit = octokitCache.get(token);\n  if (!octokit) {\n    octokit = new Octokit({ auth: token });\n    octokitCache.set(token, octokit);\n  }\n  return octokit;\n}\n\n// ============================================\n// Configuration\n// ============================================\n\nexport interface GitHubClientConfig {\n  /** Token for authentication */\n  token?: string;\n  /** Repository owner */\n  owner?: string;\n  /** Repository name */\n  repo?: string;\n}\n\n// ============================================\n// GitHub Client Class\n// ============================================\n\nexport class GitHubClient {\n  private token: string | null;\n  private owner: string | null;\n  private repo: string | null;\n\n  /**\n   * Create a new GitHubClient.\n   *\n   * Can be used in two modes:\n   * 1. With explicit config: new GitHubClient({ token, owner, repo })\n   * 2. Token-aware mode: new GitHubClient() - uses token based on repo\n   */\n  constructor(config: GitHubClientConfig = {}) {\n    this.token = config.token ?? null;\n    this.owner = config.owner ?? null;\n    this.repo = config.repo ?? null;\n  }\n\n  // ============================================\n  // Token Management (Static Methods)\n  // ============================================\n\n  /**\n   * Get an Octokit instance for a repository.\n   * Automatically selects the correct token based on org.\n   */\n  static forRepo(repoUrl: string): Octokit | null {\n    const token = getTokenForRepo(repoUrl);\n    if (!token) {\n      log.warn(`No token available for repo: ${repoUrl}`);\n      return null;\n    }\n    return getOctokit(token);\n  }\n\n  /**\n   * Get an Octokit instance for PR review operations.\n   * Always uses the consistent PR review identity.\n   */\n  static forPRReview(): Octokit | null {\n    const token = getPRReviewToken();\n    if (!token) {\n      log.warn('No PR review token available');\n      return null;\n    }\n    return getOctokit(token);\n  }\n\n  // ============================================\n  // Instance Helpers\n  // ============================================\n\n  private getOctokitInstance(): Octokit {\n    if (this.token) {\n      return getOctokit(this.token);\n    }\n    if (this.owner && this.repo) {\n      const octokit = GitHubClient.forRepo(`${this.owner}/${this.repo}`);\n      if (!octokit) {\n        throw new Error(`No token available for ${this.owner}/${this.repo}`);\n      }\n      return octokit;\n    }\n    throw new Error('GitHubClient requires either token or owner/repo');\n  }\n\n  private ensureRepo(): { owner: string; repo: string } {\n    if (!this.owner || !this.repo) {\n      throw new Error('owner and repo are required for this operation');\n    }\n    return { owner: this.owner, repo: this.repo };\n  }\n\n  // ============================================\n  // Repository Operations (Static)\n  // ============================================\n\n  /**\n   * Get repository information\n   */\n  static async getRepo(owner: string, repo: string): Promise<Result<Repository>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      const { data } = await octokit.repos.get({ owner, repo });\n      return {\n        success: true,\n        data: {\n          owner: data.owner.login,\n          name: data.name,\n          fullName: data.full_name,\n          defaultBranch: data.default_branch,\n          isPrivate: data.private,\n          url: data.html_url,\n        },\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * List repositories for an organization\n   */\n  static async listOrgRepos(\n    org: string,\n    options?: {\n      type?: 'all' | 'public' | 'private' | 'forks' | 'sources' | 'member';\n      perPage?: number;\n    }\n  ): Promise<Result<Repository[]>> {\n    const octokit = GitHubClient.forRepo(`${org}/any`);\n    if (!octokit) {\n      return { success: false, error: `No token available for org: ${org}` };\n    }\n\n    try {\n      const { data } = await octokit.repos.listForOrg({\n        org,\n        type: options?.type ?? 'all',\n        per_page: options?.perPage ?? 100,\n      });\n\n      return {\n        success: true,\n        data: data.map((r) => ({\n          owner: r.owner.login,\n          name: r.name,\n          fullName: r.full_name,\n          defaultBranch: r.default_branch ?? 'main',\n          isPrivate: r.private,\n          url: r.html_url,\n        })),\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  // ============================================\n  // Pull Request Operations\n  // ============================================\n\n  /**\n   * Get pull request information (static version)\n   */\n  static async getPRStatic(\n    owner: string,\n    repo: string,\n    prNumber: number\n  ): Promise<Result<PullRequest>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      const { data } = await octokit.pulls.get({ owner, repo, pull_number: prNumber });\n      return {\n        success: true,\n        data: {\n          number: data.number,\n          title: data.title,\n          body: data.body ?? undefined,\n          state: data.state as 'open' | 'closed',\n          draft: data.draft ?? false,\n          url: data.html_url,\n          headBranch: data.head.ref,\n          baseBranch: data.base.ref,\n          author: data.user?.login ?? 'unknown',\n        },\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Get pull request (instance version with full data)\n   */\n  async getPR(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.get({\n      owner,\n      repo,\n      pull_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * Get files changed in a PR\n   */\n  async getPRFiles(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.listFiles({\n      owner,\n      repo,\n      pull_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * Create a pull request\n   */\n  static async createPR(\n    owner: string,\n    repo: string,\n    options: {\n      title: string;\n      body?: string;\n      head: string;\n      base: string;\n      draft?: boolean;\n    }\n  ): Promise<Result<PullRequest>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      const { data } = await octokit.pulls.create({\n        owner,\n        repo,\n        title: options.title,\n        body: options.body,\n        head: options.head,\n        base: options.base,\n        draft: options.draft,\n      });\n\n      return {\n        success: true,\n        data: {\n          number: data.number,\n          title: data.title,\n          body: data.body ?? undefined,\n          state: data.state as 'open' | 'closed',\n          draft: data.draft ?? false,\n          url: data.html_url,\n          headBranch: data.head.ref,\n          baseBranch: data.base.ref,\n          author: data.user?.login ?? 'unknown',\n        },\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Merge a pull request\n   */\n  static async mergePRStatic(\n    owner: string,\n    repo: string,\n    prNumber: number,\n    options?: {\n      mergeMethod?: 'merge' | 'squash' | 'rebase';\n      commitTitle?: string;\n      commitMessage?: string;\n    }\n  ): Promise<Result<void>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      await octokit.pulls.merge({\n        owner,\n        repo,\n        pull_number: prNumber,\n        merge_method: options?.mergeMethod ?? 'squash',\n        commit_title: options?.commitTitle,\n        commit_message: options?.commitMessage,\n      });\n\n      return { success: true };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Merge a pull request (instance version)\n   */\n  async mergePR(prNumber: number, method: 'merge' | 'squash' | 'rebase' = 'squash') {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.merge({\n      owner,\n      repo,\n      pull_number: prNumber,\n      merge_method: method,\n    });\n    return data;\n  }\n\n  // ============================================\n  // Reviews and Comments\n  // ============================================\n\n  /**\n   * Get reviews on a PR\n   */\n  async getReviews(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.listReviews({\n      owner,\n      repo,\n      pull_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * Get review comments on a PR\n   */\n  async getReviewComments(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.listReviewComments({\n      owner,\n      repo,\n      pull_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * Get issue comments on a PR\n   */\n  async getIssueComments(prNumber: number) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.issues.listComments({\n      owner,\n      repo,\n      issue_number: prNumber,\n    });\n    return data;\n  }\n\n  /**\n   * List PR comments (static version)\n   */\n  static async listPRComments(\n    owner: string,\n    repo: string,\n    prNumber: number\n  ): Promise<Result<PRComment[]>> {\n    const octokit = GitHubClient.forRepo(`${owner}/${repo}`);\n    if (!octokit) {\n      return { success: false, error: 'No token available for this repository' };\n    }\n\n    try {\n      const { data } = await octokit.issues.listComments({\n        owner,\n        repo,\n        issue_number: prNumber,\n        per_page: 100,\n      });\n\n      return {\n        success: true,\n        data: data.map((c) => ({\n          id: c.id,\n          body: c.body ?? '',\n          author: c.user?.login ?? 'unknown',\n          createdAt: c.created_at,\n          updatedAt: c.updated_at,\n        })),\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Post a PR comment (ALWAYS uses PR review identity)\n   */\n  static async postPRComment(\n    owner: string,\n    repo: string,\n    prNumber: number,\n    body: string\n  ): Promise<Result<PRComment>> {\n    const octokit = GitHubClient.forPRReview();\n    if (!octokit) {\n      return { success: false, error: 'No PR review token available' };\n    }\n\n    try {\n      const { data } = await octokit.issues.createComment({\n        owner,\n        repo,\n        issue_number: prNumber,\n        body,\n      });\n\n      return {\n        success: true,\n        data: {\n          id: data.id,\n          body: data.body ?? '',\n          author: data.user?.login ?? 'unknown',\n          createdAt: data.created_at,\n          updatedAt: data.updated_at,\n        },\n      };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  /**\n   * Post a comment (instance version)\n   */\n  async postComment(prNumber: number, body: string) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.issues.createComment({\n      owner,\n      repo,\n      issue_number: prNumber,\n      body,\n    });\n    return data;\n  }\n\n  /**\n   * Reply to a review comment\n   */\n  async replyToComment(prNumber: number, commentId: number, body: string) {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n    const { data } = await octokit.pulls.createReplyForReviewComment({\n      owner,\n      repo,\n      pull_number: prNumber,\n      comment_id: commentId,\n      body,\n    });\n    return data;\n  }\n\n  /**\n   * Request a review on a PR (ALWAYS uses PR review identity)\n   */\n  static async requestReview(\n    owner: string,\n    repo: string,\n    prNumber: number,\n    reviewers: string[]\n  ): Promise<Result<void>> {\n    const octokit = GitHubClient.forPRReview();\n    if (!octokit) {\n      return { success: false, error: 'No PR review token available' };\n    }\n\n    try {\n      await octokit.pulls.requestReviewers({\n        owner,\n        repo,\n        pull_number: prNumber,\n        reviewers,\n      });\n\n      return { success: true };\n    } catch (error) {\n      return { success: false, error: String(error) };\n    }\n  }\n\n  // ============================================\n  // CI Status\n  // ============================================\n\n  /**\n   * Get CI status for a PR\n   */\n  async getCIStatus(prNumber: number): Promise<CIStatus> {\n    const { owner, repo } = this.ensureRepo();\n    const octokit = this.getOctokitInstance();\n\n    const pr = await this.getPR(prNumber);\n    const ref = pr.head.sha;\n\n    const { data: checkRuns } = await octokit.checks.listForRef({\n      owner,\n      repo,\n      ref,\n    });\n\n    const checks: CICheck[] = checkRuns.check_runs.map((run) => ({\n      name: run.name,\n      status: this.mapCheckStatus(run.status, run.conclusion),\n      conclusion: run.conclusion,\n      url: run.html_url ?? '',\n      startedAt: run.started_at,\n      completedAt: run.completed_at,\n    }));\n\n    const failures = checks.filter((c) => c.status === 'failure');\n    const pending = checks.filter((c) => c.status === 'pending' || c.status === 'in_progress');\n\n    return {\n      allPassing: failures.length === 0 && pending.length === 0,\n      anyPending: pending.length > 0,\n      checks,\n      failures,\n    };\n  }\n\n  private mapCheckStatus(status: string, conclusion: string | null): CICheck['status'] {\n    if (status === 'queued' || status === 'pending') return 'pending';\n    if (status === 'in_progress') return 'in_progress';\n    if (conclusion === 'success') return 'success';\n    if (conclusion === 'failure' || conclusion === 'timed_out') return 'failure';\n    if (conclusion === 'skipped' || conclusion === 'cancelled') return 'skipped';\n    return 'pending';\n  }\n\n  // ============================================\n  // Feedback Collection\n  // ============================================\n\n  /**\n   * Collect all feedback on a PR\n   */\n  async collectFeedback(prNumber: number): Promise<FeedbackItem[]> {\n    const [reviewComments, reviews] = await Promise.all([\n      this.getReviewComments(prNumber),\n      this.getReviews(prNumber),\n    ]);\n\n    const feedbackItems: FeedbackItem[] = [];\n\n    // Process inline review comments\n    for (const comment of reviewComments) {\n      const severity = this.inferSeverity(comment.body);\n      feedbackItems.push({\n        id: `comment-${comment.id}`,\n        author: comment.user?.login ?? 'unknown',\n        body: comment.body,\n        path: comment.path,\n        line: comment.line ?? comment.original_line ?? null,\n        severity,\n        status: this.inferStatus(comment),\n        createdAt: comment.created_at,\n        url: comment.html_url,\n        isAutoResolvable: this.isAutoResolvable(comment.body, severity),\n        suggestedAction: this.extractSuggestion(comment.body),\n        resolution: null,\n      });\n    }\n\n    // Process review bodies (summary comments)\n    for (const review of reviews) {\n      if (!review.body || review.body.trim() === '') continue;\n\n      const severity = this.inferSeverity(review.body);\n      feedbackItems.push({\n        id: `review-${review.id}`,\n        author: review.user?.login ?? 'unknown',\n        body: review.body,\n        path: null,\n        line: null,\n        severity,\n        status: 'addressed', // Review summaries are informational\n        createdAt: review.submitted_at ?? new Date().toISOString(),\n        url: review.html_url,\n        isAutoResolvable: false,\n        suggestedAction: null,\n        resolution: null,\n      });\n    }\n\n    return feedbackItems;\n  }\n\n  private inferSeverity(body: string): FeedbackSeverity {\n    const lower = body.toLowerCase();\n\n    if (body.includes('') || body.includes(':stop_sign:') || lower.includes('critical')) {\n      return 'critical';\n    }\n    if (body.includes('medium-priority') || lower.includes('high severity')) {\n      return 'high';\n    }\n    if (body.includes('medium') || lower.includes('should')) {\n      return 'medium';\n    }\n    if (body.includes('nitpick') || body.includes('nit:') || lower.includes('consider')) {\n      return 'low';\n    }\n    if (body.includes('info') || body.includes('note:')) {\n      return 'info';\n    }\n\n    if (lower.includes('error') || lower.includes('bug') || lower.includes('fix')) {\n      return 'high';\n    }\n\n    return 'medium';\n  }\n\n  private inferStatus(comment: { body: string; in_reply_to_id?: number }): FeedbackStatus {\n    if (comment.in_reply_to_id) {\n      return 'addressed';\n    }\n    return 'unaddressed';\n  }\n\n  private isAutoResolvable(body: string, severity: FeedbackSeverity): boolean {\n    if (body.includes('```suggestion')) return true;\n    if (severity === 'low' || severity === 'info') return true;\n\n    const lower = body.toLowerCase();\n    if (lower.includes('formatting') || lower.includes('typo') || lower.includes('spelling')) {\n      return true;\n    }\n\n    return false;\n  }\n\n  private extractSuggestion(body: string): string | null {\n    const suggestionMatch = body.match(/```suggestion\\n([\\s\\S]*?)```/);\n    const suggestion = suggestionMatch?.[1];\n    if (suggestion !== undefined) {\n      return suggestion.trim();\n    }\n    return null;\n  }\n}\n\n// ============================================\n// Safe Git Operations\n// ============================================\n\n/**\n * Clone a repository with appropriate token.\n * Uses spawnSync for safe command execution (no shell injection).\n */\nexport function cloneRepo(repoUrl: string, destPath: string): Result<void> {\n  const token = getTokenForRepo(repoUrl);\n  if (!token) {\n    return { success: false, error: `No token available for repo: ${repoUrl}` };\n  }\n\n  let cloneUrl = repoUrl;\n  if (cloneUrl.startsWith('https://github.com/')) {\n    cloneUrl = cloneUrl.replace('https://github.com/', `https://oauth2:${token}@github.com/`);\n  } else if (!cloneUrl.includes('@') && !cloneUrl.startsWith('https://')) {\n    const org = extractOrg(repoUrl);\n    const repoName = repoUrl.replace(`${org}/`, '');\n    cloneUrl = `https://oauth2:${token}@github.com/${org}/${repoName}.git`;\n  }\n\n  const proc = spawnSync('git', ['clone', cloneUrl, destPath], {\n    encoding: 'utf-8',\n    stdio: 'pipe',\n    timeout: 120000,\n  });\n\n  if (proc.error) {\n    return { success: false, error: `Git clone error: ${proc.error.message}` };\n  }\n\n  if (proc.status !== 0) {\n    const errorOutput = (proc.stderr || 'Unknown error').replace(\n      /oauth2:[^@]+@/g,\n      'oauth2:[REDACTED]@'\n    );\n    return { success: false, error: `Git clone failed: ${errorOutput}` };\n  }\n\n  return { success: true };\n}\n\n/**\n * Validate a git ref/branch name to prevent injection\n */\nexport function isValidGitRef(ref: string): boolean {\n  return /^[a-zA-Z0-9._/-]+$/.test(ref) && ref.length <= 200;\n}\n\n/**\n * Validate owner/repo format\n */\nexport function isValidRepoFormat(repo: string): boolean {\n  return /^[a-zA-Z0-9._-]+\\/[a-zA-Z0-9._-]+$/.test(repo) && repo.length <= 200;\n}\n\n// ============================================\n// Configuration Type Export\n// ============================================\n\nexport type { GitHubClientConfig as GitHubConfig };\n","/**\n * MCP Client Integration - Config-driven\n *\n * Reads MCP server configuration from agentic.config.json.\n * Falls back to sensible defaults if not configured.\n */\n\nimport { experimental_createMCPClient as createMCPClient } from '@ai-sdk/mcp';\nimport { Experimental_StdioMCPTransport as StdioMCPTransport } from '@ai-sdk/mcp/mcp-stdio';\nimport type { ToolSet } from 'ai';\nimport { getConfig, type MCPConfig, type MCPServerConfig } from '../core/config.js';\n\n// \n// Default MCP Configuration (used if not in config file)\n// \n\nconst DEFAULT_MCP_CONFIG: MCPConfig = {\n  // \n  // Vendor Connectors (Python) - Jules, Cursor, GitHub, Slack, etc.\n  // Provides unified access to all vendor APIs via MCP.\n  // Install: pip install vendor-connectors[mcp]\n  // \n  'vendor-connectors': {\n    enabled: true,\n    tokenEnvVar: 'GOOGLE_JULES_API_KEY',\n    tokenEnvVarFallbacks: ['JULES_API_KEY', 'CURSOR_API_KEY'],\n    mode: 'stdio',\n    command: 'python',\n    args: ['-m', 'vendor_connectors.mcp'],\n  },\n  cursor: {\n    enabled: true,\n    tokenEnvVar: 'CURSOR_API_KEY',\n    tokenEnvVarFallbacks: ['COPILOT_MCP_CURSOR_API_KEY'],\n    mode: 'stdio',\n    command: 'npx',\n    args: ['-y', 'cursor-mcp-server'],\n  },\n  github: {\n    enabled: true,\n    tokenEnvVar: 'GITHUB_TOKEN',\n    tokenEnvVarFallbacks: ['GITHUB_JBCOM_TOKEN', 'COPILOT_MCP_GITHUB_TOKEN'],\n    mode: 'stdio',\n    command: 'npx',\n    args: ['-y', '@modelcontextprotocol/server-github'],\n  },\n  context7: {\n    enabled: true,\n    tokenEnvVar: 'CONTEXT7_API_KEY',\n    tokenEnvVarFallbacks: ['COPILOT_MCP_CONTEXT7_API_KEY'],\n    mode: 'stdio',\n    command: 'npx',\n    args: ['-y', '@anthropic/context7-mcp'],\n  },\n  '21st-magic': {\n    enabled: true,\n    tokenEnvVar: 'TWENTY_FIRST_API_KEY',\n    tokenEnvVarFallbacks: ['COPILOT_MCP_TWENTY_FIRST_API_KEY'],\n    mode: 'stdio',\n    command: 'npx',\n    args: ['-y', '@21st-dev/magic-mcp@latest'],\n  },\n};\n\n// \n// Helper Functions\n// \n\n/**\n * Resolve token from env vars with fallbacks\n */\nfunction resolveToken(serverConfig: MCPServerConfig): string | undefined {\n  // Try primary env var\n  if (serverConfig.tokenEnvVar) {\n    const token = process.env[serverConfig.tokenEnvVar];\n    if (token) return token;\n  }\n\n  // Try fallbacks\n  if (serverConfig.tokenEnvVarFallbacks) {\n    for (const envVar of serverConfig.tokenEnvVarFallbacks) {\n      const token = process.env[envVar];\n      if (token) return token;\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Get merged MCP config (user config + defaults)\n */\nfunction getMCPConfig(): MCPConfig {\n  const userConfig = getConfig().mcp ?? {};\n\n  // Merge user config with defaults\n  const merged: MCPConfig = {};\n\n  for (const [name, defaultServer] of Object.entries(DEFAULT_MCP_CONFIG)) {\n    const userServer = userConfig[name];\n    if (userServer === undefined) {\n      merged[name] = defaultServer;\n    } else {\n      merged[name] = { ...defaultServer, ...userServer };\n    }\n  }\n\n  // Add any custom servers from user config\n  for (const [name, server] of Object.entries(userConfig)) {\n    if (!(name in merged) && server) {\n      merged[name] = server;\n    }\n  }\n\n  return merged;\n}\n\n// \n// Exports for backward compatibility\n// \n\n/** @deprecated Use getMCPConfig() instead */\nexport const MCP_ENV_VARS = {\n  cursor: { name: 'CURSOR_API_KEY', sources: ['COPILOT_MCP_CURSOR_API_KEY', 'CURSOR_API_KEY'] },\n  github: {\n    name: 'GITHUB_TOKEN',\n    sources: ['COPILOT_MCP_GITHUB_TOKEN', 'GITHUB_JBCOM_TOKEN', 'GITHUB_TOKEN'],\n  },\n  context7: {\n    name: 'CONTEXT7_API_KEY',\n    sources: ['COPILOT_MCP_CONTEXT7_API_KEY', 'CONTEXT7_API_KEY'],\n    optional: true,\n  },\n} as const;\n\n/** @deprecated Use getMCPConfig() and resolveToken() instead */\nexport const mcpCredentials = {\n  get cursorApiKey() {\n    return resolveToken(getMCPConfig().cursor ?? {});\n  },\n  get githubToken() {\n    return resolveToken(getMCPConfig().github ?? {});\n  },\n  get context7ApiKey() {\n    return resolveToken(getMCPConfig().context7 ?? {});\n  },\n};\n\n// \n// Types\n// \n\nexport interface MCPClientConfig {\n  /** Override specific server configs */\n  cursor?: Partial<MCPServerConfig> & { apiKey?: string };\n  github?: Partial<MCPServerConfig> & { token?: string };\n  context7?: Partial<MCPServerConfig> & { apiKey?: string };\n  '21st-magic'?: Partial<MCPServerConfig> & { apiKey?: string };\n  /**\n   * Vendor Connectors MCP Server (Python)\n   * Provides unified access to Jules, Cursor, GitHub, Slack, Vault, Zoom, etc.\n   * Install: pip install vendor-connectors[mcp]\n   */\n  'vendor-connectors'?: Partial<MCPServerConfig> & {\n    julesApiKey?: string;\n    cursorApiKey?: string;\n    ollamaApiKey?: string;\n  };\n}\n\nexport interface MCPClients {\n  [name: string]: Awaited<ReturnType<typeof createMCPClient>> | undefined;\n}\n\n// \n// Main Functions\n// \n\n/**\n * Initialize MCP clients based on config\n */\nexport async function initializeMCPClients(overrides: MCPClientConfig = {}): Promise<MCPClients> {\n  const clients: MCPClients = {};\n  const mcpConfig = getMCPConfig();\n\n  for (const [name, serverConfig] of Object.entries(mcpConfig)) {\n    if (!serverConfig || serverConfig.enabled === false) continue;\n\n    // Apply overrides\n    const override = overrides[name as keyof MCPClientConfig];\n    const config = override ? { ...serverConfig, ...override } : serverConfig;\n\n    // Resolve token\n    let token = resolveToken(config);\n\n    // Check for legacy override format\n    if (override) {\n      if ('apiKey' in override && override.apiKey) token = override.apiKey;\n      if ('token' in override && override.token) token = override.token;\n    }\n\n    // Optional servers that can run without tokens\n    const optionalServers = ['context7', '21st-magic', 'vendor-connectors'];\n    if (!token && !optionalServers.includes(name)) {\n      // Skip non-optional servers without tokens\n      continue;\n    }\n\n    try {\n      if (config.mode === 'stdio' && config.command) {\n        const env: Record<string, string> = { ...(process.env as Record<string, string>) };\n\n        // Set token in environment for the command\n        if (token) {\n          if (name === 'cursor') env.CURSOR_API_KEY = token;\n          if (name === 'github') env.GITHUB_TOKEN = token;\n          if (name === 'context7') env.CONTEXT7_API_KEY = token;\n          if (name === '21st-magic') env.TWENTY_FIRST_API_KEY = token;\n        }\n\n        // vendor-connectors uses multiple tokens from env vars (outside token check per AI review)\n        if (name === 'vendor-connectors') {\n          const vcOverride = overrides['vendor-connectors'];\n          // Pass through all relevant API keys for vendor-connectors, respecting overrides\n          env.GOOGLE_JULES_API_KEY =\n            vcOverride?.julesApiKey ?? process.env.GOOGLE_JULES_API_KEY ?? '';\n          env.JULES_API_KEY =\n            vcOverride?.julesApiKey ??\n            process.env.JULES_API_KEY ??\n            process.env.GOOGLE_JULES_API_KEY ??\n            '';\n          env.CURSOR_API_KEY = vcOverride?.cursorApiKey ?? process.env.CURSOR_API_KEY ?? '';\n          env.OLLAMA_API_KEY = vcOverride?.ollamaApiKey ?? process.env.OLLAMA_API_KEY ?? '';\n        }\n\n        clients[name] = await createMCPClient({\n          transport: new StdioMCPTransport({\n            command: config.command,\n            args: config.args ?? [],\n            env,\n          }),\n        });\n      }\n      // TODO: Add proxy mode support when needed\n    } catch (err) {\n      console.warn(`Failed to initialize ${name} MCP client:`, err);\n    }\n  }\n\n  return clients;\n}\n\n/**\n * Get all tools from initialized MCP clients\n */\nexport async function getMCPTools(clients: MCPClients): Promise<ToolSet> {\n  const allTools: ToolSet = {};\n\n  for (const [name, client] of Object.entries(clients)) {\n    if (!client) continue;\n\n    try {\n      const { tools } = await client.tools();\n      if (tools) {\n        for (const [toolName, mcpTool] of Object.entries(tools)) {\n          // MCP tools need to be cast to AI SDK ToolSet format\n          allTools[`${name}_${toolName}`] = mcpTool as unknown as ToolSet[string];\n        }\n      }\n    } catch (err) {\n      console.warn(`Failed to get tools from ${name}:`, err);\n    }\n  }\n\n  return allTools;\n}\n\n/**\n * Close all MCP clients\n */\nexport async function closeMCPClients(clients: MCPClients): Promise<void> {\n  for (const [name, client] of Object.entries(clients)) {\n    if (!client) continue;\n\n    try {\n      await client.close();\n    } catch (err) {\n      console.warn(`Failed to close ${name} MCP client:`, err);\n    }\n  }\n}\n\n// NOTE: The listMCPPrompts and listMCPResources methods have been removed.\n// The current @ai-sdk/mcp MCPClient type does not expose these methods.\n// If you need to list prompts or resources, use the MCP server's native API directly\n// or wait for future @ai-sdk/mcp updates that may add this functionality.\n","/**\n * Security utilities for the Agent\n *\n * Centralized security functions to prevent:\n * - Path traversal attacks\n * - Command injection\n * - Sandbox escapes\n */\n\nimport { existsSync, realpathSync } from 'node:fs';\nimport { dirname, isAbsolute, relative, resolve } from 'node:path';\n\n/**\n * Result of path validation\n */\nexport interface PathValidationResult {\n  /** Whether the path is valid and within the sandbox */\n  valid: boolean;\n  /** The fully resolved path */\n  resolvedPath: string;\n  /** Error message if validation failed */\n  error?: string;\n}\n\n/**\n * Validate that a path is within the allowed working directory.\n * Prevents path traversal attacks (e.g., ../../../etc/passwd)\n *\n * @param inputPath - The path to validate (relative or absolute)\n * @param workingDirectory - The sandbox directory that paths must stay within\n * @returns Validation result with resolved path or error\n */\nexport function validatePath(inputPath: string, workingDirectory: string): PathValidationResult {\n  try {\n    // Resolve the input path relative to working directory (this normalizes .. components)\n    const fullPath = isAbsolute(inputPath)\n      ? resolve(inputPath)\n      : resolve(workingDirectory, inputPath);\n\n    // Get the real path of workingDirectory (resolves symlinks)\n    const realWorkDir = realpathSync(workingDirectory);\n\n    // For existing paths, use realpathSync to resolve symlinks\n    if (existsSync(fullPath)) {\n      const realPath = realpathSync(fullPath);\n      const relativePath = relative(realWorkDir, realPath);\n      if (relativePath.startsWith('..') || isAbsolute(relativePath)) {\n        return {\n          valid: false,\n          resolvedPath: fullPath,\n          error: `Path traversal detected: ${inputPath} resolves outside working directory`,\n        };\n      }\n      return { valid: true, resolvedPath: fullPath };\n    }\n\n    // For non-existing paths, find the nearest existing ancestor\n    let pathToCheck = dirname(fullPath);\n    while (!existsSync(pathToCheck)) {\n      const parent = dirname(pathToCheck);\n      if (parent === pathToCheck) {\n        // Reached filesystem root without finding existing directory\n        break;\n      }\n      pathToCheck = parent;\n    }\n\n    // Validate that the existing ancestor is within workingDirectory\n    if (existsSync(pathToCheck)) {\n      const realPath = realpathSync(pathToCheck);\n      const relativePath = relative(realWorkDir, realPath);\n      if (relativePath.startsWith('..') || isAbsolute(relativePath)) {\n        return {\n          valid: false,\n          resolvedPath: fullPath,\n          error: `Path traversal detected: ${inputPath} resolves outside working directory`,\n        };\n      }\n    } else {\n      // No existing ancestor found - path is at root level and outside workingDirectory\n      return {\n        valid: false,\n        resolvedPath: fullPath,\n        error: `Path traversal detected: ${inputPath} resolves outside working directory`,\n      };\n    }\n\n    // Also verify the full resolved path is within workingDirectory\n    const normalizedRelative = relative(realWorkDir, fullPath);\n    if (normalizedRelative.startsWith('..') || isAbsolute(normalizedRelative)) {\n      return {\n        valid: false,\n        resolvedPath: fullPath,\n        error: `Path traversal detected: ${inputPath} resolves outside working directory`,\n      };\n    }\n\n    return { valid: true, resolvedPath: fullPath };\n  } catch (error) {\n    return {\n      valid: false,\n      resolvedPath: inputPath,\n      error: `Path validation error: ${error instanceof Error ? error.message : String(error)}`,\n    };\n  }\n}\n\n/**\n * Sanitize a filename for use in shell commands.\n * Prevents command injection via filenames.\n *\n * @param filename - The filename to sanitize\n * @returns Sanitized filename with dangerous characters replaced\n */\nexport function sanitizeFilename(filename: string): string {\n  // Remove or escape dangerous characters\n  // Allow only alphanumeric, dots, dashes, underscores, and forward slashes\n  return filename.replace(/[^a-zA-Z0-9._\\-/]/g, '_');\n}\n\n/**\n * Check if a shell command contains potentially dangerous patterns.\n * This is a heuristic check - not a replacement for proper sandboxing.\n *\n * @param command - The command to check\n * @returns Object with safety assessment\n */\nexport function assessCommandSafety(command: string): {\n  safe: boolean;\n  risks: string[];\n} {\n  const risks: string[] = [];\n\n  // Check for destructive commands\n  if (/\\brm\\s+(-rf?|--recursive)\\b/i.test(command)) {\n    risks.push('Recursive deletion detected');\n  }\n\n  // Check for privilege escalation\n  if (/\\bsudo\\b/i.test(command)) {\n    risks.push('Sudo usage detected');\n  }\n\n  // Check for dangerous permission changes\n  if (/\\bchmod\\s+(777|a\\+rwx)\\b/i.test(command)) {\n    risks.push('Dangerous permission change detected');\n  }\n\n  // Check for shell escapes and redirects to sensitive locations\n  if (/>\\s*\\/etc\\//i.test(command)) {\n    risks.push('Write to /etc detected');\n  }\n\n  // Check for curl/wget piped to shell\n  if (/\\b(curl|wget)\\b.*\\|\\s*(bash|sh|zsh)\\b/i.test(command)) {\n    risks.push('Remote code execution pattern detected');\n  }\n\n  return {\n    safe: risks.length === 0,\n    risks,\n  };\n}\n","/**\n * Agent - Unified AI-powered development agent\n *\n * A single, comprehensive agent that handles all agentic tasks:\n * - Code operations (bash, file editing, git)\n * - MCP integrations (Cursor, GitHub, Context7)\n * - Extended thinking/reasoning\n * - Web search\n * - Structured output\n * - Tool approval for sensitive operations\n *\n * This consolidates CodeAgent, EnhancedAgent, and UnifiedAgent into one class.\n */\n\nimport { execFileSync, execSync } from 'node:child_process';\nimport { existsSync, mkdirSync, readFileSync, unlinkSync, writeFileSync } from 'node:fs';\nimport { dirname } from 'node:path';\nimport { type AnthropicProviderOptions, anthropic } from '@ai-sdk/anthropic';\nimport { generateObject, generateText, stepCountIs, streamText, type ToolSet, tool } from 'ai';\nimport { z } from 'zod';\nimport {\n  closeMCPClients,\n  getMCPTools,\n  initializeMCPClients,\n  type MCPClientConfig,\n  type MCPClients,\n} from './mcp-clients.js';\nimport { assessCommandSafety, validatePath } from './security.js';\n\n// \n// Configuration Types\n// \n\nexport interface AgentConfig {\n  /** Working directory for file operations (sandbox root) */\n  workingDirectory?: string;\n  /** Maximum steps for multi-step tool calls */\n  maxSteps?: number;\n  /** MCP client configuration */\n  mcp?: MCPClientConfig;\n  /** Model to use */\n  model?: 'claude-sonnet-4-20250514' | 'claude-opus-4-20250514' | string;\n  /** Enable verbose logging */\n  verbose?: boolean;\n  /** Enable extended thinking/reasoning for complex tasks */\n  reasoning?: {\n    enabled: boolean;\n    /** Token budget for thinking (default: 12000) */\n    budgetTokens?: number;\n  };\n  /** Enable web search capability */\n  webSearch?: {\n    enabled: boolean;\n    /** Max number of searches per request */\n    maxUses?: number;\n    /** Allowed domains for search */\n    allowedDomains?: string[];\n    /** Blocked domains */\n    blockedDomains?: string[];\n  };\n  /** Tool approval settings */\n  approval?: {\n    /** Tools requiring approval before execution */\n    requireApproval?: string[];\n    /** Callback to handle approval requests */\n    onApprovalRequest?: (toolName: string, input: unknown) => Promise<boolean>;\n  };\n}\n\nexport interface AgentResult {\n  success: boolean;\n  result: string;\n  reasoning?: string;\n  steps: AgentStep[];\n  usage?: {\n    inputTokens: number;\n    outputTokens: number;\n    totalTokens: number;\n  };\n}\n\nexport interface AgentStep {\n  toolName: string;\n  input: unknown;\n  output: string;\n  timestamp: Date;\n  approved?: boolean;\n}\n\n// \n// Structured Output Schemas\n// \n\nexport const TaskAnalysisSchema = z.object({\n  complexity: z.enum(['simple', 'moderate', 'complex']).describe('Task complexity assessment'),\n  estimatedSteps: z.number().describe('Estimated number of steps to complete'),\n  requiresWebSearch: z.boolean().describe('Whether web search might help'),\n  requiresReasoning: z.boolean().describe('Whether extended thinking would help'),\n  subtasks: z.array(\n    z.object({\n      description: z.string(),\n      priority: z.enum(['critical', 'high', 'medium', 'low']),\n      tools: z.array(z.string()).describe('Tools likely needed'),\n    })\n  ),\n  risks: z.array(z.string()).describe('Potential risks or blockers'),\n});\n\nexport type TaskAnalysis = z.infer<typeof TaskAnalysisSchema>;\n\n// \n// Agent Class\n// \n\nexport class Agent {\n  private config: Required<Omit<AgentConfig, 'mcp' | 'reasoning' | 'webSearch' | 'approval'>> & {\n    mcp?: MCPClientConfig;\n    reasoning?: AgentConfig['reasoning'];\n    webSearch?: AgentConfig['webSearch'];\n    approval?: AgentConfig['approval'];\n  };\n  private mcpClients: MCPClients | null = null;\n  private initialized = false;\n  /** Promise-based lock to prevent concurrent initialization race conditions */\n  private initializationPromise: Promise<void> | null = null;\n\n  constructor(config: AgentConfig = {}) {\n    this.config = {\n      workingDirectory: config.workingDirectory ?? process.cwd(),\n      maxSteps: config.maxSteps ?? 25,\n      model: config.model ?? 'claude-sonnet-4-20250514',\n      verbose: config.verbose ?? false,\n      mcp: config.mcp,\n      reasoning: config.reasoning,\n      webSearch: config.webSearch,\n      approval: config.approval,\n    };\n  }\n\n  // \n  // Lifecycle\n  // \n\n  /**\n   * Initialize MCP clients and prepare the agent.\n   * Thread-safe: concurrent calls will wait for the same initialization to complete.\n   */\n  async initialize(): Promise<void> {\n    // Fast path: already initialized\n    if (this.initialized) return;\n\n    // If initialization is in progress, wait for it to complete\n    if (this.initializationPromise) {\n      return this.initializationPromise;\n    }\n\n    // Start initialization and store the promise so concurrent calls can wait\n    this.initializationPromise = this.doInitialize();\n\n    try {\n      await this.initializationPromise;\n    } catch (error) {\n      // Reset on failure so retry is possible\n      this.initializationPromise = null;\n      throw error;\n    }\n  }\n\n  /**\n   * Internal initialization logic - only called once due to promise lock\n   */\n  private async doInitialize(): Promise<void> {\n    this.log(' Initializing Agent...');\n\n    if (this.config.mcp) {\n      this.mcpClients = await initializeMCPClients(this.config.mcp);\n    }\n\n    this.initialized = true;\n    this.log(' Agent initialized');\n  }\n\n  /**\n   * Close all connections and clean up\n   */\n  async close(): Promise<void> {\n    if (this.mcpClients) {\n      await closeMCPClients(this.mcpClients);\n      this.mcpClients = null;\n    }\n    this.initialized = false;\n  }\n\n  // \n  // Core Execution Methods\n  // \n\n  /**\n   * Execute a task with full tool access\n   */\n  async execute(\n    task: string,\n    options?: {\n      enableReasoning?: boolean;\n      enableWebSearch?: boolean;\n    }\n  ): Promise<AgentResult> {\n    await this.initialize();\n\n    const steps: AgentStep[] = [];\n    const recordStep = (toolName: string, input: unknown, output: string, approved?: boolean) => {\n      steps.push({ toolName, input, output, timestamp: new Date(), approved });\n      if (this.config.verbose) {\n        console.log(\n          `   ${toolName}:`,\n          typeof input === 'string' ? input.slice(0, 100) : JSON.stringify(input).slice(0, 100)\n        );\n      }\n    };\n\n    // Build tool set\n    const tools = await this.buildToolSet(recordStep);\n\n    // Add web search if enabled\n    if ((options?.enableWebSearch ?? this.config.webSearch?.enabled) && this.config.webSearch) {\n      const webSearchTool = anthropic.tools.webSearch_20250305({\n        maxUses: this.config.webSearch.maxUses ?? 5,\n        allowedDomains: this.config.webSearch.allowedDomains,\n        blockedDomains: this.config.webSearch.blockedDomains,\n      });\n      (tools as Record<string, unknown>).web_search = webSearchTool;\n    }\n\n    // Build provider options\n    const providerOptions: { anthropic?: AnthropicProviderOptions } = {};\n\n    if ((options?.enableReasoning ?? this.config.reasoning?.enabled) && this.config.reasoning) {\n      providerOptions.anthropic = {\n        thinking: {\n          type: 'enabled',\n          budgetTokens: this.config.reasoning.budgetTokens ?? 12000,\n        },\n      };\n    }\n\n    try {\n      const result = await generateText({\n        model: anthropic(this.config.model),\n        tools,\n        stopWhen: stepCountIs(this.config.maxSteps),\n        system: this.getSystemPrompt(),\n        prompt: task,\n        providerOptions: Object.keys(providerOptions).length > 0 ? providerOptions : undefined,\n      });\n\n      return {\n        success: true,\n        result: result.text,\n        reasoning: result.reasoning?.map((r) => r.text).join('\\n'),\n        steps,\n        usage: result.usage\n          ? {\n              inputTokens: result.usage.inputTokens ?? 0,\n              outputTokens: result.usage.outputTokens ?? 0,\n              totalTokens: result.usage.totalTokens ?? 0,\n            }\n          : undefined,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        result: error instanceof Error ? error.message : String(error),\n        steps,\n      };\n    }\n  }\n\n  /**\n   * Execute a task with streaming output.\n   * Note: Currently only yields text chunks. Reasoning chunks are not yet supported\n   * by the streaming API even when extended thinking is enabled.\n   */\n  async *stream(task: string): AsyncGenerator<{ type: 'text'; content: string }> {\n    await this.initialize();\n\n    const steps: AgentStep[] = [];\n    const recordStep = (toolName: string, input: unknown, output: string) => {\n      steps.push({ toolName, input, output, timestamp: new Date() });\n    };\n\n    const tools = await this.buildToolSet(recordStep);\n\n    // Build provider options for reasoning\n    const providerOptions: { anthropic?: AnthropicProviderOptions } = {};\n    if (this.config.reasoning?.enabled) {\n      providerOptions.anthropic = {\n        thinking: {\n          type: 'enabled',\n          budgetTokens: this.config.reasoning.budgetTokens ?? 12000,\n        },\n      };\n    }\n\n    const result = streamText({\n      model: anthropic(this.config.model),\n      tools,\n      stopWhen: stepCountIs(this.config.maxSteps),\n      system: this.getSystemPrompt(),\n      prompt: task,\n      providerOptions: Object.keys(providerOptions).length > 0 ? providerOptions : undefined,\n    });\n\n    for await (const chunk of result.textStream) {\n      yield { type: 'text', content: chunk };\n    }\n  }\n\n  /**\n   * Execute with structured output - combine tool use with schema-constrained response\n   */\n  async executeWithOutput<T extends z.ZodTypeAny>(\n    task: string,\n    outputSchema: T\n  ): Promise<{\n    success: boolean;\n    output?: z.infer<T>;\n    error?: string;\n    steps: AgentStep[];\n    usage?: AgentResult['usage'];\n  }> {\n    await this.initialize();\n\n    const steps: AgentStep[] = [];\n    const recordStep = (toolName: string, input: unknown, output: string) => {\n      steps.push({ toolName, input, output, timestamp: new Date() });\n    };\n\n    const tools = await this.buildToolSet(recordStep);\n\n    try {\n      // First, use tools to gather information\n      const gatherResult = await generateText({\n        model: anthropic(this.config.model),\n        tools,\n        stopWhen: stepCountIs(Math.floor(this.config.maxSteps / 2)),\n        system: this.getSystemPrompt(),\n        prompt: task,\n      });\n\n      // Then, generate structured output\n      const structured = await generateObject({\n        model: anthropic(this.config.model),\n        schema: outputSchema,\n        prompt: `Based on this information, provide a structured response:\n\n${gatherResult.text}\n\nOriginal task: ${task}`,\n      });\n\n      return {\n        success: true,\n        output: structured.object as z.infer<T>,\n        steps,\n        usage: gatherResult.usage\n          ? {\n              inputTokens: gatherResult.usage.inputTokens ?? 0,\n              outputTokens: gatherResult.usage.outputTokens ?? 0,\n              totalTokens: gatherResult.usage.totalTokens ?? 0,\n            }\n          : undefined,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : String(error),\n        steps,\n      };\n    }\n  }\n\n  // \n  // Task Analysis\n  // \n\n  /**\n   * Analyze a task before executing to determine optimal approach\n   */\n  async analyzeTask(task: string): Promise<TaskAnalysis> {\n    const analysis = await generateObject({\n      model: anthropic(this.config.model),\n      schema: TaskAnalysisSchema,\n      prompt: `Analyze this task and provide a structured assessment:\n\nTask: ${task}\n\nConsider:\n1. How complex is this task?\n2. How many steps might it take?\n3. Would web search help gather current information?\n4. Would extended thinking/reasoning help with complex logic?\n5. What are the subtasks and their priorities?\n6. What are potential risks or blockers?`,\n    });\n\n    return analysis.object;\n  }\n\n  // \n  // Convenience Methods\n  // \n\n  /**\n   * Fix a specific file based on feedback\n   */\n  async fixFile(\n    filePath: string,\n    feedback: string,\n    suggestion?: string\n  ): Promise<{\n    success: boolean;\n    result: string;\n    diff?: string;\n  }> {\n    const task = suggestion\n      ? `Fix the file ${filePath} based on this feedback:\n${feedback}\n\nApply this suggested change:\n${suggestion}`\n      : `Fix the file ${filePath} based on this feedback:\n${feedback}\n\nAnalyze the file, understand the issue, and make the appropriate fix.`;\n\n    const result = await this.execute(task);\n\n    // Get diff if we made changes\n    let diff: string | undefined;\n    if (result.success) {\n      try {\n        diff = execFileSync('git', ['diff', filePath], {\n          cwd: this.config.workingDirectory,\n          encoding: 'utf-8',\n        });\n      } catch {\n        // No diff available\n      }\n    }\n\n    return {\n      success: result.success,\n      result: result.result,\n      diff,\n    };\n  }\n\n  /**\n   * Run tests and fix failures\n   */\n  async fixTests(testCommand: string = 'npm test'): Promise<{\n    success: boolean;\n    result: string;\n    iterations: number;\n  }> {\n    const task = `Run the tests with \"${testCommand}\" and fix any failures.\n\nProcess:\n1. Run the test command\n2. If tests fail, analyze the failure\n3. Fix the code causing the failure\n4. Re-run tests\n5. Repeat until all tests pass or you've tried 5 times`;\n\n    const result = await this.execute(task);\n\n    // Count iterations from steps\n    const testRuns = result.steps.filter(\n      (s) =>\n        s.toolName === 'bash' &&\n        typeof s.input === 'object' &&\n        s.input !== null &&\n        'command' in s.input &&\n        String(s.input.command).includes('test')\n    ).length;\n\n    return {\n      success: result.success,\n      result: result.result,\n      iterations: testRuns,\n    };\n  }\n\n  /**\n   * Commit changes with a message\n   */\n  async commitChanges(message: string): Promise<{\n    success: boolean;\n    commitSha?: string;\n  }> {\n    const result = await this.execute(\n      `Stage all changes and commit with message: \"${message}\"\n      \nUse these commands:\n1. git add -A\n2. git commit -m \"${message}\"\n3. Output the commit SHA`\n    );\n\n    // Extract commit SHA from steps\n    const commitStep = result.steps.find(\n      (s) => s.toolName === 'bash' && s.output.includes('commit')\n    );\n\n    let commitSha: string | undefined;\n    if (commitStep) {\n      const shaMatch = commitStep.output.match(/\\[[\\w-]+ ([a-f0-9]+)\\]/);\n      if (shaMatch) {\n        commitSha = shaMatch[1];\n      }\n    }\n\n    return {\n      success: result.success,\n      commitSha,\n    };\n  }\n\n  // \n  // Tool Building\n  // \n\n  /**\n   * Build the complete tool set\n   */\n  private async buildToolSet(\n    recordStep: (name: string, input: unknown, output: string, approved?: boolean) => void\n  ): Promise<ToolSet> {\n    const requiresApproval = (toolName: string): boolean => {\n      return this.config.approval?.requireApproval?.includes(toolName) ?? false;\n    };\n\n    const checkApproval = async (toolName: string, input: unknown): Promise<boolean> => {\n      if (!requiresApproval(toolName)) return true;\n      if (!this.config.approval?.onApprovalRequest) return true;\n      return this.config.approval.onApprovalRequest(toolName, input);\n    };\n\n    // Bash tool with security checks\n    const bashTool = anthropic.tools.bash_20250124({\n      execute: async ({ command, restart }) => {\n        if (restart) {\n          recordStep('bash', { restart: true }, 'Shell restarted');\n          return 'Shell restarted';\n        }\n\n        // Assess command safety\n        const safety = assessCommandSafety(command);\n        const needsApproval = requiresApproval('bash') || !safety.safe;\n\n        if (needsApproval) {\n          const approved = await checkApproval('bash', { command, risks: safety.risks });\n          if (!approved) {\n            recordStep('bash', { command }, 'Command rejected by approval', false);\n            return 'Command rejected by approval policy';\n          }\n        }\n\n        try {\n          const output = execSync(command, {\n            cwd: this.config.workingDirectory,\n            encoding: 'utf-8',\n            maxBuffer: 10 * 1024 * 1024,\n            timeout: 120000,\n          });\n\n          recordStep('bash', { command }, output, true);\n          return output;\n        } catch (error) {\n          const errorMsg = error instanceof Error ? error.message : String(error);\n          recordStep('bash', { command }, `Error: ${errorMsg}`);\n          return `Error: ${errorMsg}`;\n        }\n      },\n    });\n\n    // Text editor tool with path validation\n    const textEditorTool = anthropic.tools.textEditor_20250124({\n      execute: async ({ command, path, file_text, insert_line, new_str, old_str, view_range }) => {\n        // Security: Validate path to prevent path traversal attacks\n        const pathValidation = validatePath(path, this.config.workingDirectory);\n        if (!pathValidation.valid) {\n          recordStep(\n            'str_replace_editor',\n            { command, path },\n            `Security Error: ${pathValidation.error}`\n          );\n          return `Security Error: ${pathValidation.error}`;\n        }\n        const fullPath = pathValidation.resolvedPath;\n\n        try {\n          let result: string;\n\n          switch (command) {\n            case 'view': {\n              if (!existsSync(fullPath)) {\n                result = `Error: File not found: ${path}`;\n              } else {\n                const content = readFileSync(fullPath, 'utf-8');\n                const lines = content.split('\\n');\n\n                const start = view_range?.[0];\n                const end = view_range?.[1];\n                if (start !== undefined && end !== undefined) {\n                  const selectedLines = lines.slice(start - 1, end);\n                  result = selectedLines.map((line, i) => `${start + i}: ${line}`).join('\\n');\n                } else {\n                  result = lines.map((line, i) => `${i + 1}: ${line}`).join('\\n');\n                }\n              }\n              break;\n            }\n\n            case 'create': {\n              if (!file_text) {\n                result = 'Error: file_text is required for create command';\n              } else {\n                const dir = dirname(fullPath);\n                if (!existsSync(dir)) mkdirSync(dir, { recursive: true });\n                writeFileSync(fullPath, file_text);\n                result = `Created file: ${path}`;\n              }\n              break;\n            }\n\n            case 'str_replace': {\n              if (!old_str || new_str === undefined) {\n                result = 'Error: old_str and new_str are required for str_replace';\n              } else if (!existsSync(fullPath)) {\n                result = `Error: File not found: ${path}`;\n              } else {\n                const content = readFileSync(fullPath, 'utf-8');\n                if (!content.includes(old_str)) {\n                  result = `Error: old_str not found in file`;\n                } else {\n                  const newContent = content.replace(old_str, new_str);\n                  writeFileSync(fullPath, newContent);\n                  result = `Replaced text in ${path}`;\n                }\n              }\n              break;\n            }\n\n            case 'insert': {\n              if (insert_line === undefined || new_str === undefined) {\n                result = 'Error: insert_line and new_str are required for insert';\n              } else if (!existsSync(fullPath)) {\n                result = `Error: File not found: ${path}`;\n              } else {\n                const content = readFileSync(fullPath, 'utf-8');\n                const lines = content.split('\\n');\n                lines.splice(insert_line, 0, new_str);\n                writeFileSync(fullPath, lines.join('\\n'));\n                result = `Inserted text at line ${insert_line} in ${path}`;\n              }\n              break;\n            }\n\n            default:\n              result = `Unknown command: ${command}`;\n          }\n\n          recordStep('str_replace_editor', { command, path }, result);\n          return result;\n        } catch (error) {\n          const errorMsg = error instanceof Error ? error.message : String(error);\n          recordStep('str_replace_editor', { command, path }, `Error: ${errorMsg}`);\n          return `Error: ${errorMsg}`;\n        }\n      },\n    });\n\n    const tools: ToolSet = {\n      bash: bashTool,\n      str_replace_editor: textEditorTool,\n    } as ToolSet;\n\n    // Git status tool\n    tools.git_status = tool({\n      description: 'Get current git status including branch, staged files, and modified files',\n      inputSchema: z.object({}),\n      execute: async () => {\n        try {\n          const status = execSync('git status --porcelain -b', {\n            cwd: this.config.workingDirectory,\n            encoding: 'utf-8',\n          });\n          recordStep('git_status', {}, status);\n          return status;\n        } catch (error) {\n          const msg = error instanceof Error ? error.message : String(error);\n          recordStep('git_status', {}, `Error: ${msg}`);\n          return `Error: ${msg}`;\n        }\n      },\n    });\n\n    // Git diff tool with path validation\n    tools.git_diff = tool({\n      description: 'Get git diff for staged or unstaged changes',\n      inputSchema: z.object({\n        staged: z.boolean().optional().describe('Show staged changes only'),\n        file: z.string().optional().describe('Specific file to diff'),\n      }),\n      execute: async ({ staged, file }) => {\n        try {\n          const args = staged ? ['--cached'] : [];\n          if (file) {\n            // Security: Validate file path\n            const pathValidation = validatePath(file, this.config.workingDirectory);\n            if (!pathValidation.valid) {\n              recordStep('git_diff', { staged, file }, `Security Error: ${pathValidation.error}`);\n              return `Security Error: ${pathValidation.error}`;\n            }\n            // Use -- to separate paths from options (git best practice)\n            args.push('--', file);\n          }\n          const diff = execSync(`git diff ${args.join(' ')}`, {\n            cwd: this.config.workingDirectory,\n            encoding: 'utf-8',\n          });\n          recordStep('git_diff', { staged, file }, diff || '(no changes)');\n          return diff || '(no changes)';\n        } catch (error) {\n          const msg = error instanceof Error ? error.message : String(error);\n          recordStep('git_diff', { staged, file }, `Error: ${msg}`);\n          return `Error: ${msg}`;\n        }\n      },\n    });\n\n    // File delete tool with approval and path validation\n    tools.delete_file = tool({\n      description: 'Delete a file (may require approval)',\n      inputSchema: z.object({\n        path: z.string().describe('Path to the file to delete'),\n      }),\n      execute: async ({ path }) => {\n        // Security: Validate path to prevent path traversal attacks\n        const pathValidation = validatePath(path, this.config.workingDirectory);\n        if (!pathValidation.valid) {\n          recordStep('delete_file', { path }, `Security Error: ${pathValidation.error}`, false);\n          return `Security Error: ${pathValidation.error}`;\n        }\n        const fullPath = pathValidation.resolvedPath;\n\n        // Always check approval for delete operations\n        const approved = await checkApproval('delete_file', { path });\n        if (!approved) {\n          recordStep('delete_file', { path }, 'Delete rejected by approval', false);\n          return 'Delete operation rejected by approval policy';\n        }\n\n        try {\n          if (!existsSync(fullPath)) {\n            recordStep('delete_file', { path }, `File not found: ${path}`);\n            return `File not found: ${path}`;\n          }\n          unlinkSync(fullPath);\n          recordStep('delete_file', { path }, `Deleted: ${path}`, true);\n          return `Successfully deleted: ${path}`;\n        } catch (error) {\n          const msg = error instanceof Error ? error.message : String(error);\n          recordStep('delete_file', { path }, `Error: ${msg}`);\n          return `Error: ${msg}`;\n        }\n      },\n    });\n\n    // Add MCP tools if available\n    if (this.mcpClients) {\n      const mcpTools = await getMCPTools(this.mcpClients);\n      Object.assign(tools, mcpTools);\n    }\n\n    return tools as ToolSet;\n  }\n\n  // \n  // System Prompt\n  // \n\n  /**\n   * Get the system prompt for the agent\n   */\n  private getSystemPrompt(): string {\n    const features: string[] = [];\n\n    if (this.config.reasoning?.enabled) {\n      features.push('- Extended thinking enabled for complex reasoning');\n    }\n    if (this.config.webSearch?.enabled) {\n      features.push('- Web search available for current information');\n    }\n    if (this.mcpClients) {\n      features.push('- MCP integrations (Cursor, GitHub, Context7) available');\n    }\n\n    return `You are an expert software development agent with access to powerful tools.\n\n## Your Capabilities\n\n### Code Operations (Anthropic Tools)\n- **bash**: Execute shell commands for git, tests, builds, etc.\n- **str_replace_editor**: View and edit files with precision\n- **delete_file**: Delete files (may require approval)\n\n### Git Utilities\n- **git_status**: Quick git status check\n- **git_diff**: View changes in working directory\n\n${features.length > 0 ? `### Special Features\\n${features.join('\\n')}` : ''}\n\n### MCP Integrations (when available)\n- **Cursor Agent MCP**: Spawn and manage background agents\n- **GitHub MCP**: PR/issue management, code search\n- **Context7 MCP**: Up-to-date library documentation\n\n## Working Directory\n${this.config.workingDirectory}\n\n## Guidelines\n\n1. **Be thorough**: Verify your changes work before reporting success\n2. **Use appropriate tools**: Prefer MCP tools for GitHub operations\n3. **Handle errors gracefully**: Try to understand and fix failures\n4. **Document your actions**: Explain what you're doing\n5. **Test your changes**: Run tests and linting after code changes\n${this.config.approval?.requireApproval?.length ? '\\n6. **Respect approval policies**: Some operations require user approval' : ''}\n\n## When Triaging PRs\n1. First understand the current state (CI status, feedback, changes)\n2. Identify all blockers and unaddressed feedback\n3. Fix issues systematically, starting with CI failures\n4. Commit and push changes\n5. Verify CI passes after your changes`;\n  }\n\n  private log(message: string): void {\n    if (this.config.verbose) {\n      console.log(message);\n    }\n  }\n}\n\n// \n// Convenience Functions\n// \n\n/**\n * Run a one-shot task with the agent\n */\nexport async function runTask(task: string, config?: AgentConfig): Promise<AgentResult> {\n  const agent = new Agent(config);\n  try {\n    return await agent.execute(task);\n  } finally {\n    await agent.close();\n  }\n}\n\n/**\n * Run a task with pre-analysis to determine optimal configuration\n */\nexport async function runSmartTask(\n  task: string,\n  config?: Omit<AgentConfig, 'reasoning' | 'webSearch'>\n): Promise<AgentResult> {\n  const agent = new Agent({\n    ...config,\n    reasoning: { enabled: false }, // Disable for analysis\n    webSearch: { enabled: false },\n  });\n\n  try {\n    // First, analyze the task\n    const analysis = await agent.analyzeTask(task);\n\n    console.log(` Task Analysis:`);\n    console.log(`   Complexity: ${analysis.complexity}`);\n    console.log(`   Estimated steps: ${analysis.estimatedSteps}`);\n    console.log(`   Needs reasoning: ${analysis.requiresReasoning}`);\n    console.log(`   Needs web search: ${analysis.requiresWebSearch}`);\n\n    // Execute with optimal settings\n    return await agent.execute(task, {\n      enableReasoning: analysis.requiresReasoning,\n      enableWebSearch: analysis.requiresWebSearch,\n    });\n  } finally {\n    await agent.close();\n  }\n}\n","/**\n * AI Provider Loading - Shared provider utilities\n *\n * Supports multiple AI providers via Vercel AI SDK:\n * - anthropic (@ai-sdk/anthropic)\n * - openai (@ai-sdk/openai)\n * - google (@ai-sdk/google)\n * - mistral (@ai-sdk/mistral)\n * - azure (@ai-sdk/azure)\n * - ollama (ai-sdk-ollama) - for Ollama Cloud and local Ollama\n *\n * Install the provider you need:\n *   pnpm add @ai-sdk/anthropic\n *   pnpm add ai-sdk-ollama  # for Ollama support\n */\n\nimport { getDefaultApiKeyEnvVar, getTriageConfig } from './config.js';\n\n// ============================================\n// Types\n// ============================================\n\nexport type ProviderFactory = (config: { apiKey: string }) => unknown;\nexport type ModelFactory = (model: string) => unknown;\n\nexport type SupportedProvider = 'anthropic' | 'openai' | 'google' | 'mistral' | 'azure' | 'ollama';\n\nexport interface ProviderConfig {\n  package: string;\n  factory: string;\n}\n\n// ============================================\n// Provider Configuration\n// ============================================\n\n/**\n * Security: Explicit allowlist of supported providers and their packages.\n * Dynamic imports are only allowed for these pre-defined packages.\n */\nexport const PROVIDER_CONFIG: Record<SupportedProvider, ProviderConfig> = {\n  anthropic: { package: '@ai-sdk/anthropic', factory: 'createAnthropic' },\n  openai: { package: '@ai-sdk/openai', factory: 'createOpenAI' },\n  google: { package: '@ai-sdk/google', factory: 'createGoogleGenerativeAI' },\n  mistral: { package: '@ai-sdk/mistral', factory: 'createMistral' },\n  azure: { package: '@ai-sdk/azure', factory: 'createAzure' },\n  ollama: { package: 'ai-sdk-ollama', factory: 'createOllama' },\n} as const;\n\n/**\n * Ollama-specific configuration\n */\nexport const OLLAMA_CONFIG = {\n  /** Default model for Ollama Cloud (qwen3-coder has excellent tool support) */\n  defaultModel: 'qwen3-coder:480b-cloud',\n  /** Ollama Cloud API URL (SDK appends /api paths automatically) */\n  cloudHost: 'https://ollama.com',\n  /** Local Ollama API URL (SDK appends /api paths automatically) */\n  localHost: 'http://localhost:11434',\n  /** Enable reliable object generation with automatic JSON repair (v3.0.0+) */\n  reliableObjectGeneration: true,\n  /** Object generation options for better reliability */\n  objectGenerationOptions: {\n    /** Enable automatic JSON repair for malformed outputs */\n    enableTextRepair: true,\n    /** Maximum retries for object generation */\n    maxRetries: 3,\n  },\n} as const;\n\n/**\n * Check if a provider name is valid\n */\nexport function isValidProvider(name: string): name is SupportedProvider {\n  return name in PROVIDER_CONFIG;\n}\n\n/**\n * Get list of supported provider names\n */\nexport function getSupportedProviders(): SupportedProvider[] {\n  return Object.keys(PROVIDER_CONFIG) as SupportedProvider[];\n}\n\n// ============================================\n// Provider Loading\n// ============================================\n\n/**\n * Load an AI provider dynamically.\n *\n * @param providerName - Name of the provider (anthropic, openai, etc.)\n * @param apiKey - API key for the provider\n * @returns A function that creates a model instance\n * @throws Error if provider is unknown or package not installed\n */\nexport async function loadProvider(providerName: string, apiKey: string): Promise<ModelFactory> {\n  // Security: Validate provider name against explicit allowlist\n  if (!isValidProvider(providerName)) {\n    throw new Error(\n      `Unknown provider: ${providerName}\\n` +\n        `Supported providers: ${getSupportedProviders().join(', ')}`\n    );\n  }\n\n  const config = PROVIDER_CONFIG[providerName];\n\n  try {\n    // Security: Only import from pre-defined allowlist - no user input in import path\n    let module: Record<string, unknown>;\n    switch (providerName) {\n      case 'anthropic':\n        module = await import('@ai-sdk/anthropic');\n        break;\n      case 'openai':\n        module = await import('@ai-sdk/openai');\n        break;\n      case 'google':\n        module = await import('@ai-sdk/google');\n        break;\n      case 'mistral':\n        module = await import('@ai-sdk/mistral');\n        break;\n      case 'azure':\n        module = await import('@ai-sdk/azure');\n        break;\n      case 'ollama':\n        module = await import('ai-sdk-ollama');\n        break;\n      default:\n        // This should never happen due to isValidProvider check above\n        throw new Error(`Provider ${providerName} not implemented`);\n    }\n\n    const factory = module[config.factory] as ProviderFactory;\n\n    if (typeof factory !== 'function') {\n      throw new Error(`Factory ${config.factory} not found in ${config.package}`);\n    }\n\n    // Ollama provider has different config structure (ai-sdk-ollama v3.0.0+)\n    if (providerName === 'ollama') {\n      // Determine host URL based on API key presence\n      const host =\n        process.env.OLLAMA_HOST || (apiKey ? OLLAMA_CONFIG.cloudHost : OLLAMA_CONFIG.localHost);\n      // Normalize URL to remove any trailing slashes or /api path (SDK appends /api automatically)\n      const normalizedHost = host.replace(/\\/api\\/?$/, '').replace(/\\/$/, '');\n\n      // ai-sdk-ollama v3.0.0+ configuration with reliable object generation\n      type OllamaProviderFactory = (config: {\n        baseURL: string;\n        headers?: { Authorization: string };\n      }) => unknown;\n\n      // Model factory type with v3 options\n      type OllamaModelFactory = (\n        model: string,\n        options?: {\n          structuredOutputs?: boolean;\n          reliableObjectGeneration?: boolean;\n          objectGenerationOptions?: {\n            enableTextRepair?: boolean;\n            maxRetries?: number;\n          };\n        }\n      ) => unknown;\n\n      const provider = (factory as unknown as OllamaProviderFactory)({\n        baseURL: normalizedHost,\n        headers: apiKey ? { Authorization: `Bearer ${apiKey}` } : undefined,\n      });\n\n      // Return a model factory that applies reliability settings by default\n      return (model: string) =>\n        (provider as OllamaModelFactory)(model, {\n          // Enable reliable object generation with automatic JSON repair\n          reliableObjectGeneration: OLLAMA_CONFIG.reliableObjectGeneration,\n          objectGenerationOptions: OLLAMA_CONFIG.objectGenerationOptions,\n        });\n    }\n\n    const provider = factory({ apiKey });\n    return (model: string) => (provider as ModelFactory)(model);\n  } catch (err) {\n    if ((err as NodeJS.ErrnoException).code === 'ERR_MODULE_NOT_FOUND') {\n      throw new Error(\n        `Provider package not installed: ${config.package}\\n` +\n          `Install it with: pnpm add ${config.package}`\n      );\n    }\n    throw err;\n  }\n}\n\n// ============================================\n// Provider Instance Management\n// ============================================\n\n/**\n * Cached provider instances to avoid re-loading\n */\nconst providerCache = new Map<string, ModelFactory>();\n\n/**\n * Get or create a cached provider instance.\n *\n * @param providerName - Name of the provider\n * @param apiKey - API key for the provider\n * @returns A function that creates a model instance\n */\nexport async function getOrLoadProvider(\n  providerName: string,\n  apiKey: string\n): Promise<ModelFactory> {\n  const cacheKey = `${providerName}:${apiKey.slice(0, 8)}`;\n\n  let provider = providerCache.get(cacheKey);\n  if (!provider) {\n    provider = await loadProvider(providerName, apiKey);\n    providerCache.set(cacheKey, provider);\n  }\n\n  return provider;\n}\n\n/**\n * Clear the provider cache (useful for testing)\n */\nexport function clearProviderCache(): void {\n  providerCache.clear();\n}\n\n// ============================================\n// Configuration Helpers\n// ============================================\n\nexport interface ProviderOptions {\n  /** AI provider: anthropic, openai, google, mistral, azure, ollama */\n  provider?: string;\n  /** Model to use */\n  model?: string;\n  /** API key (defaults to provider-specific env var) */\n  apiKey?: string;\n}\n\n/**\n * Resolve provider options with defaults from config.\n *\n * @param options - User-provided options\n * @returns Resolved provider name, model, and API key\n * @throws Error if API key is not available\n */\nexport function resolveProviderOptions(options: ProviderOptions = {}): {\n  providerName: string;\n  model: string;\n  apiKey: string;\n} {\n  const triageConfig = getTriageConfig();\n\n  const providerName = options.provider ?? triageConfig.provider ?? 'anthropic';\n  const model = options.model ?? triageConfig.model ?? 'claude-sonnet-4-20250514';\n\n  // Determine the correct API key\n  const effectiveProvider = options.provider ?? triageConfig.provider ?? 'anthropic';\n  const envVarName =\n    options.provider && options.provider !== triageConfig.provider\n      ? getDefaultApiKeyEnvVar(effectiveProvider)\n      : (triageConfig.apiKeyEnvVar ?? getDefaultApiKeyEnvVar(effectiveProvider));\n\n  const apiKey = options.apiKey ?? process.env[envVarName] ?? '';\n\n  if (!apiKey) {\n    const hint = getDefaultApiKeyEnvVar(effectiveProvider);\n    throw new Error(\n      `API key required for ${providerName} provider.\\n` +\n        `Set ${hint} environment variable or pass apiKey option.`\n    );\n  }\n\n  return { providerName, model, apiKey };\n}\n","/**\n * Analyzer - Unified AI-powered analysis\n *\n * Combines conversation analysis, PR triage, and code review into one class.\n * Supports multiple AI providers via Vercel AI SDK.\n *\n * This consolidates the former AIAnalyzer and PRAnalyzer classes.\n */\n\nimport { spawnSync } from 'node:child_process';\nimport { generateObject, generateText } from 'ai';\nimport { z } from 'zod';\nimport { getConfig, log } from '../core/config.js';\nimport {\n  getOrLoadProvider,\n  type ModelFactory,\n  type ProviderOptions,\n  resolveProviderOptions,\n} from '../core/providers.js';\nimport { getEnvForPRReview } from '../core/tokens.js';\nimport type {\n  AnalysisResult,\n  CodeReviewResult,\n  Conversation,\n  ConversationMessage,\n  Blocker as CoreBlocker,\n  TriageResult as CoreTriageResult,\n  ReviewImprovement,\n  ReviewIssue,\n  Task,\n} from '../core/types.js';\nimport type { Blocker, CIStatus, FeedbackItem, PRStatus, TriageResult } from './types.js';\n\n// ============================================\n// Schemas for Structured AI Output\n// ============================================\n\nconst TaskAnalysisSchema = z.object({\n  completedTasks: z.array(\n    z.object({\n      id: z.string(),\n      title: z.string(),\n      description: z.string().optional(),\n      priority: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n      category: z.enum([\n        'bug',\n        'feature',\n        'security',\n        'performance',\n        'documentation',\n        'infrastructure',\n        'dependency',\n        'ci',\n        'other',\n      ]),\n      status: z.literal('completed'),\n      evidence: z.string().optional(),\n      prNumber: z.number().nullable().optional(),\n    })\n  ),\n  outstandingTasks: z.array(\n    z.object({\n      id: z.string(),\n      title: z.string(),\n      description: z.string().optional(),\n      priority: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n      category: z.enum([\n        'bug',\n        'feature',\n        'security',\n        'performance',\n        'documentation',\n        'infrastructure',\n        'dependency',\n        'ci',\n        'other',\n      ]),\n      status: z.enum(['pending', 'in_progress', 'blocked']),\n      blockers: z.array(z.string()).optional(),\n      suggestedLabels: z.array(z.string()).optional(),\n    })\n  ),\n  blockers: z.array(\n    z.object({\n      issue: z.string(),\n      severity: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n      suggestedResolution: z.string().optional(),\n    })\n  ),\n  summary: z.string(),\n  recommendations: z.array(z.string()),\n});\n\nconst CodeReviewSchema = z.object({\n  issues: z.array(\n    z.object({\n      file: z.string(),\n      line: z.number().optional(),\n      severity: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n      category: z.enum([\n        'bug',\n        'security',\n        'performance',\n        'style',\n        'logic',\n        'documentation',\n        'test',\n        'other',\n      ]),\n      description: z.string(),\n      suggestedFix: z.string().optional(),\n    })\n  ),\n  improvements: z.array(\n    z.object({\n      area: z.string(),\n      suggestion: z.string(),\n      effort: z.enum(['low', 'medium', 'high']),\n    })\n  ),\n  overallAssessment: z.string(),\n  readyToMerge: z.boolean(),\n  mergeBlockers: z.array(z.string()),\n});\n\nconst QuickTriageSchema = z.object({\n  priority: z.enum(['critical', 'high', 'medium', 'low', 'info']),\n  category: z.enum([\n    'bug',\n    'feature',\n    'security',\n    'performance',\n    'documentation',\n    'infrastructure',\n    'dependency',\n    'ci',\n    'other',\n  ]),\n  summary: z.string(),\n  suggestedAction: z.string(),\n  confidence: z.number().min(0).max(1),\n});\n\n// ============================================\n// Types\n// ============================================\n\nexport interface AnalyzerOptions extends ProviderOptions {\n  /** Repository for GitHub operations (required for issue creation) */\n  repo?: string;\n}\n\n/**\n * Interface for GitHub client - allows dependency injection\n */\nexport interface GitHubClientInterface {\n  getPR(prNumber: number): Promise<{\n    html_url: string;\n    title: string;\n    merged: boolean;\n    state: string;\n    mergeable: boolean | null;\n    mergeable_state: string;\n  }>;\n  getCIStatus(prNumber: number): Promise<CIStatus>;\n  collectFeedback(prNumber: number): Promise<FeedbackItem[]>;\n  getPRFiles(prNumber: number): Promise<Array<{ filename: string }>>;\n}\n\n// ============================================\n// Analyzer Class\n// ============================================\n\nexport class Analyzer {\n  private providerName: string;\n  private model: string;\n  private apiKey: string;\n  private repo: string | undefined;\n  private providerFn: ModelFactory | null = null;\n\n  constructor(options: AnalyzerOptions = {}) {\n    const resolved = resolveProviderOptions(options);\n    this.providerName = resolved.providerName;\n    this.model = resolved.model;\n    this.apiKey = resolved.apiKey;\n    this.repo = options.repo ?? getConfig().defaultRepository;\n  }\n\n  private async getModel(): Promise<unknown> {\n    if (!this.providerFn) {\n      this.providerFn = await getOrLoadProvider(this.providerName, this.apiKey);\n    }\n    return this.providerFn(this.model);\n  }\n\n  /**\n   * Set the repository for GitHub operations\n   */\n  setRepo(repo: string): void {\n    this.repo = repo;\n  }\n\n  // ============================================\n  // Conversation Analysis\n  // ============================================\n\n  /**\n   * Analyze a conversation to extract completed/outstanding tasks\n   */\n  async analyzeConversation(conversation: Conversation): Promise<AnalysisResult> {\n    const messages = conversation.messages || [];\n    const conversationText = this.prepareConversationText(messages);\n\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: TaskAnalysisSchema,\n      prompt: `Analyze this agent conversation and extract:\n1. COMPLETED TASKS - What was actually finished and merged/deployed\n2. OUTSTANDING TASKS - What remains to be done\n3. BLOCKERS - Any issues preventing progress\n4. SUMMARY - Brief overall assessment\n5. RECOMMENDATIONS - What should be done next\n\nBe thorough and specific. Reference PR numbers, file paths, and specific changes where possible.\nGenerate unique IDs for tasks (e.g., task-001, task-002).\n\nCONVERSATION:\n${conversationText}`,\n    });\n\n    // Map to our types\n    const completedTasks: Task[] = object.completedTasks.map((t) => ({\n      id: t.id,\n      title: t.title,\n      description: t.description,\n      priority: t.priority,\n      category: t.category,\n      status: 'completed' as const,\n    }));\n\n    const outstandingTasks: Task[] = object.outstandingTasks.map((t) => ({\n      id: t.id,\n      title: t.title,\n      description: t.description,\n      priority: t.priority,\n      category: t.category,\n      status: t.status === 'blocked' ? ('blocked' as const) : ('pending' as const),\n      blockers: t.blockers,\n    }));\n\n    const blockers: CoreBlocker[] = object.blockers.map((b) => ({\n      issue: b.issue,\n      severity: b.severity,\n      suggestedResolution: b.suggestedResolution,\n    }));\n\n    return {\n      summary: object.summary,\n      completedTasks,\n      outstandingTasks,\n      blockers,\n      recommendations: object.recommendations,\n    };\n  }\n\n  // ============================================\n  // Code Review\n  // ============================================\n\n  /**\n   * Review code changes and identify issues\n   */\n  async reviewCode(diff: string, context?: string): Promise<CodeReviewResult> {\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: CodeReviewSchema,\n      prompt: `Review this code diff and identify:\n1. ISSUES - Security, bugs, performance problems\n2. IMPROVEMENTS - Suggestions for better code\n3. OVERALL ASSESSMENT - Is this ready to merge?\n\nBe specific about file paths and line numbers.\nFocus on real issues, not style nitpicks.\n\n${context ? `CONTEXT:\\n${context}\\n\\n` : ''}DIFF:\n${diff}`,\n    });\n\n    const issues: ReviewIssue[] = object.issues.map((i) => ({\n      file: i.file,\n      line: i.line,\n      severity: i.severity,\n      category: i.category,\n      description: i.description,\n      suggestedFix: i.suggestedFix,\n    }));\n\n    const improvements: ReviewImprovement[] = object.improvements.map((i) => ({\n      area: i.area,\n      suggestion: i.suggestion,\n      effort: i.effort,\n    }));\n\n    return {\n      readyToMerge: object.readyToMerge,\n      mergeBlockers: object.mergeBlockers,\n      issues,\n      improvements,\n      overallAssessment: object.overallAssessment,\n    };\n  }\n\n  // ============================================\n  // Quick Triage\n  // ============================================\n\n  /**\n   * Quick triage - fast assessment of what needs attention\n   */\n  async quickTriage(input: string): Promise<CoreTriageResult> {\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: QuickTriageSchema,\n      prompt: `Quickly triage this input and determine:\n1. Priority level (critical/high/medium/low/info)\n2. Category (bug, feature, documentation, infrastructure, etc.)\n3. Brief summary\n4. Suggested immediate action\n5. Confidence level (0-1)\n\nINPUT:\n${input}`,\n    });\n\n    return {\n      priority: object.priority,\n      category: object.category,\n      summary: object.summary,\n      suggestedAction: object.suggestedAction,\n      confidence: object.confidence,\n    };\n  }\n\n  // ============================================\n  // PR Analysis\n  // ============================================\n\n  /**\n   * Analyze a Pull Request for triage\n   */\n  async analyzePR(github: GitHubClientInterface, prNumber: number): Promise<TriageResult> {\n    // Gather all data\n    const [pr, ci, feedback] = await Promise.all([\n      github.getPR(prNumber),\n      github.getCIStatus(prNumber),\n      github.collectFeedback(prNumber),\n    ]);\n\n    // Analyze feedback for unaddressed items\n    const analyzedFeedback = await this.analyzeFeedback(feedback);\n    const unaddressedFeedback = analyzedFeedback.filter((f) => f.status === 'unaddressed');\n\n    // Identify blockers\n    const blockers = await this.identifyBlockers(pr, ci, unaddressedFeedback);\n\n    // Determine status\n    const status = this.determineStatus(pr, ci, blockers, unaddressedFeedback);\n\n    // Generate next actions\n    const nextActions = this.generateNextActions(status, blockers, unaddressedFeedback);\n\n    // Generate summary\n    const summary = await this.generatePRSummary(pr, ci, blockers, unaddressedFeedback);\n\n    return {\n      prNumber,\n      prUrl: pr.html_url,\n      prTitle: pr.title,\n      status,\n      ci,\n      feedback: {\n        total: feedback.length,\n        unaddressed: unaddressedFeedback.length,\n        items: analyzedFeedback,\n      },\n      blockers,\n      nextActions,\n      summary,\n      timestamp: new Date().toISOString(),\n    };\n  }\n\n  /**\n   * Generate a response for feedback (fix or justification)\n   */\n  async generateFeedbackResponse(\n    feedback: FeedbackItem,\n    context: { prTitle: string; files: string[] }\n  ): Promise<{ type: 'fix' | 'justification'; content: string }> {\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: z.object({\n        type: z.enum(['fix', 'justification']),\n        content: z.string(),\n        reasoning: z.string(),\n      }),\n      prompt: `Determine how to address this PR feedback.\n\nPR: ${context.prTitle}\nFiles changed: ${context.files.join(', ')}\n\nFeedback from ${feedback.author}:\n${feedback.body}\n\n${feedback.path ? `File: ${feedback.path}` : ''}\n${feedback.line ? `Line: ${feedback.line}` : ''}\n\nOptions:\n1. \"fix\" - Generate code/text to fix the issue\n2. \"justification\" - Explain why this feedback should not be implemented\n\nChoose \"fix\" if:\n- There's a clear suggestion to implement\n- The issue is valid and should be fixed\n- It's a straightforward change\n\nChoose \"justification\" if:\n- The feedback is a false positive\n- It conflicts with project conventions\n- It's out of scope for this PR\n\nProvide the content (code fix or justification text) and your reasoning.`,\n    });\n\n    return {\n      type: object.type,\n      content: object.content,\n    };\n  }\n\n  // ============================================\n  // Issue Creation\n  // ============================================\n\n  /**\n   * Create GitHub issues from analysis.\n   * Always uses PR review token for consistent identity.\n   */\n  async createIssuesFromAnalysis(\n    analysis: AnalysisResult,\n    options?: {\n      dryRun?: boolean;\n      labels?: string[];\n      assignCopilot?: boolean;\n      repo?: string;\n    }\n  ): Promise<string[]> {\n    const repo = options?.repo ?? this.repo;\n    if (!repo) {\n      throw new Error(\n        'Repository is required for issue creation. Set via:\\n' +\n          \"  - Analyzer constructor: new Analyzer({ repo: 'owner/repo' })\\n\" +\n          '  - setRepo() method\\n' +\n          \"  - createIssuesFromAnalysis() options: { repo: 'owner/repo' }\\n\" +\n          '  - Config file: defaultRepository in agentic.config.json'\n      );\n    }\n\n    const createdIssues: string[] = [];\n    const env = { ...process.env, ...getEnvForPRReview() };\n\n    for (const task of analysis.outstandingTasks) {\n      const labels: string[] = [...(options?.labels || [])];\n\n      if (options?.assignCopilot !== false) {\n        labels.push('copilot');\n      }\n\n      if (task.priority === 'critical' || task.priority === 'high') {\n        labels.push(`priority:${task.priority}`);\n      }\n\n      const body = `## Summary\n${task.description || task.title}\n\n## Priority\n\\`${task.priority.toUpperCase()}\\`\n\n${task.blockers?.length ? `## Blocked By\\n${task.blockers.join('\\n')}\\n` : ''}\n\n## Acceptance Criteria\n- [ ] Implementation complete\n- [ ] Tests added/updated\n- [ ] Documentation updated if needed\n- [ ] CI passes\n\n## Context for AI Agents\nThis issue was auto-generated from agent session analysis.\n- Follow your project's contribution guidelines\n- Versioning is typically managed automatically  avoid manual version bumps\n\n---\n*Generated by agentic-control Analyzer*`;\n\n      if (options?.dryRun) {\n        log.info(`[DRY RUN] Would create issue: ${task.title}`);\n        createdIssues.push(`[DRY RUN] ${task.title}`);\n        continue;\n      }\n\n      try {\n        // Build args array safely - no shell interpolation\n        const args = ['issue', 'create', '--repo', repo, '--title', task.title, '--body-file', '-'];\n\n        // Add labels if any\n        if (labels.length > 0) {\n          args.push('--label', labels.join(','));\n        }\n\n        // Use spawnSync for safe command execution (no shell injection)\n        const proc = spawnSync('gh', args, {\n          input: body,\n          encoding: 'utf-8',\n          env,\n          maxBuffer: 10 * 1024 * 1024, // 10MB\n        });\n\n        if (proc.error) {\n          throw proc.error;\n        }\n\n        if (proc.status !== 0) {\n          throw new Error(proc.stderr || 'gh issue create failed');\n        }\n\n        const result = proc.stdout.trim();\n        createdIssues.push(result);\n        log.info(` Created issue: ${result}`);\n      } catch (err) {\n        log.error(` Failed to create issue: ${task.title}`, err);\n      }\n    }\n\n    return createdIssues;\n  }\n\n  // ============================================\n  // Report Generation\n  // ============================================\n\n  /**\n   * Generate a comprehensive assessment report\n   */\n  async generateReport(conversation: Conversation): Promise<string> {\n    const analysis = await this.analyzeConversation(conversation);\n\n    return `# Agent Session Assessment Report\n\n## Summary\n${analysis.summary}\n\n## Completed Tasks (${analysis.completedTasks.length})\n${analysis.completedTasks\n  .map(\n    (t) => `\n###  ${t.title}\n${t.description || ''}\n`\n  )\n  .join('\\n')}\n\n## Outstanding Tasks (${analysis.outstandingTasks.length})\n${analysis.outstandingTasks\n  .map(\n    (t) => `\n###  ${t.title}\n**Priority**: ${t.priority}\n${t.description || ''}\n${t.blockers?.length ? `**Blocked By**: ${t.blockers.join(', ')}` : ''}\n`\n  )\n  .join('\\n')}\n\n## Blockers (${analysis.blockers.length})\n${analysis.blockers\n  .map(\n    (b) => `\n###  ${b.issue}\n**Severity**: ${b.severity}\n**Suggested Resolution**: ${b.suggestedResolution || 'None provided'}\n`\n  )\n  .join('\\n')}\n\n## Recommendations\n${analysis.recommendations.map((r) => `- ${r}`).join('\\n')}\n\n---\n*Generated by agentic-control Analyzer using ${this.providerName}/${this.model}*\n*Timestamp: ${new Date().toISOString()}*\n`;\n  }\n\n  // ============================================\n  // Private Helper Methods\n  // ============================================\n\n  private prepareConversationText(messages: ConversationMessage[], maxTokens = 100000): string {\n    const maxChars = maxTokens * 4;\n    const APPROX_CHARS_PER_MESSAGE = 500;\n\n    let text = messages\n      .map((m, i) => {\n        const role = m.type === 'user_message' ? 'USER' : 'ASSISTANT';\n        return `[${i + 1}] ${role}:\\n${m.text}\\n`;\n      })\n      .join('\\n---\\n');\n\n    if (text.length > maxChars) {\n      const firstPart = text.slice(0, Math.floor(maxChars * 0.2));\n      const lastPart = text.slice(-Math.floor(maxChars * 0.8));\n      const truncatedChars = text.length - (firstPart.length + lastPart.length);\n      const estimatedMessages = Math.ceil(truncatedChars / APPROX_CHARS_PER_MESSAGE);\n      text = `${firstPart}\\n\\n[... approximately ${estimatedMessages} messages truncated (${truncatedChars} chars) ...]\\n\\n${lastPart}`;\n    }\n\n    return text;\n  }\n\n  private async analyzeFeedback(feedback: FeedbackItem[]): Promise<FeedbackItem[]> {\n    if (feedback.length === 0) return [];\n\n    const { object } = await generateObject({\n      model: (await this.getModel()) as Parameters<typeof generateObject>[0]['model'],\n      schema: z.object({\n        items: z.array(\n          z.object({\n            id: z.string(),\n            status: z.enum(['unaddressed', 'addressed', 'dismissed', 'wont_fix']),\n            isAutoResolvable: z.boolean(),\n            suggestedAction: z.string().nullable(),\n          })\n        ),\n      }),\n      prompt: `Analyze these PR feedback items and determine their status.\n\nFeedback items:\n${feedback\n  .map(\n    (f) => `\nID: ${f.id}\nAuthor: ${f.author}\nSeverity: ${f.severity}\nPath: ${f.path ?? 'general'}\nBody: ${f.body}\n---`\n  )\n  .join('\\n')}\n\nFor each item:\n1. Determine if it's addressed (has been fixed/responded to), unaddressed (needs action), dismissed (explicitly dismissed with reason), or wont_fix\n2. Determine if it can be auto-resolved (has suggestion block, is simple fix, etc.)\n3. Suggest the action needed if unaddressed\n\nReturn analysis for each item by ID.`,\n    });\n\n    return feedback.map((item) => {\n      const analysis = object.items.find((a) => a.id === item.id);\n      if (analysis) {\n        return {\n          ...item,\n          status: analysis.status,\n          isAutoResolvable: analysis.isAutoResolvable,\n          suggestedAction: analysis.suggestedAction,\n        };\n      }\n      return item;\n    });\n  }\n\n  private async identifyBlockers(\n    pr: { mergeable: boolean | null; mergeable_state: string },\n    ci: CIStatus,\n    unaddressedFeedback: FeedbackItem[]\n  ): Promise<Blocker[]> {\n    const blockers: Blocker[] = [];\n\n    // CI failures\n    for (const failure of ci.failures) {\n      blockers.push({\n        type: 'ci_failure',\n        description: `CI check \"${failure.name}\" failed`,\n        isAutoResolvable: true,\n        suggestedFix: `Analyze failure logs at ${failure.url} and fix the issue`,\n        url: failure.url,\n        resolved: false,\n      });\n    }\n\n    // Unaddressed critical/high feedback\n    const criticalFeedback = unaddressedFeedback.filter(\n      (f) => f.severity === 'critical' || f.severity === 'high'\n    );\n    if (criticalFeedback.length > 0) {\n      blockers.push({\n        type: 'review_feedback',\n        description: `${criticalFeedback.length} critical/high severity feedback items unaddressed`,\n        isAutoResolvable: criticalFeedback.some((f) => f.isAutoResolvable),\n        suggestedFix: 'Address each feedback item with a fix or justified response',\n        url: null,\n        resolved: false,\n      });\n    }\n\n    // Merge conflicts\n    if (pr.mergeable === false && pr.mergeable_state === 'dirty') {\n      blockers.push({\n        type: 'merge_conflict',\n        description: 'PR has merge conflicts that must be resolved',\n        isAutoResolvable: false,\n        suggestedFix: 'Rebase or merge main branch and resolve conflicts',\n        url: null,\n        resolved: false,\n      });\n    }\n\n    // Branch protection\n    if (pr.mergeable_state === 'blocked') {\n      blockers.push({\n        type: 'branch_protection',\n        description: 'Branch protection rules prevent merge',\n        isAutoResolvable: false,\n        suggestedFix: 'Ensure all required checks pass and approvals are obtained',\n        url: null,\n        resolved: false,\n      });\n    }\n\n    return blockers;\n  }\n\n  private determineStatus(\n    pr: { merged: boolean; state: string },\n    ci: CIStatus,\n    blockers: Blocker[],\n    unaddressedFeedback: FeedbackItem[]\n  ): PRStatus {\n    if (pr.merged) return 'merged';\n    if (pr.state === 'closed') return 'closed';\n\n    const hardBlockers = blockers.filter((b) => !b.isAutoResolvable);\n    if (hardBlockers.length > 0) return 'blocked';\n\n    if (ci.anyPending) return 'needs_ci';\n\n    if (ci.failures.length > 0 || unaddressedFeedback.length > 0) {\n      return 'needs_work';\n    }\n\n    if (ci.allPassing && unaddressedFeedback.length === 0) {\n      return 'ready_to_merge';\n    }\n\n    return 'needs_review';\n  }\n\n  private generateNextActions(\n    status: PRStatus,\n    blockers: Blocker[],\n    unaddressedFeedback: FeedbackItem[]\n  ): TriageResult['nextActions'] {\n    const actions: TriageResult['nextActions'] = [];\n\n    if (status === 'needs_work') {\n      const ciBlockers = blockers.filter((b) => b.type === 'ci_failure');\n      for (const blocker of ciBlockers) {\n        actions.push({\n          action: `Fix CI failure: ${blocker.description}`,\n          priority: 'critical',\n          automated: true,\n          reason: 'CI must pass before merge',\n        });\n      }\n\n      for (const feedback of unaddressedFeedback) {\n        actions.push({\n          action: feedback.isAutoResolvable\n            ? `Auto-fix: ${feedback.suggestedAction ?? feedback.body.slice(0, 100)}`\n            : `Address feedback from ${feedback.author}: ${feedback.body.slice(0, 100)}`,\n          priority: feedback.severity,\n          automated: feedback.isAutoResolvable,\n          reason: `${feedback.severity} severity feedback requires resolution`,\n        });\n      }\n    }\n\n    if (status === 'needs_review') {\n      actions.push({\n        action: 'Request AI reviews: /gemini review, /q review',\n        priority: 'high',\n        automated: true,\n        reason: 'AI review required before merge',\n      });\n    }\n\n    if (status === 'ready_to_merge') {\n      actions.push({\n        action: 'Merge PR',\n        priority: 'high',\n        automated: false,\n        reason: 'All checks pass and feedback addressed',\n      });\n    }\n\n    return actions;\n  }\n\n  private async generatePRSummary(\n    pr: { title: string },\n    ci: CIStatus,\n    blockers: Blocker[],\n    unaddressedFeedback: FeedbackItem[]\n  ): Promise<string> {\n    const { text } = await generateText({\n      model: (await this.getModel()) as Parameters<typeof generateText>[0]['model'],\n      prompt: `Generate a concise summary of this PR's triage status.\n\nPR: ${pr.title}\nCI: ${ci.allPassing ? ' All passing' : ci.anyPending ? ' Pending' : ` ${ci.failures.length} failures`}\nBlockers: ${blockers.length > 0 ? blockers.map((b) => b.description).join(', ') : 'None'}\nUnaddressed feedback: ${unaddressedFeedback.length} items\n\nWrite 2-3 sentences summarizing the current state and what needs to happen next.`,\n    });\n\n    return text;\n  }\n}\n\n// ============================================\n// Legacy Aliases for backwards compatibility\n// ============================================\n\n/** @deprecated Use Analyzer instead */\nexport { Analyzer as AIAnalyzer };\nexport type { AnalyzerOptions as AIAnalyzerOptions };\n","/**\n * PR Triage Agent\n *\n * Specialized agent for triaging and resolving Pull Requests.\n * Combines MCP tools with AI analysis to:\n * - Analyze PR state and feedback\n * - Identify and fix blockers\n * - Address reviewer comments\n * - Ensure CI passes\n * - Prepare PRs for merge\n */\n\nimport { anthropic } from '@ai-sdk/anthropic';\nimport { generateObject, generateText, stepCountIs } from 'ai';\nimport { z } from 'zod';\nimport { Agent, type AgentConfig, type AgentResult } from './agent.js';\nimport {\n  closeMCPClients,\n  getMCPTools,\n  initializeMCPClients,\n  type MCPClients,\n} from './mcp-clients.js';\n\n// \n// Schemas for structured AI output\n// \n\nconst FeedbackSeveritySchema = z.enum(['critical', 'high', 'medium', 'low', 'suggestion']);\n\nconst FeedbackItemSchema = z.object({\n  id: z.string(),\n  source: z.string().describe('Who provided this feedback (e.g., gemini-code-assist, copilot)'),\n  severity: FeedbackSeveritySchema,\n  category: z.enum([\n    'bug',\n    'security',\n    'performance',\n    'style',\n    'documentation',\n    'suggestion',\n    'question',\n  ]),\n  file: z.string().optional(),\n  line: z.number().optional(),\n  content: z.string(),\n  suggestion: z.string().optional().describe('Specific fix suggestion if provided'),\n  addressed: z.boolean(),\n  addressedBy: z.string().optional().describe('How it was addressed (commit SHA, response, etc.)'),\n});\n\nconst CIStatusSchema = z.object({\n  status: z.enum(['passing', 'failing', 'pending', 'unknown']),\n  checks: z.array(\n    z.object({\n      name: z.string(),\n      status: z.enum(['success', 'failure', 'pending', 'skipped']),\n      url: z.string().optional(),\n      summary: z.string().optional(),\n    })\n  ),\n  failureReasons: z.array(z.string()),\n});\n\nconst PRAnalysisSchema = z.object({\n  prNumber: z.number(),\n  prUrl: z.string(),\n  prTitle: z.string(),\n  status: z.enum(['ready', 'needs_work', 'blocked', 'waiting_ci', 'waiting_review']),\n  ci: CIStatusSchema,\n  feedback: z.object({\n    total: z.number(),\n    unaddressed: z.number(),\n    critical: z.number(),\n    items: z.array(FeedbackItemSchema),\n  }),\n  blockers: z.array(\n    z.object({\n      type: z.enum([\n        'ci_failure',\n        'unaddressed_feedback',\n        'merge_conflict',\n        'missing_approval',\n        'other',\n      ]),\n      description: z.string(),\n      autoResolvable: z.boolean(),\n      suggestedFix: z.string().optional(),\n    })\n  ),\n  summary: z.string(),\n  nextActions: z.array(\n    z.object({\n      action: z.string(),\n      priority: z.enum(['critical', 'high', 'medium', 'low']),\n      automated: z.boolean(),\n      reason: z.string(),\n    })\n  ),\n});\n\nexport type PRAnalysis = z.infer<typeof PRAnalysisSchema>;\nexport type FeedbackItem = z.infer<typeof FeedbackItemSchema>;\n\n// \n// PR Triage Agent\n// \n\nexport interface PRTriageConfig extends AgentConfig {\n  /** Repository in format owner/repo */\n  repository: string;\n}\n\nexport class PRTriageAgent {\n  private config: PRTriageConfig;\n  private agent: Agent;\n  private mcpClients: MCPClients | null = null;\n  private initialized = false;\n  /** Promise-based lock to prevent concurrent initialization race conditions */\n  private initializationPromise: Promise<void> | null = null;\n\n  constructor(config: PRTriageConfig) {\n    this.config = config;\n    this.agent = new Agent(config);\n  }\n\n  /**\n   * Initialize the agent and MCP clients.\n   * Thread-safe: concurrent calls will wait for the same initialization to complete.\n   */\n  async initialize(): Promise<void> {\n    // Fast path: already initialized\n    if (this.initialized) return;\n\n    // If initialization is in progress, wait for it to complete\n    if (this.initializationPromise) {\n      return this.initializationPromise;\n    }\n\n    // Start initialization and store the promise so concurrent calls can wait\n    this.initializationPromise = this.doInitialize();\n\n    try {\n      await this.initializationPromise;\n    } catch (error) {\n      // Reset on failure so retry is possible\n      this.initializationPromise = null;\n      throw error;\n    }\n  }\n\n  /**\n   * Internal initialization logic - only called once due to promise lock\n   */\n  private async doInitialize(): Promise<void> {\n    await this.agent.initialize();\n    this.mcpClients = await initializeMCPClients(this.config.mcp);\n    this.initialized = true;\n  }\n\n  async close(): Promise<void> {\n    await this.agent.close();\n    if (this.mcpClients) {\n      await closeMCPClients(this.mcpClients);\n      this.mcpClients = null;\n    }\n    this.initialized = false;\n  }\n\n  /**\n   * Analyze a PR and return structured analysis\n   */\n  async analyze(prNumber: number): Promise<PRAnalysis> {\n    await this.initialize();\n\n    const tools = this.mcpClients ? await getMCPTools(this.mcpClients) : {};\n\n    // Use AI with tools to gather PR information\n    const gatherResult = await generateText({\n      model: anthropic('claude-sonnet-4-20250514'),\n      tools,\n      stopWhen: stepCountIs(10),\n      system: `You are a PR analysis assistant. Gather all relevant information about the PR.`,\n      prompt: `Analyze PR #${prNumber} in repository ${this.config.repository}.\n\nGather:\n1. PR title, description, and current state\n2. CI/check status (all checks)\n3. All review comments and feedback\n4. Recent commits\n5. Any merge conflicts\n\nUse the available tools to get this information.`,\n    });\n\n    // Now generate structured analysis\n    const analysis = await generateObject({\n      model: anthropic('claude-sonnet-4-20250514'),\n      schema: PRAnalysisSchema,\n      prompt: `Based on this PR information, generate a structured analysis:\n\n${gatherResult.text}\n\nAnalyze:\n- Overall PR status\n- CI status and any failures\n- All feedback items (categorize by severity)\n- Blockers preventing merge\n- Recommended next actions\n\nBe thorough - identify ALL unaddressed feedback items.`,\n    });\n\n    return analysis.object;\n  }\n\n  /**\n   * Generate a human-readable triage report\n   */\n  async generateReport(prNumber: number): Promise<string> {\n    const analysis = await this.analyze(prNumber);\n    return this.formatReport(analysis);\n  }\n\n  /**\n   * Automatically resolve all auto-resolvable issues\n   */\n  async resolve(prNumber: number): Promise<AgentResult> {\n    const analysis = await this.analyze(prNumber);\n\n    const autoResolvable = analysis.blockers.filter((b) => b.autoResolvable);\n    const unaddressedFeedback = analysis.feedback.items.filter((f) => !f.addressed);\n\n    if (autoResolvable.length === 0 && unaddressedFeedback.length === 0) {\n      return {\n        success: true,\n        result: 'No issues to resolve - PR appears ready',\n        steps: [],\n      };\n    }\n\n    // Build resolution task\n    const task = `Resolve issues in PR #${prNumber} (${this.config.repository}):\n\n## Blockers to Fix\n${autoResolvable\n  .map(\n    (b, i) => `${i + 1}. [${b.type}] ${b.description}\n   Suggested fix: ${b.suggestedFix || 'Analyze and fix'}`\n  )\n  .join('\\n\\n')}\n\n## Unaddressed Feedback\n${unaddressedFeedback\n  .map(\n    (f, i) => `${i + 1}. [${f.severity}] ${f.source}: ${f.content}\n   File: ${f.file || 'N/A'}${f.line ? `:${f.line}` : ''}\n   ${f.suggestion ? `Suggestion: ${f.suggestion}` : ''}`\n  )\n  .join('\\n\\n')}\n\n## Instructions\n1. Fix each issue in order of severity (critical > high > medium > low)\n2. For each fix:\n   a. Make the code change\n   b. Verify it doesn't break anything (run tests if applicable)\n   c. Commit with a clear message\n3. Push all changes when done\n4. Report what was fixed and what couldn't be auto-fixed`;\n\n    return await this.agent.execute(task);\n  }\n\n  /**\n   * Run the complete triage workflow until PR is ready\n   */\n  async runUntilReady(\n    prNumber: number,\n    options: {\n      maxIterations?: number;\n      requestReviews?: boolean;\n      autoMerge?: boolean;\n    } = {}\n  ): Promise<{\n    success: boolean;\n    finalStatus: PRAnalysis['status'];\n    iterations: number;\n    report: string;\n  }> {\n    const maxIterations = options.maxIterations ?? 5;\n    let iterations = 0;\n    let lastAnalysis: PRAnalysis | null = null;\n\n    while (iterations < maxIterations) {\n      iterations++;\n      console.log(`\\n Triage iteration ${iterations}/${maxIterations}`);\n\n      // Analyze current state\n      const analysis = await this.analyze(prNumber);\n      lastAnalysis = analysis;\n\n      console.log(`   Status: ${analysis.status}`);\n      console.log(`   CI: ${analysis.ci.status}`);\n      console.log(`   Unaddressed feedback: ${analysis.feedback.unaddressed}`);\n\n      // Check if ready\n      if (analysis.status === 'ready') {\n        if (options.requestReviews) {\n          await this.agent.execute(`Request reviews for PR #${prNumber} if not already requested`);\n        }\n\n        if (options.autoMerge) {\n          await this.agent.execute(\n            `Merge PR #${prNumber} using squash merge and delete the branch`\n          );\n        }\n\n        return {\n          success: true,\n          finalStatus: 'ready',\n          iterations,\n          report: this.formatReport(analysis),\n        };\n      }\n\n      // Check if blocked by non-auto-resolvable issues\n      const nonResolvableBlockers = analysis.blockers.filter((b) => !b.autoResolvable);\n      if (nonResolvableBlockers.length > 0 && analysis.blockers.every((b) => !b.autoResolvable)) {\n        return {\n          success: false,\n          finalStatus: 'blocked',\n          iterations,\n          report:\n            this.formatReport(analysis) +\n            `\\n\\n## Cannot Auto-Resolve\\n` +\n            nonResolvableBlockers.map((b) => `- ${b.description}`).join('\\n'),\n        };\n      }\n\n      // Try to resolve issues\n      const resolution = await this.resolve(prNumber);\n\n      if (!resolution.success) {\n        console.log(`    Resolution failed: ${resolution.result}`);\n      }\n\n      // Wait for CI if needed\n      if (analysis.ci.status === 'pending') {\n        console.log('    Waiting for CI...');\n        await this.waitForCI(prNumber);\n      }\n    }\n\n    return {\n      success: false,\n      finalStatus: lastAnalysis?.status ?? 'needs_work',\n      iterations,\n      report: lastAnalysis ? this.formatReport(lastAnalysis) : 'Analysis failed',\n    };\n  }\n\n  /**\n   * Wait for CI to complete\n   */\n  private async waitForCI(prNumber: number, timeout = 300000): Promise<void> {\n    const startTime = Date.now();\n    const pollInterval = 30000;\n\n    while (Date.now() - startTime < timeout) {\n      await new Promise((resolve) => setTimeout(resolve, pollInterval));\n\n      const analysis = await this.analyze(prNumber);\n      if (analysis.ci.status !== 'pending') {\n        return;\n      }\n    }\n  }\n\n  /**\n   * Format analysis as a readable report\n   */\n  private formatReport(analysis: PRAnalysis): string {\n    const statusEmoji = {\n      ready: '',\n      needs_work: '',\n      blocked: '',\n      waiting_ci: '',\n      waiting_review: '',\n    };\n\n    const severityEmoji = {\n      critical: '',\n      high: '',\n      medium: '',\n      low: '',\n      suggestion: '',\n    };\n\n    let report = `# PR Triage Report: #${analysis.prNumber}\n\n## ${statusEmoji[analysis.status]} Status: ${analysis.status.toUpperCase()}\n\n**${analysis.prTitle}**\n${analysis.prUrl}\n\n## CI Status: ${analysis.ci.status}\n${analysis.ci.checks.map((c) => `- ${c.status === 'success' ? '' : c.status === 'failure' ? '' : ''} ${c.name}`).join('\\n')}\n${analysis.ci.failureReasons.length > 0 ? `\\n### Failures:\\n${analysis.ci.failureReasons.map((r) => `- ${r}`).join('\\n')}` : ''}\n\n## Feedback Summary\n- Total: ${analysis.feedback.total}\n- Unaddressed: ${analysis.feedback.unaddressed}\n- Critical: ${analysis.feedback.critical}\n\n`;\n\n    if (analysis.feedback.items.length > 0) {\n      report += `### Feedback Items\\n`;\n      for (const item of analysis.feedback.items) {\n        const status = item.addressed ? '' : '';\n        report += `${status} ${severityEmoji[item.severity]} **${item.source}** [${item.category}]\n   ${item.content.slice(0, 200)}${item.content.length > 200 ? '...' : ''}\n   ${item.file ? ` ${item.file}${item.line ? `:${item.line}` : ''}` : ''}\n   ${item.addressed ? ` Addressed: ${item.addressedBy}` : ''}\n\n`;\n      }\n    }\n\n    if (analysis.blockers.length > 0) {\n      report += `##  Blockers\\n`;\n      for (const blocker of analysis.blockers) {\n        const autoIcon = blocker.autoResolvable ? '' : '';\n        report += `${autoIcon} **${blocker.type}**: ${blocker.description}\n   ${blocker.suggestedFix ? ` Fix: ${blocker.suggestedFix}` : ''}\n\n`;\n      }\n    }\n\n    report += `##  Next Actions\\n`;\n    for (const action of analysis.nextActions) {\n      const autoIcon = action.automated ? '' : '';\n      report += `${autoIcon} [${action.priority}] ${action.action}\n   ${action.reason}\n\n`;\n    }\n\n    report += `---\n*${analysis.summary}*`;\n\n    return report;\n  }\n}\n\n/**\n * Convenience function for quick PR triage\n */\nexport async function triagePR(\n  repository: string,\n  prNumber: number,\n  options?: Partial<PRTriageConfig>\n): Promise<PRAnalysis> {\n  const agent = new PRTriageAgent({\n    repository,\n    ...options,\n  });\n\n  try {\n    return await agent.analyze(prNumber);\n  } finally {\n    await agent.close();\n  }\n}\n","import { existsSync } from 'node:fs';\nimport { writeFile } from 'node:fs/promises';\nimport { anthropic } from '@ai-sdk/anthropic';\nimport { generateText } from 'ai';\nimport { type SimpleGit, simpleGit } from 'simple-git';\nimport type { GitHubClient } from '../github/client.js';\nimport type { ActionResult, Blocker, FeedbackItem, TriageResult } from './types.js';\n\nexport interface ResolverConfig {\n  workingDirectory: string;\n  dryRun?: boolean;\n}\n\nexport class Resolver {\n  private model = anthropic('claude-sonnet-4-20250514');\n  private config: ResolverConfig;\n  private git: SimpleGit;\n\n  constructor(config: ResolverConfig) {\n    this.config = config;\n    this.git = simpleGit(config.workingDirectory);\n  }\n\n  // ==========================================================================\n  // Main Resolution Methods\n  // ==========================================================================\n\n  async resolveBlockers(github: GitHubClient, triage: TriageResult): Promise<ActionResult[]> {\n    const results: ActionResult[] = [];\n\n    for (const blocker of triage.blockers) {\n      if (!blocker.isAutoResolvable) {\n        results.push({\n          success: false,\n          action: `Resolve ${blocker.type}`,\n          description: blocker.description,\n          error: 'Blocker requires human intervention',\n          changes: null,\n          commitSha: null,\n        });\n        continue;\n      }\n\n      const result = await this.resolveBlocker(github, triage.prNumber, blocker);\n      results.push(result);\n    }\n\n    return results;\n  }\n\n  async resolveFeedback(github: GitHubClient, triage: TriageResult): Promise<ActionResult[]> {\n    const results: ActionResult[] = [];\n    const unaddressed = triage.feedback.items.filter((f) => f.status === 'unaddressed');\n\n    for (const feedback of unaddressed) {\n      const result = await this.resolveFeedbackItem(github, triage.prNumber, feedback, {\n        prTitle: triage.prTitle,\n      });\n      results.push(result);\n    }\n\n    return results;\n  }\n\n  // ==========================================================================\n  // Blocker Resolution\n  // ==========================================================================\n\n  private async resolveBlocker(\n    github: GitHubClient,\n    prNumber: number,\n    blocker: Blocker\n  ): Promise<ActionResult> {\n    switch (blocker.type) {\n      case 'ci_failure':\n        return this.fixCIFailure(github, prNumber, blocker);\n      case 'review_feedback':\n        // This is handled by resolveFeedback\n        return {\n          success: true,\n          action: 'Resolve review feedback',\n          description: 'Handled by feedback resolver',\n          error: null,\n          changes: null,\n          commitSha: null,\n        };\n      default:\n        return {\n          success: false,\n          action: `Resolve ${blocker.type}`,\n          description: blocker.description,\n          error: `Cannot auto-resolve blocker type: ${blocker.type}`,\n          changes: null,\n          commitSha: null,\n        };\n    }\n  }\n\n  private async fixCIFailure(\n    github: GitHubClient,\n    prNumber: number,\n    blocker: Blocker\n  ): Promise<ActionResult> {\n    try {\n      // Get failure details\n      const ciUrl = blocker.url;\n      if (!ciUrl) {\n        return {\n          success: false,\n          action: 'Fix CI failure',\n          description: blocker.description,\n          error: 'No CI URL available to analyze',\n          changes: null,\n          commitSha: null,\n        };\n      }\n\n      // Use AI to analyze the failure and generate a fix\n      const { text: analysis } = await generateText({\n        model: this.model,\n        prompt: `Analyze this CI failure and suggest a fix.\n\nCI Failure: ${blocker.description}\nURL: ${ciUrl}\n\nBased on common CI failure patterns, what is likely wrong and how should it be fixed?\nBe specific about which files to change and what changes to make.`,\n      });\n\n      // For now, we'll report the analysis rather than auto-applying\n      // Full implementation would use bash/textEditor tools to apply fixes\n      await github.postComment(\n        prNumber,\n        `## CI Failure Analysis\\n\\n${analysis}\\n\\n_Auto-generated by ai-triage_`\n      );\n\n      return {\n        success: true,\n        action: 'Analyze CI failure',\n        description: `Posted analysis for: ${blocker.description}`,\n        error: null,\n        changes: null,\n        commitSha: null,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        action: 'Fix CI failure',\n        description: blocker.description,\n        error: error instanceof Error ? error.message : String(error),\n        changes: null,\n        commitSha: null,\n      };\n    }\n  }\n\n  // ==========================================================================\n  // Feedback Resolution\n  // ==========================================================================\n\n  private async resolveFeedbackItem(\n    github: GitHubClient,\n    prNumber: number,\n    feedback: FeedbackItem,\n    context: { prTitle: string }\n  ): Promise<ActionResult> {\n    try {\n      // Check if there's a suggestion block we can apply directly\n      if (feedback.suggestedAction && feedback.path) {\n        return this.applySuggestion(github, prNumber, feedback);\n      }\n\n      // Generate a response (fix or justification)\n      const response = await this.generateResponse(feedback, context);\n\n      if (response.type === 'fix' && feedback.path) {\n        // Apply the fix to the file\n        return this.applyFix(github, prNumber, feedback, response.content);\n      } else {\n        // Post a justification comment\n        return this.postJustification(github, prNumber, feedback, response.content);\n      }\n    } catch (error) {\n      return {\n        success: false,\n        action: `Address feedback ${feedback.id}`,\n        description: feedback.body.slice(0, 100),\n        error: error instanceof Error ? error.message : String(error),\n        changes: null,\n        commitSha: null,\n      };\n    }\n  }\n\n  private async applySuggestion(\n    _github: GitHubClient,\n    _prNumber: number,\n    feedback: FeedbackItem\n  ): Promise<ActionResult> {\n    if (!feedback.path || !feedback.suggestedAction) {\n      return {\n        success: false,\n        action: 'Apply suggestion',\n        description: 'Missing path or suggestion',\n        error: 'Cannot apply suggestion without file path and content',\n        changes: null,\n        commitSha: null,\n      };\n    }\n\n    const filePath = `${this.config.workingDirectory}/${feedback.path}`;\n\n    if (!existsSync(filePath)) {\n      return {\n        success: false,\n        action: 'Apply suggestion',\n        description: `File not found: ${feedback.path}`,\n        error: 'Target file does not exist',\n        changes: null,\n        commitSha: null,\n      };\n    }\n\n    if (this.config.dryRun) {\n      return {\n        success: true,\n        action: 'Apply suggestion (dry run)',\n        description: `Would apply suggestion to ${feedback.path}`,\n        error: null,\n        changes: [{ file: feedback.path, type: 'modified' }],\n        commitSha: null,\n      };\n    }\n\n    // Read file, apply suggestion, write back\n    // This is simplified - full implementation would handle line-specific changes\n    // Apply the suggestion by replacing the file content with the suggestedAction\n    const newContent = feedback.suggestedAction;\n\n    await writeFile(filePath, newContent, 'utf-8');\n\n    return {\n      success: true,\n      action: 'Apply suggestion',\n      description: `Applied suggestion to ${feedback.path}`,\n      error: null,\n      changes: [{ file: feedback.path, type: 'modified' }],\n      commitSha: null,\n    };\n  }\n\n  private async generateResponse(\n    feedback: FeedbackItem,\n    context: { prTitle: string }\n  ): Promise<{ type: 'fix' | 'justification'; content: string }> {\n    const { text } = await generateText({\n      model: this.model,\n      prompt: `Determine how to respond to this PR feedback.\n\nPR: ${context.prTitle}\n\nFeedback from ${feedback.author} (${feedback.severity} severity):\n${feedback.body}\n\n${feedback.path ? `File: ${feedback.path}` : ''}\n\nShould this be fixed or justified? If fixed, what's the fix? If justified, what's the reasoning?\n\nRespond in this format:\nTYPE: fix OR justification\nCONTENT: <the fix code or justification text>`,\n    });\n\n    const typeMatch = text.match(/TYPE:\\s*(fix|justification)/i);\n    const contentMatch = text.match(/CONTENT:\\s*([\\s\\S]+)/i);\n\n    return {\n      type: (typeMatch?.[1]?.toLowerCase() as 'fix' | 'justification') ?? 'justification',\n      content: contentMatch?.[1]?.trim() ?? text,\n    };\n  }\n\n  private async applyFix(\n    github: GitHubClient,\n    prNumber: number,\n    feedback: FeedbackItem,\n    fix: string\n  ): Promise<ActionResult> {\n    if (!feedback.path) {\n      return {\n        success: false,\n        action: 'Apply fix',\n        description: 'No file path for fix',\n        error: 'Cannot apply fix without target file',\n        changes: null,\n        commitSha: null,\n      };\n    }\n\n    if (this.config.dryRun) {\n      return {\n        success: true,\n        action: 'Apply fix (dry run)',\n        description: `Would apply fix to ${feedback.path}`,\n        error: null,\n        changes: [{ file: feedback.path, type: 'modified' }],\n        commitSha: null,\n      };\n    }\n\n    // Apply the fix - post as comment for human review\n    try {\n      // For now, post the fix as a comment for human review\n      await github.postComment(\n        prNumber,\n        `## Suggested Fix for ${feedback.path}\\n\\n\\`\\`\\`\\n${fix}\\n\\`\\`\\`\\n\\n_Responding to feedback from ${feedback.author}_`\n      );\n\n      return {\n        success: true,\n        action: 'Suggest fix',\n        description: `Posted fix suggestion for ${feedback.path}`,\n        error: null,\n        changes: null,\n        commitSha: null,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        action: 'Apply fix',\n        description: `Failed to apply fix to ${feedback.path}`,\n        error: error instanceof Error ? error.message : String(error),\n        changes: null,\n        commitSha: null,\n      };\n    }\n  }\n\n  private async postJustification(\n    github: GitHubClient,\n    prNumber: number,\n    feedback: FeedbackItem,\n    justification: string\n  ): Promise<ActionResult> {\n    try {\n      // Extract comment ID if possible\n      const commentIdMatch = feedback.id.match(/comment-(\\d+)/);\n      const commentId = commentIdMatch?.[1];\n      if (commentId) {\n        await github.replyToComment(prNumber, Number.parseInt(commentId, 10), justification);\n      } else {\n        await github.postComment(prNumber, `Re: ${feedback.author}'s feedback\\n\\n${justification}`);\n      }\n\n      return {\n        success: true,\n        action: 'Post justification',\n        description: `Responded to ${feedback.author}'s feedback`,\n        error: null,\n        changes: null,\n        commitSha: null,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        action: 'Post justification',\n        description: `Failed to respond to ${feedback.author}`,\n        error: error instanceof Error ? error.message : String(error),\n        changes: null,\n        commitSha: null,\n      };\n    }\n  }\n\n  // ==========================================================================\n  // Git Operations\n  // ==========================================================================\n\n  async commitAndPush(message: string): Promise<ActionResult> {\n    if (this.config.dryRun) {\n      return {\n        success: true,\n        action: 'Commit and push (dry run)',\n        description: `Would commit: ${message}`,\n        error: null,\n        changes: null,\n        commitSha: null,\n      };\n    }\n\n    try {\n      // Use simple-git for safe git operations (no shell injection)\n      await this.git.add('-A');\n      await this.git.commit(message);\n      const commitSha = await this.git.revparse(['HEAD']);\n      await this.git.push();\n\n      return {\n        success: true,\n        action: 'Commit and push',\n        description: message,\n        error: null,\n        changes: null,\n        commitSha: commitSha.trim(),\n      };\n    } catch (error) {\n      return {\n        success: false,\n        action: 'Commit and push',\n        description: message,\n        error: error instanceof Error ? error.message : String(error),\n        changes: null,\n        commitSha: null,\n      };\n    }\n  }\n\n  /**\n   * Get current git status\n   */\n  async getStatus(): Promise<{ modified: string[]; staged: string[]; untracked: string[] }> {\n    const status = await this.git.status();\n    return {\n      modified: status.modified,\n      staged: status.staged,\n      untracked: status.not_added,\n    };\n  }\n\n  /**\n   * Get diff for files\n   */\n  async getDiff(staged = false): Promise<string> {\n    if (staged) {\n      return this.git.diff(['--cached']);\n    }\n    return this.git.diff();\n  }\n}\n","import { GitHubClient, type GitHubConfig } from '../github/client.js';\nimport { Analyzer } from './analyzer.js';\nimport { Resolver, type ResolverConfig } from './resolver.js';\nimport type { ActionResult, ResolutionPlan, TriageResult } from './types.js';\n\nexport interface TriageConfig {\n  github: GitHubConfig;\n  resolver: ResolverConfig;\n}\n\nexport class Triage {\n  private github: GitHubClient;\n  private analyzer: Analyzer;\n  private resolver: Resolver;\n\n  constructor(config: TriageConfig) {\n    this.github = new GitHubClient(config.github);\n    this.analyzer = new Analyzer();\n    this.resolver = new Resolver(config.resolver);\n  }\n\n  // ==========================================================================\n  // Analysis\n  // ==========================================================================\n\n  /**\n   * Analyze a PR and return its current triage status\n   */\n  async analyze(prNumber: number): Promise<TriageResult> {\n    return this.analyzer.analyzePR(this.github, prNumber);\n  }\n\n  // ==========================================================================\n  // Resolution\n  // ==========================================================================\n\n  /**\n   * Resolve all auto-resolvable blockers and feedback\n   */\n  async resolve(prNumber: number): Promise<{\n    triage: TriageResult;\n    actions: ActionResult[];\n  }> {\n    const triage = await this.analyze(prNumber);\n    const actions: ActionResult[] = [];\n\n    // Resolve blockers first\n    const blockerResults = await this.resolver.resolveBlockers(this.github, triage);\n    actions.push(...blockerResults);\n\n    // Then resolve feedback\n    const feedbackResults = await this.resolver.resolveFeedback(this.github, triage);\n    actions.push(...feedbackResults);\n\n    // Re-analyze after resolution\n    const updatedTriage = await this.analyze(prNumber);\n\n    return {\n      triage: updatedTriage,\n      actions,\n    };\n  }\n\n  /**\n   * Generate a plan for resolving all issues without executing\n   */\n  async plan(prNumber: number): Promise<ResolutionPlan> {\n    const triage = await this.analyze(prNumber);\n    const steps: ResolutionPlan['steps'] = [];\n    let order = 1;\n\n    // CI failures first\n    for (const blocker of triage.blockers.filter((b) => b.type === 'ci_failure')) {\n      steps.push({\n        order: order++,\n        action: 'Fix CI failure',\n        description: blocker.description,\n        automated: blocker.isAutoResolvable,\n        estimatedDuration: '5-10 minutes',\n        dependencies: [],\n      });\n    }\n\n    // Then feedback\n    const feedbackStep = order;\n    const unaddressed = triage.feedback.items.filter((f) => f.status === 'unaddressed');\n    if (unaddressed.length > 0) {\n      steps.push({\n        order: order++,\n        action: 'Address feedback',\n        description: `${unaddressed.length} feedback items to address`,\n        automated: unaddressed.every((f) => f.isAutoResolvable),\n        estimatedDuration: `${unaddressed.length * 2}-${unaddressed.length * 5} minutes`,\n        dependencies: steps.filter((s) => s.action === 'Fix CI failure').map((s) => s.order),\n      });\n    }\n\n    // Request re-review if needed\n    if (steps.length > 0) {\n      steps.push({\n        order: order++,\n        action: 'Request re-review',\n        description: 'Request AI reviewers to re-review changes',\n        automated: true,\n        estimatedDuration: '1-5 minutes',\n        dependencies: [feedbackStep],\n      });\n    }\n\n    // Wait for CI\n    steps.push({\n      order: order++,\n      action: 'Wait for CI',\n      description: 'Wait for all CI checks to complete',\n      automated: true,\n      estimatedDuration: '5-15 minutes',\n      dependencies: steps.map((s) => s.order),\n    });\n\n    // Final merge\n    steps.push({\n      order: order++,\n      action: 'Merge PR',\n      description: 'Merge the PR once all checks pass',\n      automated: false, // Requires explicit approval\n      estimatedDuration: '1 minute',\n      dependencies: [order - 1],\n    });\n\n    const hasHumanStep = steps.some((s) => !s.automated);\n\n    return {\n      prNumber,\n      steps,\n      estimatedTotalDuration: '15-30 minutes',\n      requiresHumanIntervention: hasHumanStep,\n      humanInterventionReason: hasHumanStep ? 'Some steps require manual review or approval' : null,\n    };\n  }\n\n  // ==========================================================================\n  // Workflows\n  // ==========================================================================\n\n  /**\n   * Run the full workflow until PR is ready to merge\n   */\n  async runUntilReady(\n    prNumber: number,\n    options: {\n      maxIterations?: number;\n      onProgress?: (triage: TriageResult, iteration: number) => void;\n    } = {}\n  ): Promise<{\n    success: boolean;\n    finalTriage: TriageResult;\n    iterations: number;\n    allActions: ActionResult[];\n  }> {\n    const maxIterations = options.maxIterations ?? 10;\n    const allActions: ActionResult[] = [];\n    let iteration = 0;\n\n    while (iteration < maxIterations) {\n      iteration++;\n\n      const triage = await this.analyze(prNumber);\n      options.onProgress?.(triage, iteration);\n\n      if (triage.status === 'ready_to_merge') {\n        return {\n          success: true,\n          finalTriage: triage,\n          iterations: iteration,\n          allActions,\n        };\n      }\n\n      if (triage.status === 'blocked') {\n        return {\n          success: false,\n          finalTriage: triage,\n          iterations: iteration,\n          allActions,\n        };\n      }\n\n      if (triage.status === 'needs_ci') {\n        // Wait for CI to complete\n        await this.waitForCI(prNumber);\n        continue;\n      }\n\n      // Resolve what we can\n      const { actions } = await this.resolve(prNumber);\n      allActions.push(...actions);\n\n      // If no actions were successful, we're stuck\n      const successfulActions = actions.filter((a) => a.success);\n      if (successfulActions.length === 0) {\n        return {\n          success: false,\n          finalTriage: triage,\n          iterations: iteration,\n          allActions,\n        };\n      }\n\n      // Commit any changes\n      const hasChanges = actions.some((a) => a.changes && a.changes.length > 0);\n      if (hasChanges) {\n        await this.resolver.commitAndPush(`fix: address feedback (iteration ${iteration})`);\n      }\n\n      // Small delay before next iteration\n      await new Promise((resolve) => setTimeout(resolve, 5000));\n    }\n\n    const finalTriage = await this.analyze(prNumber);\n    return {\n      success: finalTriage.status === 'ready_to_merge',\n      finalTriage,\n      iterations: iteration,\n      allActions,\n    };\n  }\n\n  private async waitForCI(prNumber: number, timeoutMs = 600000): Promise<void> {\n    const startTime = Date.now();\n    const pollInterval = 30000; // 30 seconds\n\n    while (Date.now() - startTime < timeoutMs) {\n      const ci = await this.github.getCIStatus(prNumber);\n      if (!ci.anyPending) {\n        return;\n      }\n      await new Promise((resolve) => setTimeout(resolve, pollInterval));\n    }\n\n    throw new Error('CI timeout exceeded');\n  }\n\n  // ==========================================================================\n  // Review Requests\n  // ==========================================================================\n\n  async requestReviews(prNumber: number): Promise<void> {\n    // Post review request commands as comments\n    const reviewCommands = ['/gemini review', '/q review'];\n    for (const command of reviewCommands) {\n      await this.github.postComment(prNumber, command);\n    }\n  }\n\n  // ==========================================================================\n  // Reporting\n  // ==========================================================================\n\n  formatTriageReport(triage: TriageResult): string {\n    const lines: string[] = [];\n\n    lines.push(`# Triage Report: PR #${triage.prNumber}`);\n    lines.push('');\n    lines.push(`**Title:** ${triage.prTitle}`);\n    lines.push(`**Status:** ${triage.status}`);\n    lines.push(`**URL:** ${triage.prUrl}`);\n    lines.push('');\n\n    lines.push('## CI Status');\n    lines.push(triage.ci.allPassing ? ' All checks passing' : '');\n    lines.push(triage.ci.anyPending ? ' Checks pending' : '');\n    if (triage.ci.failures.length > 0) {\n      lines.push(` ${triage.ci.failures.length} failing checks:`);\n      for (const failure of triage.ci.failures) {\n        lines.push(`  - ${failure.name}: ${failure.url}`);\n      }\n    }\n    lines.push('');\n\n    lines.push('## Feedback');\n    lines.push(`Total: ${triage.feedback.total} | Unaddressed: ${triage.feedback.unaddressed}`);\n    if (triage.feedback.unaddressed > 0) {\n      lines.push('');\n      lines.push('### Unaddressed Items:');\n      for (const item of triage.feedback.items.filter((f) => f.status === 'unaddressed')) {\n        lines.push(`- **${item.severity}** from ${item.author}: ${item.body.slice(0, 100)}...`);\n        if (item.isAutoResolvable) {\n          lines.push(`  -  Auto-resolvable`);\n        }\n      }\n    }\n    lines.push('');\n\n    lines.push('## Blockers');\n    if (triage.blockers.length === 0) {\n      lines.push('None');\n    } else {\n      for (const blocker of triage.blockers) {\n        lines.push(`- **${blocker.type}**: ${blocker.description}`);\n        lines.push(`  - Auto-resolvable: ${blocker.isAutoResolvable ? 'Yes' : 'No'}`);\n      }\n    }\n    lines.push('');\n\n    lines.push('## Next Actions');\n    for (const action of triage.nextActions) {\n      const icon = action.automated ? '' : '';\n      lines.push(`${icon} [${action.priority}] ${action.action}`);\n    }\n    lines.push('');\n\n    lines.push('## Summary');\n    lines.push(triage.summary);\n    lines.push('');\n\n    lines.push(`_Generated: ${triage.timestamp}_`);\n\n    return lines.join('\\n');\n  }\n}\n","import { z } from 'zod';\n\n// ============================================================================\n// Core Triage Types\n// ============================================================================\n\n/**\n * Severity levels for feedback items.\n * Used to prioritize which feedback needs immediate attention.\n *\n * @remarks\n * - `critical` - Must be addressed before merge, blocks deployment\n * - `high` - Should be addressed before merge\n * - `medium` - Should be addressed, but not blocking\n * - `low` - Nice to have improvements\n * - `info` - Informational comments, no action required\n */\nexport const FeedbackSeveritySchema = z.enum(['critical', 'high', 'medium', 'low', 'info']);\n\n/** Severity level for feedback items */\nexport type FeedbackSeverity = z.infer<typeof FeedbackSeveritySchema>;\n\n/**\n * Status of a feedback item indicating whether it has been addressed.\n *\n * @remarks\n * - `unaddressed` - Feedback has not been addressed yet\n * - `addressed` - Feedback has been addressed with code changes\n * - `dismissed` - Feedback was reviewed and dismissed as not applicable\n * - `wont_fix` - Feedback acknowledged but won't be fixed in this PR\n */\nexport const FeedbackStatusSchema = z.enum(['unaddressed', 'addressed', 'dismissed', 'wont_fix']);\n\n/** Status of a feedback item */\nexport type FeedbackStatus = z.infer<typeof FeedbackStatusSchema>;\n\n/**\n * Types of blockers that can prevent a PR from being merged.\n *\n * @remarks\n * - `ci_failure` - One or more CI checks have failed\n * - `review_feedback` - Unaddressed review comments\n * - `merge_conflict` - Branch has conflicts with base branch\n * - `missing_approval` - Required approvals not yet received\n * - `branch_protection` - Branch protection rules not satisfied\n * - `stale_branch` - Branch is significantly behind base branch\n */\nexport const BlockerTypeSchema = z.enum([\n  'ci_failure',\n  'review_feedback',\n  'merge_conflict',\n  'missing_approval',\n  'branch_protection',\n  'stale_branch',\n]);\n\n/** Type of blocker preventing PR merge */\nexport type BlockerType = z.infer<typeof BlockerTypeSchema>;\n\n/**\n * Overall status of a pull request in the triage workflow.\n *\n * @remarks\n * - `needs_work` - Has unaddressed blockers requiring code changes\n * - `needs_review` - Waiting for AI or human review\n * - `needs_ci` - Waiting for CI checks to complete\n * - `ready_to_merge` - All checks pass, feedback addressed, ready to merge\n * - `blocked` - Cannot proceed without human intervention\n * - `merged` - PR has been merged\n * - `closed` - PR was closed without merging\n */\nexport const PRStatusSchema = z.enum([\n  'needs_work',\n  'needs_review',\n  'needs_ci',\n  'ready_to_merge',\n  'blocked',\n  'merged',\n  'closed',\n]);\n\n/** Overall status of a pull request */\nexport type PRStatus = z.infer<typeof PRStatusSchema>;\n\n// ============================================================================\n// Feedback Item\n// ============================================================================\n\n/**\n * Schema for a feedback item from a PR review.\n * Represents a single comment or suggestion from a reviewer.\n */\nexport const FeedbackItemSchema = z.object({\n  /** Unique identifier for the feedback item */\n  id: z.string(),\n  /** GitHub username of the reviewer */\n  author: z.string(),\n  /** Content of the feedback comment */\n  body: z.string(),\n  /** File path the feedback relates to, if any */\n  path: z.string().nullable(),\n  /** Line number in the file, if applicable */\n  line: z.number().nullable(),\n  /** Severity level of the feedback */\n  severity: FeedbackSeveritySchema,\n  /** Current status of the feedback */\n  status: FeedbackStatusSchema,\n  /** ISO timestamp when the feedback was created */\n  createdAt: z.string(),\n  /** URL to the feedback comment on GitHub */\n  url: z.string(),\n  /** Whether AI can automatically resolve this feedback */\n  isAutoResolvable: z.boolean(),\n  /** AI-suggested action to address the feedback */\n  suggestedAction: z.string().nullable(),\n  /** Description of how the feedback was resolved */\n  resolution: z.string().nullable(),\n});\n\n/**\n * A feedback item from a PR review.\n * Contains the review comment details, severity, status, and AI analysis.\n */\nexport type FeedbackItem = z.infer<typeof FeedbackItemSchema>;\n\n// ============================================================================\n// Blocker\n// ============================================================================\n\n/**\n * Schema for a blocker preventing PR merge.\n * Represents an issue that must be resolved before the PR can be merged.\n */\nexport const BlockerSchema = z.object({\n  /** Type of blocker */\n  type: BlockerTypeSchema,\n  /** Human-readable description of the blocker */\n  description: z.string(),\n  /** Whether AI can automatically resolve this blocker */\n  isAutoResolvable: z.boolean(),\n  /** Suggested fix for the blocker, if available */\n  suggestedFix: z.string().nullable(),\n  /** URL with more information about the blocker */\n  url: z.string().nullable(),\n  /** Whether the blocker has been resolved */\n  resolved: z.boolean(),\n});\n\n/**\n * A blocker preventing PR merge.\n * Includes the blocker type, description, and resolution status.\n */\nexport type Blocker = z.infer<typeof BlockerSchema>;\n\n// ============================================================================\n// CI Status\n// ============================================================================\n\n/**\n * Schema for a single CI check result.\n */\nexport const CICheckSchema = z.object({\n  /** Name of the CI check */\n  name: z.string(),\n  /** Current status of the check */\n  status: z.enum(['pending', 'in_progress', 'success', 'failure', 'skipped']),\n  /** Final conclusion of the check, if completed */\n  conclusion: z.string().nullable(),\n  /** URL to the CI check details */\n  url: z.string(),\n  /** ISO timestamp when the check started */\n  startedAt: z.string().nullable(),\n  /** ISO timestamp when the check completed */\n  completedAt: z.string().nullable(),\n});\n\n/**\n * A single CI check result.\n * Contains the check name, status, and timing information.\n */\nexport type CICheck = z.infer<typeof CICheckSchema>;\n\n/**\n * Schema for the overall CI status of a PR.\n */\nexport const CIStatusSchema = z.object({\n  /** Whether all CI checks are passing */\n  allPassing: z.boolean(),\n  /** Whether any CI checks are still pending */\n  anyPending: z.boolean(),\n  /** List of all CI checks */\n  checks: z.array(CICheckSchema),\n  /** List of failed CI checks */\n  failures: z.array(CICheckSchema),\n});\n\n/**\n * Overall CI status for a pull request.\n * Aggregates all CI check results with convenience flags.\n */\nexport type CIStatus = z.infer<typeof CIStatusSchema>;\n\n// ============================================================================\n// Triage Result\n// ============================================================================\n\n/**\n * Schema for the complete triage result of a PR.\n * This is the main output of the triage process.\n */\nexport const TriageResultSchema = z.object({\n  /** PR number */\n  prNumber: z.number(),\n  /** URL to the PR on GitHub */\n  prUrl: z.string(),\n  /** Title of the PR */\n  prTitle: z.string(),\n  /** Overall status of the PR */\n  status: PRStatusSchema,\n  /** CI check status */\n  ci: CIStatusSchema,\n  /** Feedback summary and items */\n  feedback: z.object({\n    /** Total number of feedback items */\n    total: z.number(),\n    /** Number of unaddressed feedback items */\n    unaddressed: z.number(),\n    /** List of all feedback items */\n    items: z.array(FeedbackItemSchema),\n  }),\n  /** List of blockers preventing merge */\n  blockers: z.array(BlockerSchema),\n  /** Recommended next actions */\n  nextActions: z.array(\n    z.object({\n      /** Action to take */\n      action: z.string(),\n      /** Priority of the action */\n      priority: FeedbackSeveritySchema,\n      /** Whether the action can be automated */\n      automated: z.boolean(),\n      /** Reason for the recommended action */\n      reason: z.string(),\n    })\n  ),\n  /** Human-readable summary of the triage result */\n  summary: z.string(),\n  /** ISO timestamp when the triage was performed */\n  timestamp: z.string(),\n});\n\n/**\n * Complete triage result for a pull request.\n * Contains PR status, CI results, feedback, blockers, and recommended actions.\n */\nexport type TriageResult = z.infer<typeof TriageResultSchema>;\n\n// ============================================================================\n// Action Result\n// ============================================================================\n\n/**\n * Schema for the result of an automated action.\n */\nexport const ActionResultSchema = z.object({\n  /** Whether the action succeeded */\n  success: z.boolean(),\n  /** Name of the action that was taken */\n  action: z.string(),\n  /** Description of what was done */\n  description: z.string(),\n  /** Error message if the action failed */\n  error: z.string().nullable(),\n  /** List of file changes made by the action */\n  changes: z\n    .array(\n      z.object({\n        /** Path to the changed file */\n        file: z.string(),\n        /** Type of change */\n        type: z.enum(['created', 'modified', 'deleted']),\n      })\n    )\n    .nullable(),\n  /** Git commit SHA if changes were committed */\n  commitSha: z.string().nullable(),\n});\n\n/**\n * Result of an automated action.\n * Contains success status, description, and any file changes made.\n */\nexport type ActionResult = z.infer<typeof ActionResultSchema>;\n\n// ============================================================================\n// Resolution Plan\n// ============================================================================\n\n/**\n * Schema for a resolution plan to address PR blockers.\n */\nexport const ResolutionPlanSchema = z.object({\n  /** PR number this plan is for */\n  prNumber: z.number(),\n  /** Ordered list of steps to resolve blockers */\n  steps: z.array(\n    z.object({\n      /** Order of this step (1-based) */\n      order: z.number(),\n      /** Action to take */\n      action: z.string(),\n      /** Detailed description of the step */\n      description: z.string(),\n      /** Whether this step can be automated */\n      automated: z.boolean(),\n      /** Estimated time to complete this step */\n      estimatedDuration: z.string(),\n      /** Step orders that must be completed before this step */\n      dependencies: z.array(z.number()),\n    })\n  ),\n  /** Estimated total time to complete the plan */\n  estimatedTotalDuration: z.string(),\n  /** Whether the plan requires human intervention */\n  requiresHumanIntervention: z.boolean(),\n  /** Reason human intervention is required, if applicable */\n  humanInterventionReason: z.string().nullable(),\n});\n\n/**\n * A plan to resolve PR blockers.\n * Contains ordered steps with dependencies and time estimates.\n */\nexport type ResolutionPlan = z.infer<typeof ResolutionPlanSchema>;\n"]}